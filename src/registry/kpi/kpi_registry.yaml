# KPI Registry - Finance Domain
# Contains all KPIs for financial analysis and monitoring
# Format follows the src.registry.models.kpi model structure
# MVP scope is limited to Finance KPIs only

# Defaults applied to KPIs at load time (by KPIProvider) to avoid per-KPI duplication
kpi_defaults:
  by_data_product_id:
    FI_Star_Schema:
      filters:
        Version: "Actual"
      dimensions:
        - name: "Version"
          field: "version"
          values: ["Actual", "Budget"]
          description: "Version dimension"

# List of KPIs
kpis:
  - id: gross_revenue
    name: "Gross Revenue"
    domain: "Finance"
    description: "Total gross revenue recognized in the period."
    unit: "$"
    data_product_id: "fi_star_schema"
    view_name: "FI_Star_View"
    business_process_ids:
      - "finance_revenue_growth_analysis"
      - "finance_profitability_analysis"
    filters:
      "Account Hierarchy Desc": "Gross Revenue"
    sql_query: SELECT SUM("Transaction Value Amount") FROM FI_Star_View
    thresholds:
      - comparison_type: "yoy"
        green_threshold: 0.10
        yellow_threshold: 0.0
        red_threshold: -0.05
        inverse_logic: false
      - comparison_type: "mom"
        green_threshold: 0.05
        yellow_threshold: 0.0
        red_threshold: -0.03
        inverse_logic: false
      - comparison_type: "qoq"
        green_threshold: 0.05
        yellow_threshold: 0.0
        red_threshold: -0.03
        inverse_logic: false
    dimensions:
      - name: "Profit Center"
        field: "profit_center"
        description: "Business profit center"
    tags:
      - "revenue"
      - "top_line"
      - "financial"
    synonyms:
      - "Revenue"
      - "Sales"
    owner_role: "CFO"
    stakeholder_roles:
      - "CFO"
      - "Finance Manager"
      - "CEO"
    metadata:
      line: "top_line"
      altitude: "strategic"
      profit_driver_type: "revenue"
      lens_affinity: "mckinsey,bcg"

  - id: cost_of_goods_sold
    name: "Cost of Goods Sold"
    domain: "Finance"
    description: "Total cost of goods sold in the period."
    unit: "$"
    data_product_id: "fi_star_schema"
    view_name: "FI_Star_View"
    business_process_ids:
      - "finance_profitability_analysis"
      - "finance_expense_management"
    filters:
      "Account Hierarchy Desc": "Cost of Goods Sold"
    sql_query: SELECT SUM("Transaction Value Amount") FROM FI_Star_View
    thresholds:
      - comparison_type: "mom"
        green_threshold: -0.05
        yellow_threshold: 0.0
        red_threshold: 0.10
        inverse_logic: true
      - comparison_type: "qoq"
        green_threshold: -0.05
        yellow_threshold: 0.0
        red_threshold: 0.10
        inverse_logic: true
      - comparison_type: "budget"
        green_threshold: -0.05
        yellow_threshold: 0.0
        red_threshold: 0.10
        inverse_logic: true
    dimensions:
      - name: "Profit Center"
        field: "profit_center"
        description: "Business profit center"
    tags:
      - "cogs"
      - "cost"
      - "financial"
    synonyms:
      - "COGS"
      - "Cost of Sales"
    owner_role: "CFO"
    stakeholder_roles:
      - "CFO"
      - "Finance Manager"
    metadata:
      line: "bottom_line"
      altitude: "operational"
      profit_driver_type: "cost"
      lens_affinity: "bcg,bain"

  - id: gross_margin
    name: "Gross Margin"
    domain: "Finance"
    description: "Gross Margin is calculated as Net Revenue (Gross Revenue - Sales Deductions) minus Cost of Goods Sold."
    unit: "%"
    data_product_id: "fi_star_schema"
    view_name: "FI_Star_View"
    business_process_ids:
      - "finance_profitability_analysis"
      - "finance_revenue_growth_analysis"
    filters:
      "Account Hierarchy Desc":
        - "Gross Revenue"
        - "Cost of Goods Sold"
        - "Sales Deductions"
    sql_query: |
      SELECT SUM(
        CASE 
          WHEN "Account Hierarchy Desc" = 'Cost of Goods Sold' THEN -1 * "Transaction Value Amount" 
          ELSE "Transaction Value Amount" 
        END
      ) FROM FI_Star_View
    thresholds:
      - comparison_type: "yoy"
        green_threshold: 0.10
        yellow_threshold: 0.0
        red_threshold: -0.05
        inverse_logic: false
      - comparison_type: "qoq"
        green_threshold: 0.10
        yellow_threshold: 0.0
        red_threshold: -0.05
        inverse_logic: false
      - comparison_type: "budget"
        green_threshold: 0.0
        yellow_threshold: -0.05
        red_threshold: -0.10
        inverse_logic: false
    dimensions:
      - name: "Profit Center"
        field: "profit_center"
        description: "Business profit center"
    tags:
      - "margin"
      - "profitability"
      - "financial"
    synonyms:
      - "Margin"
      - "Gross Profit"
    owner_role: "CFO"
    stakeholder_roles:
      - "CFO"
      - "Finance Manager"
      - "CEO"
    metadata:
      line: "bottom_line"
      altitude: "strategic"
      profit_driver_type: "margin"
      lens_affinity: "mckinsey,bcg"

  - id: utilities_expense
    name: "Utilities Expense"
    domain: "Finance"
    description: "Total utilities expense."
    unit: "$"
    data_product_id: "fi_star_schema"
    view_name: "FI_Star_View"
    business_process_ids:
      - "finance_expense_management"
      - "finance_budget_vs_actuals"
    filters:
      "Account Hierarchy Desc": "Utilities"
    sql_query: SELECT SUM("Transaction Value Amount") FROM FI_Star_View
    thresholds:
      - comparison_type: "mom"
        green_threshold: -0.05
        yellow_threshold: 0.0
        red_threshold: 0.10
        inverse_logic: true
      - comparison_type: "qoq"
        green_threshold: -0.05
        yellow_threshold: 0.0
        red_threshold: 0.10
        inverse_logic: true
      - comparison_type: "budget"
        green_threshold: -0.05
        yellow_threshold: 0.0
        red_threshold: 0.10
        inverse_logic: true
    dimensions:
      - name: "Profit Center"
        field: "profit_center"
        description: "Business profit center"
    tags:
      - "expense"
      - "utilities"
      - "financial"
    owner_role: "Finance Manager"
    stakeholder_roles:
      - "Finance Manager"
      - "COO"
    metadata:
      line: "bottom_line"
      altitude: "operational"
      profit_driver_type: "expense"
      lens_affinity: "bcg,bain"

  - id: office_expense
    name: "Office Expense"
    domain: "Finance"
    description: "Total office expense."
    unit: "$"
    data_product_id: "fi_star_schema"
    view_name: "FI_Star_View"
    business_process_ids:
      - "finance_expense_management"
      - "finance_budget_vs_actuals"
    filters:
      "Account Hierarchy Desc": "Office"
    sql_query: SELECT SUM("Transaction Value Amount") FROM FI_Star_View
    thresholds:
      - comparison_type: "mom"
        green_threshold: -0.05
        yellow_threshold: 0.0
        red_threshold: 0.10
        inverse_logic: true
      - comparison_type: "qoq"
        green_threshold: -0.05
        yellow_threshold: 0.0
        red_threshold: 0.10
        inverse_logic: true
      - comparison_type: "budget"
        green_threshold: -0.05
        yellow_threshold: 0.0
        red_threshold: 0.10
        inverse_logic: true
    dimensions:
      - name: "Profit Center"
        field: "profit_center"
        description: "Business profit center"
    tags:
      - "expense"
      - "office"
      - "financial"
    owner_role: "Finance Manager"
    stakeholder_roles:
      - "Finance Manager"
      - "COO"
    metadata:
      line: "bottom_line"
      altitude: "operational"
      profit_driver_type: "expense"
      lens_affinity: "bcg,bain"

  - id: payroll
    name: "Payroll"
    domain: "Finance"
    description: "Total payroll expense."
    unit: "$"
    data_product_id: "fi_star_schema"
    view_name: "FI_Star_View"
    business_process_ids:
      - "finance_expense_management"
      - "finance_budget_vs_actuals"
    filters:
      "Account Hierarchy Desc": "Payroll"
    sql_query: SELECT SUM("Transaction Value Amount") FROM FI_Star_View
    thresholds:
      - comparison_type: "mom"
        green_threshold: -0.05
        yellow_threshold: 0.0
        red_threshold: 0.10
        inverse_logic: true
      - comparison_type: "qoq"
        green_threshold: -0.05
        yellow_threshold: 0.0
        red_threshold: 0.10
        inverse_logic: true
      - comparison_type: "budget"
        green_threshold: -0.05
        yellow_threshold: 0.0
        red_threshold: 0.10
        inverse_logic: true
    dimensions:
      - name: "Profit Center"
        field: "profit_center"
        description: "Business profit center"
    tags:
      - "expense"
      - "payroll"
      - "financial"
      - "hr"
    owner_role: "Finance Manager"
    stakeholder_roles:
      - "Finance Manager"
      - "CHRO"
    metadata:
      line: "bottom_line"
      altitude: "operational"
      profit_driver_type: "expense"
      lens_affinity: "bcg,bain"


  - id: sales_deductions
    name: "Sales Deductions"
    domain: "Finance"
    description: "Total sales deductions in the period."
    unit: "$"
    data_product_id: "fi_star_schema"
    view_name: "FI_Star_View"
    business_process_ids:
      - "finance_profitability_analysis"
      - "finance_revenue_growth_analysis"
    filters:
      "Account Hierarchy Desc": "Sales Deductions"
    sql_query: SELECT SUM("Transaction Value Amount") FROM FI_Star_View
    thresholds:
      - comparison_type: "yoy"
        green_threshold: 0.05
        yellow_threshold: 0.10
        red_threshold: 0.20
        inverse_logic: true
      - comparison_type: "mom"
        green_threshold: 0.05
        yellow_threshold: 0.10
        red_threshold: 0.20
        inverse_logic: true
    dimensions:
      - name: "Profit Center"
        field: "profit_center"
        description: "Business profit center"
    tags:
      - "deductions"
      - "revenue"
      - "financial"
    owner_role: "CFO"
    stakeholder_roles:
      - "CFO"
      - "Finance Manager"
      - "CEO"
    metadata:
      line: "top_line"
      altitude: "operational"
      profit_driver_type: "revenue"
      lens_affinity: "bcg,bain"

  - id: periodic_building_expense
    name: "Periodic Building Expense"
    domain: "Finance"
    description: "Total periodic building expense."
    unit: "$"
    data_product_id: "fi_star_schema"
    view_name: "FI_Star_View"
    business_process_ids:
      - "finance_expense_management"
      - "finance_facilities_management"
    filters:
      "Account Hierarchy Desc": "Periodic Building Expense"
    sql_query: SELECT SUM("Transaction Value Amount") FROM FI_Star_View
    thresholds:
      - comparison_type: "mom"
        green_threshold: -0.05
        yellow_threshold: 0.0
        red_threshold: 0.10
        inverse_logic: true
    dimensions:
      - name: "Profit Center"
        field: "profit_center"
        description: "Business profit center"
    tags:
      - "expense"
      - "facilities"
      - "financial"
    owner_role: "Finance Manager"
    stakeholder_roles:
      - "Finance Manager"
      - "COO"
    metadata:
      line: "bottom_line"
      altitude: "operational"
      profit_driver_type: "expense"
      lens_affinity: "bcg,bain"

  - id: travel
    name: "Travel"
    domain: "Finance"
    description: "Total travel expense."
    unit: "$"
    data_product_id: "fi_star_schema"
    view_name: "FI_Star_View"
    business_process_ids:
      - "finance_expense_management"
      - "finance_travel_management"
    filters:
      "Account Hierarchy Desc": "Travel"
    sql_query: SELECT SUM("Transaction Value Amount") FROM FI_Star_View
    thresholds:
      - comparison_type: "mom"
        green_threshold: -0.05
        yellow_threshold: 0.0
        red_threshold: 0.10
        inverse_logic: true
    dimensions:
      - name: "Profit Center"
        field: "profit_center"
        description: "Business profit center"
    tags:
      - "expense"
      - "travel"
      - "financial"
    owner_role: "Finance Manager"
    stakeholder_roles:
      - "Finance Manager"
    metadata:
      line: "bottom_line"
      altitude: "operational"
      profit_driver_type: "expense"
      lens_affinity: "bcg,bain"

  - id: employee_expense_other
    name: "Employee Expense Other"
    domain: "Finance"
    description: "Total employee expense (other)."
    unit: "$"
    data_product_id: "fi_star_schema"
    view_name: "FI_Star_View"
    business_process_ids:
      - "finance_expense_management"
      - "finance_employee_benefits"
    filters:
      "Account Hierarchy Desc": "Employee Expense Other"
    sql_query: SELECT SUM("Transaction Value Amount") FROM FI_Star_View
    thresholds:
      - comparison_type: "mom"
        green_threshold: -0.05
        yellow_threshold: 0.0
        red_threshold: 0.10
        inverse_logic: true
    dimensions:
      - name: "Profit Center"
        field: "profit_center"
        description: "Business profit center"
    tags:
      - "expense"
      - "hr"
      - "financial"
    owner_role: "Finance Manager"
    stakeholder_roles:
      - "Finance Manager"
      - "CHRO"
    metadata:
      line: "bottom_line"
      altitude: "operational"
      profit_driver_type: "expense"
      lens_affinity: "bcg,bain"

  - id: other_operating_expense
    name: "Other Operating Expense"
    domain: "Finance"
    description: "Total other operating expense."
    unit: "$"
    data_product_id: "fi_star_schema"
    view_name: "FI_Star_View"
    business_process_ids:
      - "finance_expense_management"
      - "finance_miscellaneous_expense"
    filters:
      "Account Hierarchy Desc": "Other Operating Expense"
    sql_query: SELECT SUM("Transaction Value Amount") FROM FI_Star_View
    thresholds:
      - comparison_type: "mom"
        green_threshold: -0.05
        yellow_threshold: 0.0
        red_threshold: 0.10
        inverse_logic: true
    dimensions:
      - name: "Profit Center"
        field: "profit_center"
        description: "Business profit center"
    tags:
      - "expense"
      - "financial"
    owner_role: "Finance Manager"
    stakeholder_roles:
      - "Finance Manager"
    metadata:
      line: "bottom_line"
      altitude: "operational"
      profit_driver_type: "expense"
      lens_affinity: "bcg,bain"

  - id: net_revenue
    name: "Net Revenue"
    domain: "Finance"
    description: "Total net revenue (Gross Revenue - Sales Deductions)."
    unit: "$"
    data_product_id: "fi_star_schema"
    view_name: "FI_Star_View"
    business_process_ids:
      - "finance_revenue_growth_analysis"
      - "finance_profitability_analysis"
    base_column: "Transaction Value Amount"
    filters:
      "Parent Account/Group Description": "Net Revenue"
    sql_query: SELECT SUM("Transaction Value Amount") FROM FI_Star_View
    thresholds:
      - comparison_type: "yoy"
        green_threshold: 0.10
        yellow_threshold: 0.0
        red_threshold: -0.05
        inverse_logic: false
    dimensions:
      - name: "Profit Center"
        field: "profit_center"
        description: "Business profit center"
    tags:
      - "revenue"
      - "financial"
    owner_role: "CFO"
    stakeholder_roles:
      - "CFO"
      - "CEO"
    metadata:
      line: "top_line"
      altitude: "strategic"
      profit_driver_type: "revenue"
      lens_affinity: "mckinsey,bcg,bain"

  - id: operating_income
    name: "Operating Income"
    domain: "Finance"
    description: "Operating Income."
    unit: "$"
    data_product_id: "fi_star_schema"
    view_name: "FI_Star_View"
    business_process_ids:
      - "finance_profitability_analysis"
    base_column: "Transaction Value Amount"
    # Composite filter: Captures all branches rolling up to Op Income (Net Rev branch + Op Exp branch + Gross Margin branch)
    filters:
      "Parent Account/Group Description": 
        - "Net Revenue"
        - "Gross Margin"
        - "Building Expense"
        - "Employee Expense"
        - "Operating Expense"
    sql_query: |
      SELECT SUM(
        CASE 
          WHEN "Parent Account/Group Description" IN ('Gross Margin', 'Building Expense', 'Employee Expense', 'Operating Expense') THEN -1 * "Transaction Value Amount" 
          ELSE "Transaction Value Amount" 
        END
      ) FROM FI_Star_View
    thresholds:
      - comparison_type: "yoy"
        green_threshold: 0.10
        yellow_threshold: 0.0
        red_threshold: -0.05
        inverse_logic: false
    dimensions:
      - name: "Profit Center"
        field: "profit_center"
        description: "Business profit center"
    tags:
      - "profitability"
      - "financial"
    owner_role: "CFO"
    stakeholder_roles:
      - "CFO"
      - "CEO"
    metadata:
      line: "bottom_line"
      altitude: "strategic"
      profit_driver_type: "profitability"
      lens_affinity: "mckinsey,bcg,bain"
  - id: operating_expense
    name: "Operating Expense"
    domain: "Finance"
    description: "Total Operating Expense."
    unit: "$"
    data_product_id: "fi_star_schema"
    view_name: "FI_Star_View"
    business_process_ids:
      - "finance_expense_management"
    base_column: "Transaction Value Amount"
    # Composite filter: Captures all branches rolling up to Op Expense
    filters:
      "Parent Account/Group Description": 
        - "Building Expense"
        - "Employee Expense"
        - "Operating Expense"
    thresholds:
      - comparison_type: "mom"
        green_threshold: -0.05
        yellow_threshold: 0.0
        red_threshold: 0.10
        inverse_logic: true
    dimensions:
      - name: "Profit Center"
        field: "profit_center"
        description: "Business profit center"
    tags:
      - "expense"
      - "financial"
    owner_role: "CFO"
    stakeholder_roles:
      - "CFO"
      - "Finance Manager"
    metadata:
      line: "bottom_line"
      altitude: "operational"
      profit_driver_type: "expense"
      lens_affinity: "bcg,bain"
  - id: building_expense
    name: "Building Expense"
    domain: "Finance"
    description: "Total Building Expense (includes Periodic & Utilities)."
    unit: "$"
    data_product_id: "fi_star_schema"
    view_name: "FI_Star_View"
    business_process_ids:
      - "finance_expense_management"
      - "finance_facilities_management"
    base_column: "Transaction Value Amount"
    filters:
      "Parent Account/Group Description": "Building Expense"
    thresholds:
      - comparison_type: "mom"
        green_threshold: -0.05
        yellow_threshold: 0.0
        red_threshold: 0.10
        inverse_logic: true
    dimensions:
      - name: "Profit Center"
        field: "profit_center"
        description: "Business profit center"
    tags:
      - "expense"
      - "facilities"
      - "financial"
    owner_role: "Finance Manager"
    stakeholder_roles:
      - "Finance Manager"
      - "COO"
  - id: employee_expense
    name: "Employee Expense"
    domain: "Finance"
    description: "Total Employee Expense (includes Payroll, Travel, Office, Other)."
    unit: "$"
    data_product_id: "fi_star_schema"
    view_name: "FI_Star_View"
    business_process_ids:
      - "finance_expense_management"
      - "finance_human_resources"
    base_column: "Transaction Value Amount"
    filters:
      "Parent Account/Group Description": "Employee Expense"
    thresholds:
      - comparison_type: "mom"
        green_threshold: -0.05
        yellow_threshold: 0.0
        red_threshold: 0.10
        inverse_logic: true
    dimensions:
      - name: "Profit Center"
        field: "profit_center"
        description: "Business profit center"
    tags:
      - "expense"
      - "hr"
      - "financial"
    owner_role: "Finance Manager"
    stakeholder_roles:
      - "Finance Manager"
      - "CHRO"
  - id: net_income
    name: "Net Income"
    domain: "Finance"
    description: "Net Income."
    unit: "$"
    data_product_id: "fi_star_schema"
    view_name: "FI_Star_View"
    business_process_ids:
      - "finance_profitability_analysis"
      - "finance_investor_relations_reporting"
    base_column: "Transaction Value Amount"
    # Same as Op Income for MVP (assuming no interest/tax data)
    filters:
      "Parent Account/Group Description": 
        - "Net Revenue"
        - "Gross Margin"
        - "Building Expense"
        - "Employee Expense"
        - "Operating Expense"
    sql_query: |
      SELECT SUM(
        CASE 
          WHEN "Parent Account/Group Description" IN ('Gross Margin', 'Building Expense', 'Employee Expense', 'Operating Expense') THEN -1 * "Transaction Value Amount" 
          ELSE "Transaction Value Amount" 
        END
      ) FROM FI_Star_View
    thresholds:
      - comparison_type: "yoy"
        green_threshold: 0.10
        yellow_threshold: 0.0
        red_threshold: -0.05
        inverse_logic: false
    dimensions:
      - name: "Profit Center"
        field: "profit_center"
        description: "Business profit center"
    tags:
      - "profitability"
      - "financial"
      - "bottom_line"
    owner_role: "CFO"
    stakeholder_roles:
      - "CFO"
      - "CEO"
      - "Investors"
    metadata:
      line: "bottom_line"
      altitude: "strategic"
      profit_driver_type: "profitability"
      lens_affinity: "mckinsey,bcg,bain"
  - id: earnings_before_interest_and_taxes
    name: "Earnings Before Interest & Taxes"
    domain: "Finance"
    description: "Earnings Before Interest & Taxes (EBIT)."
    unit: "$"
    data_product_id: "fi_star_schema"
    view_name: "FI_Star_View"
    business_process_ids:
      - "finance_profitability_analysis"
      - "strategy_ebitda_growth_tracking"
    base_column: "Transaction Value Amount"
    # Same as Op Income for MVP
    filters:
      "Parent Account/Group Description": 
        - "Net Revenue"
        - "Gross Margin"
        - "Building Expense"
        - "Employee Expense"
        - "Operating Expense"
    sql_query: |
      SELECT SUM(
        CASE 
          WHEN "Parent Account/Group Description" IN ('Gross Margin', 'Building Expense', 'Employee Expense', 'Operating Expense') THEN -1 * "Transaction Value Amount" 
          ELSE "Transaction Value Amount" 
        END
      ) FROM FI_Star_View
    thresholds:
      - comparison_type: "yoy"
        green_threshold: 0.10
        yellow_threshold: 0.0
        red_threshold: -0.05
        inverse_logic: false
    dimensions:
      - name: "Profit Center"
        field: "profit_center"
        description: "Business profit center"
    tags:
      - "profitability"
      - "financial"
      - "ebit"
    synonyms:
      - "EBIT"
    owner_role: "CFO"
    stakeholder_roles:
      - "CFO"
      - "CEO"
    metadata:
      line: "bottom_line"
      altitude: "strategic"
      profit_driver_type: "profitability"
      lens_affinity: "mckinsey,bcg,bain"
  - id: depreciation
    name: "Depreciation"
    domain: "Finance"
    description: "Depreciation."
    unit: "$"
    data_product_id: "fi_star_schema"
    view_name: "FI_Star_View"
    business_process_ids:
      - "finance_expense_management"
      - "finance_cash_flow_management"
    filters:
      "Account Hierarchy Desc": "Depreciation"
    sql_query: SELECT SUM("Transaction Value Amount") FROM FI_Star_View
    thresholds:
      - comparison_type: "mom"
        green_threshold: -0.05
        yellow_threshold: 0.0
        red_threshold: 0.10
        inverse_logic: true
    dimensions:
      - name: "Profit Center"
        field: "profit_center"
        description: "Business profit center"
    tags:
      - "expense"
      - "financial"
      - "cash_flow"
    owner_role: "CFO"
    stakeholder_roles:
      - "CFO"
      - "Finance Manager"
    metadata:
      line: "bottom_line"
      altitude: "operational"
      profit_driver_type: "expense"
      lens_affinity: "bcg,bain"

  - id: cash_flow_from_operating_activities
    name: "Cash Flow from Operating Activities"
    domain: "Finance"
    description: "Cash Flow from Operating Activities (CFO)."
    unit: "$"
    data_product_id: "fi_star_schema"
    view_name: "FI_Star_View"
    business_process_ids:
      - "finance_cash_flow_management"
    base_column: "Transaction Value Amount"
    filters:
      "Parent Account/Group Description": "Cash Flow from Operating Activities (CFO)"
    thresholds:
      - comparison_type: "yoy"
        green_threshold: 0.10
        yellow_threshold: 0.0
        red_threshold: -0.05
        inverse_logic: false
    dimensions:
      - name: "Profit Center"
        field: "profit_center"
        description: "Business profit center"
    tags:
      - "cash_flow"
      - "financial"
    synonyms:
      - "CFO"
      - "Operating Cash Flow"
    owner_role: "CFO"
    stakeholder_roles:
      - "CFO"
      - "CEO"
    metadata:
      line: "bottom_line"
      altitude: "strategic"
      profit_driver_type: "cash_flow"
      lens_affinity: "mckinsey,bcg,bain"

  # Sales Domain KPIs
  - id: total_gross_sales
    name: "Total Gross Sales"
    domain: "Sales"
    description: "Total gross amount of sales orders"
    unit: "USD"
    data_product_id: "dp_sales_analytics_009"
    sql_query: "SELECT SUM(SalesOrder_GROSSAMOUNT) FROM `agent9-465818.SalesOrders.SalesOrderStarSchemaView`"
    dimensions:
      - name: "Partner Role"
        field: "PARTNERROLE"
        description: "Role of the business partner in transactions"
        values: ["all"]
    thresholds:
      - comparison_type: "greater_than"
        green_threshold: 1000000
        yellow_threshold: 500000
        red_threshold: 100000
        inverse_logic: false
    metadata:
      line: "top_line"
      altitude: "strategic"
      profit_driver_type: "revenue"
      lens_affinity: "bcg,mckinsey"
      refresh_frequency: "daily"
      data_latency: "1 hour"
      calculation_complexity: "simple"
    business_process_ids:
      - "sales_management"
      - "financial_reporting"
    tags:
      - "total_sales"
      - "gross_revenue"
    owner_role: "CFO"
    stakeholder_roles:
      - "Sales Director"
      - "Financial Analyst"

  - id: net_sales_performance
    name: "Net Sales Performance"
    domain: "Sales"
    description: "Total net amount of sales orders after taxes and discounts"
    unit: "USD"
    data_product_id: "dp_sales_analytics_009"
    sql_query: "SELECT SUM(SalesOrder_NETAMOUNT) FROM `agent9-465818.SalesOrders.SalesOrderStarSchemaView`"
    dimensions:
      - name: "Company Name"
        field: "COMPANYNAME"
        description: "Name of the company making the transaction"
        values: ["all"]
    thresholds:
      - comparison_type: "greater_than"
        green_threshold: 800000
        yellow_threshold: 400000
        red_threshold: 200000
        inverse_logic: false
    metadata:
      line: "top_line"
      altitude: "strategic"
      profit_driver_type: "revenue"
      lens_affinity: "bcg,mckinsey"
      refresh_frequency: "daily"
      data_latency: "1 hour"
      calculation_complexity: "simple"
    business_process_ids:
      - "sales_management"
      - "financial_reporting"
    tags:
      - "net_sales"
      - "performance"
    owner_role: "CFO"
    stakeholder_roles:
      - "Sales Manager"
      - "Accounting Manager"

  - id: sales_tax_collected
    name: "Sales Tax Collected"
    domain: "Sales"
    description: "Total tax amount collected from sales"
    unit: "USD"
    data_product_id: "dp_sales_analytics_009"
    sql_query: "SELECT SUM(SalesOrder_TAXAMOUNT) FROM `agent9-465818.SalesOrders.SalesOrderStarSchemaView`"
    dimensions:
      - name: "Legal Form"
        field: "LEGALFORM"
        description: "Legal form of the business partner"
        values: ["all"]
    thresholds:
      - comparison_type: "greater_than"
        green_threshold: 150000
        yellow_threshold: 75000
        red_threshold: 30000
        inverse_logic: false
    metadata:
      line: "bottom_line"
      altitude: "operational"
      profit_driver_type: "expense"
      lens_affinity: "bain"
      refresh_frequency: "weekly"
      data_latency: "2 hours"
      calculation_complexity: "simple"
    business_process_ids:
      - "tax_management"
      - "compliance"
    tags:
      - "tax_collection"
      - "sales_tax"
    owner_role: "Compliance Officer"
    stakeholder_roles:
      - "Tax Manager"
      - "CFO"

  - id: average_product_price
    name: "Average Product Price"
    domain: "Sales"
    description: "Average selling price of products"
    unit: "USD"
    data_product_id: "dp_sales_analytics_009"
    sql_query: "SELECT AVG(Product_PRICE) FROM `agent9-465818.SalesOrders.SalesOrderStarSchemaView`"
    dimensions:
      - name: "Product Price"
        field: "Product_PRICE"
        description: "Price of the product"
        values: ["all"]
    thresholds:
      - comparison_type: "greater_than"
        green_threshold: 500
        yellow_threshold: 250
        red_threshold: 100
        inverse_logic: false
    metadata:
      line: "middle_line"
      altitude: "tactical"
      profit_driver_type: "efficiency"
      lens_affinity: "bain"
      refresh_frequency: "monthly"
      data_latency: "1 day"
      calculation_complexity: "moderate"
    business_process_ids:
      - "pricing_strategy"
      - "product_management"
    tags:
      - "average_price"
      - "product_pricing"
    owner_role: "Product Manager"
    stakeholder_roles:
      - "Marketing Manager"
      - "Sales Analyst"

  - id: sales_order_volume
    name: "Sales Order Volume"
    domain: "Sales"
    description: "Count of total sales orders processed"
    unit: "count"
    data_product_id: "dp_sales_analytics_009"
    sql_query: "SELECT COUNT(*) FROM `agent9-465818.SalesOrders.SalesOrderStarSchemaView`"
    dimensions:
      - name: "Transaction Volume"
        field: "SalesOrder_GROSSAMOUNT"
        description: "Gross amount of sales orders as a proxy for transaction volume"
        values: ["all"]
    thresholds:
      - comparison_type: "greater_than"
        green_threshold: 1000
        yellow_threshold: 500
        red_threshold: 100
        inverse_logic: false
    metadata:
      line: "middle_line"
      altitude: "tactical"
      profit_driver_type: "efficiency"
      lens_affinity: "bain"
      refresh_frequency: "daily"
      data_latency: "1 hour"
      calculation_complexity: "simple"
    business_process_ids:
      - "order_processing"
      - "sales_operations"
    tags:
      - "order_volume"
      - "transaction_count"
    owner_role: "COO"
    stakeholder_roles:
      - "Sales Operations Manager"
      - "Data Analyst"

