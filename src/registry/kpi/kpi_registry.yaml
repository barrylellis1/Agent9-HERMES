# KPI Registry - Finance Domain
# Contains all KPIs for financial analysis and monitoring
# Format follows the src.registry.models.kpi model structure
# MVP scope is limited to Finance KPIs only

# List of KPIs
kpis:
  - id: gross_revenue
    name: "Gross Revenue"
    domain: "Finance"
    description: "Total gross revenue recognized in the period."
    unit: "$"
    data_product_id: "FI_Star_Schema"
    business_process_ids: 
      - "finance_revenue_growth_analysis"
      - "finance_profitability_analysis"
    sql_query: "SELECT SUM(value) FROM sap.FinancialTransactions JOIN sap.GLAccounts ON FinancialTransactions.account_id = GLAccounts.account_id WHERE GLAccounts.account_hierarchy_desc = 'Gross Revenue'"
    thresholds:
      - comparison_type: "yoy"
        green_threshold: 0.10
        yellow_threshold: 0.0
        red_threshold: -0.05
        inverse_logic: false
      - comparison_type: "mom"
        green_threshold: 0.05
        yellow_threshold: 0.0
        red_threshold: -0.03
        inverse_logic: false
    dimensions:
      - name: "Region"
        field: "region"
        values: ["EMEA", "AMERICAS", "APAC"]
        description: "Geographic region"
      - name: "Profit Center"
        field: "profit_center"
        description: "Business profit center"
    tags:
      - "revenue"
      - "top_line"
      - "financial"
    owner_role: "CFO"
    stakeholder_roles:
      - "CFO"
      - "Finance Manager"
      - "CEO"

  - id: cost_of_goods_sold
    name: "Cost of Goods Sold"
    domain: "Finance"
    description: "Total cost of goods sold in the period."
    unit: "$"
    data_product_id: "FI_Star_Schema"
    business_process_ids:
      - "finance_profitability_analysis" 
      - "finance_expense_management"
    sql_query: "SELECT SUM(value) FROM sap.FinancialTransactions JOIN sap.GLAccounts ON FinancialTransactions.account_id = GLAccounts.account_id WHERE GLAccounts.account_hierarchy_desc = 'Cost of Goods Sold'"
    thresholds:
      - comparison_type: "mom"
        green_threshold: -0.05
        yellow_threshold: 0.0
        red_threshold: 0.10
        inverse_logic: true
      - comparison_type: "budget"
        green_threshold: -0.05
        yellow_threshold: 0.0
        red_threshold: 0.10
        inverse_logic: true
    dimensions:
      - name: "Region"
        field: "region"
        values: ["EMEA", "AMERICAS", "APAC"]
        description: "Geographic region"
      - name: "Profit Center"
        field: "profit_center"
        description: "Business profit center"
    tags:
      - "cogs"
      - "cost"
      - "financial"
    owner_role: "CFO"
    stakeholder_roles:
      - "CFO"
      - "Finance Manager"

  - id: gross_margin
    name: "Gross Margin"
    domain: "Finance"
    description: "Gross Margin is calculated as Gross Revenue minus Cost of Goods Sold."
    unit: "%"
    data_product_id: "FI_Star_Schema"
    business_process_ids:
      - "finance_profitability_analysis"
      - "finance_revenue_growth_analysis"
    sql_query: "WITH gross_rev AS (SELECT SUM(value) as gross FROM sap.FinancialTransactions JOIN sap.GLAccounts ON FinancialTransactions.account_id = GLAccounts.account_id WHERE GLAccounts.account_hierarchy_desc = 'Gross Revenue'), cogs AS (SELECT SUM(value) as cost FROM sap.FinancialTransactions JOIN sap.GLAccounts ON FinancialTransactions.account_id = GLAccounts.account_id WHERE GLAccounts.account_hierarchy_desc = 'Cost of Goods Sold') SELECT (gross_rev.gross - cogs.cost) / gross_rev.gross * 100 FROM gross_rev, cogs"
    thresholds:
      - comparison_type: "yoy"
        green_threshold: 0.10
        yellow_threshold: 0.0
        red_threshold: -0.05
        inverse_logic: false
      - comparison_type: "budget"
        green_threshold: 0.0
        yellow_threshold: -0.05
        red_threshold: -0.10
        inverse_logic: false
    dimensions:
      - name: "Region"
        field: "region"
        values: ["EMEA", "AMERICAS", "APAC"]
        description: "Geographic region"
      - name: "Profit Center"
        field: "profit_center"
        description: "Business profit center"
    tags:
      - "margin"
      - "profitability"
      - "financial"
    owner_role: "CFO"
    stakeholder_roles:
      - "CFO"
      - "Finance Manager"
      - "CEO"

  - id: utilities_expense
    name: "Utilities Expense"
    domain: "Finance"
    description: "Total utilities expense."
    unit: "$"
    data_product_id: "FI_Star_Schema"
    business_process_ids:
      - "finance_expense_management"
      - "finance_budget_vs_actuals"
    sql_query: "SELECT SUM(value) FROM sap.FinancialTransactions JOIN sap.GLAccounts ON FinancialTransactions.account_id = GLAccounts.account_id WHERE GLAccounts.account_hierarchy_desc = 'Utilities'"
    thresholds:
      - comparison_type: "mom"
        green_threshold: -0.05
        yellow_threshold: 0.0
        red_threshold: 0.10
        inverse_logic: true
      - comparison_type: "budget"
        green_threshold: -0.05
        yellow_threshold: 0.0
        red_threshold: 0.10
        inverse_logic: true
    dimensions:
      - name: "Region"
        field: "region"
        values: ["EMEA", "AMERICAS", "APAC"]
        description: "Geographic region"
      - name: "Profit Center"
        field: "profit_center"
        description: "Business profit center"
    tags:
      - "expense"
      - "utilities"
      - "financial"
    owner_role: "Finance Manager"
    stakeholder_roles:
      - "Finance Manager"
      - "COO"

  - id: office_expense
    name: "Office Expense"
    domain: "Finance"
    description: "Total office expense."
    unit: "$"
    data_product_id: "FI_Star_Schema"
    business_process_ids:
      - "finance_expense_management"
      - "finance_budget_vs_actuals"
    sql_query: "SELECT SUM(value) FROM sap.FinancialTransactions JOIN sap.GLAccounts ON FinancialTransactions.account_id = GLAccounts.account_id WHERE GLAccounts.account_hierarchy_desc = 'Office'"
    thresholds:
      - comparison_type: "mom"
        green_threshold: -0.05
        yellow_threshold: 0.0
        red_threshold: 0.10
        inverse_logic: true
      - comparison_type: "budget"
        green_threshold: -0.05
        yellow_threshold: 0.0
        red_threshold: 0.10
        inverse_logic: true
    dimensions:
      - name: "Region"
        field: "region"
        values: ["EMEA", "AMERICAS", "APAC"]
        description: "Geographic region"
      - name: "Profit Center"
        field: "profit_center"
        description: "Business profit center"
    tags:
      - "expense"
      - "office"
      - "financial"
    owner_role: "Finance Manager"
    stakeholder_roles:
      - "Finance Manager"
      - "COO"

  - id: payroll
    name: "Payroll"
    domain: "Finance"
    description: "Total payroll expense."
    unit: "$"
    data_product_id: "FI_Star_Schema"
    business_process_ids:
      - "finance_expense_management"
      - "finance_budget_vs_actuals"
    sql_query: "SELECT SUM(value) FROM sap.FinancialTransactions JOIN sap.GLAccounts ON FinancialTransactions.account_id = GLAccounts.account_id WHERE GLAccounts.account_hierarchy_desc = 'Payroll'"
    thresholds:
      - comparison_type: "mom"
        green_threshold: -0.05
        yellow_threshold: 0.0
        red_threshold: 0.10
        inverse_logic: true
      - comparison_type: "budget"
        green_threshold: -0.05
        yellow_threshold: 0.0
        red_threshold: 0.10
        inverse_logic: true
    dimensions:
      - name: "Region"
        field: "region"
        values: ["EMEA", "AMERICAS", "APAC"]
        description: "Geographic region"
      - name: "Profit Center"
        field: "profit_center"
        description: "Business profit center"
    tags:
      - "expense"
      - "payroll"
      - "financial"
      - "hr"
    owner_role: "Finance Manager"
    stakeholder_roles:
      - "Finance Manager"
      - "CHRO"
      - "CFO"
