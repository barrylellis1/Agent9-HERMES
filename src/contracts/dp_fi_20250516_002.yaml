data_product: dp_fi_20250516_002
description: >
  General ledger accounts master data for SAP finance.
tables:
  - name: GLAccounts
    columns:
      - name: gl_account
        type: string
      - name: gl_account_type
        type: string
      - name: gl_account_desc
        type: string
relationships: []
kpis:
  - name: GrossMargin
    description: Gross margin for the period.
    calculation: SUM(value) WHERE GLAccounts.account_hierarchy_desc = 'Cost of Goods Sold'
    filter_type: account_hierarchy_desc
    filter_value: Cost of Goods Sold
    aggregation: SUM
    base_column: value
    join_tables:
      - GLAccounts
    dependencies: null
    sql_example: |
      SELECT SUM(CASE WHEN ga.account_hierarchy_desc = 'Cost of Goods Sold' THEN ft.value ELSE 0 END) AS gross_margin
      FROM FinancialTransactions ft
      JOIN GLAccounts ga ON ft.accountid = ga.accountid
      JOIN Products p ON ft.productid = p.productid
      WHERE ft.date >= DATE_TRUNC('quarter', CURRENT_DATE - INTERVAL '1 quarter')
        AND ft.date < DATE_TRUNC('quarter', CURRENT_DATE)
      GROUP BY p.productid, p.product_name
  - name: Sales Deductions
    description: Total sales deductions in the period.
    calculation: SUM(value) WHERE GLAccounts.account_hierarchy_desc = 'Sales Deductions'
    filter_type: account_hierarchy_desc
    filter_value: Sales Deductions
    aggregation: SUM
    base_column: value
    join_tables:
      - GLAccounts
    dependencies: null
    sql_example: null
  - name: Periodic Building Expense
    description: Total periodic building expense.
    calculation: SUM(value) WHERE GLAccounts.account_hierarchy_desc = 'Periodic Building Expense'
    filter_type: account_hierarchy_desc
    filter_value: Periodic Building Expense
    aggregation: SUM
    base_column: value
    join_tables:
      - GLAccounts
    dependencies: null
    sql_example: null
  - name: Utilities Expense
    description: Total utilities expense.
    calculation: SUM(value) WHERE GLAccounts.account_hierarchy_desc = 'Utilities Expense'
    filter_type: account_hierarchy_desc
    filter_value: Utilities Expense
    aggregation: SUM
    base_column: value
    join_tables:
      - GLAccounts
    dependencies: null
    sql_example: null
  - name: Office Expense
    description: Total office expense.
    calculation: SUM(value) WHERE GLAccounts.account_hierarchy_desc = 'Office Expense'
    filter_type: account_hierarchy_desc
    filter_value: Office Expense
    aggregation: SUM
    base_column: value
    join_tables:
      - GLAccounts
    dependencies: null
    sql_example: null
  - name: Payroll
    description: Total payroll expense.
    calculation: SUM(value) WHERE GLAccounts.account_hierarchy_desc = 'Payroll'
    filter_type: account_hierarchy_desc
    filter_value: Payroll
    aggregation: SUM
    base_column: value
    join_tables:
      - GLAccounts
    dependencies: null
    sql_example: null
  - name: Travel
    description: Total travel expense.
    calculation: SUM(value) WHERE GLAccounts.account_hierarchy_desc = 'Travel'
    filter_type: account_hierarchy_desc
    filter_value: Travel
    aggregation: SUM
    base_column: value
    join_tables:
      - GLAccounts
    dependencies: null
    sql_example: null
  - name: Employee Expense Other
    description: Total employee expense (other).
    calculation: SUM(value) WHERE GLAccounts.account_hierarchy_desc = 'Employee Expense Other'
    filter_type: account_hierarchy_desc
    filter_value: Employee Expense Other
    aggregation: SUM
    base_column: value
    join_tables:
      - GLAccounts
    dependencies: null
    sql_example: null
  - name: Other Operating Expense
    description: Total other operating expense.
    calculation: SUM(value) WHERE GLAccounts.account_hierarchy_desc = 'Other Operating Expense'
    filter_type: account_hierarchy_desc
    filter_value: Other Operating Expense
    aggregation: SUM
    base_column: value
    join_tables:
      - GLAccounts
    dependencies: null
    sql_example: null
