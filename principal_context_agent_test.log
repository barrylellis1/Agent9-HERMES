2025-09-01 09:54:43,804 - principal_context_test - INFO - Starting Principal Context Agent tests
2025-09-01 09:54:43,805 - principal_context_test - INFO - === Testing Registry Structure ===
2025-09-01 09:54:43,805 - principal_context_test - INFO - Registry path: C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\principal\principal_registry.yaml
2025-09-01 09:54:43,827 - principal_context_test - INFO - Registry top-level keys: ['principals', 'roles']
2025-09-01 09:54:43,828 - principal_context_test - INFO - Found 3 principals in registry
2025-09-01 09:54:43,828 - principal_context_test - INFO - First principal:
2025-09-01 09:54:43,829 - principal_context_test - INFO -   ID: cfo_001
2025-09-01 09:54:43,830 - principal_context_test - INFO -   Name: Lars Mikkelsen
2025-09-01 09:54:43,830 - principal_context_test - INFO -   Role: CFO
2025-09-01 09:54:43,830 - principal_context_test - INFO -   Keys: ['id', 'name', 'title', 'first_name', 'last_name', 'role', 'department', 'responsibilities', 'business_processes', 'default_filters', 'typical_timeframes', 'principal_groups', 'persona_profile', 'preferences', 'permissions', 'source', 'description', 'time_frame', 'communication']
2025-09-01 09:54:43,831 - principal_context_test - INFO - === Testing Agent Initialization ===
2025-09-01 09:54:44,027 - principal_context_test - INFO - Creating agent instance
2025-09-01 09:54:44,027 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Initializing A9_Principal_Context_Agent
2025-09-01 09:54:44,027 - principal_context_test - INFO - Connecting agent
2025-09-01 09:54:44,028 - src.registry.factory - INFO - Registry Factory initialized
2025-09-01 09:54:44,028 - src.registry.factory - INFO - Registered principal_profile provider
2025-09-01 09:54:44,028 - src.registry.providers.principal_provider - INFO - Loading principal profiles from C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\principal\principal_registry.yaml (yaml)
2025-09-01 09:54:44,038 - src.registry.providers.principal_provider - INFO - Found 3 roles in YAML under 'roles' key
2025-09-01 09:54:44,039 - src.registry.providers.principal_provider - INFO - Found 3 principal profiles in YAML under 'principals' key
2025-09-01 09:54:44,039 - src.registry.providers.principal_provider - INFO - Registered principal: cfo_001 - Lars Mikkelsen
2025-09-01 09:54:44,039 - src.registry.providers.principal_provider - INFO - Registered principal: ceo_001 - Alex Morgan
2025-09-01 09:54:44,039 - src.registry.providers.principal_provider - INFO - Registered principal: coo_001 - Priya Desai
2025-09-01 09:54:44,039 - src.registry.providers.principal_provider - INFO - Added role ID mapping: cfo_001 -> Lars Mikkelsen
2025-09-01 09:54:44,039 - src.registry.providers.principal_provider - INFO - Added role ID mapping: ceo_001 -> Alex Morgan
2025-09-01 09:54:44,040 - src.registry.providers.principal_provider - INFO - Added role ID mapping: coo_001 -> Priya Desai
2025-09-01 09:54:44,040 - src.registry.providers.principal_provider - INFO - Loaded 3 principal profiles
2025-09-01 09:54:44,040 - src.registry.bootstrap - INFO - Initialized principal provider with 3 profiles
2025-09-01 09:54:44,040 - src.registry.factory - INFO - Registered data_product provider
2025-09-01 09:54:44,040 - src.registry.providers.data_product_provider - INFO - Loading data products from C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\data_product\data_product_registry.yaml (yaml)
2025-09-01 09:54:44,045 - src.registry.providers.data_product_provider - INFO - Loaded 1 data products
2025-09-01 09:54:44,046 - src.registry.bootstrap - INFO - Initialized data product provider with 1 data products
2025-09-01 09:54:44,047 - src.registry.bootstrap - INFO - Initializing agent bootstrap
2025-09-01 09:54:44,056 - src.agents.agent_bootstrap - WARNING - Found agent class A9_Data_Governance_Agent but it lacks a create method
2025-09-01 09:54:44,498 - src.agents.agent_bootstrap - WARNING - Found agent class A9_Data_Product_MCP_Service_Agent but it lacks a create method
2025-09-01 09:54:44,948 - src.agents.agent_bootstrap - WARNING - Found agent class A9_LLM_Service_Agent but it lacks a create method
2025-09-01 09:54:44,948 - src.agents.agent_bootstrap - WARNING - Found agent class A9_Orchestrator_Agent but it lacks a create method
2025-09-01 09:54:44,949 - src.agents.agent_bootstrap - WARNING - Found agent class A9_Principal_Context_Agent but it lacks a create method
2025-09-01 09:54:44,953 - src.agents.agent_bootstrap - WARNING - Found agent class A9_Data_Product_MCP_Service_Agent but it lacks a create method
2025-09-01 09:54:44,954 - src.agents.agent_bootstrap - WARNING - Found agent class A9_Orchestrator_Agent but it lacks a create method
2025-09-01 09:54:44,954 - src.agents.agent_bootstrap - WARNING - Found agent class A9_Situation_Awareness_Agent but it lacks a create method
2025-09-01 09:54:44,957 - src.agents.agent_bootstrap - WARNING - Found agent class A9_Data_Governance_Agent but it lacks a create method
2025-09-01 09:54:44,958 - src.agents.agent_bootstrap - WARNING - Found agent class A9_Orchestrator_Agent but it lacks a create method
2025-09-01 09:54:44,958 - src.agents.agent_bootstrap - WARNING - Found agent class A9_Principal_Context_Agent but it lacks a create method
2025-09-01 09:54:44,959 - src.agents.agent_bootstrap - WARNING - Found agent class A9_Data_Product_MCP_Service_Agent but it lacks a create method
2025-09-01 09:54:44,960 - src.agents.agent_bootstrap - WARNING - Found agent class A9_Orchestrator_Agent but it lacks a create method
2025-09-01 09:54:44,960 - src.agents.agent_bootstrap - WARNING - Found agent class A9_Situation_Awareness_Agent but it lacks a create method
2025-09-01 09:54:44,960 - src.agents.agent_bootstrap - WARNING - No agent implementations discovered
2025-09-01 09:54:44,961 - src.registry.bootstrap - WARNING - Agent bootstrap initialization had issues, continuing with available agents
2025-09-01 09:54:44,961 - src.registry.bootstrap - INFO - Registry providers and agent factories initialized successfully
2025-09-01 09:54:44,961 - src.registry.factory - WARNING - Provider 'principal_profile' exists but may not be properly initialized
2025-09-01 09:54:44,962 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - WARNING - No 'principals' key found in registry or no valid profiles, using defaults
2025-09-01 09:54:44,975 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Loaded 3 principal profiles from registry file
2025-09-01 09:54:44,976 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Connected to dependencies
2025-09-01 09:54:44,976 - principal_context_test - INFO - Agent connected successfully
2025-09-01 09:54:44,976 - principal_context_test - INFO - Loaded 3 principal profiles
2025-09-01 09:54:44,977 - principal_context_test - INFO - Available roles: ['cfo', 'ceo', 'coo']
2025-09-01 09:54:44,977 - principal_context_test - INFO - First profile (cfo):
2025-09-01 09:54:44,977 - principal_context_test - INFO - {'business_processes': ['Finance: Profitability Analysis',
                        'Finance: Revenue Growth Analysis',
                        'Finance: Expense Management',
                        'Finance: Cash Flow Management',
                        'Finance: Budget vs. Actuals'],
 'communication_style': 'concise',
 'decision_style': 'analytical',
 'default_filters': {'customer_hierarchyid': ['Total'],
                     'profit_center_hierarchyid': ['Total']},
 'description': 'CFO responsible for financial performance in EMEA.',
 'name': 'Lars Mikkelsen',
 'role': 'CFO',
 'timeframes': ['Monthly', 'Quarterly'],
 'title': 'Chief Financial Officer'}
2025-09-01 09:54:44,978 - principal_context_test - INFO - === Testing fetch_principal_profile for role: cfo ===
2025-09-01 09:54:44,978 - principal_context_test - INFO - Calling fetch_principal_profile with role: cfo
2025-09-01 09:54:44,978 - principal_context_test - INFO - Successfully fetched profile for cfo
2025-09-01 09:54:44,979 - principal_context_test - INFO - Profile content:
2025-09-01 09:54:44,979 - principal_context_test - INFO - {'business_processes': ['Finance: Profitability Analysis',
                        'Finance: Revenue Growth Analysis',
                        'Finance: Expense Management',
                        'Finance: Cash Flow Management',
                        'Finance: Budget vs. Actuals'],
 'communication_style': 'concise',
 'decision_style': 'analytical',
 'default_filters': {'customer_hierarchyid': ['Total'],
                     'profit_center_hierarchyid': ['Total']},
 'description': 'CFO responsible for financial performance in EMEA.',
 'name': 'Lars Mikkelsen',
 'timeframes': ['Monthly', 'Quarterly'],
 'title': 'Chief Financial Officer'}
2025-09-01 09:54:44,980 - principal_context_test - INFO - === Testing get_principal_context for role: cfo ===
2025-09-01 09:54:44,980 - principal_context_test - INFO - Calling get_principal_context with role: cfo
2025-09-01 09:54:44,981 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Getting principal context for role: cfo
2025-09-01 09:54:44,982 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - ERROR - Error 7e6486cf in get_principal_context: 1 validation error for PrincipalContext
role
  Input should be 'CFO' or 'Finance Manager' [type=enum, input_value='cfo', input_type=str]
    For further information visit https://errors.pydantic.dev/2.11/v/enum
2025-09-01 09:54:44,983 - principal_context_test - ERROR - Error testing get_principal_context: 1 validation error for PrincipalContext
role
  Input should be 'CFO' or 'Finance Manager' [type=enum, input_value='cfo', input_type=str]
    For further information visit https://errors.pydantic.dev/2.11/v/enum
2025-09-01 09:54:44,987 - principal_context_test - INFO - === Testing fetch_principal_profile for role: ceo ===
2025-09-01 09:54:44,987 - principal_context_test - INFO - Calling fetch_principal_profile with role: ceo
2025-09-01 09:54:44,987 - principal_context_test - INFO - Successfully fetched profile for ceo
2025-09-01 09:54:44,988 - principal_context_test - INFO - Profile content:
2025-09-01 09:54:44,988 - principal_context_test - INFO - {'business_processes': ['Finance: Profitability Analysis',
                        'Finance: Revenue Growth Analysis',
                        'Finance: Expense Management',
                        'Finance: Cash Flow Management',
                        'Finance: Budget vs. Actuals'],
 'communication_style': 'inspirational',
 'decision_style': 'visionary',
 'default_filters': {'profit_center_hierarchyid': ['#']},
 'description': 'CEO driving company strategy and performance.',
 'name': 'Alex Morgan',
 'timeframes': ['Quarterly', 'Annually'],
 'title': 'Chief Executive Officer'}
2025-09-01 09:54:44,988 - principal_context_test - INFO - === Testing get_principal_context for role: ceo ===
2025-09-01 09:54:44,989 - principal_context_test - INFO - Calling get_principal_context with role: ceo
2025-09-01 09:54:44,989 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Getting principal context for role: ceo
2025-09-01 09:54:44,989 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - ERROR - Error d87a9bc9 in get_principal_context: 1 validation error for PrincipalContext
role
  Input should be 'CFO' or 'Finance Manager' [type=enum, input_value='ceo', input_type=str]
    For further information visit https://errors.pydantic.dev/2.11/v/enum
2025-09-01 09:54:44,990 - principal_context_test - ERROR - Error testing get_principal_context: 1 validation error for PrincipalContext
role
  Input should be 'CFO' or 'Finance Manager' [type=enum, input_value='ceo', input_type=str]
    For further information visit https://errors.pydantic.dev/2.11/v/enum
2025-09-01 09:54:44,992 - principal_context_test - INFO - === Testing fetch_principal_profile for role: coo ===
2025-09-01 09:54:44,992 - principal_context_test - INFO - Calling fetch_principal_profile with role: coo
2025-09-01 09:54:44,993 - principal_context_test - INFO - Successfully fetched profile for coo
2025-09-01 09:54:44,993 - principal_context_test - INFO - Profile content:
2025-09-01 09:54:44,993 - principal_context_test - INFO - {'business_processes': ['finance_expense_management',
                        'finance_cash_flow',
                        'finance_budget_vs_actuals'],
 'communication_style': 'direct',
 'decision_style': 'pragmatic',
 'default_filters': {'customer_hierarchyid': ['17100001'],
                     'profit_center_hierarchyid': ['Best Run U']},
 'description': 'COO focused on operational excellence and efficiency.',
 'name': 'Priya Desai',
 'timeframes': ['Monthly', 'Quarterly'],
 'title': 'Chief Operating Officer'}
2025-09-01 09:54:44,994 - principal_context_test - INFO - === Testing get_principal_context for role: coo ===
2025-09-01 09:54:44,994 - principal_context_test - INFO - Calling get_principal_context with role: coo
2025-09-01 09:54:44,994 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Getting principal context for role: coo
2025-09-01 09:54:44,995 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - ERROR - Error a439f71c in get_principal_context: 1 validation error for PrincipalContext
role
  Input should be 'CFO' or 'Finance Manager' [type=enum, input_value='coo', input_type=str]
    For further information visit https://errors.pydantic.dev/2.11/v/enum
2025-09-01 09:54:44,996 - principal_context_test - ERROR - Error testing get_principal_context: 1 validation error for PrincipalContext
role
  Input should be 'CFO' or 'Finance Manager' [type=enum, input_value='coo', input_type=str]
    For further information visit https://errors.pydantic.dev/2.11/v/enum
2025-09-01 09:54:44,999 - principal_context_test - INFO - === Testing extract_filters ===
2025-09-01 09:54:44,999 - principal_context_test - INFO - Calling extract_filters with job description
2025-09-01 09:54:45,000 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Extracting filters from description: 
        As a CFO, I need to analyze the monthly f...
2025-09-01 09:54:45,000 - principal_context_test - INFO - Response status: success
2025-09-01 09:54:45,001 - principal_context_test - INFO - Response message: Extracted 7 filters from description
2025-09-01 09:54:45,001 - principal_context_test - INFO - Extracted filters: {'region': ['Europe'], 'time_period': ['monthly', 'year-to-date'], 'business_unit': ['Sales', 'Marketing', 'Operations', 'IT']}
2025-09-01 09:54:45,001 - principal_context_test - INFO -   region: Europe (confidence: 0.8)
2025-09-01 09:54:45,001 - principal_context_test - INFO -   time_period: monthly (confidence: 0.8)
2025-09-01 09:54:45,002 - principal_context_test - INFO -   time_period: year-to-date (confidence: 0.8)
2025-09-01 09:54:45,002 - principal_context_test - INFO -   business_unit: Sales (confidence: 0.7)
2025-09-01 09:54:45,002 - principal_context_test - INFO -   business_unit: Marketing (confidence: 0.7)
2025-09-01 09:54:45,002 - principal_context_test - INFO -   business_unit: Operations (confidence: 0.7)
2025-09-01 09:54:45,002 - principal_context_test - INFO -   business_unit: IT (confidence: 0.7)
2025-09-01 09:54:45,002 - principal_context_test - INFO - All tests completed successfully
2025-09-01 09:56:42,609 - principal_context_test - INFO - Starting Principal Context Agent tests
2025-09-01 09:56:42,610 - principal_context_test - INFO - === Testing Registry Structure ===
2025-09-01 09:56:42,613 - principal_context_test - INFO - Registry path: C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\principal\principal_registry.yaml
2025-09-01 09:56:42,633 - principal_context_test - INFO - Registry top-level keys: ['principals', 'roles']
2025-09-01 09:56:42,633 - principal_context_test - INFO - Found 3 principals in registry
2025-09-01 09:56:42,633 - principal_context_test - INFO - First principal:
2025-09-01 09:56:42,633 - principal_context_test - INFO -   ID: cfo_001
2025-09-01 09:56:42,633 - principal_context_test - INFO -   Name: Lars Mikkelsen
2025-09-01 09:56:42,634 - principal_context_test - INFO -   Role: CFO
2025-09-01 09:56:42,634 - principal_context_test - INFO -   Keys: ['id', 'name', 'title', 'first_name', 'last_name', 'role', 'department', 'responsibilities', 'business_processes', 'default_filters', 'typical_timeframes', 'principal_groups', 'persona_profile', 'preferences', 'permissions', 'source', 'description', 'time_frame', 'communication']
2025-09-01 09:56:42,635 - principal_context_test - INFO - === Testing Agent Initialization ===
2025-09-01 09:56:42,901 - principal_context_test - INFO - Creating agent instance
2025-09-01 09:56:42,901 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Initializing A9_Principal_Context_Agent
2025-09-01 09:56:42,902 - principal_context_test - INFO - Connecting agent
2025-09-01 09:56:42,902 - src.registry.factory - INFO - Registry Factory initialized
2025-09-01 09:56:42,902 - src.registry.factory - INFO - Registered principal_profile provider
2025-09-01 09:56:42,903 - src.registry.providers.principal_provider - INFO - Loading principal profiles from C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\principal\principal_registry.yaml (yaml)
2025-09-01 09:56:42,921 - src.registry.providers.principal_provider - INFO - Found 3 roles in YAML under 'roles' key
2025-09-01 09:56:42,922 - src.registry.providers.principal_provider - INFO - Found 3 principal profiles in YAML under 'principals' key
2025-09-01 09:56:42,925 - src.registry.providers.principal_provider - INFO - Registered principal: cfo_001 - Lars Mikkelsen
2025-09-01 09:56:42,926 - src.registry.providers.principal_provider - INFO - Registered principal: ceo_001 - Alex Morgan
2025-09-01 09:56:42,926 - src.registry.providers.principal_provider - INFO - Registered principal: coo_001 - Priya Desai
2025-09-01 09:56:42,927 - src.registry.providers.principal_provider - INFO - Added role ID mapping: cfo_001 -> Lars Mikkelsen
2025-09-01 09:56:42,927 - src.registry.providers.principal_provider - INFO - Added role ID mapping: ceo_001 -> Alex Morgan
2025-09-01 09:56:42,927 - src.registry.providers.principal_provider - INFO - Added role ID mapping: coo_001 -> Priya Desai
2025-09-01 09:56:42,928 - src.registry.providers.principal_provider - INFO - Loaded 3 principal profiles
2025-09-01 09:56:42,928 - src.registry.bootstrap - INFO - Initialized principal provider with 3 profiles
2025-09-01 09:56:42,928 - src.registry.factory - INFO - Registered data_product provider
2025-09-01 09:56:42,928 - src.registry.providers.data_product_provider - INFO - Loading data products from C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\data_product\data_product_registry.yaml (yaml)
2025-09-01 09:56:42,936 - src.registry.providers.data_product_provider - INFO - Loaded 1 data products
2025-09-01 09:56:42,936 - src.registry.bootstrap - INFO - Initialized data product provider with 1 data products
2025-09-01 09:56:42,937 - src.registry.bootstrap - INFO - Initializing agent bootstrap
2025-09-01 09:56:42,951 - src.agents.agent_bootstrap - WARNING - Found agent class A9_Data_Governance_Agent but it lacks a create method
2025-09-01 09:56:43,384 - src.agents.agent_bootstrap - WARNING - Found agent class A9_Data_Product_MCP_Service_Agent but it lacks a create method
2025-09-01 09:56:43,897 - src.agents.agent_bootstrap - WARNING - Found agent class A9_LLM_Service_Agent but it lacks a create method
2025-09-01 09:56:43,897 - src.agents.agent_bootstrap - WARNING - Found agent class A9_Orchestrator_Agent but it lacks a create method
2025-09-01 09:56:43,898 - src.agents.agent_bootstrap - WARNING - Found agent class A9_Principal_Context_Agent but it lacks a create method
2025-09-01 09:56:43,900 - src.agents.agent_bootstrap - WARNING - Found agent class A9_Data_Product_MCP_Service_Agent but it lacks a create method
2025-09-01 09:56:43,901 - src.agents.agent_bootstrap - WARNING - Found agent class A9_Orchestrator_Agent but it lacks a create method
2025-09-01 09:56:43,901 - src.agents.agent_bootstrap - WARNING - Found agent class A9_Situation_Awareness_Agent but it lacks a create method
2025-09-01 09:56:43,903 - src.agents.agent_bootstrap - WARNING - Found agent class A9_Data_Governance_Agent but it lacks a create method
2025-09-01 09:56:43,904 - src.agents.agent_bootstrap - WARNING - Found agent class A9_Orchestrator_Agent but it lacks a create method
2025-09-01 09:56:43,904 - src.agents.agent_bootstrap - WARNING - Found agent class A9_Principal_Context_Agent but it lacks a create method
2025-09-01 09:56:43,906 - src.agents.agent_bootstrap - WARNING - Found agent class A9_Data_Product_MCP_Service_Agent but it lacks a create method
2025-09-01 09:56:43,906 - src.agents.agent_bootstrap - WARNING - Found agent class A9_Orchestrator_Agent but it lacks a create method
2025-09-01 09:56:43,908 - src.agents.agent_bootstrap - WARNING - Found agent class A9_Situation_Awareness_Agent but it lacks a create method
2025-09-01 09:56:43,908 - src.agents.agent_bootstrap - WARNING - No agent implementations discovered
2025-09-01 09:56:43,908 - src.registry.bootstrap - WARNING - Agent bootstrap initialization had issues, continuing with available agents
2025-09-01 09:56:43,908 - src.registry.bootstrap - INFO - Registry providers and agent factories initialized successfully
2025-09-01 09:56:43,908 - src.registry.factory - WARNING - Provider 'principal_profile' exists but may not be properly initialized
2025-09-01 09:56:43,908 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - WARNING - No 'principals' key found in registry or no valid profiles, using defaults
2025-09-01 09:56:43,919 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Loaded 3 principal profiles from registry file
2025-09-01 09:56:43,920 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Connected to dependencies
2025-09-01 09:56:43,920 - principal_context_test - INFO - Agent connected successfully
2025-09-01 09:56:43,921 - principal_context_test - INFO - Loaded 3 principal profiles
2025-09-01 09:56:43,921 - principal_context_test - INFO - Available roles: ['cfo', 'ceo', 'coo']
2025-09-01 09:56:43,921 - principal_context_test - INFO - First profile (cfo):
2025-09-01 09:56:43,921 - principal_context_test - INFO - {'business_processes': ['Finance: Profitability Analysis',
                        'Finance: Revenue Growth Analysis',
                        'Finance: Expense Management',
                        'Finance: Cash Flow Management',
                        'Finance: Budget vs. Actuals'],
 'communication_style': 'concise',
 'decision_style': 'analytical',
 'default_filters': {'customer_hierarchyid': ['Total'],
                     'profit_center_hierarchyid': ['Total']},
 'description': 'CFO responsible for financial performance in EMEA.',
 'name': 'Lars Mikkelsen',
 'role': 'CFO',
 'timeframes': ['Monthly', 'Quarterly'],
 'title': 'Chief Financial Officer'}
2025-09-01 09:56:43,922 - principal_context_test - INFO - === Testing fetch_principal_profile for role: cfo ===
2025-09-01 09:56:43,922 - principal_context_test - INFO - Calling fetch_principal_profile with role: cfo
2025-09-01 09:56:43,922 - principal_context_test - INFO - Successfully fetched profile for cfo
2025-09-01 09:56:43,923 - principal_context_test - INFO - Profile content:
2025-09-01 09:56:43,923 - principal_context_test - INFO - {'business_processes': ['Finance: Profitability Analysis',
                        'Finance: Revenue Growth Analysis',
                        'Finance: Expense Management',
                        'Finance: Cash Flow Management',
                        'Finance: Budget vs. Actuals'],
 'communication_style': 'concise',
 'decision_style': 'analytical',
 'default_filters': {'customer_hierarchyid': ['Total'],
                     'profit_center_hierarchyid': ['Total']},
 'description': 'CFO responsible for financial performance in EMEA.',
 'name': 'Lars Mikkelsen',
 'timeframes': ['Monthly', 'Quarterly'],
 'title': 'Chief Financial Officer'}
2025-09-01 09:56:43,924 - principal_context_test - INFO - === Testing get_principal_context for role: cfo ===
2025-09-01 09:56:43,924 - principal_context_test - INFO - Calling get_principal_context with role: cfo
2025-09-01 09:56:43,924 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Getting principal context for role: cfo
2025-09-01 09:56:43,924 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Mapped role 'cfo' to enum value 'PrincipalRole.CFO'
2025-09-01 09:56:43,925 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - ERROR - Error d78d94d6 in get_principal_context: 1 validation error for PrincipalProfileResponse
profile
  Field required [type=missing, input_value={'request_id': '9ad37266-...R: 'current_quarter'>])}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-09-01 09:56:43,926 - principal_context_test - ERROR - Error testing get_principal_context: 1 validation error for PrincipalProfileResponse
profile
  Field required [type=missing, input_value={'request_id': '9ad37266-...DATE: 'year_to_date'>])}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-09-01 09:56:43,929 - principal_context_test - INFO - === Testing fetch_principal_profile for role: ceo ===
2025-09-01 09:56:43,929 - principal_context_test - INFO - Calling fetch_principal_profile with role: ceo
2025-09-01 09:56:43,929 - principal_context_test - INFO - Successfully fetched profile for ceo
2025-09-01 09:56:43,930 - principal_context_test - INFO - Profile content:
2025-09-01 09:56:43,930 - principal_context_test - INFO - {'business_processes': ['Finance: Profitability Analysis',
                        'Finance: Revenue Growth Analysis',
                        'Finance: Expense Management',
                        'Finance: Cash Flow Management',
                        'Finance: Budget vs. Actuals'],
 'communication_style': 'inspirational',
 'decision_style': 'visionary',
 'default_filters': {'profit_center_hierarchyid': ['#']},
 'description': 'CEO driving company strategy and performance.',
 'name': 'Alex Morgan',
 'timeframes': ['Quarterly', 'Annually'],
 'title': 'Chief Executive Officer'}
2025-09-01 09:56:43,930 - principal_context_test - INFO - === Testing get_principal_context for role: ceo ===
2025-09-01 09:56:43,930 - principal_context_test - INFO - Calling get_principal_context with role: ceo
2025-09-01 09:56:43,931 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Getting principal context for role: ceo
2025-09-01 09:56:43,931 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Mapped role 'ceo' to enum value 'PrincipalRole.CFO'
2025-09-01 09:56:43,931 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - ERROR - Error db0efe63 in get_principal_context: 1 validation error for PrincipalProfileResponse
profile
  Field required [type=missing, input_value={'request_id': '1fa5445d-...YEAR: 'current_year'>])}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-09-01 09:56:43,932 - principal_context_test - ERROR - Error testing get_principal_context: 1 validation error for PrincipalProfileResponse
profile
  Field required [type=missing, input_value={'request_id': '1fa5445d-...DATE: 'year_to_date'>])}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-09-01 09:56:43,934 - principal_context_test - INFO - === Testing fetch_principal_profile for role: coo ===
2025-09-01 09:56:43,934 - principal_context_test - INFO - Calling fetch_principal_profile with role: coo
2025-09-01 09:56:43,935 - principal_context_test - INFO - Successfully fetched profile for coo
2025-09-01 09:56:43,935 - principal_context_test - INFO - Profile content:
2025-09-01 09:56:43,935 - principal_context_test - INFO - {'business_processes': ['finance_expense_management',
                        'finance_cash_flow',
                        'finance_budget_vs_actuals'],
 'communication_style': 'direct',
 'decision_style': 'pragmatic',
 'default_filters': {'customer_hierarchyid': ['17100001'],
                     'profit_center_hierarchyid': ['Best Run U']},
 'description': 'COO focused on operational excellence and efficiency.',
 'name': 'Priya Desai',
 'timeframes': ['Monthly', 'Quarterly'],
 'title': 'Chief Operating Officer'}
2025-09-01 09:56:43,935 - principal_context_test - INFO - === Testing get_principal_context for role: coo ===
2025-09-01 09:56:43,935 - principal_context_test - INFO - Calling get_principal_context with role: coo
2025-09-01 09:56:43,936 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Getting principal context for role: coo
2025-09-01 09:56:43,936 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Mapped role 'coo' to enum value 'PrincipalRole.CFO'
2025-09-01 09:56:43,936 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - ERROR - Error 7e7dbaa8 in get_principal_context: 1 validation error for PrincipalProfileResponse
profile
  Field required [type=missing, input_value={'request_id': '33b4c0ab-...R: 'current_quarter'>])}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-09-01 09:56:43,937 - principal_context_test - ERROR - Error testing get_principal_context: 1 validation error for PrincipalProfileResponse
profile
  Field required [type=missing, input_value={'request_id': '33b4c0ab-...DATE: 'year_to_date'>])}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-09-01 09:56:43,939 - principal_context_test - INFO - === Testing extract_filters ===
2025-09-01 09:56:43,939 - principal_context_test - INFO - Calling extract_filters with job description
2025-09-01 09:56:43,939 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Extracting filters from description: 
        As a CFO, I need to analyze the monthly f...
2025-09-01 09:56:43,940 - principal_context_test - INFO - Response status: success
2025-09-01 09:56:43,940 - principal_context_test - INFO - Response message: Extracted 7 filters from description
2025-09-01 09:56:43,941 - principal_context_test - INFO - Extracted filters: {'region': ['Europe'], 'time_period': ['monthly', 'year-to-date'], 'business_unit': ['Sales', 'Marketing', 'Operations', 'IT']}
2025-09-01 09:56:43,941 - principal_context_test - INFO -   region: Europe (confidence: 0.8)
2025-09-01 09:56:43,941 - principal_context_test - INFO -   time_period: monthly (confidence: 0.8)
2025-09-01 09:56:43,941 - principal_context_test - INFO -   time_period: year-to-date (confidence: 0.8)
2025-09-01 09:56:43,941 - principal_context_test - INFO -   business_unit: Sales (confidence: 0.7)
2025-09-01 09:56:43,942 - principal_context_test - INFO -   business_unit: Marketing (confidence: 0.7)
2025-09-01 09:56:43,942 - principal_context_test - INFO -   business_unit: Operations (confidence: 0.7)
2025-09-01 09:56:43,942 - principal_context_test - INFO -   business_unit: IT (confidence: 0.7)
2025-09-01 09:56:43,942 - principal_context_test - INFO - All tests completed successfully
2025-09-01 09:57:33,103 - principal_context_test - INFO - Starting Principal Context Agent tests
2025-09-01 09:57:33,104 - principal_context_test - INFO - === Testing Registry Structure ===
2025-09-01 09:57:33,104 - principal_context_test - INFO - Registry path: C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\principal\principal_registry.yaml
2025-09-01 09:57:33,120 - principal_context_test - INFO - Registry top-level keys: ['principals', 'roles']
2025-09-01 09:57:33,121 - principal_context_test - INFO - Found 3 principals in registry
2025-09-01 09:57:33,121 - principal_context_test - INFO - First principal:
2025-09-01 09:57:33,121 - principal_context_test - INFO -   ID: cfo_001
2025-09-01 09:57:33,121 - principal_context_test - INFO -   Name: Lars Mikkelsen
2025-09-01 09:57:33,121 - principal_context_test - INFO -   Role: CFO
2025-09-01 09:57:33,121 - principal_context_test - INFO -   Keys: ['id', 'name', 'title', 'first_name', 'last_name', 'role', 'department', 'responsibilities', 'business_processes', 'default_filters', 'typical_timeframes', 'principal_groups', 'persona_profile', 'preferences', 'permissions', 'source', 'description', 'time_frame', 'communication']
2025-09-01 09:57:33,123 - principal_context_test - INFO - === Testing Agent Initialization ===
2025-09-01 09:57:33,291 - principal_context_test - INFO - Creating agent instance
2025-09-01 09:57:33,291 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Initializing A9_Principal_Context_Agent
2025-09-01 09:57:33,292 - principal_context_test - INFO - Connecting agent
2025-09-01 09:57:33,292 - src.registry.factory - INFO - Registry Factory initialized
2025-09-01 09:57:33,292 - src.registry.factory - INFO - Registered principal_profile provider
2025-09-01 09:57:33,292 - src.registry.providers.principal_provider - INFO - Loading principal profiles from C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\principal\principal_registry.yaml (yaml)
2025-09-01 09:57:33,305 - src.registry.providers.principal_provider - INFO - Found 3 roles in YAML under 'roles' key
2025-09-01 09:57:33,305 - src.registry.providers.principal_provider - INFO - Found 3 principal profiles in YAML under 'principals' key
2025-09-01 09:57:33,305 - src.registry.providers.principal_provider - INFO - Registered principal: cfo_001 - Lars Mikkelsen
2025-09-01 09:57:33,306 - src.registry.providers.principal_provider - INFO - Registered principal: ceo_001 - Alex Morgan
2025-09-01 09:57:33,306 - src.registry.providers.principal_provider - INFO - Registered principal: coo_001 - Priya Desai
2025-09-01 09:57:33,306 - src.registry.providers.principal_provider - INFO - Added role ID mapping: cfo_001 -> Lars Mikkelsen
2025-09-01 09:57:33,306 - src.registry.providers.principal_provider - INFO - Added role ID mapping: ceo_001 -> Alex Morgan
2025-09-01 09:57:33,307 - src.registry.providers.principal_provider - INFO - Added role ID mapping: coo_001 -> Priya Desai
2025-09-01 09:57:33,307 - src.registry.providers.principal_provider - INFO - Loaded 3 principal profiles
2025-09-01 09:57:33,307 - src.registry.bootstrap - INFO - Initialized principal provider with 3 profiles
2025-09-01 09:57:33,308 - src.registry.factory - INFO - Registered data_product provider
2025-09-01 09:57:33,308 - src.registry.providers.data_product_provider - INFO - Loading data products from C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\data_product\data_product_registry.yaml (yaml)
2025-09-01 09:57:33,314 - src.registry.providers.data_product_provider - INFO - Loaded 1 data products
2025-09-01 09:57:33,314 - src.registry.bootstrap - INFO - Initialized data product provider with 1 data products
2025-09-01 09:57:33,315 - src.registry.bootstrap - INFO - Initializing agent bootstrap
2025-09-01 09:57:33,326 - src.agents.agent_bootstrap - WARNING - Found agent class A9_Data_Governance_Agent but it lacks a create method
2025-09-01 09:57:33,784 - src.agents.agent_bootstrap - WARNING - Found agent class A9_Data_Product_MCP_Service_Agent but it lacks a create method
2025-09-01 09:57:34,306 - src.agents.agent_bootstrap - WARNING - Found agent class A9_LLM_Service_Agent but it lacks a create method
2025-09-01 09:57:34,307 - src.agents.agent_bootstrap - WARNING - Found agent class A9_Orchestrator_Agent but it lacks a create method
2025-09-01 09:57:34,308 - src.agents.agent_bootstrap - WARNING - Found agent class A9_Principal_Context_Agent but it lacks a create method
2025-09-01 09:57:34,312 - src.agents.agent_bootstrap - WARNING - Found agent class A9_Data_Product_MCP_Service_Agent but it lacks a create method
2025-09-01 09:57:34,312 - src.agents.agent_bootstrap - WARNING - Found agent class A9_Orchestrator_Agent but it lacks a create method
2025-09-01 09:57:34,313 - src.agents.agent_bootstrap - WARNING - Found agent class A9_Situation_Awareness_Agent but it lacks a create method
2025-09-01 09:57:34,316 - src.agents.agent_bootstrap - WARNING - Found agent class A9_Data_Governance_Agent but it lacks a create method
2025-09-01 09:57:34,318 - src.agents.agent_bootstrap - WARNING - Found agent class A9_Orchestrator_Agent but it lacks a create method
2025-09-01 09:57:34,318 - src.agents.agent_bootstrap - WARNING - Found agent class A9_Principal_Context_Agent but it lacks a create method
2025-09-01 09:57:34,320 - src.agents.agent_bootstrap - WARNING - Found agent class A9_Data_Product_MCP_Service_Agent but it lacks a create method
2025-09-01 09:57:34,321 - src.agents.agent_bootstrap - WARNING - Found agent class A9_Orchestrator_Agent but it lacks a create method
2025-09-01 09:57:34,321 - src.agents.agent_bootstrap - WARNING - Found agent class A9_Situation_Awareness_Agent but it lacks a create method
2025-09-01 09:57:34,321 - src.agents.agent_bootstrap - WARNING - No agent implementations discovered
2025-09-01 09:57:34,322 - src.registry.bootstrap - WARNING - Agent bootstrap initialization had issues, continuing with available agents
2025-09-01 09:57:34,322 - src.registry.bootstrap - INFO - Registry providers and agent factories initialized successfully
2025-09-01 09:57:34,323 - src.registry.factory - WARNING - Provider 'principal_profile' exists but may not be properly initialized
2025-09-01 09:57:34,323 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - WARNING - No 'principals' key found in registry or no valid profiles, using defaults
2025-09-01 09:57:34,335 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Loaded 3 principal profiles from registry file
2025-09-01 09:57:34,336 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Connected to dependencies
2025-09-01 09:57:34,336 - principal_context_test - INFO - Agent connected successfully
2025-09-01 09:57:34,336 - principal_context_test - INFO - Loaded 3 principal profiles
2025-09-01 09:57:34,336 - principal_context_test - INFO - Available roles: ['cfo', 'ceo', 'coo']
2025-09-01 09:57:34,337 - principal_context_test - INFO - First profile (cfo):
2025-09-01 09:57:34,337 - principal_context_test - INFO - {'business_processes': ['Finance: Profitability Analysis',
                        'Finance: Revenue Growth Analysis',
                        'Finance: Expense Management',
                        'Finance: Cash Flow Management',
                        'Finance: Budget vs. Actuals'],
 'communication_style': 'concise',
 'decision_style': 'analytical',
 'default_filters': {'customer_hierarchyid': ['Total'],
                     'profit_center_hierarchyid': ['Total']},
 'description': 'CFO responsible for financial performance in EMEA.',
 'name': 'Lars Mikkelsen',
 'role': 'CFO',
 'timeframes': ['Monthly', 'Quarterly'],
 'title': 'Chief Financial Officer'}
2025-09-01 09:57:34,337 - principal_context_test - INFO - === Testing fetch_principal_profile for role: cfo ===
2025-09-01 09:57:34,338 - principal_context_test - INFO - Calling fetch_principal_profile with role: cfo
2025-09-01 09:57:34,338 - principal_context_test - INFO - Successfully fetched profile for cfo
2025-09-01 09:57:34,338 - principal_context_test - INFO - Profile content:
2025-09-01 09:57:34,339 - principal_context_test - INFO - {'business_processes': ['Finance: Profitability Analysis',
                        'Finance: Revenue Growth Analysis',
                        'Finance: Expense Management',
                        'Finance: Cash Flow Management',
                        'Finance: Budget vs. Actuals'],
 'communication_style': 'concise',
 'decision_style': 'analytical',
 'default_filters': {'customer_hierarchyid': ['Total'],
                     'profit_center_hierarchyid': ['Total']},
 'description': 'CFO responsible for financial performance in EMEA.',
 'name': 'Lars Mikkelsen',
 'timeframes': ['Monthly', 'Quarterly'],
 'title': 'Chief Financial Officer'}
2025-09-01 09:57:34,340 - principal_context_test - INFO - === Testing get_principal_context for role: cfo ===
2025-09-01 09:57:34,340 - principal_context_test - INFO - Calling get_principal_context with role: cfo
2025-09-01 09:57:34,340 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Getting principal context for role: cfo
2025-09-01 09:57:34,340 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Mapped role 'cfo' to enum value 'PrincipalRole.CFO'
2025-09-01 09:57:34,341 - principal_context_test - INFO - Response status: success
2025-09-01 09:57:34,341 - principal_context_test - INFO - Response message: Principal context retrieved for cfo
2025-09-01 09:57:34,341 - principal_context_test - INFO - Context role: PrincipalRole.CFO
2025-09-01 09:57:34,341 - principal_context_test - INFO - Context business processes: ['BusinessProcess.PROFITABILITY_ANALYSIS', 'BusinessProcess.REVENUE_GROWTH', 'BusinessProcess.EXPENSE_MANAGEMENT', 'BusinessProcess.CASH_FLOW', 'BusinessProcess.BUDGET_VS_ACTUALS']
2025-09-01 09:57:34,342 - principal_context_test - INFO - Context default filters: {'profit_center_hierarchyid': ['Total'], 'customer_hierarchyid': ['Total']}
2025-09-01 09:57:34,342 - principal_context_test - INFO - Context decision style: analytical
2025-09-01 09:57:34,342 - principal_context_test - INFO - Context communication style: concise
2025-09-01 09:57:34,342 - principal_context_test - INFO - Context preferred timeframes: ['TimeFrame.CURRENT_MONTH', 'TimeFrame.CURRENT_QUARTER']
2025-09-01 09:57:34,342 - principal_context_test - INFO - === Testing fetch_principal_profile for role: ceo ===
2025-09-01 09:57:34,343 - principal_context_test - INFO - Calling fetch_principal_profile with role: ceo
2025-09-01 09:57:34,343 - principal_context_test - INFO - Successfully fetched profile for ceo
2025-09-01 09:57:34,343 - principal_context_test - INFO - Profile content:
2025-09-01 09:57:34,343 - principal_context_test - INFO - {'business_processes': ['Finance: Profitability Analysis',
                        'Finance: Revenue Growth Analysis',
                        'Finance: Expense Management',
                        'Finance: Cash Flow Management',
                        'Finance: Budget vs. Actuals'],
 'communication_style': 'inspirational',
 'decision_style': 'visionary',
 'default_filters': {'profit_center_hierarchyid': ['#']},
 'description': 'CEO driving company strategy and performance.',
 'name': 'Alex Morgan',
 'timeframes': ['Quarterly', 'Annually'],
 'title': 'Chief Executive Officer'}
2025-09-01 09:57:34,344 - principal_context_test - INFO - === Testing get_principal_context for role: ceo ===
2025-09-01 09:57:34,344 - principal_context_test - INFO - Calling get_principal_context with role: ceo
2025-09-01 09:57:34,344 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Getting principal context for role: ceo
2025-09-01 09:57:34,345 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Mapped role 'ceo' to enum value 'PrincipalRole.CFO'
2025-09-01 09:57:34,345 - principal_context_test - INFO - Response status: success
2025-09-01 09:57:34,345 - principal_context_test - INFO - Response message: Principal context retrieved for ceo
2025-09-01 09:57:34,345 - principal_context_test - INFO - Context role: PrincipalRole.CFO
2025-09-01 09:57:34,346 - principal_context_test - INFO - Context business processes: ['BusinessProcess.PROFITABILITY_ANALYSIS', 'BusinessProcess.REVENUE_GROWTH', 'BusinessProcess.EXPENSE_MANAGEMENT', 'BusinessProcess.CASH_FLOW', 'BusinessProcess.BUDGET_VS_ACTUALS']
2025-09-01 09:57:34,346 - principal_context_test - INFO - Context default filters: {'profit_center_hierarchyid': ['#']}
2025-09-01 09:57:34,346 - principal_context_test - INFO - Context decision style: visionary
2025-09-01 09:57:34,346 - principal_context_test - INFO - Context communication style: inspirational
2025-09-01 09:57:34,346 - principal_context_test - INFO - Context preferred timeframes: ['TimeFrame.CURRENT_QUARTER', 'TimeFrame.CURRENT_YEAR']
2025-09-01 09:57:34,346 - principal_context_test - INFO - === Testing fetch_principal_profile for role: coo ===
2025-09-01 09:57:34,347 - principal_context_test - INFO - Calling fetch_principal_profile with role: coo
2025-09-01 09:57:34,347 - principal_context_test - INFO - Successfully fetched profile for coo
2025-09-01 09:57:34,347 - principal_context_test - INFO - Profile content:
2025-09-01 09:57:34,347 - principal_context_test - INFO - {'business_processes': ['finance_expense_management',
                        'finance_cash_flow',
                        'finance_budget_vs_actuals'],
 'communication_style': 'direct',
 'decision_style': 'pragmatic',
 'default_filters': {'customer_hierarchyid': ['17100001'],
                     'profit_center_hierarchyid': ['Best Run U']},
 'description': 'COO focused on operational excellence and efficiency.',
 'name': 'Priya Desai',
 'timeframes': ['Monthly', 'Quarterly'],
 'title': 'Chief Operating Officer'}
2025-09-01 09:57:34,348 - principal_context_test - INFO - === Testing get_principal_context for role: coo ===
2025-09-01 09:57:34,349 - principal_context_test - INFO - Calling get_principal_context with role: coo
2025-09-01 09:57:34,349 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Getting principal context for role: coo
2025-09-01 09:57:34,349 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Mapped role 'coo' to enum value 'PrincipalRole.CFO'
2025-09-01 09:57:34,350 - principal_context_test - INFO - Response status: success
2025-09-01 09:57:34,350 - principal_context_test - INFO - Response message: Principal context retrieved for coo
2025-09-01 09:57:34,350 - principal_context_test - INFO - Context role: PrincipalRole.CFO
2025-09-01 09:57:34,350 - principal_context_test - INFO - Context business processes: ['BusinessProcess.PROFITABILITY_ANALYSIS', 'BusinessProcess.REVENUE_GROWTH', 'BusinessProcess.EXPENSE_MANAGEMENT', 'BusinessProcess.CASH_FLOW', 'BusinessProcess.BUDGET_VS_ACTUALS']
2025-09-01 09:57:34,351 - principal_context_test - INFO - Context default filters: {'profit_center_hierarchyid': ['Best Run U'], 'customer_hierarchyid': ['17100001']}
2025-09-01 09:57:34,351 - principal_context_test - INFO - Context decision style: pragmatic
2025-09-01 09:57:34,351 - principal_context_test - INFO - Context communication style: direct
2025-09-01 09:57:34,351 - principal_context_test - INFO - Context preferred timeframes: ['TimeFrame.CURRENT_MONTH', 'TimeFrame.CURRENT_QUARTER']
2025-09-01 09:57:34,351 - principal_context_test - INFO - === Testing extract_filters ===
2025-09-01 09:57:34,351 - principal_context_test - INFO - Calling extract_filters with job description
2025-09-01 09:57:34,352 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Extracting filters from description: 
        As a CFO, I need to analyze the monthly f...
2025-09-01 09:57:34,352 - principal_context_test - INFO - Response status: success
2025-09-01 09:57:34,352 - principal_context_test - INFO - Response message: Extracted 7 filters from description
2025-09-01 09:57:34,353 - principal_context_test - INFO - Extracted filters: {'region': ['Europe'], 'time_period': ['monthly', 'year-to-date'], 'business_unit': ['Sales', 'Marketing', 'Operations', 'IT']}
2025-09-01 09:57:34,353 - principal_context_test - INFO -   region: Europe (confidence: 0.8)
2025-09-01 09:57:34,353 - principal_context_test - INFO -   time_period: monthly (confidence: 0.8)
2025-09-01 09:57:34,353 - principal_context_test - INFO -   time_period: year-to-date (confidence: 0.8)
2025-09-01 09:57:34,354 - principal_context_test - INFO -   business_unit: Sales (confidence: 0.7)
2025-09-01 09:57:34,354 - principal_context_test - INFO -   business_unit: Marketing (confidence: 0.7)
2025-09-01 09:57:34,354 - principal_context_test - INFO -   business_unit: Operations (confidence: 0.7)
2025-09-01 09:57:34,354 - principal_context_test - INFO -   business_unit: IT (confidence: 0.7)
2025-09-01 09:57:34,354 - principal_context_test - INFO - All tests completed successfully
2025-09-02 10:29:04,055 - asyncio - DEBUG - Using proactor: IocpProactor
2025-09-02 10:29:04,057 - principal_context_agent_test - INFO - Starting Principal Context Agent tests
2025-09-02 10:29:04,059 - principal_context_agent_test - INFO - Step 1: Testing registry structure
2025-09-02 10:29:04,060 - principal_context_agent_test - INFO - === Testing registry structure ===
2025-09-02 10:29:04,062 - principal_context_agent_test - INFO - Initializing registry bootstrap
2025-09-02 10:29:04,062 - src.registry.factory - INFO - Registry Factory initialized
2025-09-02 10:29:04,063 - src.registry.factory - INFO - Registered principal_profile provider
2025-09-02 10:29:04,065 - src.registry.providers.principal_provider - INFO - Loading principal profiles from C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\principal\principal_registry.yaml (yaml)
2025-09-02 10:29:04,095 - src.registry.providers.principal_provider - INFO - Found 4 roles in YAML under 'roles' key
2025-09-02 10:29:04,099 - src.registry.providers.principal_provider - DEBUG - Registered role: cfo_001 - CFO
2025-09-02 10:29:04,100 - src.registry.providers.principal_provider - DEBUG - Registered role: ceo_001 - CEO
2025-09-02 10:29:04,100 - src.registry.providers.principal_provider - DEBUG - Registered role: coo_001 - COO
2025-09-02 10:29:04,101 - src.registry.providers.principal_provider - DEBUG - Registered role: finance_manager_001 - Finance Manager
2025-09-02 10:29:04,101 - src.registry.providers.principal_provider - INFO - Found 4 principal profiles in YAML under 'principals' key
2025-09-02 10:29:04,105 - src.registry.providers.principal_provider - DEBUG - Mapped role name CFO to principal ID cfo_001
2025-09-02 10:29:04,106 - src.registry.providers.principal_provider - INFO - Registered principal: cfo_001 - Lars Mikkelsen
2025-09-02 10:29:04,106 - src.registry.providers.principal_provider - DEBUG - Mapped role name CEO to principal ID ceo_001
2025-09-02 10:29:04,106 - src.registry.providers.principal_provider - INFO - Registered principal: ceo_001 - Alex Morgan
2025-09-02 10:29:04,107 - src.registry.providers.principal_provider - DEBUG - Mapped role name COO to principal ID coo_001
2025-09-02 10:29:04,107 - src.registry.providers.principal_provider - INFO - Registered principal: coo_001 - Priya Desai
2025-09-02 10:29:04,108 - src.registry.providers.principal_provider - DEBUG - Mapped role name Finance Manager to principal ID finance_manager_001
2025-09-02 10:29:04,108 - src.registry.providers.principal_provider - INFO - Registered principal: finance_manager_001 - Emily Chen
2025-09-02 10:29:04,109 - src.registry.providers.principal_provider - INFO - Added role ID mapping: cfo_001 -> Lars Mikkelsen
2025-09-02 10:29:04,109 - src.registry.providers.principal_provider - INFO - Added role ID mapping: ceo_001 -> Alex Morgan
2025-09-02 10:29:04,110 - src.registry.providers.principal_provider - INFO - Added role ID mapping: coo_001 -> Priya Desai
2025-09-02 10:29:04,111 - src.registry.providers.principal_provider - INFO - Added role ID mapping: finance_manager_001 -> Emily Chen
2025-09-02 10:29:04,112 - src.registry.providers.principal_provider - INFO - Loaded 4 principal profiles
2025-09-02 10:29:04,117 - src.registry.bootstrap - INFO - Initialized principal provider with 4 profiles
2025-09-02 10:29:04,124 - src.registry.factory - WARNING - Provider 'business_glossary' not found in registry factory
2025-09-02 10:29:04,128 - src.registry.bootstrap - INFO - Initializing business glossary provider
2025-09-02 10:29:04,140 - src.registry.providers.business_glossary_provider - INFO - Loaded 4 business terms from glossary
2025-09-02 10:29:04,140 - src.registry.factory - INFO - Registered business_glossary provider
2025-09-02 10:29:04,141 - src.registry.bootstrap - INFO - Initialized business glossary provider with 4 terms
2025-09-02 10:29:04,142 - src.registry.factory - INFO - Registered data_product provider
2025-09-02 10:29:04,142 - src.registry.providers.data_product_provider - INFO - Loading data products from C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\data_product\data_product_registry.yaml (yaml)
2025-09-02 10:29:04,154 - src.registry.providers.data_product_provider - INFO - Loaded 1 data products
2025-09-02 10:29:04,156 - src.registry.bootstrap - INFO - Initialized data product provider with 1 data products
2025-09-02 10:29:04,157 - src.registry.bootstrap - INFO - Initializing KPI provider
2025-09-02 10:29:04,158 - src.registry.factory - WARNING - Provider 'kpi' not found in registry factory
2025-09-02 10:29:04,159 - src.registry.bootstrap - INFO - Creating KPI provider with file at C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\kpi\kpi_registry.yaml
2025-09-02 10:29:04,160 - src.registry.bootstrap - INFO - Registering KPI provider with registry factory
2025-09-02 10:29:04,161 - src.registry.factory - INFO - Registered kpi provider
2025-09-02 10:29:04,161 - src.registry.bootstrap - INFO - Loading KPI provider data
2025-09-02 10:29:04,162 - src.registry.providers.kpi_provider - INFO - Loading KPIs from C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\kpi\kpi_registry.yaml (yaml)
2025-09-02 10:29:04,188 - src.registry.providers.kpi_provider - INFO - Loaded 6 KPIs
2025-09-02 10:29:04,189 - src.registry.bootstrap - INFO - KPI provider successfully registered and initialized with 6 KPIs
2025-09-02 10:29:04,190 - src.registry.bootstrap - INFO - Initializing agent bootstrap
2025-09-02 10:29:04,191 - src.agents.agent_bootstrap - WARNING - No agent implementations discovered
2025-09-02 10:29:04,191 - src.registry.bootstrap - WARNING - Agent bootstrap initialization had issues, continuing with available agents
2025-09-02 10:29:04,191 - src.registry.bootstrap - INFO - Registry providers and agent factories initialized successfully
2025-09-02 10:29:04,196 - principal_context_agent_test - INFO - Registry bootstrap initialized successfully
2025-09-02 10:29:04,196 - principal_context_agent_test - INFO - Got RegistryFactory from bootstrap
2025-09-02 10:29:04,196 - principal_context_agent_test - INFO - Provider status: {'principal_profile': True, 'business_glossary': True, 'data_product': False, 'kpi': True}
2025-09-02 10:29:04,198 - principal_context_agent_test - INFO - principal_profile provider status: True
2025-09-02 10:29:04,199 - principal_context_agent_test - INFO - Got principal provider: <src.registry.providers.principal_provider.PrincipalProfileProvider object at 0x000001D88FED6790>
2025-09-02 10:29:04,201 - principal_context_agent_test - INFO - Provider methods: ['__abstractmethods__', '__class__', '__class_getitem__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__orig_bases__', '__parameters__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', '__weakref__', '_abc_impl', '_add_profile', '_extract_profiles_from_module', '_is_protocol', '_load_default_profiles', '_load_from_json', '_load_from_python_module', '_load_from_yaml', '_profiles', '_profiles_by_name', '_profiles_by_title', '_registry_base_path', 'find_by_attribute', 'find_by_business_process', 'find_by_kpi', 'get', 'get_all', 'get_registry_path', 'initialize', 'load', 'register', 'source_path', 'storage_format']
2025-09-02 10:29:04,202 - principal_context_agent_test - INFO - Principal registry file exists at: C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\principal\principal_registry.yaml
2025-09-02 10:29:04,203 - principal_context_agent_test - INFO - Registry file content length: 6517 bytes
2025-09-02 10:29:04,203 - principal_context_agent_test - INFO - Registry file first 100 chars: # Principal Registry
# Contains all principal profiles for personalization and context-aware process...
2025-09-02 10:29:04,203 - principal_context_agent_test - INFO - Got registry data type: <class 'list'>
2025-09-02 10:29:04,204 - principal_context_agent_test - INFO - Found 4 principals in registry
2025-09-02 10:29:04,204 - principal_context_agent_test - INFO - Principal 1 details:
2025-09-02 10:29:04,205 - principal_context_agent_test - INFO -   ID: cfo_001
2025-09-02 10:29:04,205 - principal_context_agent_test - INFO -   Name: Lars Mikkelsen
2025-09-02 10:29:04,206 - principal_context_agent_test - INFO -   Role: N/A
2025-09-02 10:29:04,206 - principal_context_agent_test - INFO -   Title: Chief Financial Officer
2025-09-02 10:29:04,206 - principal_context_agent_test - INFO -   Business Processes: ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals']
2025-09-02 10:29:04,208 - principal_context_agent_test - INFO -   All attributes: ['__abstractmethods__', '__annotations__', '__class__', '__class_getitem__', '__class_vars__', '__copy__', '__deepcopy__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__fields__', '__fields_set__', '__format__', '__ge__', '__get_pydantic_core_schema__', '__get_pydantic_json_schema__', '__getattr__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__iter__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__pretty__', '__private_attributes__', '__pydantic_complete__', '__pydantic_computed_fields__', '__pydantic_core_schema__', '__pydantic_custom_init__', '__pydantic_decorators__', '__pydantic_extra__', '__pydantic_fields__', '__pydantic_fields_set__', '__pydantic_generic_metadata__', '__pydantic_init_subclass__', '__pydantic_parent_namespace__', '__pydantic_post_init__', '__pydantic_private__', '__pydantic_root_model__', '__pydantic_serializer__', '__pydantic_setattr_handlers__', '__pydantic_validator__', '__reduce__', '__reduce_ex__', '__replace__', '__repr__', '__repr_args__', '__repr_name__', '__repr_recursion__', '__repr_str__', '__rich_repr__', '__setattr__', '__setstate__', '__signature__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', '__weakref__', '_abc_impl', '_calculate_keys', '_copy_and_set_values', '_get_value', '_iter', '_setattr_handler', 'business_processes', 'communication', 'construct', 'copy', 'default_filters', 'description', 'dict', 'from_orm', 'id', 'json', 'kpis', 'metadata', 'model_computed_fields', 'model_config', 'model_construct', 'model_copy', 'model_dump', 'model_dump_json', 'model_extra', 'model_fields', 'model_fields_set', 'model_json_schema', 'model_parametrized_name', 'model_post_init', 'model_rebuild', 'model_validate', 'model_validate_json', 'model_validate_strings', 'name', 'parse_file', 'parse_obj', 'parse_raw', 'responsibilities', 'schema', 'schema_json', 'time_frame', 'title', 'to_dict', 'update_forward_refs', 'validate']
2025-09-02 10:29:04,210 - principal_context_agent_test - INFO -   Dict representation: {'id': 'cfo_001', 'name': 'Lars Mikkelsen', 'title': 'Chief Financial Officer', 'description': 'CFO responsible for financial performance in EMEA.', 'business_processes': ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals'], 'kpis': [], 'responsibilities': ['maximize EBIT', 'manage revenue', 'control expenses'], 'default_filters': {'profit_center_hierarchyid': ['Total'], 'customer_hierarchyid': ['Total']}, 'time_frame': {'default_period': 'QTD', 'historical_periods': 4, 'forward_looking_periods': 2}, 'communication': {'detail_level': 'high', 'format_preference': ['visual', 'text', 'table'], 'emphasis': ['trends', 'anomalies', 'forecasts']}, 'metadata': {}}
2025-09-02 10:29:04,210 - principal_context_agent_test - INFO -   __dict__ representation: {'id': 'cfo_001', 'name': 'Lars Mikkelsen', 'title': 'Chief Financial Officer', 'description': 'CFO responsible for financial performance in EMEA.', 'business_processes': ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals'], 'kpis': [], 'responsibilities': ['maximize EBIT', 'manage revenue', 'control expenses'], 'default_filters': {'profit_center_hierarchyid': ['Total'], 'customer_hierarchyid': ['Total']}, 'time_frame': TimeFrame(default_period='QTD', historical_periods=4, forward_looking_periods=2), 'communication': CommunicationPreference(detail_level='high', format_preference=['visual', 'text', 'table'], emphasis=['trends', 'anomalies', 'forecasts']), 'metadata': {}}
2025-09-02 10:29:04,211 - principal_context_agent_test - INFO - Principal 2 details:
2025-09-02 10:29:04,211 - principal_context_agent_test - INFO -   ID: ceo_001
2025-09-02 10:29:04,211 - principal_context_agent_test - INFO -   Name: Alex Morgan
2025-09-02 10:29:04,212 - principal_context_agent_test - INFO -   Role: N/A
2025-09-02 10:29:04,212 - principal_context_agent_test - INFO -   Title: Chief Executive Officer
2025-09-02 10:29:04,212 - principal_context_agent_test - INFO -   Business Processes: ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals']
2025-09-02 10:29:04,215 - principal_context_agent_test - INFO -   All attributes: ['__abstractmethods__', '__annotations__', '__class__', '__class_getitem__', '__class_vars__', '__copy__', '__deepcopy__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__fields__', '__fields_set__', '__format__', '__ge__', '__get_pydantic_core_schema__', '__get_pydantic_json_schema__', '__getattr__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__iter__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__pretty__', '__private_attributes__', '__pydantic_complete__', '__pydantic_computed_fields__', '__pydantic_core_schema__', '__pydantic_custom_init__', '__pydantic_decorators__', '__pydantic_extra__', '__pydantic_fields__', '__pydantic_fields_set__', '__pydantic_generic_metadata__', '__pydantic_init_subclass__', '__pydantic_parent_namespace__', '__pydantic_post_init__', '__pydantic_private__', '__pydantic_root_model__', '__pydantic_serializer__', '__pydantic_setattr_handlers__', '__pydantic_validator__', '__reduce__', '__reduce_ex__', '__replace__', '__repr__', '__repr_args__', '__repr_name__', '__repr_recursion__', '__repr_str__', '__rich_repr__', '__setattr__', '__setstate__', '__signature__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', '__weakref__', '_abc_impl', '_calculate_keys', '_copy_and_set_values', '_get_value', '_iter', '_setattr_handler', 'business_processes', 'communication', 'construct', 'copy', 'default_filters', 'description', 'dict', 'from_orm', 'id', 'json', 'kpis', 'metadata', 'model_computed_fields', 'model_config', 'model_construct', 'model_copy', 'model_dump', 'model_dump_json', 'model_extra', 'model_fields', 'model_fields_set', 'model_json_schema', 'model_parametrized_name', 'model_post_init', 'model_rebuild', 'model_validate', 'model_validate_json', 'model_validate_strings', 'name', 'parse_file', 'parse_obj', 'parse_raw', 'responsibilities', 'schema', 'schema_json', 'time_frame', 'title', 'to_dict', 'update_forward_refs', 'validate']
2025-09-02 10:29:04,217 - principal_context_agent_test - INFO -   Dict representation: {'id': 'ceo_001', 'name': 'Alex Morgan', 'title': 'Chief Executive Officer', 'description': 'CEO driving company strategy and performance.', 'business_processes': ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals'], 'kpis': [], 'responsibilities': ['set strategic direction', 'oversee company performance', 'lead executive team'], 'default_filters': {'profit_center_hierarchyid': ['#']}, 'time_frame': {'default_period': 'YTD', 'historical_periods': 3, 'forward_looking_periods': 4}, 'communication': {'detail_level': 'medium', 'format_preference': ['visual', 'summary'], 'emphasis': ['trends', 'strategic_impact']}, 'metadata': {}}
2025-09-02 10:29:04,219 - principal_context_agent_test - INFO -   __dict__ representation: {'id': 'ceo_001', 'name': 'Alex Morgan', 'title': 'Chief Executive Officer', 'description': 'CEO driving company strategy and performance.', 'business_processes': ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals'], 'kpis': [], 'responsibilities': ['set strategic direction', 'oversee company performance', 'lead executive team'], 'default_filters': {'profit_center_hierarchyid': ['#']}, 'time_frame': TimeFrame(default_period='YTD', historical_periods=3, forward_looking_periods=4), 'communication': CommunicationPreference(detail_level='medium', format_preference=['visual', 'summary'], emphasis=['trends', 'strategic_impact']), 'metadata': {}}
2025-09-02 10:29:04,219 - principal_context_agent_test - INFO - Principal 3 details:
2025-09-02 10:29:04,220 - principal_context_agent_test - INFO -   ID: coo_001
2025-09-02 10:29:04,220 - principal_context_agent_test - INFO -   Name: Priya Desai
2025-09-02 10:29:04,220 - principal_context_agent_test - INFO -   Role: N/A
2025-09-02 10:29:04,220 - principal_context_agent_test - INFO -   Title: Chief Operating Officer
2025-09-02 10:29:04,221 - principal_context_agent_test - INFO -   Business Processes: ['finance_expense_management', 'finance_cash_flow', 'finance_budget_vs_actuals']
2025-09-02 10:29:04,222 - principal_context_agent_test - INFO -   All attributes: ['__abstractmethods__', '__annotations__', '__class__', '__class_getitem__', '__class_vars__', '__copy__', '__deepcopy__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__fields__', '__fields_set__', '__format__', '__ge__', '__get_pydantic_core_schema__', '__get_pydantic_json_schema__', '__getattr__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__iter__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__pretty__', '__private_attributes__', '__pydantic_complete__', '__pydantic_computed_fields__', '__pydantic_core_schema__', '__pydantic_custom_init__', '__pydantic_decorators__', '__pydantic_extra__', '__pydantic_fields__', '__pydantic_fields_set__', '__pydantic_generic_metadata__', '__pydantic_init_subclass__', '__pydantic_parent_namespace__', '__pydantic_post_init__', '__pydantic_private__', '__pydantic_root_model__', '__pydantic_serializer__', '__pydantic_setattr_handlers__', '__pydantic_validator__', '__reduce__', '__reduce_ex__', '__replace__', '__repr__', '__repr_args__', '__repr_name__', '__repr_recursion__', '__repr_str__', '__rich_repr__', '__setattr__', '__setstate__', '__signature__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', '__weakref__', '_abc_impl', '_calculate_keys', '_copy_and_set_values', '_get_value', '_iter', '_setattr_handler', 'business_processes', 'communication', 'construct', 'copy', 'default_filters', 'description', 'dict', 'from_orm', 'id', 'json', 'kpis', 'metadata', 'model_computed_fields', 'model_config', 'model_construct', 'model_copy', 'model_dump', 'model_dump_json', 'model_extra', 'model_fields', 'model_fields_set', 'model_json_schema', 'model_parametrized_name', 'model_post_init', 'model_rebuild', 'model_validate', 'model_validate_json', 'model_validate_strings', 'name', 'parse_file', 'parse_obj', 'parse_raw', 'responsibilities', 'schema', 'schema_json', 'time_frame', 'title', 'to_dict', 'update_forward_refs', 'validate']
2025-09-02 10:29:04,224 - principal_context_agent_test - INFO -   Dict representation: {'id': 'coo_001', 'name': 'Priya Desai', 'title': 'Chief Operating Officer', 'description': 'COO focused on operational excellence and efficiency.', 'business_processes': ['finance_expense_management', 'finance_cash_flow', 'finance_budget_vs_actuals'], 'kpis': [], 'responsibilities': ['optimize operations', 'reduce operational costs', 'improve process efficiency'], 'default_filters': {'profit_center_hierarchyid': ['Best Run U'], 'customer_hierarchyid': ['17100001']}, 'time_frame': {'default_period': 'MTD', 'historical_periods': 6, 'forward_looking_periods': 2}, 'communication': {'detail_level': 'high', 'format_preference': ['table', 'visual'], 'emphasis': ['variances', 'operational_metrics']}, 'metadata': {}}
2025-09-02 10:29:04,225 - principal_context_agent_test - INFO -   __dict__ representation: {'id': 'coo_001', 'name': 'Priya Desai', 'title': 'Chief Operating Officer', 'description': 'COO focused on operational excellence and efficiency.', 'business_processes': ['finance_expense_management', 'finance_cash_flow', 'finance_budget_vs_actuals'], 'kpis': [], 'responsibilities': ['optimize operations', 'reduce operational costs', 'improve process efficiency'], 'default_filters': {'profit_center_hierarchyid': ['Best Run U'], 'customer_hierarchyid': ['17100001']}, 'time_frame': TimeFrame(default_period='MTD', historical_periods=6, forward_looking_periods=2), 'communication': CommunicationPreference(detail_level='high', format_preference=['table', 'visual'], emphasis=['variances', 'operational_metrics']), 'metadata': {}}
2025-09-02 10:29:04,226 - principal_context_agent_test - INFO - Principal 4 details:
2025-09-02 10:29:04,227 - principal_context_agent_test - INFO -   ID: finance_manager_001
2025-09-02 10:29:04,227 - principal_context_agent_test - INFO -   Name: Emily Chen
2025-09-02 10:29:04,227 - principal_context_agent_test - INFO -   Role: N/A
2025-09-02 10:29:04,227 - principal_context_agent_test - INFO -   Title: Finance Manager
2025-09-02 10:29:04,228 - principal_context_agent_test - INFO -   Business Processes: ['Finance: Expense Management', 'Finance: Budget vs. Actuals', 'Finance: Cash Flow Management']
2025-09-02 10:29:04,229 - principal_context_agent_test - INFO -   All attributes: ['__abstractmethods__', '__annotations__', '__class__', '__class_getitem__', '__class_vars__', '__copy__', '__deepcopy__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__fields__', '__fields_set__', '__format__', '__ge__', '__get_pydantic_core_schema__', '__get_pydantic_json_schema__', '__getattr__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__iter__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__pretty__', '__private_attributes__', '__pydantic_complete__', '__pydantic_computed_fields__', '__pydantic_core_schema__', '__pydantic_custom_init__', '__pydantic_decorators__', '__pydantic_extra__', '__pydantic_fields__', '__pydantic_fields_set__', '__pydantic_generic_metadata__', '__pydantic_init_subclass__', '__pydantic_parent_namespace__', '__pydantic_post_init__', '__pydantic_private__', '__pydantic_root_model__', '__pydantic_serializer__', '__pydantic_setattr_handlers__', '__pydantic_validator__', '__reduce__', '__reduce_ex__', '__replace__', '__repr__', '__repr_args__', '__repr_name__', '__repr_recursion__', '__repr_str__', '__rich_repr__', '__setattr__', '__setstate__', '__signature__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', '__weakref__', '_abc_impl', '_calculate_keys', '_copy_and_set_values', '_get_value', '_iter', '_setattr_handler', 'business_processes', 'communication', 'construct', 'copy', 'default_filters', 'description', 'dict', 'from_orm', 'id', 'json', 'kpis', 'metadata', 'model_computed_fields', 'model_config', 'model_construct', 'model_copy', 'model_dump', 'model_dump_json', 'model_extra', 'model_fields', 'model_fields_set', 'model_json_schema', 'model_parametrized_name', 'model_post_init', 'model_rebuild', 'model_validate', 'model_validate_json', 'model_validate_strings', 'name', 'parse_file', 'parse_obj', 'parse_raw', 'responsibilities', 'schema', 'schema_json', 'time_frame', 'title', 'to_dict', 'update_forward_refs', 'validate']
2025-09-02 10:29:04,231 - principal_context_agent_test - INFO -   Dict representation: {'id': 'finance_manager_001', 'name': 'Emily Chen', 'title': 'Finance Manager', 'description': 'Finance Manager responsible for departmental financial analysis and reporting.', 'business_processes': ['Finance: Expense Management', 'Finance: Budget vs. Actuals', 'Finance: Cash Flow Management'], 'kpis': [], 'responsibilities': ['manage departmental budget', 'analyze financial data', 'prepare financial reports'], 'default_filters': {'profit_center_hierarchyid': ['Finance'], 'customer_hierarchyid': ['Total']}, 'time_frame': {'default_period': 'MTD', 'historical_periods': 6, 'forward_looking_periods': 3}, 'communication': {'detail_level': 'high', 'format_preference': ['table', 'visual', 'text'], 'emphasis': ['variances', 'trends', 'forecasts']}, 'metadata': {}}
2025-09-02 10:29:04,234 - principal_context_agent_test - INFO -   __dict__ representation: {'id': 'finance_manager_001', 'name': 'Emily Chen', 'title': 'Finance Manager', 'description': 'Finance Manager responsible for departmental financial analysis and reporting.', 'business_processes': ['Finance: Expense Management', 'Finance: Budget vs. Actuals', 'Finance: Cash Flow Management'], 'kpis': [], 'responsibilities': ['manage departmental budget', 'analyze financial data', 'prepare financial reports'], 'default_filters': {'profit_center_hierarchyid': ['Finance'], 'customer_hierarchyid': ['Total']}, 'time_frame': TimeFrame(default_period='MTD', historical_periods=6, forward_looking_periods=3), 'communication': CommunicationPreference(detail_level='high', format_preference=['table', 'visual', 'text'], emphasis=['variances', 'trends', 'forecasts']), 'metadata': {}}
2025-09-02 10:29:04,235 - principal_context_agent_test - INFO - Step 2: Testing loading principal profiles
2025-09-02 10:29:04,235 - principal_context_agent_test - INFO - === Testing loading principal profiles ===
2025-09-02 10:29:04,236 - principal_context_agent_test - INFO - Creating Principal Context Agent
2025-09-02 10:29:04,236 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Initializing A9_Principal_Context_Agent
2025-09-02 10:29:04,236 - principal_context_agent_test - INFO - Connecting agent
2025-09-02 10:29:04,237 - src.registry.bootstrap - INFO - Registry bootstrap already initialized
2025-09-02 10:29:04,237 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Loaded 4 principal profiles from registry
2025-09-02 10:29:04,237 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - First profile: id=cfo_001, role=unknown, name=Lars Mikkelsen
2025-09-02 10:29:04,237 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Profile attributes: ['__abstractmethods__', '__annotations__', '__class__', '__class_getitem__', '__class_vars__', '__copy__', '__deepcopy__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__fields__', '__fields_set__', '__format__', '__ge__', '__get_pydantic_core_schema__', '__get_pydantic_json_schema__', '__getattr__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__iter__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__pretty__', '__private_attributes__', '__pydantic_complete__', '__pydantic_computed_fields__', '__pydantic_core_schema__', '__pydantic_custom_init__', '__pydantic_decorators__', '__pydantic_extra__', '__pydantic_fields__', '__pydantic_fields_set__', '__pydantic_generic_metadata__', '__pydantic_init_subclass__', '__pydantic_parent_namespace__', '__pydantic_post_init__', '__pydantic_private__', '__pydantic_root_model__', '__pydantic_serializer__', '__pydantic_setattr_handlers__', '__pydantic_validator__', '__reduce__', '__reduce_ex__', '__replace__', '__repr__', '__repr_args__', '__repr_name__', '__repr_recursion__', '__repr_str__', '__rich_repr__', '__setattr__', '__setstate__', '__signature__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', '__weakref__', '_abc_impl', '_calculate_keys', '_copy_and_set_values', '_get_value', '_iter', '_setattr_handler', 'business_processes', 'communication', 'construct', 'copy', 'default_filters', 'description', 'dict', 'from_orm', 'id', 'json', 'kpis', 'metadata', 'model_computed_fields', 'model_config', 'model_construct', 'model_copy', 'model_dump', 'model_dump_json', 'model_extra', 'model_fields', 'model_fields_set', 'model_json_schema', 'model_parametrized_name', 'model_post_init', 'model_rebuild', 'model_validate', 'model_validate_json', 'model_validate_strings', 'name', 'parse_file', 'parse_obj', 'parse_raw', 'responsibilities', 'schema', 'schema_json', 'time_frame', 'title', 'to_dict', 'update_forward_refs', 'validate']
2025-09-02 10:29:04,240 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Profile dict: {'id': 'cfo_001', 'name': 'Lars Mikkelsen', 'title': 'Chief Financial Officer', 'description': 'CFO responsible for financial performance in EMEA.', 'business_processes': ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals'], 'kpis': [], 'responsibilities': ['maximize EBIT', 'manage revenue', 'control expenses'], 'default_filters': {'profit_center_hierarchyid': ['Total'], 'customer_hierarchyid': ['Total']}, 'time_frame': {'default_period': 'QTD', 'historical_periods': 4, 'forward_looking_periods': 2}, 'communication': {'detail_level': 'high', 'format_preference': ['visual', 'text', 'table'], 'emphasis': ['trends', 'anomalies', 'forecasts']}, 'metadata': {}}
2025-09-02 10:29:04,241 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found 4 principals in registry
2025-09-02 10:29:04,242 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Loaded 4 principal profiles by ID from registry
2025-09-02 10:29:04,242 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Loaded 0 principal profiles by role from registry
2025-09-02 10:29:04,242 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Connected to dependencies
2025-09-02 10:29:04,242 - principal_context_agent_test - INFO - Loaded 0 principal profiles in principal_profiles dictionary
2025-09-02 10:29:04,243 - principal_context_agent_test - INFO - Loaded 4 principal profiles in principal_profiles_by_id dictionary
2025-09-02 10:29:04,243 - principal_context_agent_test - INFO - Keys in principal_profiles_by_id: ['cfo_001', 'ceo_001', 'coo_001', 'finance_manager_001']
2025-09-02 10:29:04,243 - principal_context_agent_test - INFO - Available roles in principal_profiles: []
2025-09-02 10:29:04,243 - principal_context_agent_test - INFO - Inspecting _load_principal_profiles method
2025-09-02 10:29:04,251 - principal_context_agent_test - INFO - _load_principal_profiles method code:
    async def _load_principal_profiles(self):
        """Load principal profiles from registry."""
        try:
            # Try to get principal profiles from registry
            if not self._principal_provider:
                self.logger.warning("Principal profile provider not initialized")
                self._load_default_profiles()
                return
                
            registry_data = self._principal_provider.get_all()
            self.logger.info(f"Loaded {len(registry_data) if registry_data else 0} principal profiles from registry")
            
            if registry_data and isinstance(registry_data, list):
                # Debug: Log the first profile to see its structure
                if registry_data:
                    first_profile = registry_data[0]
                    self.logger.info(f"First profile: id={getattr(first_profile, 'id', 'unknown')}, "
                                    f"role={getattr(first_profile, 'role', 'unknown')}, "
                                    f"name={getattr(first_profile, 'name', 'unknown')}")
                    self.logger.info(f"Profile attributes: {dir(first_profile)}")
                    self.logger.info(f"Profile dict: {first_profile.dict() if hasattr(first_profile, 'dict') else 'No dict method'}")
                
                principals = registry_data
                self.logger.info(f"Found {len(principals)} principals in registry")
                
                # Convert to our internal dictionary format keyed by ID and role
                normalized_by_role: Dict[str, Any] = {}
                normalized_by_id: Dict[str, Any] = {}
                role_to_id: Dict[str, str] = {}
                
                for principal in principals:
                    # Use attribute access for Pydantic models instead of dictionary-style access
                    principal_id = getattr(principal, 'id', None)
                    role = getattr(principal, 'role', None)
                    role_key = str(role).lower() if role else ''
                    
                    if not principal_id:
                        self.logger.warning(f"Principal missing ID: {getattr(principal, 'name', 'Unknown')} - {role}")
                        continue
                        
                    # Create profile object
                    profile = {
                        "id": principal_id,
                        "role": role,
                        "name": getattr(principal, 'name', None),
                        "title": getattr(principal, 'title', None),
                        "business_processes": getattr(principal, 'business_processes', []),
                        "default_filters": getattr(principal, 'default_filters', {}),
                        "decision_style": getattr(getattr(principal, 'persona_profile', {}), 'decision_style', 'Analytical'),
                        "communication_style": getattr(getattr(principal, 'persona_profile', {}), 'communication_style', 'Concise'),
                        "description": getattr(principal, 'description', ''),
                        "timeframes": getattr(principal, 'typical_timeframes', [])
                    }
                    
                    # Store by ID (primary index)
                    normalized_by_id[principal_id] = profile
                    
                    # Store by role (secondary index for backward compatibility)
                    if role_key:
                        normalized_by_role[role_key] = profile
                        role_to_id[role_key] = principal_id
                
                if normalized_by_id:
                    self.principal_profiles = normalized_by_role
                    self.principal_profiles_by_id = normalized_by_id
                    self.role_to_id_map = role_to_id
                    self.logger.info(f"Loaded {len(self.principal_profiles_by_id)} principal profiles by ID from registry")
                    self.logger.info(f"Loaded {len(self.principal_profiles)} principal profiles by role from registry")
                    return
            
            # Fallback to old format or empty registry
            self.logger.warning("No 'principals' key found in registry or no valid profiles, using defaults")
            self._load_default_profiles()
        except Exception as e:
            error_id = self._log_error("_load_principal_profiles", e)
            self._load_default_profiles()
            self.logger.warning(f"Using default profiles due to loading error {error_id}")

2025-09-02 10:29:04,255 - principal_context_agent_test - ERROR - Agent's principal_profiles dictionary is empty
2025-09-02 10:29:04,256 - principal_context_agent_test - INFO - principal_profiles_by_id has 4 entries
2025-09-02 10:29:04,256 - principal_context_agent_test - INFO - Keys in principal_profiles_by_id: ['cfo_001', 'ceo_001', 'coo_001', 'finance_manager_001']
2025-09-02 10:45:49,667 - asyncio - DEBUG - Using proactor: IocpProactor
2025-09-02 10:54:11,332 - asyncio - DEBUG - Using proactor: IocpProactor
2025-09-02 10:57:26,956 - asyncio - DEBUG - Using proactor: IocpProactor
2025-09-02 11:11:16,298 - asyncio - DEBUG - Using proactor: IocpProactor
2025-09-02 11:14:11,975 - asyncio - DEBUG - Using proactor: IocpProactor
2025-09-02 11:14:11,980 - principal_context_agent_test - INFO - Starting Principal Context Agent tests
2025-09-02 11:14:11,981 - principal_context_agent_test - INFO - Step 1: Testing registry structure
2025-09-02 11:14:11,981 - principal_context_agent_test - INFO - === Testing registry structure ===
2025-09-02 11:14:11,982 - principal_context_agent_test - INFO - Initializing registry bootstrap
2025-09-02 11:14:11,984 - src.registry.factory - INFO - Registry Factory initialized
2025-09-02 11:14:11,985 - src.registry.factory - INFO - Registered principal_profile provider
2025-09-02 11:14:11,985 - src.registry.providers.principal_provider - INFO - Loading principal profiles from C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\principal\principal_registry.yaml (yaml)
2025-09-02 11:14:12,012 - src.registry.providers.principal_provider - INFO - Found 4 roles in YAML under 'roles' key
2025-09-02 11:14:12,013 - src.registry.providers.principal_provider - DEBUG - Registered role: cfo_001 - CFO
2025-09-02 11:14:12,013 - src.registry.providers.principal_provider - DEBUG - Registered role: ceo_001 - CEO
2025-09-02 11:14:12,014 - src.registry.providers.principal_provider - DEBUG - Registered role: coo_001 - COO
2025-09-02 11:14:12,014 - src.registry.providers.principal_provider - DEBUG - Registered role: finance_manager_001 - Finance Manager
2025-09-02 11:14:12,015 - src.registry.providers.principal_provider - INFO - Found 4 principal profiles in YAML under 'principals' key
2025-09-02 11:14:12,015 - src.registry.providers.principal_provider - DEBUG - Mapped role name CFO to principal ID cfo_001
2025-09-02 11:14:12,015 - src.registry.providers.principal_provider - INFO - Registered principal: cfo_001 - Lars Mikkelsen
2025-09-02 11:14:12,016 - src.registry.providers.principal_provider - DEBUG - Mapped role name CEO to principal ID ceo_001
2025-09-02 11:14:12,016 - src.registry.providers.principal_provider - INFO - Registered principal: ceo_001 - Alex Morgan
2025-09-02 11:14:12,017 - src.registry.providers.principal_provider - DEBUG - Mapped role name COO to principal ID coo_001
2025-09-02 11:14:12,017 - src.registry.providers.principal_provider - INFO - Registered principal: coo_001 - Priya Desai
2025-09-02 11:14:12,018 - src.registry.providers.principal_provider - DEBUG - Mapped role name Finance Manager to principal ID finance_manager_001
2025-09-02 11:14:12,019 - src.registry.providers.principal_provider - INFO - Registered principal: finance_manager_001 - Emily Chen
2025-09-02 11:14:12,021 - src.registry.providers.principal_provider - INFO - Added role ID mapping: cfo_001 -> Lars Mikkelsen
2025-09-02 11:14:12,021 - src.registry.providers.principal_provider - INFO - Added role ID mapping: ceo_001 -> Alex Morgan
2025-09-02 11:14:12,022 - src.registry.providers.principal_provider - INFO - Added role ID mapping: coo_001 -> Priya Desai
2025-09-02 11:14:12,022 - src.registry.providers.principal_provider - INFO - Added role ID mapping: finance_manager_001 -> Emily Chen
2025-09-02 11:14:12,023 - src.registry.providers.principal_provider - INFO - Loaded 4 principal profiles
2025-09-02 11:14:12,023 - src.registry.bootstrap - INFO - Initialized principal provider with 4 profiles
2025-09-02 11:14:12,028 - src.registry.factory - WARNING - Provider 'business_glossary' not found in registry factory
2025-09-02 11:14:12,029 - src.registry.bootstrap - INFO - Initializing business glossary provider
2025-09-02 11:14:12,035 - src.registry.providers.business_glossary_provider - INFO - Loaded 4 business terms from glossary
2025-09-02 11:14:12,035 - src.registry.factory - INFO - Registered business_glossary provider
2025-09-02 11:14:12,036 - src.registry.bootstrap - INFO - Initialized business glossary provider with 4 terms
2025-09-02 11:14:12,036 - src.registry.factory - INFO - Registered data_product provider
2025-09-02 11:14:12,037 - src.registry.providers.data_product_provider - INFO - Loading data products from C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\data_product\data_product_registry.yaml (yaml)
2025-09-02 11:14:12,051 - src.registry.providers.data_product_provider - INFO - Loaded 1 data products
2025-09-02 11:14:12,052 - src.registry.bootstrap - INFO - Initialized data product provider with 1 data products
2025-09-02 11:14:12,052 - src.registry.bootstrap - INFO - Initializing KPI provider
2025-09-02 11:14:12,053 - src.registry.factory - WARNING - Provider 'kpi' not found in registry factory
2025-09-02 11:14:12,053 - src.registry.bootstrap - INFO - Creating KPI provider with file at C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\kpi\kpi_registry.yaml
2025-09-02 11:14:12,054 - src.registry.bootstrap - INFO - Registering KPI provider with registry factory
2025-09-02 11:14:12,054 - src.registry.factory - INFO - Registered kpi provider
2025-09-02 11:14:12,054 - src.registry.bootstrap - INFO - Loading KPI provider data
2025-09-02 11:14:12,055 - src.registry.providers.kpi_provider - INFO - Loading KPIs from C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\kpi\kpi_registry.yaml (yaml)
2025-09-02 11:14:12,088 - src.registry.providers.kpi_provider - INFO - Loaded 6 KPIs
2025-09-02 11:14:12,089 - src.registry.bootstrap - INFO - KPI provider successfully registered and initialized with 6 KPIs
2025-09-02 11:14:12,090 - src.registry.bootstrap - INFO - Initializing agent bootstrap
2025-09-02 11:14:12,091 - src.agents.agent_bootstrap - WARNING - No agent implementations discovered
2025-09-02 11:14:12,091 - src.registry.bootstrap - WARNING - Agent bootstrap initialization had issues, continuing with available agents
2025-09-02 11:14:12,091 - src.registry.bootstrap - INFO - Registry providers and agent factories initialized successfully
2025-09-02 11:14:12,092 - principal_context_agent_test - INFO - Registry bootstrap initialized successfully
2025-09-02 11:14:12,092 - principal_context_agent_test - INFO - Got RegistryFactory from bootstrap
2025-09-02 11:14:12,093 - principal_context_agent_test - INFO - Provider status: {'principal_profile': True, 'business_glossary': True, 'data_product': False, 'kpi': True}
2025-09-02 11:14:12,093 - principal_context_agent_test - INFO - principal_profile provider status: True
2025-09-02 11:14:12,094 - principal_context_agent_test - INFO - Got principal provider: <src.registry.providers.principal_provider.PrincipalProfileProvider object at 0x000002846518FA50>
2025-09-02 11:14:12,096 - principal_context_agent_test - INFO - Provider methods: ['__abstractmethods__', '__class__', '__class_getitem__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__orig_bases__', '__parameters__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', '__weakref__', '_abc_impl', '_add_profile', '_extract_profiles_from_module', '_is_protocol', '_load_default_profiles', '_load_from_json', '_load_from_python_module', '_load_from_yaml', '_profiles', '_profiles_by_name', '_profiles_by_title', '_registry_base_path', 'find_by_attribute', 'find_by_business_process', 'find_by_kpi', 'get', 'get_all', 'get_registry_path', 'initialize', 'load', 'register', 'source_path', 'storage_format']
2025-09-02 11:14:12,097 - principal_context_agent_test - INFO - Principal registry file exists at: C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\principal\principal_registry.yaml
2025-09-02 11:14:12,098 - principal_context_agent_test - INFO - Registry file content length: 6517 bytes
2025-09-02 11:14:12,098 - principal_context_agent_test - INFO - Registry file first 100 chars: # Principal Registry
# Contains all principal profiles for personalization and context-aware process...
2025-09-02 11:14:12,099 - principal_context_agent_test - INFO - Got registry data type: <class 'list'>
2025-09-02 11:14:12,100 - principal_context_agent_test - INFO - Found 4 principals in registry
2025-09-02 11:14:12,100 - principal_context_agent_test - INFO - Principal 1 details:
2025-09-02 11:14:12,101 - principal_context_agent_test - INFO -   ID: cfo_001
2025-09-02 11:14:12,101 - principal_context_agent_test - INFO -   Name: Lars Mikkelsen
2025-09-02 11:14:12,102 - principal_context_agent_test - INFO -   Role: N/A
2025-09-02 11:14:12,102 - principal_context_agent_test - INFO -   Title: Chief Financial Officer
2025-09-02 11:14:12,103 - principal_context_agent_test - INFO -   Business Processes: ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals']
2025-09-02 11:14:12,105 - principal_context_agent_test - INFO -   All attributes: ['__abstractmethods__', '__annotations__', '__class__', '__class_getitem__', '__class_vars__', '__copy__', '__deepcopy__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__fields__', '__fields_set__', '__format__', '__ge__', '__get_pydantic_core_schema__', '__get_pydantic_json_schema__', '__getattr__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__iter__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__pretty__', '__private_attributes__', '__pydantic_complete__', '__pydantic_computed_fields__', '__pydantic_core_schema__', '__pydantic_custom_init__', '__pydantic_decorators__', '__pydantic_extra__', '__pydantic_fields__', '__pydantic_fields_set__', '__pydantic_generic_metadata__', '__pydantic_init_subclass__', '__pydantic_parent_namespace__', '__pydantic_post_init__', '__pydantic_private__', '__pydantic_root_model__', '__pydantic_serializer__', '__pydantic_setattr_handlers__', '__pydantic_validator__', '__reduce__', '__reduce_ex__', '__replace__', '__repr__', '__repr_args__', '__repr_name__', '__repr_recursion__', '__repr_str__', '__rich_repr__', '__setattr__', '__setstate__', '__signature__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', '__weakref__', '_abc_impl', '_calculate_keys', '_copy_and_set_values', '_get_value', '_iter', '_setattr_handler', 'business_processes', 'communication', 'construct', 'copy', 'default_filters', 'description', 'dict', 'from_orm', 'id', 'json', 'kpis', 'metadata', 'model_computed_fields', 'model_config', 'model_construct', 'model_copy', 'model_dump', 'model_dump_json', 'model_extra', 'model_fields', 'model_fields_set', 'model_json_schema', 'model_parametrized_name', 'model_post_init', 'model_rebuild', 'model_validate', 'model_validate_json', 'model_validate_strings', 'name', 'parse_file', 'parse_obj', 'parse_raw', 'responsibilities', 'schema', 'schema_json', 'time_frame', 'title', 'to_dict', 'update_forward_refs', 'validate']
2025-09-02 11:14:12,109 - principal_context_agent_test - INFO -   Dict representation: {'id': 'cfo_001', 'name': 'Lars Mikkelsen', 'title': 'Chief Financial Officer', 'description': 'CFO responsible for financial performance in EMEA.', 'business_processes': ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals'], 'kpis': [], 'responsibilities': ['maximize EBIT', 'manage revenue', 'control expenses'], 'default_filters': {'profit_center_hierarchyid': ['Total'], 'customer_hierarchyid': ['Total']}, 'time_frame': {'default_period': 'QTD', 'historical_periods': 4, 'forward_looking_periods': 2}, 'communication': {'detail_level': 'high', 'format_preference': ['visual', 'text', 'table'], 'emphasis': ['trends', 'anomalies', 'forecasts']}, 'metadata': {}}
2025-09-02 11:14:12,113 - principal_context_agent_test - INFO -   __dict__ representation: {'id': 'cfo_001', 'name': 'Lars Mikkelsen', 'title': 'Chief Financial Officer', 'description': 'CFO responsible for financial performance in EMEA.', 'business_processes': ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals'], 'kpis': [], 'responsibilities': ['maximize EBIT', 'manage revenue', 'control expenses'], 'default_filters': {'profit_center_hierarchyid': ['Total'], 'customer_hierarchyid': ['Total']}, 'time_frame': TimeFrame(default_period='QTD', historical_periods=4, forward_looking_periods=2), 'communication': CommunicationPreference(detail_level='high', format_preference=['visual', 'text', 'table'], emphasis=['trends', 'anomalies', 'forecasts']), 'metadata': {}}
2025-09-02 11:14:12,115 - principal_context_agent_test - INFO - Principal 2 details:
2025-09-02 11:14:12,116 - principal_context_agent_test - INFO -   ID: ceo_001
2025-09-02 11:14:12,116 - principal_context_agent_test - INFO -   Name: Alex Morgan
2025-09-02 11:14:12,117 - principal_context_agent_test - INFO -   Role: N/A
2025-09-02 11:14:12,117 - principal_context_agent_test - INFO -   Title: Chief Executive Officer
2025-09-02 11:14:12,118 - principal_context_agent_test - INFO -   Business Processes: ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals']
2025-09-02 11:14:12,120 - principal_context_agent_test - INFO -   All attributes: ['__abstractmethods__', '__annotations__', '__class__', '__class_getitem__', '__class_vars__', '__copy__', '__deepcopy__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__fields__', '__fields_set__', '__format__', '__ge__', '__get_pydantic_core_schema__', '__get_pydantic_json_schema__', '__getattr__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__iter__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__pretty__', '__private_attributes__', '__pydantic_complete__', '__pydantic_computed_fields__', '__pydantic_core_schema__', '__pydantic_custom_init__', '__pydantic_decorators__', '__pydantic_extra__', '__pydantic_fields__', '__pydantic_fields_set__', '__pydantic_generic_metadata__', '__pydantic_init_subclass__', '__pydantic_parent_namespace__', '__pydantic_post_init__', '__pydantic_private__', '__pydantic_root_model__', '__pydantic_serializer__', '__pydantic_setattr_handlers__', '__pydantic_validator__', '__reduce__', '__reduce_ex__', '__replace__', '__repr__', '__repr_args__', '__repr_name__', '__repr_recursion__', '__repr_str__', '__rich_repr__', '__setattr__', '__setstate__', '__signature__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', '__weakref__', '_abc_impl', '_calculate_keys', '_copy_and_set_values', '_get_value', '_iter', '_setattr_handler', 'business_processes', 'communication', 'construct', 'copy', 'default_filters', 'description', 'dict', 'from_orm', 'id', 'json', 'kpis', 'metadata', 'model_computed_fields', 'model_config', 'model_construct', 'model_copy', 'model_dump', 'model_dump_json', 'model_extra', 'model_fields', 'model_fields_set', 'model_json_schema', 'model_parametrized_name', 'model_post_init', 'model_rebuild', 'model_validate', 'model_validate_json', 'model_validate_strings', 'name', 'parse_file', 'parse_obj', 'parse_raw', 'responsibilities', 'schema', 'schema_json', 'time_frame', 'title', 'to_dict', 'update_forward_refs', 'validate']
2025-09-02 11:14:12,123 - principal_context_agent_test - INFO -   Dict representation: {'id': 'ceo_001', 'name': 'Alex Morgan', 'title': 'Chief Executive Officer', 'description': 'CEO driving company strategy and performance.', 'business_processes': ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals'], 'kpis': [], 'responsibilities': ['set strategic direction', 'oversee company performance', 'lead executive team'], 'default_filters': {'profit_center_hierarchyid': ['#']}, 'time_frame': {'default_period': 'YTD', 'historical_periods': 3, 'forward_looking_periods': 4}, 'communication': {'detail_level': 'medium', 'format_preference': ['visual', 'summary'], 'emphasis': ['trends', 'strategic_impact']}, 'metadata': {}}
2025-09-02 11:14:12,125 - principal_context_agent_test - INFO -   __dict__ representation: {'id': 'ceo_001', 'name': 'Alex Morgan', 'title': 'Chief Executive Officer', 'description': 'CEO driving company strategy and performance.', 'business_processes': ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals'], 'kpis': [], 'responsibilities': ['set strategic direction', 'oversee company performance', 'lead executive team'], 'default_filters': {'profit_center_hierarchyid': ['#']}, 'time_frame': TimeFrame(default_period='YTD', historical_periods=3, forward_looking_periods=4), 'communication': CommunicationPreference(detail_level='medium', format_preference=['visual', 'summary'], emphasis=['trends', 'strategic_impact']), 'metadata': {}}
2025-09-02 11:14:12,127 - principal_context_agent_test - INFO - Principal 3 details:
2025-09-02 11:14:12,127 - principal_context_agent_test - INFO -   ID: coo_001
2025-09-02 11:14:12,127 - principal_context_agent_test - INFO -   Name: Priya Desai
2025-09-02 11:14:12,129 - principal_context_agent_test - INFO -   Role: N/A
2025-09-02 11:14:12,129 - principal_context_agent_test - INFO -   Title: Chief Operating Officer
2025-09-02 11:14:12,129 - principal_context_agent_test - INFO -   Business Processes: ['finance_expense_management', 'finance_cash_flow', 'finance_budget_vs_actuals']
2025-09-02 11:14:12,131 - principal_context_agent_test - INFO -   All attributes: ['__abstractmethods__', '__annotations__', '__class__', '__class_getitem__', '__class_vars__', '__copy__', '__deepcopy__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__fields__', '__fields_set__', '__format__', '__ge__', '__get_pydantic_core_schema__', '__get_pydantic_json_schema__', '__getattr__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__iter__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__pretty__', '__private_attributes__', '__pydantic_complete__', '__pydantic_computed_fields__', '__pydantic_core_schema__', '__pydantic_custom_init__', '__pydantic_decorators__', '__pydantic_extra__', '__pydantic_fields__', '__pydantic_fields_set__', '__pydantic_generic_metadata__', '__pydantic_init_subclass__', '__pydantic_parent_namespace__', '__pydantic_post_init__', '__pydantic_private__', '__pydantic_root_model__', '__pydantic_serializer__', '__pydantic_setattr_handlers__', '__pydantic_validator__', '__reduce__', '__reduce_ex__', '__replace__', '__repr__', '__repr_args__', '__repr_name__', '__repr_recursion__', '__repr_str__', '__rich_repr__', '__setattr__', '__setstate__', '__signature__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', '__weakref__', '_abc_impl', '_calculate_keys', '_copy_and_set_values', '_get_value', '_iter', '_setattr_handler', 'business_processes', 'communication', 'construct', 'copy', 'default_filters', 'description', 'dict', 'from_orm', 'id', 'json', 'kpis', 'metadata', 'model_computed_fields', 'model_config', 'model_construct', 'model_copy', 'model_dump', 'model_dump_json', 'model_extra', 'model_fields', 'model_fields_set', 'model_json_schema', 'model_parametrized_name', 'model_post_init', 'model_rebuild', 'model_validate', 'model_validate_json', 'model_validate_strings', 'name', 'parse_file', 'parse_obj', 'parse_raw', 'responsibilities', 'schema', 'schema_json', 'time_frame', 'title', 'to_dict', 'update_forward_refs', 'validate']
2025-09-02 11:14:12,134 - principal_context_agent_test - INFO -   Dict representation: {'id': 'coo_001', 'name': 'Priya Desai', 'title': 'Chief Operating Officer', 'description': 'COO focused on operational excellence and efficiency.', 'business_processes': ['finance_expense_management', 'finance_cash_flow', 'finance_budget_vs_actuals'], 'kpis': [], 'responsibilities': ['optimize operations', 'reduce operational costs', 'improve process efficiency'], 'default_filters': {'profit_center_hierarchyid': ['Best Run U'], 'customer_hierarchyid': ['17100001']}, 'time_frame': {'default_period': 'MTD', 'historical_periods': 6, 'forward_looking_periods': 2}, 'communication': {'detail_level': 'high', 'format_preference': ['table', 'visual'], 'emphasis': ['variances', 'operational_metrics']}, 'metadata': {}}
2025-09-02 11:14:12,136 - principal_context_agent_test - INFO -   __dict__ representation: {'id': 'coo_001', 'name': 'Priya Desai', 'title': 'Chief Operating Officer', 'description': 'COO focused on operational excellence and efficiency.', 'business_processes': ['finance_expense_management', 'finance_cash_flow', 'finance_budget_vs_actuals'], 'kpis': [], 'responsibilities': ['optimize operations', 'reduce operational costs', 'improve process efficiency'], 'default_filters': {'profit_center_hierarchyid': ['Best Run U'], 'customer_hierarchyid': ['17100001']}, 'time_frame': TimeFrame(default_period='MTD', historical_periods=6, forward_looking_periods=2), 'communication': CommunicationPreference(detail_level='high', format_preference=['table', 'visual'], emphasis=['variances', 'operational_metrics']), 'metadata': {}}
2025-09-02 11:14:12,137 - principal_context_agent_test - INFO - Principal 4 details:
2025-09-02 11:14:12,137 - principal_context_agent_test - INFO -   ID: finance_manager_001
2025-09-02 11:14:12,138 - principal_context_agent_test - INFO -   Name: Emily Chen
2025-09-02 11:14:12,138 - principal_context_agent_test - INFO -   Role: N/A
2025-09-02 11:14:12,138 - principal_context_agent_test - INFO -   Title: Finance Manager
2025-09-02 11:14:12,139 - principal_context_agent_test - INFO -   Business Processes: ['Finance: Expense Management', 'Finance: Budget vs. Actuals', 'Finance: Cash Flow Management']
2025-09-02 11:14:12,142 - principal_context_agent_test - INFO -   All attributes: ['__abstractmethods__', '__annotations__', '__class__', '__class_getitem__', '__class_vars__', '__copy__', '__deepcopy__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__fields__', '__fields_set__', '__format__', '__ge__', '__get_pydantic_core_schema__', '__get_pydantic_json_schema__', '__getattr__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__iter__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__pretty__', '__private_attributes__', '__pydantic_complete__', '__pydantic_computed_fields__', '__pydantic_core_schema__', '__pydantic_custom_init__', '__pydantic_decorators__', '__pydantic_extra__', '__pydantic_fields__', '__pydantic_fields_set__', '__pydantic_generic_metadata__', '__pydantic_init_subclass__', '__pydantic_parent_namespace__', '__pydantic_post_init__', '__pydantic_private__', '__pydantic_root_model__', '__pydantic_serializer__', '__pydantic_setattr_handlers__', '__pydantic_validator__', '__reduce__', '__reduce_ex__', '__replace__', '__repr__', '__repr_args__', '__repr_name__', '__repr_recursion__', '__repr_str__', '__rich_repr__', '__setattr__', '__setstate__', '__signature__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', '__weakref__', '_abc_impl', '_calculate_keys', '_copy_and_set_values', '_get_value', '_iter', '_setattr_handler', 'business_processes', 'communication', 'construct', 'copy', 'default_filters', 'description', 'dict', 'from_orm', 'id', 'json', 'kpis', 'metadata', 'model_computed_fields', 'model_config', 'model_construct', 'model_copy', 'model_dump', 'model_dump_json', 'model_extra', 'model_fields', 'model_fields_set', 'model_json_schema', 'model_parametrized_name', 'model_post_init', 'model_rebuild', 'model_validate', 'model_validate_json', 'model_validate_strings', 'name', 'parse_file', 'parse_obj', 'parse_raw', 'responsibilities', 'schema', 'schema_json', 'time_frame', 'title', 'to_dict', 'update_forward_refs', 'validate']
2025-09-02 11:14:12,147 - principal_context_agent_test - INFO -   Dict representation: {'id': 'finance_manager_001', 'name': 'Emily Chen', 'title': 'Finance Manager', 'description': 'Finance Manager responsible for departmental financial analysis and reporting.', 'business_processes': ['Finance: Expense Management', 'Finance: Budget vs. Actuals', 'Finance: Cash Flow Management'], 'kpis': [], 'responsibilities': ['manage departmental budget', 'analyze financial data', 'prepare financial reports'], 'default_filters': {'profit_center_hierarchyid': ['Finance'], 'customer_hierarchyid': ['Total']}, 'time_frame': {'default_period': 'MTD', 'historical_periods': 6, 'forward_looking_periods': 3}, 'communication': {'detail_level': 'high', 'format_preference': ['table', 'visual', 'text'], 'emphasis': ['variances', 'trends', 'forecasts']}, 'metadata': {}}
2025-09-02 11:14:12,148 - principal_context_agent_test - INFO -   __dict__ representation: {'id': 'finance_manager_001', 'name': 'Emily Chen', 'title': 'Finance Manager', 'description': 'Finance Manager responsible for departmental financial analysis and reporting.', 'business_processes': ['Finance: Expense Management', 'Finance: Budget vs. Actuals', 'Finance: Cash Flow Management'], 'kpis': [], 'responsibilities': ['manage departmental budget', 'analyze financial data', 'prepare financial reports'], 'default_filters': {'profit_center_hierarchyid': ['Finance'], 'customer_hierarchyid': ['Total']}, 'time_frame': TimeFrame(default_period='MTD', historical_periods=6, forward_looking_periods=3), 'communication': CommunicationPreference(detail_level='high', format_preference=['table', 'visual', 'text'], emphasis=['variances', 'trends', 'forecasts']), 'metadata': {}}
2025-09-02 11:14:12,149 - principal_context_agent_test - INFO - 
Step 2: Testing Agent Initialization
2025-09-02 11:14:12,150 - principal_context_agent_test - INFO - === Testing loading principal profiles ===
2025-09-02 11:14:12,150 - principal_context_agent_test - INFO - Creating Principal Context Agent
2025-09-02 11:14:12,151 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Initializing A9_Principal_Context_Agent
2025-09-02 11:14:12,152 - principal_context_agent_test - INFO - Connecting agent
2025-09-02 11:14:12,152 - src.registry.bootstrap - INFO - Registry bootstrap already initialized
2025-09-02 11:14:12,152 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Loaded 4 principal profiles from registry
2025-09-02 11:14:12,153 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - First profile: id=cfo_001, role=unknown, name=Lars Mikkelsen
2025-09-02 11:14:12,154 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Profile attributes: ['__abstractmethods__', '__annotations__', '__class__', '__class_getitem__', '__class_vars__', '__copy__', '__deepcopy__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__fields__', '__fields_set__', '__format__', '__ge__', '__get_pydantic_core_schema__', '__get_pydantic_json_schema__', '__getattr__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__iter__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__pretty__', '__private_attributes__', '__pydantic_complete__', '__pydantic_computed_fields__', '__pydantic_core_schema__', '__pydantic_custom_init__', '__pydantic_decorators__', '__pydantic_extra__', '__pydantic_fields__', '__pydantic_fields_set__', '__pydantic_generic_metadata__', '__pydantic_init_subclass__', '__pydantic_parent_namespace__', '__pydantic_post_init__', '__pydantic_private__', '__pydantic_root_model__', '__pydantic_serializer__', '__pydantic_setattr_handlers__', '__pydantic_validator__', '__reduce__', '__reduce_ex__', '__replace__', '__repr__', '__repr_args__', '__repr_name__', '__repr_recursion__', '__repr_str__', '__rich_repr__', '__setattr__', '__setstate__', '__signature__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', '__weakref__', '_abc_impl', '_calculate_keys', '_copy_and_set_values', '_get_value', '_iter', '_setattr_handler', 'business_processes', 'communication', 'construct', 'copy', 'default_filters', 'description', 'dict', 'from_orm', 'id', 'json', 'kpis', 'metadata', 'model_computed_fields', 'model_config', 'model_construct', 'model_copy', 'model_dump', 'model_dump_json', 'model_extra', 'model_fields', 'model_fields_set', 'model_json_schema', 'model_parametrized_name', 'model_post_init', 'model_rebuild', 'model_validate', 'model_validate_json', 'model_validate_strings', 'name', 'parse_file', 'parse_obj', 'parse_raw', 'responsibilities', 'schema', 'schema_json', 'time_frame', 'title', 'to_dict', 'update_forward_refs', 'validate']
2025-09-02 11:14:12,157 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Profile dict: {'id': 'cfo_001', 'name': 'Lars Mikkelsen', 'title': 'Chief Financial Officer', 'description': 'CFO responsible for financial performance in EMEA.', 'business_processes': ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals'], 'kpis': [], 'responsibilities': ['maximize EBIT', 'manage revenue', 'control expenses'], 'default_filters': {'profit_center_hierarchyid': ['Total'], 'customer_hierarchyid': ['Total']}, 'time_frame': {'default_period': 'QTD', 'historical_periods': 4, 'forward_looking_periods': 2}, 'communication': {'detail_level': 'high', 'format_preference': ['visual', 'text', 'table'], 'emphasis': ['trends', 'anomalies', 'forecasts']}, 'metadata': {}}
2025-09-02 11:14:12,159 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found 4 principals in registry
2025-09-02 11:14:12,160 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Loaded 4 principal profiles by ID from registry
2025-09-02 11:14:12,161 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Loaded 4 principal profiles by role from registry
2025-09-02 11:14:12,162 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Connected to dependencies
2025-09-02 11:14:12,163 - principal_context_agent_test - INFO - Loaded 4 principal profiles in principal_profiles dictionary
2025-09-02 11:14:12,163 - principal_context_agent_test - INFO - Loaded 4 principal profiles in principal_profiles_by_id dictionary
2025-09-02 11:14:12,164 - principal_context_agent_test - INFO - Keys in principal_profiles_by_id: ['cfo_001', 'ceo_001', 'coo_001', 'finance_manager_001']
2025-09-02 11:14:12,165 - principal_context_agent_test - INFO - Available roles in principal_profiles: ['chief financial officer', 'chief executive officer', 'chief operating officer', 'finance manager']
2025-09-02 11:14:12,166 - principal_context_agent_test - INFO - Sample profile for chief financial officer:
2025-09-02 11:14:12,166 - principal_context_agent_test - INFO -   id: cfo_001
2025-09-02 11:14:12,167 - principal_context_agent_test - INFO -   role: Chief Financial Officer
2025-09-02 11:14:12,167 - principal_context_agent_test - INFO -   name: Lars Mikkelsen
2025-09-02 11:14:12,168 - principal_context_agent_test - INFO -   title: Chief Financial Officer
2025-09-02 11:14:12,169 - principal_context_agent_test - INFO -   business_processes: ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals']
2025-09-02 11:14:12,170 - principal_context_agent_test - INFO -   default_filters: {'profit_center_hierarchyid': ['Total'], 'customer_hierarchyid': ['Total']}
2025-09-02 11:14:12,171 - principal_context_agent_test - INFO -   decision_style: Analytical
2025-09-02 11:14:12,172 - principal_context_agent_test - INFO -   communication_style: Concise
2025-09-02 11:14:12,172 - principal_context_agent_test - INFO -   description: CFO responsible for financial performance in EMEA.
2025-09-02 11:14:12,173 - principal_context_agent_test - INFO -   timeframes: []
2025-09-02 11:14:12,173 - principal_context_agent_test - INFO - Inspecting _load_principal_profiles method
2025-09-02 11:14:12,185 - principal_context_agent_test - INFO - _load_principal_profiles method code:
    async def _load_principal_profiles(self):
        """Load principal profiles from registry."""
        try:
            # Try to get principal profiles from registry
            if not self._principal_provider:
                self.logger.warning("Principal profile provider not initialized")
                self._load_default_profiles()
                return
                
            registry_data = self._principal_provider.get_all()
            self.logger.info(f"Loaded {len(registry_data) if registry_data else 0} principal profiles from registry")
            
            if registry_data and isinstance(registry_data, list):
                # Debug: Log the first profile to see its structure
                if registry_data:
                    first_profile = registry_data[0]
                    self.logger.info(f"First profile: id={getattr(first_profile, 'id', 'unknown')}, "
                                    f"role={getattr(first_profile, 'role', 'unknown')}, "
                                    f"name={getattr(first_profile, 'name', 'unknown')}")
                    self.logger.info(f"Profile attributes: {dir(first_profile)}")
                    self.logger.info(f"Profile dict: {first_profile.dict() if hasattr(first_profile, 'dict') else 'No dict method'}")
                
                principals = registry_data
                self.logger.info(f"Found {len(principals)} principals in registry")
                
                # Convert to our internal dictionary format keyed by ID and role
                normalized_by_role: Dict[str, Any] = {}
                normalized_by_id: Dict[str, Any] = {}
                role_to_id: Dict[str, str] = {}
                
                for principal in principals:
                    # Use attribute access for Pydantic models instead of dictionary-style access
                    principal_id = getattr(principal, 'id', None)
                    role = getattr(principal, 'role', None)
                    title = getattr(principal, 'title', None)
                    
                    # Use title as role key if role is not available
                    role_key = ''
                    if role:
                        role_key = str(role).lower()
                    elif title:
                        role_key = str(title).lower()
                    
                    if not principal_id:
                        self.logger.warning(f"Principal missing ID: {getattr(principal, 'name', 'Unknown')} - {role or title}")
                        continue
                        
                    # Create profile object
                    profile = {
                        "id": principal_id,
                        "role": role or title,  # Use title as role if role is not available
                        "name": getattr(principal, 'name', None),
                        "title": title,
                        "business_processes": getattr(principal, 'business_processes', []),
                        "default_filters": getattr(principal, 'default_filters', {}),
                        "decision_style": getattr(getattr(principal, 'persona_profile', {}), 'decision_style', 'Analytical'),
                        "communication_style": getattr(getattr(principal, 'persona_profile', {}), 'communication_style', 'Concise'),
                        "description": getattr(principal, 'description', ''),
                        "timeframes": getattr(principal, 'typical_timeframes', [])
                    }
                    
                    # Store by ID (primary index)
                    normalized_by_id[principal_id] = profile
                    
                    # Store by role (secondary index for backward compatibility)
                    if role_key:
                        normalized_by_role[role_key] = profile
                        role_to_id[role_key] = principal_id
                        
                        # Also store by title for additional lookup options
                        if title and title.lower() != role_key:
                            title_key = title.lower()
                            normalized_by_role[title_key] = profile
                            role_to_id[title_key] = principal_id
                
                if normalized_by_id:
                    self.principal_profiles = normalized_by_role
                    self.principal_profiles_by_id = normalized_by_id
                    self.role_to_id_map = role_to_id
                    self.logger.info(f"Loaded {len(self.principal_profiles_by_id)} principal profiles by ID from registry")
                    self.logger.info(f"Loaded {len(self.principal_profiles)} principal profiles by role from registry")
                    return
            
            # Fallback to old format or empty registry
            self.logger.warning("No 'principals' key found in registry or no valid profiles, using defaults")
            self._load_default_profiles()
        except Exception as e:
            error_id = self._log_error("_load_principal_profiles", e)
            self._load_default_profiles()
            self.logger.warning(f"Using default profiles due to loading error {error_id}")

2025-09-02 11:14:12,196 - principal_context_agent_test - INFO - Available roles from agent: ['chief financial officer', 'chief executive officer', 'chief operating officer', 'finance manager']
2025-09-02 11:14:12,197 - principal_context_agent_test - INFO - Testing with roles: ['chief financial officer', 'chief executive officer', 'chief operating officer']
2025-09-02 11:14:12,198 - principal_context_agent_test - INFO - 
Testing with role: chief financial officer
2025-09-02 11:14:12,199 - principal_context_agent_test - INFO - Step 3: Testing fetch_principal_profile
2025-09-02 11:14:12,199 - principal_context_agent_test - INFO - === Testing fetch_principal_profile for role: chief financial officer ===
2025-09-02 11:14:12,200 - principal_context_agent_test - INFO - Checking if 'chief financial officer' exists in principal_profiles_by_id
2025-09-02 11:14:12,200 - principal_context_agent_test - INFO - Calling fetch_principal_profile for 'chief financial officer'
2025-09-02 11:14:12,201 - principal_context_agent_test - INFO - Successfully fetched profile for chief financial officer:
2025-09-02 11:14:12,202 - principal_context_agent_test - INFO -   Profile type: <class 'dict'>
2025-09-02 11:14:12,202 - principal_context_agent_test - INFO -   Name: Lars Mikkelsen
2025-09-02 11:14:12,203 - principal_context_agent_test - INFO -   Title: Chief Financial Officer
2025-09-02 11:14:12,203 - principal_context_agent_test - INFO -   Business Processes: ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals']
2025-09-02 11:14:12,204 - principal_context_agent_test - INFO -   Default Filters: {'profit_center_hierarchyid': ['Total'], 'customer_hierarchyid': ['Total']}
2025-09-02 11:14:12,205 - principal_context_agent_test - INFO -   Decision Style: Analytical
2025-09-02 11:14:12,205 - principal_context_agent_test - INFO -   Communication Style: Concise
2025-09-02 11:14:12,206 - principal_context_agent_test - INFO -   Timeframes: []
2025-09-02 11:14:12,206 - principal_context_agent_test - INFO - Step 4: Testing get_principal_context
2025-09-02 11:14:12,206 - principal_context_agent_test - INFO - === Testing get_principal_context for role: chief financial officer ===
2025-09-02 11:14:12,207 - principal_context_agent_test - INFO - Calling get_principal_context with role: chief financial officer
2025-09-02 11:14:12,208 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'chief financial officer'
2025-09-02 11:14:12,208 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['chief financial officer', 'chief executive officer', 'chief operating officer', 'finance manager']
2025-09-02 11:14:12,209 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['chief financial officer', 'CHIEF FINANCIAL OFFICER', 'CHIEF_FINANCIAL_OFFICER', 'Chief Financial Officer', 'chief_financial_officer', 'cfo', 'CFO']
2025-09-02 11:14:12,210 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'chief financial officer'
2025-09-02 11:14:12,211 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: chief financial officer
2025-09-02 11:14:12,212 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - ERROR - Error in get_principal_context: CEO (ID: 7fd3f779)
2025-09-02 11:14:12,213 - principal_context_agent_test - INFO - Successfully got context for chief financial officer:
2025-09-02 11:14:12,214 - principal_context_agent_test - INFO - Context: request_id='d574599b-722e-42bb-a141-2c099c787d64' timestamp=datetime.datetime(2025, 9, 2, 11, 14, 12, 213220) status='error' message='Error getting principal context: CEO (error ID: 7fd3f779)' profile={'id': 'default_id', 'name': 'Default Profile', 'role': 'CFO', 'business_processes': [], 'default_filters': {}, 'timeframes': ['Quarterly'], 'responsibilities': []} responsibilities=[] filters={} context=PrincipalContext(role=<PrincipalRole.CFO: 'CFO'>, principal_id='cfo_default', business_processes=[<BusinessProcess.PROFITABILITY_ANALYSIS: 'Finance: Profitability Analysis'>, <BusinessProcess.REVENUE_GROWTH: 'Finance: Revenue Growth Analysis'>, <BusinessProcess.EXPENSE_MANAGEMENT: 'Finance: Expense Management'>, <BusinessProcess.CASH_FLOW: 'Finance: Cash Flow Management'>, <BusinessProcess.BUDGET_VS_ACTUALS: 'Finance: Budget vs. Actuals'>], default_filters={}, decision_style='Analytical', communication_style='Concise', preferred_timeframes=[<TimeFrame.CURRENT_QUARTER: 'current_quarter'>, <TimeFrame.YEAR_TO_DATE: 'year_to_date'>])
2025-09-02 11:14:12,216 - principal_context_agent_test - INFO - 
Testing with role: chief executive officer
2025-09-02 11:14:12,216 - principal_context_agent_test - INFO - Step 3: Testing fetch_principal_profile
2025-09-02 11:14:12,217 - principal_context_agent_test - INFO - === Testing fetch_principal_profile for role: chief executive officer ===
2025-09-02 11:14:12,218 - principal_context_agent_test - INFO - Checking if 'chief executive officer' exists in principal_profiles_by_id
2025-09-02 11:14:12,218 - principal_context_agent_test - INFO - Calling fetch_principal_profile for 'chief executive officer'
2025-09-02 11:14:12,219 - principal_context_agent_test - INFO - Successfully fetched profile for chief executive officer:
2025-09-02 11:14:12,219 - principal_context_agent_test - INFO -   Profile type: <class 'dict'>
2025-09-02 11:14:12,219 - principal_context_agent_test - INFO -   Name: Alex Morgan
2025-09-02 11:14:12,220 - principal_context_agent_test - INFO -   Title: Chief Executive Officer
2025-09-02 11:14:12,220 - principal_context_agent_test - INFO -   Business Processes: ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals']
2025-09-02 11:14:12,221 - principal_context_agent_test - INFO -   Default Filters: {'profit_center_hierarchyid': ['#']}
2025-09-02 11:14:12,221 - principal_context_agent_test - INFO -   Decision Style: Analytical
2025-09-02 11:14:12,222 - principal_context_agent_test - INFO -   Communication Style: Concise
2025-09-02 11:14:12,222 - principal_context_agent_test - INFO -   Timeframes: []
2025-09-02 11:14:12,223 - principal_context_agent_test - INFO - Step 4: Testing get_principal_context
2025-09-02 11:14:12,223 - principal_context_agent_test - INFO - === Testing get_principal_context for role: chief executive officer ===
2025-09-02 11:14:12,223 - principal_context_agent_test - INFO - Calling get_principal_context with role: chief executive officer
2025-09-02 11:14:12,224 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'chief executive officer'
2025-09-02 11:14:12,224 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['chief financial officer', 'chief executive officer', 'chief operating officer', 'finance manager']
2025-09-02 11:14:12,225 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['chief executive officer', 'CHIEF EXECUTIVE OFFICER', 'CHIEF_EXECUTIVE_OFFICER', 'Chief Executive Officer', 'chief_executive_officer', 'ceo', 'CEO']
2025-09-02 11:14:12,226 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'chief executive officer'
2025-09-02 11:14:12,226 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: chief executive officer
2025-09-02 11:14:12,227 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - ERROR - Error in get_principal_context: CEO (ID: e5b2cf56)
2025-09-02 11:14:12,228 - principal_context_agent_test - INFO - Successfully got context for chief executive officer:
2025-09-02 11:14:12,231 - principal_context_agent_test - INFO - Context: request_id='74dedfe3-392e-4c42-b6ef-b920ca2d2545' timestamp=datetime.datetime(2025, 9, 2, 11, 14, 12, 228220) status='error' message='Error getting principal context: CEO (error ID: e5b2cf56)' profile={'id': 'default_id', 'name': 'Default Profile', 'role': 'CFO', 'business_processes': [], 'default_filters': {}, 'timeframes': ['Quarterly'], 'responsibilities': []} responsibilities=[] filters={} context=PrincipalContext(role=<PrincipalRole.CFO: 'CFO'>, principal_id='cfo_default', business_processes=[<BusinessProcess.PROFITABILITY_ANALYSIS: 'Finance: Profitability Analysis'>, <BusinessProcess.REVENUE_GROWTH: 'Finance: Revenue Growth Analysis'>, <BusinessProcess.EXPENSE_MANAGEMENT: 'Finance: Expense Management'>, <BusinessProcess.CASH_FLOW: 'Finance: Cash Flow Management'>, <BusinessProcess.BUDGET_VS_ACTUALS: 'Finance: Budget vs. Actuals'>], default_filters={}, decision_style='Analytical', communication_style='Concise', preferred_timeframes=[<TimeFrame.CURRENT_QUARTER: 'current_quarter'>, <TimeFrame.YEAR_TO_DATE: 'year_to_date'>])
2025-09-02 11:14:12,233 - principal_context_agent_test - INFO - 
Testing with role: chief operating officer
2025-09-02 11:14:12,234 - principal_context_agent_test - INFO - Step 3: Testing fetch_principal_profile
2025-09-02 11:14:12,234 - principal_context_agent_test - INFO - === Testing fetch_principal_profile for role: chief operating officer ===
2025-09-02 11:14:12,235 - principal_context_agent_test - INFO - Checking if 'chief operating officer' exists in principal_profiles_by_id
2025-09-02 11:14:12,235 - principal_context_agent_test - INFO - Calling fetch_principal_profile for 'chief operating officer'
2025-09-02 11:14:12,236 - principal_context_agent_test - INFO - Successfully fetched profile for chief operating officer:
2025-09-02 11:14:12,236 - principal_context_agent_test - INFO -   Profile type: <class 'dict'>
2025-09-02 11:14:12,237 - principal_context_agent_test - INFO -   Name: Priya Desai
2025-09-02 11:14:12,237 - principal_context_agent_test - INFO -   Title: Chief Operating Officer
2025-09-02 11:14:12,238 - principal_context_agent_test - INFO -   Business Processes: ['finance_expense_management', 'finance_cash_flow', 'finance_budget_vs_actuals']
2025-09-02 11:14:12,238 - principal_context_agent_test - INFO -   Default Filters: {'profit_center_hierarchyid': ['Best Run U'], 'customer_hierarchyid': ['17100001']}
2025-09-02 11:14:12,239 - principal_context_agent_test - INFO -   Decision Style: Analytical
2025-09-02 11:14:12,239 - principal_context_agent_test - INFO -   Communication Style: Concise
2025-09-02 11:14:12,240 - principal_context_agent_test - INFO -   Timeframes: []
2025-09-02 11:14:12,240 - principal_context_agent_test - INFO - Step 4: Testing get_principal_context
2025-09-02 11:14:12,240 - principal_context_agent_test - INFO - === Testing get_principal_context for role: chief operating officer ===
2025-09-02 11:14:12,241 - principal_context_agent_test - INFO - Calling get_principal_context with role: chief operating officer
2025-09-02 11:14:12,241 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'chief operating officer'
2025-09-02 11:14:12,242 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['chief financial officer', 'chief executive officer', 'chief operating officer', 'finance manager']
2025-09-02 11:14:12,242 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['chief operating officer', 'CHIEF OPERATING OFFICER', 'CHIEF_OPERATING_OFFICER', 'Chief Operating Officer', 'chief_operating_officer', 'coo', 'COO']
2025-09-02 11:14:12,243 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'chief operating officer'
2025-09-02 11:14:12,244 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: chief operating officer
2025-09-02 11:14:12,244 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - ERROR - Error in get_principal_context: CEO (ID: 725005bb)
2025-09-02 11:14:12,245 - principal_context_agent_test - INFO - Successfully got context for chief operating officer:
2025-09-02 11:14:12,247 - principal_context_agent_test - INFO - Context: request_id='cacd7d29-5a5f-4096-acee-842640aa4e12' timestamp=datetime.datetime(2025, 9, 2, 11, 14, 12, 245060) status='error' message='Error getting principal context: CEO (error ID: 725005bb)' profile={'id': 'default_id', 'name': 'Default Profile', 'role': 'CFO', 'business_processes': [], 'default_filters': {}, 'timeframes': ['Quarterly'], 'responsibilities': []} responsibilities=[] filters={} context=PrincipalContext(role=<PrincipalRole.CFO: 'CFO'>, principal_id='cfo_default', business_processes=[<BusinessProcess.PROFITABILITY_ANALYSIS: 'Finance: Profitability Analysis'>, <BusinessProcess.REVENUE_GROWTH: 'Finance: Revenue Growth Analysis'>, <BusinessProcess.EXPENSE_MANAGEMENT: 'Finance: Expense Management'>, <BusinessProcess.CASH_FLOW: 'Finance: Cash Flow Management'>, <BusinessProcess.BUDGET_VS_ACTUALS: 'Finance: Budget vs. Actuals'>], default_filters={}, decision_style='Analytical', communication_style='Concise', preferred_timeframes=[<TimeFrame.CURRENT_QUARTER: 'current_quarter'>, <TimeFrame.YEAR_TO_DATE: 'year_to_date'>])
2025-09-02 11:14:12,248 - principal_context_agent_test - INFO - 
Step 5: Testing case-insensitive profile lookup
2025-09-02 11:14:12,249 - principal_context_agent_test - INFO - === Testing case-insensitive profile lookup ===
2025-09-02 11:14:12,249 - principal_context_agent_test - INFO - Testing lookup with role format: 'CFO'
2025-09-02 11:14:12,250 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'CFO'
2025-09-02 11:14:12,250 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['chief financial officer', 'chief executive officer', 'chief operating officer', 'finance manager']
2025-09-02 11:14:12,250 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['CFO', 'cfo', 'Cfo', 'Chief Financial Officer']
2025-09-02 11:14:12,251 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by attribute match: 'cfo_001' with role/title: 'Chief Financial Officer'
2025-09-02 11:14:12,252 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: CFO
2025-09-02 11:14:12,252 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - ERROR - Error in get_principal_context: CEO (ID: a11dc25b)
2025-09-02 11:14:12,439 - principal_context_agent_test - INFO - Testing lookup with role format: 'cfo'
2025-09-02 11:14:12,440 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'cfo'
2025-09-02 11:14:12,440 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['chief financial officer', 'chief executive officer', 'chief operating officer', 'finance manager']
2025-09-02 11:14:12,441 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['cfo', 'CFO', 'Cfo', 'Chief Financial Officer']
2025-09-02 11:14:12,442 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by attribute match: 'cfo_001' with role/title: 'Chief Financial Officer'
2025-09-02 11:14:12,443 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: cfo
2025-09-02 11:14:12,444 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - ERROR - Error in get_principal_context: CEO (ID: cb719da7)
2025-09-02 11:14:12,460 - principal_context_agent_test - INFO - Testing lookup with role format: 'Cfo'
2025-09-02 11:14:12,460 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'Cfo'
2025-09-02 11:14:12,461 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['chief financial officer', 'chief executive officer', 'chief operating officer', 'finance manager']
2025-09-02 11:14:12,462 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['Cfo', 'cfo', 'CFO', 'Chief Financial Officer']
2025-09-02 11:14:12,463 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by attribute match: 'cfo_001' with role/title: 'Chief Financial Officer'
2025-09-02 11:14:12,463 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: Cfo
2025-09-02 11:14:12,464 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - ERROR - Error in get_principal_context: CEO (ID: aced5051)
2025-09-02 11:14:12,479 - principal_context_agent_test - INFO - Testing lookup with role format: 'FINANCE_MANAGER'
2025-09-02 11:14:12,479 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'FINANCE_MANAGER'
2025-09-02 11:14:12,480 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['chief financial officer', 'chief executive officer', 'chief operating officer', 'finance manager']
2025-09-02 11:14:12,481 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['FINANCE_MANAGER', 'finance_manager', 'Finance Manager', 'finance manager']
2025-09-02 11:14:12,482 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'finance manager'
2025-09-02 11:14:12,482 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: FINANCE_MANAGER
2025-09-02 11:14:12,483 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Using principal ID from profile: finance_manager_001
2025-09-02 11:14:12,498 - principal_context_agent_test - INFO - Testing lookup with role format: 'Finance Manager'
2025-09-02 11:14:12,499 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'Finance Manager'
2025-09-02 11:14:12,499 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['chief financial officer', 'chief executive officer', 'chief operating officer', 'finance manager']
2025-09-02 11:14:12,500 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['Finance Manager', 'finance manager', 'FINANCE MANAGER', 'FINANCE_MANAGER', 'finance_manager']
2025-09-02 11:14:12,501 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'finance manager'
2025-09-02 11:14:12,501 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: Finance Manager
2025-09-02 11:14:12,502 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Using principal ID from profile: finance_manager_001
2025-09-02 11:14:12,519 - principal_context_agent_test - INFO - Testing lookup with role format: 'finance manager'
2025-09-02 11:14:12,519 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'finance manager'
2025-09-02 11:14:12,520 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['chief financial officer', 'chief executive officer', 'chief operating officer', 'finance manager']
2025-09-02 11:14:12,520 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['finance manager', 'FINANCE MANAGER', 'FINANCE_MANAGER', 'Finance Manager', 'finance_manager']
2025-09-02 11:14:12,521 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'finance manager'
2025-09-02 11:14:12,521 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: finance manager
2025-09-02 11:14:12,522 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Using principal ID from profile: finance_manager_001
2025-09-02 11:14:12,534 - principal_context_agent_test - INFO - Testing lookup with non-existent role: 'INVALID_ROLE'
2025-09-02 11:14:12,534 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'INVALID_ROLE'
2025-09-02 11:14:12,535 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['chief financial officer', 'chief executive officer', 'chief operating officer', 'finance manager']
2025-09-02 11:14:12,536 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['INVALID_ROLE', 'invalid_role', 'Invalid Role']
2025-09-02 11:14:12,536 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - WARNING - Principal profile not found for any variation of: 'INVALID_ROLE'
2025-09-02 11:14:12,537 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profiles: ['Chief Financial Officer', 'Chief Executive Officer', 'Chief Operating Officer', 'Finance Manager']
2025-09-02 11:14:12,537 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - WARNING - Principal profile not found for role: INVALID_ROLE
2025-09-02 11:14:12,538 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Using default principal ID: default_id
2025-09-02 11:14:12,539 - principal_context_agent_test - ERROR - Error testing non-existent role: 'PrincipalProfileResponse' object has no attribute 'get'
2025-09-02 11:14:12,540 - principal_context_agent_test - INFO - 
Step 6: Testing extract_filters
2025-09-02 11:14:12,540 - principal_context_agent_test - INFO - === Testing extract_filters ===
2025-09-02 11:14:12,543 - principal_context_agent_test - ERROR - Test failed with error: 1 validation error for ExtractFiltersRequest
job_description
  Field required [type=missing, input_value={'description': "\n    An...4136-98de-e8c028f1ba3e'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
Traceback (most recent call last):
  File "C:\Users\barry\CascadeProjects\Agent9-HERMES\test_principal_context_agent_manual.py", line 459, in main
    filter_response = await test_extract_filters(agent)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\barry\CascadeProjects\Agent9-HERMES\test_principal_context_agent_manual.py", line 246, in test_extract_filters
    request = ExtractFiltersRequest(
              ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\barry\CascadeProjects\Agent9-HERMES\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for ExtractFiltersRequest
job_description
  Field required [type=missing, input_value={'description': "\n    An...4136-98de-e8c028f1ba3e'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-09-02 11:28:39,272 - asyncio - DEBUG - Using proactor: IocpProactor
2025-09-02 11:28:39,278 - principal_context_agent_test - INFO - Starting Principal Context Agent tests
2025-09-02 11:28:39,280 - principal_context_agent_test - INFO - Step 1: Testing registry structure
2025-09-02 11:28:39,287 - principal_context_agent_test - INFO - === Testing registry structure ===
2025-09-02 11:28:39,306 - principal_context_agent_test - INFO - Initializing registry bootstrap
2025-09-02 11:28:39,312 - src.registry.factory - INFO - Registry Factory initialized
2025-09-02 11:28:39,318 - src.registry.factory - INFO - Registered principal_profile provider
2025-09-02 11:28:39,320 - src.registry.providers.principal_provider - INFO - Loading principal profiles from C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\principal\principal_registry.yaml (yaml)
2025-09-02 11:28:39,363 - src.registry.providers.principal_provider - INFO - Found 4 roles in YAML under 'roles' key
2025-09-02 11:28:39,365 - src.registry.providers.principal_provider - DEBUG - Registered role: cfo_001 - CFO
2025-09-02 11:28:39,366 - src.registry.providers.principal_provider - DEBUG - Registered role: ceo_001 - CEO
2025-09-02 11:28:39,368 - src.registry.providers.principal_provider - DEBUG - Registered role: coo_001 - COO
2025-09-02 11:28:39,369 - src.registry.providers.principal_provider - DEBUG - Registered role: finance_manager_001 - Finance Manager
2025-09-02 11:28:39,370 - src.registry.providers.principal_provider - INFO - Found 4 principal profiles in YAML under 'principals' key
2025-09-02 11:28:39,372 - src.registry.providers.principal_provider - DEBUG - Mapped role name CFO to principal ID cfo_001
2025-09-02 11:28:39,373 - src.registry.providers.principal_provider - INFO - Registered principal: cfo_001 - Lars Mikkelsen
2025-09-02 11:28:39,374 - src.registry.providers.principal_provider - DEBUG - Mapped role name CEO to principal ID ceo_001
2025-09-02 11:28:39,374 - src.registry.providers.principal_provider - INFO - Registered principal: ceo_001 - Alex Morgan
2025-09-02 11:28:39,376 - src.registry.providers.principal_provider - DEBUG - Mapped role name COO to principal ID coo_001
2025-09-02 11:28:39,377 - src.registry.providers.principal_provider - INFO - Registered principal: coo_001 - Priya Desai
2025-09-02 11:28:39,377 - src.registry.providers.principal_provider - DEBUG - Mapped role name Finance Manager to principal ID finance_manager_001
2025-09-02 11:28:39,378 - src.registry.providers.principal_provider - INFO - Registered principal: finance_manager_001 - Emily Chen
2025-09-02 11:28:39,381 - src.registry.providers.principal_provider - INFO - Added role ID mapping: cfo_001 -> Lars Mikkelsen
2025-09-02 11:28:39,382 - src.registry.providers.principal_provider - INFO - Added role ID mapping: ceo_001 -> Alex Morgan
2025-09-02 11:28:39,384 - src.registry.providers.principal_provider - INFO - Added role ID mapping: coo_001 -> Priya Desai
2025-09-02 11:28:39,385 - src.registry.providers.principal_provider - INFO - Added role ID mapping: finance_manager_001 -> Emily Chen
2025-09-02 11:28:39,386 - src.registry.providers.principal_provider - INFO - Loaded 4 principal profiles
2025-09-02 11:28:39,387 - src.registry.bootstrap - INFO - Initialized principal provider with 4 profiles
2025-09-02 11:28:39,395 - src.registry.factory - WARNING - Provider 'business_glossary' not found in registry factory
2025-09-02 11:28:39,395 - src.registry.bootstrap - INFO - Initializing business glossary provider
2025-09-02 11:28:39,403 - src.registry.providers.business_glossary_provider - INFO - Loaded 4 business terms from glossary
2025-09-02 11:28:39,404 - src.registry.factory - INFO - Registered business_glossary provider
2025-09-02 11:28:39,404 - src.registry.bootstrap - INFO - Initialized business glossary provider with 4 terms
2025-09-02 11:28:39,406 - src.registry.factory - INFO - Registered data_product provider
2025-09-02 11:28:39,407 - src.registry.providers.data_product_provider - INFO - Loading data products from C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\data_product\data_product_registry.yaml (yaml)
2025-09-02 11:28:39,425 - src.registry.providers.data_product_provider - INFO - Loaded 1 data products
2025-09-02 11:28:39,431 - src.registry.bootstrap - INFO - Initialized data product provider with 1 data products
2025-09-02 11:28:39,433 - src.registry.bootstrap - INFO - Initializing KPI provider
2025-09-02 11:28:39,434 - src.registry.factory - WARNING - Provider 'kpi' not found in registry factory
2025-09-02 11:28:39,435 - src.registry.bootstrap - INFO - Creating KPI provider with file at C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\kpi\kpi_registry.yaml
2025-09-02 11:28:39,437 - src.registry.bootstrap - INFO - Registering KPI provider with registry factory
2025-09-02 11:28:39,437 - src.registry.factory - INFO - Registered kpi provider
2025-09-02 11:28:39,438 - src.registry.bootstrap - INFO - Loading KPI provider data
2025-09-02 11:28:39,438 - src.registry.providers.kpi_provider - INFO - Loading KPIs from C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\kpi\kpi_registry.yaml (yaml)
2025-09-02 11:28:39,482 - src.registry.providers.kpi_provider - INFO - Loaded 6 KPIs
2025-09-02 11:28:39,485 - src.registry.bootstrap - INFO - KPI provider successfully registered and initialized with 6 KPIs
2025-09-02 11:28:39,486 - src.registry.bootstrap - INFO - Initializing agent bootstrap
2025-09-02 11:28:39,487 - src.agents.agent_bootstrap - WARNING - No agent implementations discovered
2025-09-02 11:28:39,488 - src.registry.bootstrap - WARNING - Agent bootstrap initialization had issues, continuing with available agents
2025-09-02 11:28:39,489 - src.registry.bootstrap - INFO - Registry providers and agent factories initialized successfully
2025-09-02 11:28:39,490 - principal_context_agent_test - INFO - Registry bootstrap initialized successfully
2025-09-02 11:28:39,491 - principal_context_agent_test - INFO - Got RegistryFactory from bootstrap
2025-09-02 11:28:39,492 - principal_context_agent_test - INFO - Provider status: {'principal_profile': True, 'business_glossary': True, 'data_product': False, 'kpi': True}
2025-09-02 11:28:39,493 - principal_context_agent_test - INFO - principal_profile provider status: True
2025-09-02 11:28:39,494 - principal_context_agent_test - INFO - Got principal provider: <src.registry.providers.principal_provider.PrincipalProfileProvider object at 0x000001DE6EA2F7D0>
2025-09-02 11:28:39,495 - principal_context_agent_test - INFO - Provider methods: ['__abstractmethods__', '__class__', '__class_getitem__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__orig_bases__', '__parameters__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', '__weakref__', '_abc_impl', '_add_profile', '_extract_profiles_from_module', '_is_protocol', '_load_default_profiles', '_load_from_json', '_load_from_python_module', '_load_from_yaml', '_profiles', '_profiles_by_name', '_profiles_by_title', '_registry_base_path', 'find_by_attribute', 'find_by_business_process', 'find_by_kpi', 'get', 'get_all', 'get_registry_path', 'initialize', 'load', 'register', 'source_path', 'storage_format']
2025-09-02 11:28:39,502 - principal_context_agent_test - INFO - Principal registry file exists at: C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\principal\principal_registry.yaml
2025-09-02 11:28:39,504 - principal_context_agent_test - INFO - Registry file content length: 6517 bytes
2025-09-02 11:28:39,506 - principal_context_agent_test - INFO - Registry file first 100 chars: # Principal Registry
# Contains all principal profiles for personalization and context-aware process...
2025-09-02 11:28:39,507 - principal_context_agent_test - INFO - Got registry data type: <class 'list'>
2025-09-02 11:28:39,508 - principal_context_agent_test - INFO - Found 4 principals in registry
2025-09-02 11:28:39,509 - principal_context_agent_test - INFO - Principal 1 details:
2025-09-02 11:28:39,510 - principal_context_agent_test - INFO -   ID: cfo_001
2025-09-02 11:28:39,510 - principal_context_agent_test - INFO -   Name: Lars Mikkelsen
2025-09-02 11:28:39,511 - principal_context_agent_test - INFO -   Role: N/A
2025-09-02 11:28:39,512 - principal_context_agent_test - INFO -   Title: Chief Financial Officer
2025-09-02 11:28:39,513 - principal_context_agent_test - INFO -   Business Processes: ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals']
2025-09-02 11:28:39,521 - principal_context_agent_test - INFO -   All attributes: ['__abstractmethods__', '__annotations__', '__class__', '__class_getitem__', '__class_vars__', '__copy__', '__deepcopy__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__fields__', '__fields_set__', '__format__', '__ge__', '__get_pydantic_core_schema__', '__get_pydantic_json_schema__', '__getattr__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__iter__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__pretty__', '__private_attributes__', '__pydantic_complete__', '__pydantic_computed_fields__', '__pydantic_core_schema__', '__pydantic_custom_init__', '__pydantic_decorators__', '__pydantic_extra__', '__pydantic_fields__', '__pydantic_fields_set__', '__pydantic_generic_metadata__', '__pydantic_init_subclass__', '__pydantic_parent_namespace__', '__pydantic_post_init__', '__pydantic_private__', '__pydantic_root_model__', '__pydantic_serializer__', '__pydantic_setattr_handlers__', '__pydantic_validator__', '__reduce__', '__reduce_ex__', '__replace__', '__repr__', '__repr_args__', '__repr_name__', '__repr_recursion__', '__repr_str__', '__rich_repr__', '__setattr__', '__setstate__', '__signature__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', '__weakref__', '_abc_impl', '_calculate_keys', '_copy_and_set_values', '_get_value', '_iter', '_setattr_handler', 'business_processes', 'communication', 'construct', 'copy', 'default_filters', 'description', 'dict', 'from_orm', 'id', 'json', 'kpis', 'metadata', 'model_computed_fields', 'model_config', 'model_construct', 'model_copy', 'model_dump', 'model_dump_json', 'model_extra', 'model_fields', 'model_fields_set', 'model_json_schema', 'model_parametrized_name', 'model_post_init', 'model_rebuild', 'model_validate', 'model_validate_json', 'model_validate_strings', 'name', 'parse_file', 'parse_obj', 'parse_raw', 'responsibilities', 'schema', 'schema_json', 'time_frame', 'title', 'to_dict', 'update_forward_refs', 'validate']
2025-09-02 11:28:39,528 - principal_context_agent_test - INFO -   Dict representation: {'id': 'cfo_001', 'name': 'Lars Mikkelsen', 'title': 'Chief Financial Officer', 'description': 'CFO responsible for financial performance in EMEA.', 'business_processes': ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals'], 'kpis': [], 'responsibilities': ['maximize EBIT', 'manage revenue', 'control expenses'], 'default_filters': {'profit_center_hierarchyid': ['Total'], 'customer_hierarchyid': ['Total']}, 'time_frame': {'default_period': 'QTD', 'historical_periods': 4, 'forward_looking_periods': 2}, 'communication': {'detail_level': 'high', 'format_preference': ['visual', 'text', 'table'], 'emphasis': ['trends', 'anomalies', 'forecasts']}, 'metadata': {}}
2025-09-02 11:28:39,534 - principal_context_agent_test - INFO -   __dict__ representation: {'id': 'cfo_001', 'name': 'Lars Mikkelsen', 'title': 'Chief Financial Officer', 'description': 'CFO responsible for financial performance in EMEA.', 'business_processes': ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals'], 'kpis': [], 'responsibilities': ['maximize EBIT', 'manage revenue', 'control expenses'], 'default_filters': {'profit_center_hierarchyid': ['Total'], 'customer_hierarchyid': ['Total']}, 'time_frame': TimeFrame(default_period='QTD', historical_periods=4, forward_looking_periods=2), 'communication': CommunicationPreference(detail_level='high', format_preference=['visual', 'text', 'table'], emphasis=['trends', 'anomalies', 'forecasts']), 'metadata': {}}
2025-09-02 11:28:39,539 - principal_context_agent_test - INFO - Principal 2 details:
2025-09-02 11:28:39,539 - principal_context_agent_test - INFO -   ID: ceo_001
2025-09-02 11:28:39,540 - principal_context_agent_test - INFO -   Name: Alex Morgan
2025-09-02 11:28:39,541 - principal_context_agent_test - INFO -   Role: N/A
2025-09-02 11:28:39,541 - principal_context_agent_test - INFO -   Title: Chief Executive Officer
2025-09-02 11:28:39,542 - principal_context_agent_test - INFO -   Business Processes: ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals']
2025-09-02 11:28:39,547 - principal_context_agent_test - INFO -   All attributes: ['__abstractmethods__', '__annotations__', '__class__', '__class_getitem__', '__class_vars__', '__copy__', '__deepcopy__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__fields__', '__fields_set__', '__format__', '__ge__', '__get_pydantic_core_schema__', '__get_pydantic_json_schema__', '__getattr__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__iter__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__pretty__', '__private_attributes__', '__pydantic_complete__', '__pydantic_computed_fields__', '__pydantic_core_schema__', '__pydantic_custom_init__', '__pydantic_decorators__', '__pydantic_extra__', '__pydantic_fields__', '__pydantic_fields_set__', '__pydantic_generic_metadata__', '__pydantic_init_subclass__', '__pydantic_parent_namespace__', '__pydantic_post_init__', '__pydantic_private__', '__pydantic_root_model__', '__pydantic_serializer__', '__pydantic_setattr_handlers__', '__pydantic_validator__', '__reduce__', '__reduce_ex__', '__replace__', '__repr__', '__repr_args__', '__repr_name__', '__repr_recursion__', '__repr_str__', '__rich_repr__', '__setattr__', '__setstate__', '__signature__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', '__weakref__', '_abc_impl', '_calculate_keys', '_copy_and_set_values', '_get_value', '_iter', '_setattr_handler', 'business_processes', 'communication', 'construct', 'copy', 'default_filters', 'description', 'dict', 'from_orm', 'id', 'json', 'kpis', 'metadata', 'model_computed_fields', 'model_config', 'model_construct', 'model_copy', 'model_dump', 'model_dump_json', 'model_extra', 'model_fields', 'model_fields_set', 'model_json_schema', 'model_parametrized_name', 'model_post_init', 'model_rebuild', 'model_validate', 'model_validate_json', 'model_validate_strings', 'name', 'parse_file', 'parse_obj', 'parse_raw', 'responsibilities', 'schema', 'schema_json', 'time_frame', 'title', 'to_dict', 'update_forward_refs', 'validate']
2025-09-02 11:28:39,566 - principal_context_agent_test - INFO -   Dict representation: {'id': 'ceo_001', 'name': 'Alex Morgan', 'title': 'Chief Executive Officer', 'description': 'CEO driving company strategy and performance.', 'business_processes': ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals'], 'kpis': [], 'responsibilities': ['set strategic direction', 'oversee company performance', 'lead executive team'], 'default_filters': {'profit_center_hierarchyid': ['#']}, 'time_frame': {'default_period': 'YTD', 'historical_periods': 3, 'forward_looking_periods': 4}, 'communication': {'detail_level': 'medium', 'format_preference': ['visual', 'summary'], 'emphasis': ['trends', 'strategic_impact']}, 'metadata': {}}
2025-09-02 11:28:39,619 - principal_context_agent_test - INFO -   __dict__ representation: {'id': 'ceo_001', 'name': 'Alex Morgan', 'title': 'Chief Executive Officer', 'description': 'CEO driving company strategy and performance.', 'business_processes': ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals'], 'kpis': [], 'responsibilities': ['set strategic direction', 'oversee company performance', 'lead executive team'], 'default_filters': {'profit_center_hierarchyid': ['#']}, 'time_frame': TimeFrame(default_period='YTD', historical_periods=3, forward_looking_periods=4), 'communication': CommunicationPreference(detail_level='medium', format_preference=['visual', 'summary'], emphasis=['trends', 'strategic_impact']), 'metadata': {}}
2025-09-02 11:28:39,637 - principal_context_agent_test - INFO - Principal 3 details:
2025-09-02 11:28:39,644 - principal_context_agent_test - INFO -   ID: coo_001
2025-09-02 11:28:39,645 - principal_context_agent_test - INFO -   Name: Priya Desai
2025-09-02 11:28:39,645 - principal_context_agent_test - INFO -   Role: N/A
2025-09-02 11:28:39,646 - principal_context_agent_test - INFO -   Title: Chief Operating Officer
2025-09-02 11:28:39,647 - principal_context_agent_test - INFO -   Business Processes: ['finance_expense_management', 'finance_cash_flow', 'finance_budget_vs_actuals']
2025-09-02 11:28:39,651 - principal_context_agent_test - INFO -   All attributes: ['__abstractmethods__', '__annotations__', '__class__', '__class_getitem__', '__class_vars__', '__copy__', '__deepcopy__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__fields__', '__fields_set__', '__format__', '__ge__', '__get_pydantic_core_schema__', '__get_pydantic_json_schema__', '__getattr__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__iter__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__pretty__', '__private_attributes__', '__pydantic_complete__', '__pydantic_computed_fields__', '__pydantic_core_schema__', '__pydantic_custom_init__', '__pydantic_decorators__', '__pydantic_extra__', '__pydantic_fields__', '__pydantic_fields_set__', '__pydantic_generic_metadata__', '__pydantic_init_subclass__', '__pydantic_parent_namespace__', '__pydantic_post_init__', '__pydantic_private__', '__pydantic_root_model__', '__pydantic_serializer__', '__pydantic_setattr_handlers__', '__pydantic_validator__', '__reduce__', '__reduce_ex__', '__replace__', '__repr__', '__repr_args__', '__repr_name__', '__repr_recursion__', '__repr_str__', '__rich_repr__', '__setattr__', '__setstate__', '__signature__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', '__weakref__', '_abc_impl', '_calculate_keys', '_copy_and_set_values', '_get_value', '_iter', '_setattr_handler', 'business_processes', 'communication', 'construct', 'copy', 'default_filters', 'description', 'dict', 'from_orm', 'id', 'json', 'kpis', 'metadata', 'model_computed_fields', 'model_config', 'model_construct', 'model_copy', 'model_dump', 'model_dump_json', 'model_extra', 'model_fields', 'model_fields_set', 'model_json_schema', 'model_parametrized_name', 'model_post_init', 'model_rebuild', 'model_validate', 'model_validate_json', 'model_validate_strings', 'name', 'parse_file', 'parse_obj', 'parse_raw', 'responsibilities', 'schema', 'schema_json', 'time_frame', 'title', 'to_dict', 'update_forward_refs', 'validate']
2025-09-02 11:28:39,659 - principal_context_agent_test - INFO -   Dict representation: {'id': 'coo_001', 'name': 'Priya Desai', 'title': 'Chief Operating Officer', 'description': 'COO focused on operational excellence and efficiency.', 'business_processes': ['finance_expense_management', 'finance_cash_flow', 'finance_budget_vs_actuals'], 'kpis': [], 'responsibilities': ['optimize operations', 'reduce operational costs', 'improve process efficiency'], 'default_filters': {'profit_center_hierarchyid': ['Best Run U'], 'customer_hierarchyid': ['17100001']}, 'time_frame': {'default_period': 'MTD', 'historical_periods': 6, 'forward_looking_periods': 2}, 'communication': {'detail_level': 'high', 'format_preference': ['table', 'visual'], 'emphasis': ['variances', 'operational_metrics']}, 'metadata': {}}
2025-09-02 11:28:39,662 - principal_context_agent_test - INFO -   __dict__ representation: {'id': 'coo_001', 'name': 'Priya Desai', 'title': 'Chief Operating Officer', 'description': 'COO focused on operational excellence and efficiency.', 'business_processes': ['finance_expense_management', 'finance_cash_flow', 'finance_budget_vs_actuals'], 'kpis': [], 'responsibilities': ['optimize operations', 'reduce operational costs', 'improve process efficiency'], 'default_filters': {'profit_center_hierarchyid': ['Best Run U'], 'customer_hierarchyid': ['17100001']}, 'time_frame': TimeFrame(default_period='MTD', historical_periods=6, forward_looking_periods=2), 'communication': CommunicationPreference(detail_level='high', format_preference=['table', 'visual'], emphasis=['variances', 'operational_metrics']), 'metadata': {}}
2025-09-02 11:28:39,665 - principal_context_agent_test - INFO - Principal 4 details:
2025-09-02 11:28:39,666 - principal_context_agent_test - INFO -   ID: finance_manager_001
2025-09-02 11:28:39,666 - principal_context_agent_test - INFO -   Name: Emily Chen
2025-09-02 11:28:39,668 - principal_context_agent_test - INFO -   Role: N/A
2025-09-02 11:28:39,671 - principal_context_agent_test - INFO -   Title: Finance Manager
2025-09-02 11:28:39,672 - principal_context_agent_test - INFO -   Business Processes: ['Finance: Expense Management', 'Finance: Budget vs. Actuals', 'Finance: Cash Flow Management']
2025-09-02 11:28:39,676 - principal_context_agent_test - INFO -   All attributes: ['__abstractmethods__', '__annotations__', '__class__', '__class_getitem__', '__class_vars__', '__copy__', '__deepcopy__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__fields__', '__fields_set__', '__format__', '__ge__', '__get_pydantic_core_schema__', '__get_pydantic_json_schema__', '__getattr__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__iter__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__pretty__', '__private_attributes__', '__pydantic_complete__', '__pydantic_computed_fields__', '__pydantic_core_schema__', '__pydantic_custom_init__', '__pydantic_decorators__', '__pydantic_extra__', '__pydantic_fields__', '__pydantic_fields_set__', '__pydantic_generic_metadata__', '__pydantic_init_subclass__', '__pydantic_parent_namespace__', '__pydantic_post_init__', '__pydantic_private__', '__pydantic_root_model__', '__pydantic_serializer__', '__pydantic_setattr_handlers__', '__pydantic_validator__', '__reduce__', '__reduce_ex__', '__replace__', '__repr__', '__repr_args__', '__repr_name__', '__repr_recursion__', '__repr_str__', '__rich_repr__', '__setattr__', '__setstate__', '__signature__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', '__weakref__', '_abc_impl', '_calculate_keys', '_copy_and_set_values', '_get_value', '_iter', '_setattr_handler', 'business_processes', 'communication', 'construct', 'copy', 'default_filters', 'description', 'dict', 'from_orm', 'id', 'json', 'kpis', 'metadata', 'model_computed_fields', 'model_config', 'model_construct', 'model_copy', 'model_dump', 'model_dump_json', 'model_extra', 'model_fields', 'model_fields_set', 'model_json_schema', 'model_parametrized_name', 'model_post_init', 'model_rebuild', 'model_validate', 'model_validate_json', 'model_validate_strings', 'name', 'parse_file', 'parse_obj', 'parse_raw', 'responsibilities', 'schema', 'schema_json', 'time_frame', 'title', 'to_dict', 'update_forward_refs', 'validate']
2025-09-02 11:28:39,686 - principal_context_agent_test - INFO -   Dict representation: {'id': 'finance_manager_001', 'name': 'Emily Chen', 'title': 'Finance Manager', 'description': 'Finance Manager responsible for departmental financial analysis and reporting.', 'business_processes': ['Finance: Expense Management', 'Finance: Budget vs. Actuals', 'Finance: Cash Flow Management'], 'kpis': [], 'responsibilities': ['manage departmental budget', 'analyze financial data', 'prepare financial reports'], 'default_filters': {'profit_center_hierarchyid': ['Finance'], 'customer_hierarchyid': ['Total']}, 'time_frame': {'default_period': 'MTD', 'historical_periods': 6, 'forward_looking_periods': 3}, 'communication': {'detail_level': 'high', 'format_preference': ['table', 'visual', 'text'], 'emphasis': ['variances', 'trends', 'forecasts']}, 'metadata': {}}
2025-09-02 11:28:39,693 - principal_context_agent_test - INFO -   __dict__ representation: {'id': 'finance_manager_001', 'name': 'Emily Chen', 'title': 'Finance Manager', 'description': 'Finance Manager responsible for departmental financial analysis and reporting.', 'business_processes': ['Finance: Expense Management', 'Finance: Budget vs. Actuals', 'Finance: Cash Flow Management'], 'kpis': [], 'responsibilities': ['manage departmental budget', 'analyze financial data', 'prepare financial reports'], 'default_filters': {'profit_center_hierarchyid': ['Finance'], 'customer_hierarchyid': ['Total']}, 'time_frame': TimeFrame(default_period='MTD', historical_periods=6, forward_looking_periods=3), 'communication': CommunicationPreference(detail_level='high', format_preference=['table', 'visual', 'text'], emphasis=['variances', 'trends', 'forecasts']), 'metadata': {}}
2025-09-02 11:28:39,699 - principal_context_agent_test - INFO - 
Step 2: Testing Agent Initialization
2025-09-02 11:28:39,701 - principal_context_agent_test - INFO - === Testing loading principal profiles ===
2025-09-02 11:28:39,704 - principal_context_agent_test - INFO - Creating Principal Context Agent
2025-09-02 11:28:39,705 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Initializing A9_Principal_Context_Agent
2025-09-02 11:28:39,707 - principal_context_agent_test - INFO - Connecting agent
2025-09-02 11:28:39,709 - src.registry.bootstrap - INFO - Registry bootstrap already initialized
2025-09-02 11:28:39,711 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Loaded 4 principal profiles from registry
2025-09-02 11:28:39,713 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - First profile: id=cfo_001, role=unknown, name=Lars Mikkelsen
2025-09-02 11:28:39,714 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Profile attributes: ['__abstractmethods__', '__annotations__', '__class__', '__class_getitem__', '__class_vars__', '__copy__', '__deepcopy__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__fields__', '__fields_set__', '__format__', '__ge__', '__get_pydantic_core_schema__', '__get_pydantic_json_schema__', '__getattr__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__iter__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__pretty__', '__private_attributes__', '__pydantic_complete__', '__pydantic_computed_fields__', '__pydantic_core_schema__', '__pydantic_custom_init__', '__pydantic_decorators__', '__pydantic_extra__', '__pydantic_fields__', '__pydantic_fields_set__', '__pydantic_generic_metadata__', '__pydantic_init_subclass__', '__pydantic_parent_namespace__', '__pydantic_post_init__', '__pydantic_private__', '__pydantic_root_model__', '__pydantic_serializer__', '__pydantic_setattr_handlers__', '__pydantic_validator__', '__reduce__', '__reduce_ex__', '__replace__', '__repr__', '__repr_args__', '__repr_name__', '__repr_recursion__', '__repr_str__', '__rich_repr__', '__setattr__', '__setstate__', '__signature__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', '__weakref__', '_abc_impl', '_calculate_keys', '_copy_and_set_values', '_get_value', '_iter', '_setattr_handler', 'business_processes', 'communication', 'construct', 'copy', 'default_filters', 'description', 'dict', 'from_orm', 'id', 'json', 'kpis', 'metadata', 'model_computed_fields', 'model_config', 'model_construct', 'model_copy', 'model_dump', 'model_dump_json', 'model_extra', 'model_fields', 'model_fields_set', 'model_json_schema', 'model_parametrized_name', 'model_post_init', 'model_rebuild', 'model_validate', 'model_validate_json', 'model_validate_strings', 'name', 'parse_file', 'parse_obj', 'parse_raw', 'responsibilities', 'schema', 'schema_json', 'time_frame', 'title', 'to_dict', 'update_forward_refs', 'validate']
2025-09-02 11:28:39,726 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Profile dict: {'id': 'cfo_001', 'name': 'Lars Mikkelsen', 'title': 'Chief Financial Officer', 'description': 'CFO responsible for financial performance in EMEA.', 'business_processes': ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals'], 'kpis': [], 'responsibilities': ['maximize EBIT', 'manage revenue', 'control expenses'], 'default_filters': {'profit_center_hierarchyid': ['Total'], 'customer_hierarchyid': ['Total']}, 'time_frame': {'default_period': 'QTD', 'historical_periods': 4, 'forward_looking_periods': 2}, 'communication': {'detail_level': 'high', 'format_preference': ['visual', 'text', 'table'], 'emphasis': ['trends', 'anomalies', 'forecasts']}, 'metadata': {}}
2025-09-02 11:28:39,731 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found 4 principals in registry
2025-09-02 11:28:39,732 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Loaded 4 principal profiles by ID from registry
2025-09-02 11:28:39,733 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Loaded 4 principal profiles by role from registry
2025-09-02 11:28:39,738 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Connected to dependencies
2025-09-02 11:28:39,741 - principal_context_agent_test - INFO - Loaded 4 principal profiles in principal_profiles dictionary
2025-09-02 11:28:39,742 - principal_context_agent_test - INFO - Loaded 4 principal profiles in principal_profiles_by_id dictionary
2025-09-02 11:28:39,747 - principal_context_agent_test - INFO - Keys in principal_profiles_by_id: ['cfo_001', 'ceo_001', 'coo_001', 'finance_manager_001']
2025-09-02 11:28:39,749 - principal_context_agent_test - INFO - Available roles in principal_profiles: ['chief financial officer', 'chief executive officer', 'chief operating officer', 'finance manager']
2025-09-02 11:28:39,750 - principal_context_agent_test - INFO - Sample profile for chief financial officer:
2025-09-02 11:28:39,751 - principal_context_agent_test - INFO -   id: cfo_001
2025-09-02 11:28:39,751 - principal_context_agent_test - INFO -   role: Chief Financial Officer
2025-09-02 11:28:39,752 - principal_context_agent_test - INFO -   name: Lars Mikkelsen
2025-09-02 11:28:39,753 - principal_context_agent_test - INFO -   title: Chief Financial Officer
2025-09-02 11:28:39,755 - principal_context_agent_test - INFO -   business_processes: ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals']
2025-09-02 11:28:39,756 - principal_context_agent_test - INFO -   default_filters: {'profit_center_hierarchyid': ['Total'], 'customer_hierarchyid': ['Total']}
2025-09-02 11:28:39,757 - principal_context_agent_test - INFO -   decision_style: Analytical
2025-09-02 11:28:39,757 - principal_context_agent_test - INFO -   communication_style: Concise
2025-09-02 11:28:39,759 - principal_context_agent_test - INFO -   description: CFO responsible for financial performance in EMEA.
2025-09-02 11:28:39,760 - principal_context_agent_test - INFO -   timeframes: []
2025-09-02 11:28:39,761 - principal_context_agent_test - INFO - Inspecting _load_principal_profiles method
2025-09-02 11:28:39,780 - principal_context_agent_test - INFO - _load_principal_profiles method code:
    async def _load_principal_profiles(self):
        """Load principal profiles from registry."""
        try:
            # Try to get principal profiles from registry
            if not self._principal_provider:
                self.logger.warning("Principal profile provider not initialized")
                self._load_default_profiles()
                return
                
            registry_data = self._principal_provider.get_all()
            self.logger.info(f"Loaded {len(registry_data) if registry_data else 0} principal profiles from registry")
            
            if registry_data and isinstance(registry_data, list):
                # Debug: Log the first profile to see its structure
                if registry_data:
                    first_profile = registry_data[0]
                    self.logger.info(f"First profile: id={getattr(first_profile, 'id', 'unknown')}, "
                                    f"role={getattr(first_profile, 'role', 'unknown')}, "
                                    f"name={getattr(first_profile, 'name', 'unknown')}")
                    self.logger.info(f"Profile attributes: {dir(first_profile)}")
                    self.logger.info(f"Profile dict: {first_profile.dict() if hasattr(first_profile, 'dict') else 'No dict method'}")
                
                principals = registry_data
                self.logger.info(f"Found {len(principals)} principals in registry")
                
                # Convert to our internal dictionary format keyed by ID and role
                normalized_by_role: Dict[str, Any] = {}
                normalized_by_id: Dict[str, Any] = {}
                role_to_id: Dict[str, str] = {}
                
                for principal in principals:
                    # Use attribute access for Pydantic models instead of dictionary-style access
                    principal_id = getattr(principal, 'id', None)
                    role = getattr(principal, 'role', None)
                    title = getattr(principal, 'title', None)
                    
                    # Use title as role key if role is not available
                    role_key = ''
                    if role:
                        role_key = str(role).lower()
                    elif title:
                        role_key = str(title).lower()
                    
                    if not principal_id:
                        self.logger.warning(f"Principal missing ID: {getattr(principal, 'name', 'Unknown')} - {role or title}")
                        continue
                        
                    # Create profile object
                    profile = {
                        "id": principal_id,
                        "role": role or title,  # Use title as role if role is not available
                        "name": getattr(principal, 'name', None),
                        "title": title,
                        "business_processes": getattr(principal, 'business_processes', []),
                        "default_filters": getattr(principal, 'default_filters', {}),
                        "decision_style": getattr(getattr(principal, 'persona_profile', {}), 'decision_style', 'Analytical'),
                        "communication_style": getattr(getattr(principal, 'persona_profile', {}), 'communication_style', 'Concise'),
                        "description": getattr(principal, 'description', ''),
                        "timeframes": getattr(principal, 'typical_timeframes', [])
                    }
                    
                    # Store by ID (primary index)
                    normalized_by_id[principal_id] = profile
                    
                    # Store by role (secondary index for backward compatibility)
                    if role_key:
                        normalized_by_role[role_key] = profile
                        role_to_id[role_key] = principal_id
                        
                        # Also store by title for additional lookup options
                        if title and title.lower() != role_key:
                            title_key = title.lower()
                            normalized_by_role[title_key] = profile
                            role_to_id[title_key] = principal_id
                
                if normalized_by_id:
                    self.principal_profiles = normalized_by_role
                    self.principal_profiles_by_id = normalized_by_id
                    self.role_to_id_map = role_to_id
                    self.logger.info(f"Loaded {len(self.principal_profiles_by_id)} principal profiles by ID from registry")
                    self.logger.info(f"Loaded {len(self.principal_profiles)} principal profiles by role from registry")
                    return
            
            # Fallback to old format or empty registry
            self.logger.warning("No 'principals' key found in registry or no valid profiles, using defaults")
            self._load_default_profiles()
        except Exception as e:
            error_id = self._log_error("_load_principal_profiles", e)
            self._load_default_profiles()
            self.logger.warning(f"Using default profiles due to loading error {error_id}")

2025-09-02 11:28:39,790 - principal_context_agent_test - INFO - Available roles from agent: ['chief financial officer', 'chief executive officer', 'chief operating officer', 'finance manager']
2025-09-02 11:28:39,791 - principal_context_agent_test - INFO - Testing with roles: ['chief financial officer', 'chief executive officer', 'chief operating officer']
2025-09-02 11:28:39,793 - principal_context_agent_test - INFO - 
Testing with role: chief financial officer
2025-09-02 11:28:39,794 - principal_context_agent_test - INFO - Step 3: Testing fetch_principal_profile
2025-09-02 11:28:39,794 - principal_context_agent_test - INFO - === Testing fetch_principal_profile for role: chief financial officer ===
2025-09-02 11:28:39,795 - principal_context_agent_test - INFO - Checking if 'chief financial officer' exists in principal_profiles_by_id
2025-09-02 11:28:39,796 - principal_context_agent_test - INFO - Calling fetch_principal_profile for 'chief financial officer'
2025-09-02 11:28:39,797 - principal_context_agent_test - INFO - Successfully fetched profile for chief financial officer:
2025-09-02 11:28:39,798 - principal_context_agent_test - INFO -   Profile type: <class 'dict'>
2025-09-02 11:28:39,800 - principal_context_agent_test - INFO -   Name: Lars Mikkelsen
2025-09-02 11:28:39,802 - principal_context_agent_test - INFO -   Title: Chief Financial Officer
2025-09-02 11:28:39,803 - principal_context_agent_test - INFO -   Business Processes: ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals']
2025-09-02 11:28:39,808 - principal_context_agent_test - INFO -   Default Filters: {'profit_center_hierarchyid': ['Total'], 'customer_hierarchyid': ['Total']}
2025-09-02 11:28:39,809 - principal_context_agent_test - INFO -   Decision Style: Analytical
2025-09-02 11:28:39,810 - principal_context_agent_test - INFO -   Communication Style: Concise
2025-09-02 11:28:39,810 - principal_context_agent_test - INFO -   Timeframes: []
2025-09-02 11:28:39,811 - principal_context_agent_test - INFO - Step 4: Testing get_principal_context
2025-09-02 11:28:39,812 - principal_context_agent_test - INFO - === Testing get_principal_context for role: chief financial officer ===
2025-09-02 11:28:39,813 - principal_context_agent_test - INFO - Calling get_principal_context with role: chief financial officer
2025-09-02 11:28:39,814 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: chief financial officer
2025-09-02 11:28:39,815 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'chief financial officer'
2025-09-02 11:28:39,817 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['chief financial officer', 'chief executive officer', 'chief operating officer', 'finance manager']
2025-09-02 11:28:39,820 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['chief financial officer', 'CHIEF FINANCIAL OFFICER', 'CHIEF_FINANCIAL_OFFICER', 'Chief Financial Officer', 'chief_financial_officer', 'cfo', 'CFO']
2025-09-02 11:28:39,821 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'chief financial officer'
2025-09-02 11:28:39,822 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: chief financial officer
2025-09-02 11:28:39,826 - principal_context_agent_test - ERROR - Error testing get_principal_context: 'str' object is not a mapping
2025-09-02 11:28:39,828 - principal_context_agent_test - INFO - Could not get context for chief financial officer, continuing with next tests
2025-09-02 11:28:39,830 - principal_context_agent_test - INFO - 
Testing with role: chief executive officer
2025-09-02 11:28:39,830 - principal_context_agent_test - INFO - Step 3: Testing fetch_principal_profile
2025-09-02 11:28:39,831 - principal_context_agent_test - INFO - === Testing fetch_principal_profile for role: chief executive officer ===
2025-09-02 11:28:39,832 - principal_context_agent_test - INFO - Checking if 'chief executive officer' exists in principal_profiles_by_id
2025-09-02 11:28:39,833 - principal_context_agent_test - INFO - Calling fetch_principal_profile for 'chief executive officer'
2025-09-02 11:28:39,833 - principal_context_agent_test - INFO - Successfully fetched profile for chief executive officer:
2025-09-02 11:28:39,835 - principal_context_agent_test - INFO -   Profile type: <class 'dict'>
2025-09-02 11:28:39,835 - principal_context_agent_test - INFO -   Name: Alex Morgan
2025-09-02 11:28:39,836 - principal_context_agent_test - INFO -   Title: Chief Executive Officer
2025-09-02 11:28:39,837 - principal_context_agent_test - INFO -   Business Processes: ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals']
2025-09-02 11:28:39,838 - principal_context_agent_test - INFO -   Default Filters: {'profit_center_hierarchyid': ['#']}
2025-09-02 11:28:39,839 - principal_context_agent_test - INFO -   Decision Style: Analytical
2025-09-02 11:28:39,840 - principal_context_agent_test - INFO -   Communication Style: Concise
2025-09-02 11:28:39,840 - principal_context_agent_test - INFO -   Timeframes: []
2025-09-02 11:28:39,841 - principal_context_agent_test - INFO - Step 4: Testing get_principal_context
2025-09-02 11:28:39,842 - principal_context_agent_test - INFO - === Testing get_principal_context for role: chief executive officer ===
2025-09-02 11:28:39,842 - principal_context_agent_test - INFO - Calling get_principal_context with role: chief executive officer
2025-09-02 11:28:39,843 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: chief executive officer
2025-09-02 11:28:39,844 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'chief executive officer'
2025-09-02 11:28:39,845 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['chief financial officer', 'chief executive officer', 'chief operating officer', 'finance manager']
2025-09-02 11:28:39,846 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['chief executive officer', 'CHIEF EXECUTIVE OFFICER', 'CHIEF_EXECUTIVE_OFFICER', 'Chief Executive Officer', 'chief_executive_officer', 'ceo', 'CEO']
2025-09-02 11:28:39,847 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'chief executive officer'
2025-09-02 11:28:39,848 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: chief executive officer
2025-09-02 11:28:39,850 - principal_context_agent_test - ERROR - Error testing get_principal_context: 'str' object is not a mapping
2025-09-02 11:28:39,851 - principal_context_agent_test - INFO - Could not get context for chief executive officer, continuing with next tests
2025-09-02 11:28:39,852 - principal_context_agent_test - INFO - 
Testing with role: chief operating officer
2025-09-02 11:28:39,853 - principal_context_agent_test - INFO - Step 3: Testing fetch_principal_profile
2025-09-02 11:28:39,854 - principal_context_agent_test - INFO - === Testing fetch_principal_profile for role: chief operating officer ===
2025-09-02 11:28:39,855 - principal_context_agent_test - INFO - Checking if 'chief operating officer' exists in principal_profiles_by_id
2025-09-02 11:28:39,856 - principal_context_agent_test - INFO - Calling fetch_principal_profile for 'chief operating officer'
2025-09-02 11:28:39,857 - principal_context_agent_test - INFO - Successfully fetched profile for chief operating officer:
2025-09-02 11:28:39,857 - principal_context_agent_test - INFO -   Profile type: <class 'dict'>
2025-09-02 11:28:39,858 - principal_context_agent_test - INFO -   Name: Priya Desai
2025-09-02 11:28:39,859 - principal_context_agent_test - INFO -   Title: Chief Operating Officer
2025-09-02 11:28:39,859 - principal_context_agent_test - INFO -   Business Processes: ['finance_expense_management', 'finance_cash_flow', 'finance_budget_vs_actuals']
2025-09-02 11:28:39,860 - principal_context_agent_test - INFO -   Default Filters: {'profit_center_hierarchyid': ['Best Run U'], 'customer_hierarchyid': ['17100001']}
2025-09-02 11:28:39,860 - principal_context_agent_test - INFO -   Decision Style: Analytical
2025-09-02 11:28:39,861 - principal_context_agent_test - INFO -   Communication Style: Concise
2025-09-02 11:28:39,861 - principal_context_agent_test - INFO -   Timeframes: []
2025-09-02 11:28:39,862 - principal_context_agent_test - INFO - Step 4: Testing get_principal_context
2025-09-02 11:28:39,863 - principal_context_agent_test - INFO - === Testing get_principal_context for role: chief operating officer ===
2025-09-02 11:28:39,863 - principal_context_agent_test - INFO - Calling get_principal_context with role: chief operating officer
2025-09-02 11:28:39,864 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: chief operating officer
2025-09-02 11:28:39,864 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'chief operating officer'
2025-09-02 11:28:39,865 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['chief financial officer', 'chief executive officer', 'chief operating officer', 'finance manager']
2025-09-02 11:28:39,866 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['chief operating officer', 'CHIEF OPERATING OFFICER', 'CHIEF_OPERATING_OFFICER', 'Chief Operating Officer', 'chief_operating_officer', 'coo', 'COO']
2025-09-02 11:28:39,867 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'chief operating officer'
2025-09-02 11:28:39,868 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: chief operating officer
2025-09-02 11:28:39,869 - principal_context_agent_test - ERROR - Error testing get_principal_context: 'str' object is not a mapping
2025-09-02 11:28:39,870 - principal_context_agent_test - INFO - Could not get context for chief operating officer, continuing with next tests
2025-09-02 11:28:39,871 - principal_context_agent_test - INFO - 
Step 5: Testing case-insensitive profile lookup
2025-09-02 11:28:39,871 - principal_context_agent_test - INFO - === Testing case-insensitive profile lookup ===
2025-09-02 11:28:39,872 - principal_context_agent_test - INFO - Testing lookup with role format: 'CFO'
2025-09-02 11:28:39,872 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: CFO
2025-09-02 11:28:39,873 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'CFO'
2025-09-02 11:28:39,873 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['chief financial officer', 'chief executive officer', 'chief operating officer', 'finance manager']
2025-09-02 11:28:39,875 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['CFO', 'cfo', 'Cfo', 'Chief Financial Officer']
2025-09-02 11:28:39,875 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by attribute match: 'cfo_001' with role/title: 'Chief Financial Officer'
2025-09-02 11:28:39,876 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: CFO
2025-09-02 11:28:39,945 - principal_context_agent_test - INFO - Testing lookup with role format: 'cfo'
2025-09-02 11:28:39,946 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: cfo
2025-09-02 11:28:39,946 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'cfo'
2025-09-02 11:28:39,947 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['chief financial officer', 'chief executive officer', 'chief operating officer', 'finance manager']
2025-09-02 11:28:39,948 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['cfo', 'CFO', 'Cfo', 'Chief Financial Officer']
2025-09-02 11:28:39,949 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by attribute match: 'cfo_001' with role/title: 'Chief Financial Officer'
2025-09-02 11:28:39,951 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: cfo
2025-09-02 11:28:39,972 - principal_context_agent_test - INFO - Testing lookup with role format: 'Cfo'
2025-09-02 11:28:39,973 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: Cfo
2025-09-02 11:28:39,974 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'Cfo'
2025-09-02 11:28:39,975 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['chief financial officer', 'chief executive officer', 'chief operating officer', 'finance manager']
2025-09-02 11:28:39,977 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['Cfo', 'cfo', 'CFO', 'Chief Financial Officer']
2025-09-02 11:28:39,978 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by attribute match: 'cfo_001' with role/title: 'Chief Financial Officer'
2025-09-02 11:28:39,979 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: Cfo
2025-09-02 11:28:40,002 - principal_context_agent_test - INFO - Testing lookup with role format: 'FINANCE_MANAGER'
2025-09-02 11:28:40,003 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: FINANCE_MANAGER
2025-09-02 11:28:40,008 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'FINANCE_MANAGER'
2025-09-02 11:28:40,013 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['chief financial officer', 'chief executive officer', 'chief operating officer', 'finance manager']
2025-09-02 11:28:40,016 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['FINANCE_MANAGER', 'finance_manager', 'Finance Manager', 'finance manager']
2025-09-02 11:28:40,018 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'finance manager'
2025-09-02 11:28:40,020 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: FINANCE_MANAGER
2025-09-02 11:28:40,020 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Mapped role directly to enum: Finance Manager -> PrincipalRole.FINANCE_MANAGER
2025-09-02 11:28:40,067 - principal_context_agent_test - INFO - Testing lookup with role format: 'Finance Manager'
2025-09-02 11:28:40,067 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: Finance Manager
2025-09-02 11:28:40,069 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'Finance Manager'
2025-09-02 11:28:40,072 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['chief financial officer', 'chief executive officer', 'chief operating officer', 'finance manager']
2025-09-02 11:28:40,076 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['Finance Manager', 'finance manager', 'FINANCE MANAGER', 'FINANCE_MANAGER', 'finance_manager']
2025-09-02 11:28:40,083 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'finance manager'
2025-09-02 11:28:40,084 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: Finance Manager
2025-09-02 11:28:40,086 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Mapped role directly to enum: Finance Manager -> PrincipalRole.FINANCE_MANAGER
2025-09-02 11:28:40,126 - principal_context_agent_test - INFO - Testing lookup with role format: 'finance manager'
2025-09-02 11:28:40,127 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: finance manager
2025-09-02 11:28:40,128 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'finance manager'
2025-09-02 11:28:40,129 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['chief financial officer', 'chief executive officer', 'chief operating officer', 'finance manager']
2025-09-02 11:28:40,130 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['finance manager', 'FINANCE MANAGER', 'FINANCE_MANAGER', 'Finance Manager', 'finance_manager']
2025-09-02 11:28:40,131 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'finance manager'
2025-09-02 11:28:40,132 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: finance manager
2025-09-02 11:28:40,133 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Mapped role directly to enum: Finance Manager -> PrincipalRole.FINANCE_MANAGER
2025-09-02 11:28:40,177 - principal_context_agent_test - INFO - Testing lookup with non-existent role: 'INVALID_ROLE'
2025-09-02 11:28:40,178 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: INVALID_ROLE
2025-09-02 11:28:40,179 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'INVALID_ROLE'
2025-09-02 11:28:40,180 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['chief financial officer', 'chief executive officer', 'chief operating officer', 'finance manager']
2025-09-02 11:28:40,181 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['INVALID_ROLE', 'invalid_role', 'Invalid Role']
2025-09-02 11:28:40,182 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - WARNING - Principal profile not found for any variation of: 'INVALID_ROLE'
2025-09-02 11:28:40,183 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profiles: ['Chief Financial Officer', 'Chief Executive Officer', 'Chief Operating Officer', 'Finance Manager']
2025-09-02 11:28:40,184 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - WARNING - Principal profile not found for role: INVALID_ROLE
2025-09-02 11:28:40,185 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Using default principal ID: default_id
2025-09-02 11:28:40,188 - principal_context_agent_test - ERROR - Error testing non-existent role: 'str' object is not a mapping
2025-09-02 11:28:40,190 - principal_context_agent_test - INFO - 
Step 6: Testing extract_filters
2025-09-02 11:28:40,191 - principal_context_agent_test - INFO - === Testing extract_filters ===
2025-09-02 11:28:40,200 - principal_context_agent_test - ERROR - Test failed with error: 1 validation error for ExtractFiltersRequest
job_description
  Field required [type=missing, input_value={'description': "\n    An...46c9-a124-fb094ab29eb2'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
Traceback (most recent call last):
  File "C:\Users\barry\CascadeProjects\Agent9-HERMES\test_principal_context_agent_manual.py", line 459, in main
    filter_response = await test_extract_filters(agent)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\barry\CascadeProjects\Agent9-HERMES\test_principal_context_agent_manual.py", line 246, in test_extract_filters
    request = ExtractFiltersRequest(
              ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\barry\CascadeProjects\Agent9-HERMES\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for ExtractFiltersRequest
job_description
  Field required [type=missing, input_value={'description': "\n    An...46c9-a124-fb094ab29eb2'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-09-02 11:37:28,582 - asyncio - DEBUG - Using proactor: IocpProactor
2025-09-02 11:37:28,583 - principal_context_agent_test - INFO - Starting Principal Context Agent tests
2025-09-02 11:37:28,583 - principal_context_agent_test - INFO - Step 1: Testing registry structure
2025-09-02 11:37:28,584 - principal_context_agent_test - INFO - === Testing registry structure ===
2025-09-02 11:37:28,585 - principal_context_agent_test - INFO - Initializing registry bootstrap
2025-09-02 11:37:28,586 - src.registry.factory - INFO - Registry Factory initialized
2025-09-02 11:37:28,587 - src.registry.factory - INFO - Registered principal_profile provider
2025-09-02 11:37:28,588 - src.registry.providers.principal_provider - INFO - Loading principal profiles from C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\principal\principal_registry.yaml (yaml)
2025-09-02 11:37:28,621 - src.registry.providers.principal_provider - INFO - Found 4 roles in YAML under 'roles' key
2025-09-02 11:37:28,622 - src.registry.providers.principal_provider - DEBUG - Registered role: cfo_001 - CFO
2025-09-02 11:37:28,623 - src.registry.providers.principal_provider - DEBUG - Registered role: ceo_001 - CEO
2025-09-02 11:37:28,623 - src.registry.providers.principal_provider - DEBUG - Registered role: coo_001 - COO
2025-09-02 11:37:28,624 - src.registry.providers.principal_provider - DEBUG - Registered role: finance_manager_001 - Finance Manager
2025-09-02 11:37:28,624 - src.registry.providers.principal_provider - INFO - Found 4 principal profiles in YAML under 'principals' key
2025-09-02 11:37:28,624 - src.registry.providers.principal_provider - DEBUG - Mapped role name CFO to principal ID cfo_001
2025-09-02 11:37:28,625 - src.registry.providers.principal_provider - INFO - Registered principal: cfo_001 - Lars Mikkelsen
2025-09-02 11:37:28,625 - src.registry.providers.principal_provider - DEBUG - Mapped role name CEO to principal ID ceo_001
2025-09-02 11:37:28,626 - src.registry.providers.principal_provider - INFO - Registered principal: ceo_001 - Alex Morgan
2025-09-02 11:37:28,626 - src.registry.providers.principal_provider - DEBUG - Mapped role name COO to principal ID coo_001
2025-09-02 11:37:28,626 - src.registry.providers.principal_provider - INFO - Registered principal: coo_001 - Priya Desai
2025-09-02 11:37:28,627 - src.registry.providers.principal_provider - DEBUG - Mapped role name Finance Manager to principal ID finance_manager_001
2025-09-02 11:37:28,627 - src.registry.providers.principal_provider - INFO - Registered principal: finance_manager_001 - Emily Chen
2025-09-02 11:37:28,628 - src.registry.providers.principal_provider - INFO - Added role ID mapping: cfo_001 -> Lars Mikkelsen
2025-09-02 11:37:28,628 - src.registry.providers.principal_provider - INFO - Added role ID mapping: ceo_001 -> Alex Morgan
2025-09-02 11:37:28,629 - src.registry.providers.principal_provider - INFO - Added role ID mapping: coo_001 -> Priya Desai
2025-09-02 11:37:28,629 - src.registry.providers.principal_provider - INFO - Added role ID mapping: finance_manager_001 -> Emily Chen
2025-09-02 11:37:28,630 - src.registry.providers.principal_provider - INFO - Loaded 4 principal profiles
2025-09-02 11:37:28,630 - src.registry.bootstrap - INFO - Initialized principal provider with 4 profiles
2025-09-02 11:37:28,634 - src.registry.factory - WARNING - Provider 'business_glossary' not found in registry factory
2025-09-02 11:37:28,635 - src.registry.bootstrap - INFO - Initializing business glossary provider
2025-09-02 11:37:28,644 - src.registry.providers.business_glossary_provider - INFO - Loaded 4 business terms from glossary
2025-09-02 11:37:28,644 - src.registry.factory - INFO - Registered business_glossary provider
2025-09-02 11:37:28,645 - src.registry.bootstrap - INFO - Initialized business glossary provider with 4 terms
2025-09-02 11:37:28,645 - src.registry.factory - INFO - Registered data_product provider
2025-09-02 11:37:28,646 - src.registry.providers.data_product_provider - INFO - Loading data products from C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\data_product\data_product_registry.yaml (yaml)
2025-09-02 11:37:28,662 - src.registry.providers.data_product_provider - INFO - Loaded 1 data products
2025-09-02 11:37:28,662 - src.registry.bootstrap - INFO - Initialized data product provider with 1 data products
2025-09-02 11:37:28,662 - src.registry.bootstrap - INFO - Initializing KPI provider
2025-09-02 11:37:28,663 - src.registry.factory - WARNING - Provider 'kpi' not found in registry factory
2025-09-02 11:37:28,663 - src.registry.bootstrap - INFO - Creating KPI provider with file at C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\kpi\kpi_registry.yaml
2025-09-02 11:37:28,664 - src.registry.bootstrap - INFO - Registering KPI provider with registry factory
2025-09-02 11:37:28,664 - src.registry.factory - INFO - Registered kpi provider
2025-09-02 11:37:28,664 - src.registry.bootstrap - INFO - Loading KPI provider data
2025-09-02 11:37:28,665 - src.registry.providers.kpi_provider - INFO - Loading KPIs from C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\kpi\kpi_registry.yaml (yaml)
2025-09-02 11:37:28,697 - src.registry.providers.kpi_provider - INFO - Loaded 6 KPIs
2025-09-02 11:37:28,697 - src.registry.bootstrap - INFO - KPI provider successfully registered and initialized with 6 KPIs
2025-09-02 11:37:28,698 - src.registry.bootstrap - INFO - Initializing agent bootstrap
2025-09-02 11:37:28,699 - src.agents.agent_bootstrap - WARNING - No agent implementations discovered
2025-09-02 11:37:28,699 - src.registry.bootstrap - WARNING - Agent bootstrap initialization had issues, continuing with available agents
2025-09-02 11:37:28,699 - src.registry.bootstrap - INFO - Registry providers and agent factories initialized successfully
2025-09-02 11:37:28,700 - principal_context_agent_test - INFO - Registry bootstrap initialized successfully
2025-09-02 11:37:28,700 - principal_context_agent_test - INFO - Got RegistryFactory from bootstrap
2025-09-02 11:37:28,700 - principal_context_agent_test - INFO - Provider status: {'principal_profile': True, 'business_glossary': True, 'data_product': False, 'kpi': True}
2025-09-02 11:37:28,701 - principal_context_agent_test - INFO - principal_profile provider status: True
2025-09-02 11:37:28,701 - principal_context_agent_test - INFO - Got principal provider: <src.registry.providers.principal_provider.PrincipalProfileProvider object at 0x00000224B348BC50>
2025-09-02 11:37:28,704 - principal_context_agent_test - INFO - Provider methods: ['__abstractmethods__', '__class__', '__class_getitem__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__orig_bases__', '__parameters__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', '__weakref__', '_abc_impl', '_add_profile', '_extract_profiles_from_module', '_is_protocol', '_load_default_profiles', '_load_from_json', '_load_from_python_module', '_load_from_yaml', '_profiles', '_profiles_by_name', '_profiles_by_title', '_registry_base_path', 'find_by_attribute', 'find_by_business_process', 'find_by_kpi', 'get', 'get_all', 'get_registry_path', 'initialize', 'load', 'register', 'source_path', 'storage_format']
2025-09-02 11:37:28,706 - principal_context_agent_test - INFO - Principal registry file exists at: C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\principal\principal_registry.yaml
2025-09-02 11:37:28,707 - principal_context_agent_test - INFO - Registry file content length: 6517 bytes
2025-09-02 11:37:28,707 - principal_context_agent_test - INFO - Registry file first 100 chars: # Principal Registry
# Contains all principal profiles for personalization and context-aware process...
2025-09-02 11:37:28,708 - principal_context_agent_test - INFO - Got registry data type: <class 'list'>
2025-09-02 11:37:28,708 - principal_context_agent_test - INFO - Found 4 principals in registry
2025-09-02 11:37:28,709 - principal_context_agent_test - INFO - Principal 1 details:
2025-09-02 11:37:28,709 - principal_context_agent_test - INFO -   ID: cfo_001
2025-09-02 11:37:28,709 - principal_context_agent_test - INFO -   Name: Lars Mikkelsen
2025-09-02 11:37:28,710 - principal_context_agent_test - INFO -   Role: N/A
2025-09-02 11:37:28,710 - principal_context_agent_test - INFO -   Title: Chief Financial Officer
2025-09-02 11:37:28,710 - principal_context_agent_test - INFO -   Business Processes: ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals']
2025-09-02 11:37:28,712 - principal_context_agent_test - INFO -   All attributes: ['__abstractmethods__', '__annotations__', '__class__', '__class_getitem__', '__class_vars__', '__copy__', '__deepcopy__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__fields__', '__fields_set__', '__format__', '__ge__', '__get_pydantic_core_schema__', '__get_pydantic_json_schema__', '__getattr__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__iter__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__pretty__', '__private_attributes__', '__pydantic_complete__', '__pydantic_computed_fields__', '__pydantic_core_schema__', '__pydantic_custom_init__', '__pydantic_decorators__', '__pydantic_extra__', '__pydantic_fields__', '__pydantic_fields_set__', '__pydantic_generic_metadata__', '__pydantic_init_subclass__', '__pydantic_parent_namespace__', '__pydantic_post_init__', '__pydantic_private__', '__pydantic_root_model__', '__pydantic_serializer__', '__pydantic_setattr_handlers__', '__pydantic_validator__', '__reduce__', '__reduce_ex__', '__replace__', '__repr__', '__repr_args__', '__repr_name__', '__repr_recursion__', '__repr_str__', '__rich_repr__', '__setattr__', '__setstate__', '__signature__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', '__weakref__', '_abc_impl', '_calculate_keys', '_copy_and_set_values', '_get_value', '_iter', '_setattr_handler', 'business_processes', 'communication', 'construct', 'copy', 'default_filters', 'description', 'dict', 'from_orm', 'id', 'json', 'kpis', 'metadata', 'model_computed_fields', 'model_config', 'model_construct', 'model_copy', 'model_dump', 'model_dump_json', 'model_extra', 'model_fields', 'model_fields_set', 'model_json_schema', 'model_parametrized_name', 'model_post_init', 'model_rebuild', 'model_validate', 'model_validate_json', 'model_validate_strings', 'name', 'parse_file', 'parse_obj', 'parse_raw', 'responsibilities', 'schema', 'schema_json', 'time_frame', 'title', 'to_dict', 'update_forward_refs', 'validate']
2025-09-02 11:37:28,716 - principal_context_agent_test - INFO -   Dict representation: {'id': 'cfo_001', 'name': 'Lars Mikkelsen', 'title': 'Chief Financial Officer', 'description': 'CFO responsible for financial performance in EMEA.', 'business_processes': ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals'], 'kpis': [], 'responsibilities': ['maximize EBIT', 'manage revenue', 'control expenses'], 'default_filters': {'profit_center_hierarchyid': ['Total'], 'customer_hierarchyid': ['Total']}, 'time_frame': {'default_period': 'QTD', 'historical_periods': 4, 'forward_looking_periods': 2}, 'communication': {'detail_level': 'high', 'format_preference': ['visual', 'text', 'table'], 'emphasis': ['trends', 'anomalies', 'forecasts']}, 'metadata': {}}
2025-09-02 11:37:28,717 - principal_context_agent_test - INFO -   __dict__ representation: {'id': 'cfo_001', 'name': 'Lars Mikkelsen', 'title': 'Chief Financial Officer', 'description': 'CFO responsible for financial performance in EMEA.', 'business_processes': ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals'], 'kpis': [], 'responsibilities': ['maximize EBIT', 'manage revenue', 'control expenses'], 'default_filters': {'profit_center_hierarchyid': ['Total'], 'customer_hierarchyid': ['Total']}, 'time_frame': TimeFrame(default_period='QTD', historical_periods=4, forward_looking_periods=2), 'communication': CommunicationPreference(detail_level='high', format_preference=['visual', 'text', 'table'], emphasis=['trends', 'anomalies', 'forecasts']), 'metadata': {}}
2025-09-02 11:37:28,718 - principal_context_agent_test - INFO - Principal 2 details:
2025-09-02 11:37:28,719 - principal_context_agent_test - INFO -   ID: ceo_001
2025-09-02 11:37:28,720 - principal_context_agent_test - INFO -   Name: Alex Morgan
2025-09-02 11:37:28,720 - principal_context_agent_test - INFO -   Role: N/A
2025-09-02 11:37:28,721 - principal_context_agent_test - INFO -   Title: Chief Executive Officer
2025-09-02 11:37:28,721 - principal_context_agent_test - INFO -   Business Processes: ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals']
2025-09-02 11:37:28,724 - principal_context_agent_test - INFO -   All attributes: ['__abstractmethods__', '__annotations__', '__class__', '__class_getitem__', '__class_vars__', '__copy__', '__deepcopy__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__fields__', '__fields_set__', '__format__', '__ge__', '__get_pydantic_core_schema__', '__get_pydantic_json_schema__', '__getattr__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__iter__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__pretty__', '__private_attributes__', '__pydantic_complete__', '__pydantic_computed_fields__', '__pydantic_core_schema__', '__pydantic_custom_init__', '__pydantic_decorators__', '__pydantic_extra__', '__pydantic_fields__', '__pydantic_fields_set__', '__pydantic_generic_metadata__', '__pydantic_init_subclass__', '__pydantic_parent_namespace__', '__pydantic_post_init__', '__pydantic_private__', '__pydantic_root_model__', '__pydantic_serializer__', '__pydantic_setattr_handlers__', '__pydantic_validator__', '__reduce__', '__reduce_ex__', '__replace__', '__repr__', '__repr_args__', '__repr_name__', '__repr_recursion__', '__repr_str__', '__rich_repr__', '__setattr__', '__setstate__', '__signature__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', '__weakref__', '_abc_impl', '_calculate_keys', '_copy_and_set_values', '_get_value', '_iter', '_setattr_handler', 'business_processes', 'communication', 'construct', 'copy', 'default_filters', 'description', 'dict', 'from_orm', 'id', 'json', 'kpis', 'metadata', 'model_computed_fields', 'model_config', 'model_construct', 'model_copy', 'model_dump', 'model_dump_json', 'model_extra', 'model_fields', 'model_fields_set', 'model_json_schema', 'model_parametrized_name', 'model_post_init', 'model_rebuild', 'model_validate', 'model_validate_json', 'model_validate_strings', 'name', 'parse_file', 'parse_obj', 'parse_raw', 'responsibilities', 'schema', 'schema_json', 'time_frame', 'title', 'to_dict', 'update_forward_refs', 'validate']
2025-09-02 11:37:28,726 - principal_context_agent_test - INFO -   Dict representation: {'id': 'ceo_001', 'name': 'Alex Morgan', 'title': 'Chief Executive Officer', 'description': 'CEO driving company strategy and performance.', 'business_processes': ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals'], 'kpis': [], 'responsibilities': ['set strategic direction', 'oversee company performance', 'lead executive team'], 'default_filters': {'profit_center_hierarchyid': ['#']}, 'time_frame': {'default_period': 'YTD', 'historical_periods': 3, 'forward_looking_periods': 4}, 'communication': {'detail_level': 'medium', 'format_preference': ['visual', 'summary'], 'emphasis': ['trends', 'strategic_impact']}, 'metadata': {}}
2025-09-02 11:37:28,728 - principal_context_agent_test - INFO -   __dict__ representation: {'id': 'ceo_001', 'name': 'Alex Morgan', 'title': 'Chief Executive Officer', 'description': 'CEO driving company strategy and performance.', 'business_processes': ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals'], 'kpis': [], 'responsibilities': ['set strategic direction', 'oversee company performance', 'lead executive team'], 'default_filters': {'profit_center_hierarchyid': ['#']}, 'time_frame': TimeFrame(default_period='YTD', historical_periods=3, forward_looking_periods=4), 'communication': CommunicationPreference(detail_level='medium', format_preference=['visual', 'summary'], emphasis=['trends', 'strategic_impact']), 'metadata': {}}
2025-09-02 11:37:28,729 - principal_context_agent_test - INFO - Principal 3 details:
2025-09-02 11:37:28,729 - principal_context_agent_test - INFO -   ID: coo_001
2025-09-02 11:37:28,730 - principal_context_agent_test - INFO -   Name: Priya Desai
2025-09-02 11:37:28,730 - principal_context_agent_test - INFO -   Role: N/A
2025-09-02 11:37:28,730 - principal_context_agent_test - INFO -   Title: Chief Operating Officer
2025-09-02 11:37:28,731 - principal_context_agent_test - INFO -   Business Processes: ['finance_expense_management', 'finance_cash_flow', 'finance_budget_vs_actuals']
2025-09-02 11:37:28,733 - principal_context_agent_test - INFO -   All attributes: ['__abstractmethods__', '__annotations__', '__class__', '__class_getitem__', '__class_vars__', '__copy__', '__deepcopy__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__fields__', '__fields_set__', '__format__', '__ge__', '__get_pydantic_core_schema__', '__get_pydantic_json_schema__', '__getattr__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__iter__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__pretty__', '__private_attributes__', '__pydantic_complete__', '__pydantic_computed_fields__', '__pydantic_core_schema__', '__pydantic_custom_init__', '__pydantic_decorators__', '__pydantic_extra__', '__pydantic_fields__', '__pydantic_fields_set__', '__pydantic_generic_metadata__', '__pydantic_init_subclass__', '__pydantic_parent_namespace__', '__pydantic_post_init__', '__pydantic_private__', '__pydantic_root_model__', '__pydantic_serializer__', '__pydantic_setattr_handlers__', '__pydantic_validator__', '__reduce__', '__reduce_ex__', '__replace__', '__repr__', '__repr_args__', '__repr_name__', '__repr_recursion__', '__repr_str__', '__rich_repr__', '__setattr__', '__setstate__', '__signature__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', '__weakref__', '_abc_impl', '_calculate_keys', '_copy_and_set_values', '_get_value', '_iter', '_setattr_handler', 'business_processes', 'communication', 'construct', 'copy', 'default_filters', 'description', 'dict', 'from_orm', 'id', 'json', 'kpis', 'metadata', 'model_computed_fields', 'model_config', 'model_construct', 'model_copy', 'model_dump', 'model_dump_json', 'model_extra', 'model_fields', 'model_fields_set', 'model_json_schema', 'model_parametrized_name', 'model_post_init', 'model_rebuild', 'model_validate', 'model_validate_json', 'model_validate_strings', 'name', 'parse_file', 'parse_obj', 'parse_raw', 'responsibilities', 'schema', 'schema_json', 'time_frame', 'title', 'to_dict', 'update_forward_refs', 'validate']
2025-09-02 11:37:28,738 - principal_context_agent_test - INFO -   Dict representation: {'id': 'coo_001', 'name': 'Priya Desai', 'title': 'Chief Operating Officer', 'description': 'COO focused on operational excellence and efficiency.', 'business_processes': ['finance_expense_management', 'finance_cash_flow', 'finance_budget_vs_actuals'], 'kpis': [], 'responsibilities': ['optimize operations', 'reduce operational costs', 'improve process efficiency'], 'default_filters': {'profit_center_hierarchyid': ['Best Run U'], 'customer_hierarchyid': ['17100001']}, 'time_frame': {'default_period': 'MTD', 'historical_periods': 6, 'forward_looking_periods': 2}, 'communication': {'detail_level': 'high', 'format_preference': ['table', 'visual'], 'emphasis': ['variances', 'operational_metrics']}, 'metadata': {}}
2025-09-02 11:37:28,740 - principal_context_agent_test - INFO -   __dict__ representation: {'id': 'coo_001', 'name': 'Priya Desai', 'title': 'Chief Operating Officer', 'description': 'COO focused on operational excellence and efficiency.', 'business_processes': ['finance_expense_management', 'finance_cash_flow', 'finance_budget_vs_actuals'], 'kpis': [], 'responsibilities': ['optimize operations', 'reduce operational costs', 'improve process efficiency'], 'default_filters': {'profit_center_hierarchyid': ['Best Run U'], 'customer_hierarchyid': ['17100001']}, 'time_frame': TimeFrame(default_period='MTD', historical_periods=6, forward_looking_periods=2), 'communication': CommunicationPreference(detail_level='high', format_preference=['table', 'visual'], emphasis=['variances', 'operational_metrics']), 'metadata': {}}
2025-09-02 11:37:28,741 - principal_context_agent_test - INFO - Principal 4 details:
2025-09-02 11:37:28,741 - principal_context_agent_test - INFO -   ID: finance_manager_001
2025-09-02 11:37:28,742 - principal_context_agent_test - INFO -   Name: Emily Chen
2025-09-02 11:37:28,742 - principal_context_agent_test - INFO -   Role: N/A
2025-09-02 11:37:28,742 - principal_context_agent_test - INFO -   Title: Finance Manager
2025-09-02 11:37:28,743 - principal_context_agent_test - INFO -   Business Processes: ['Finance: Expense Management', 'Finance: Budget vs. Actuals', 'Finance: Cash Flow Management']
2025-09-02 11:37:28,745 - principal_context_agent_test - INFO -   All attributes: ['__abstractmethods__', '__annotations__', '__class__', '__class_getitem__', '__class_vars__', '__copy__', '__deepcopy__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__fields__', '__fields_set__', '__format__', '__ge__', '__get_pydantic_core_schema__', '__get_pydantic_json_schema__', '__getattr__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__iter__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__pretty__', '__private_attributes__', '__pydantic_complete__', '__pydantic_computed_fields__', '__pydantic_core_schema__', '__pydantic_custom_init__', '__pydantic_decorators__', '__pydantic_extra__', '__pydantic_fields__', '__pydantic_fields_set__', '__pydantic_generic_metadata__', '__pydantic_init_subclass__', '__pydantic_parent_namespace__', '__pydantic_post_init__', '__pydantic_private__', '__pydantic_root_model__', '__pydantic_serializer__', '__pydantic_setattr_handlers__', '__pydantic_validator__', '__reduce__', '__reduce_ex__', '__replace__', '__repr__', '__repr_args__', '__repr_name__', '__repr_recursion__', '__repr_str__', '__rich_repr__', '__setattr__', '__setstate__', '__signature__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', '__weakref__', '_abc_impl', '_calculate_keys', '_copy_and_set_values', '_get_value', '_iter', '_setattr_handler', 'business_processes', 'communication', 'construct', 'copy', 'default_filters', 'description', 'dict', 'from_orm', 'id', 'json', 'kpis', 'metadata', 'model_computed_fields', 'model_config', 'model_construct', 'model_copy', 'model_dump', 'model_dump_json', 'model_extra', 'model_fields', 'model_fields_set', 'model_json_schema', 'model_parametrized_name', 'model_post_init', 'model_rebuild', 'model_validate', 'model_validate_json', 'model_validate_strings', 'name', 'parse_file', 'parse_obj', 'parse_raw', 'responsibilities', 'schema', 'schema_json', 'time_frame', 'title', 'to_dict', 'update_forward_refs', 'validate']
2025-09-02 11:37:28,748 - principal_context_agent_test - INFO -   Dict representation: {'id': 'finance_manager_001', 'name': 'Emily Chen', 'title': 'Finance Manager', 'description': 'Finance Manager responsible for departmental financial analysis and reporting.', 'business_processes': ['Finance: Expense Management', 'Finance: Budget vs. Actuals', 'Finance: Cash Flow Management'], 'kpis': [], 'responsibilities': ['manage departmental budget', 'analyze financial data', 'prepare financial reports'], 'default_filters': {'profit_center_hierarchyid': ['Finance'], 'customer_hierarchyid': ['Total']}, 'time_frame': {'default_period': 'MTD', 'historical_periods': 6, 'forward_looking_periods': 3}, 'communication': {'detail_level': 'high', 'format_preference': ['table', 'visual', 'text'], 'emphasis': ['variances', 'trends', 'forecasts']}, 'metadata': {}}
2025-09-02 11:37:28,749 - principal_context_agent_test - INFO -   __dict__ representation: {'id': 'finance_manager_001', 'name': 'Emily Chen', 'title': 'Finance Manager', 'description': 'Finance Manager responsible for departmental financial analysis and reporting.', 'business_processes': ['Finance: Expense Management', 'Finance: Budget vs. Actuals', 'Finance: Cash Flow Management'], 'kpis': [], 'responsibilities': ['manage departmental budget', 'analyze financial data', 'prepare financial reports'], 'default_filters': {'profit_center_hierarchyid': ['Finance'], 'customer_hierarchyid': ['Total']}, 'time_frame': TimeFrame(default_period='MTD', historical_periods=6, forward_looking_periods=3), 'communication': CommunicationPreference(detail_level='high', format_preference=['table', 'visual', 'text'], emphasis=['variances', 'trends', 'forecasts']), 'metadata': {}}
2025-09-02 11:37:28,750 - principal_context_agent_test - INFO - 
Step 2: Testing Agent Initialization
2025-09-02 11:37:28,751 - principal_context_agent_test - INFO - === Testing loading principal profiles ===
2025-09-02 11:37:28,751 - principal_context_agent_test - INFO - Creating Principal Context Agent
2025-09-02 11:37:28,752 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Initializing A9_Principal_Context_Agent
2025-09-02 11:37:28,755 - principal_context_agent_test - INFO - Connecting agent
2025-09-02 11:37:28,755 - src.registry.bootstrap - INFO - Registry bootstrap already initialized
2025-09-02 11:37:28,756 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Loaded 4 principal profiles from registry
2025-09-02 11:37:28,756 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - First profile: id=cfo_001, role=unknown, name=Lars Mikkelsen
2025-09-02 11:37:28,757 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Profile attributes: ['__abstractmethods__', '__annotations__', '__class__', '__class_getitem__', '__class_vars__', '__copy__', '__deepcopy__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__fields__', '__fields_set__', '__format__', '__ge__', '__get_pydantic_core_schema__', '__get_pydantic_json_schema__', '__getattr__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__iter__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__pretty__', '__private_attributes__', '__pydantic_complete__', '__pydantic_computed_fields__', '__pydantic_core_schema__', '__pydantic_custom_init__', '__pydantic_decorators__', '__pydantic_extra__', '__pydantic_fields__', '__pydantic_fields_set__', '__pydantic_generic_metadata__', '__pydantic_init_subclass__', '__pydantic_parent_namespace__', '__pydantic_post_init__', '__pydantic_private__', '__pydantic_root_model__', '__pydantic_serializer__', '__pydantic_setattr_handlers__', '__pydantic_validator__', '__reduce__', '__reduce_ex__', '__replace__', '__repr__', '__repr_args__', '__repr_name__', '__repr_recursion__', '__repr_str__', '__rich_repr__', '__setattr__', '__setstate__', '__signature__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', '__weakref__', '_abc_impl', '_calculate_keys', '_copy_and_set_values', '_get_value', '_iter', '_setattr_handler', 'business_processes', 'communication', 'construct', 'copy', 'default_filters', 'description', 'dict', 'from_orm', 'id', 'json', 'kpis', 'metadata', 'model_computed_fields', 'model_config', 'model_construct', 'model_copy', 'model_dump', 'model_dump_json', 'model_extra', 'model_fields', 'model_fields_set', 'model_json_schema', 'model_parametrized_name', 'model_post_init', 'model_rebuild', 'model_validate', 'model_validate_json', 'model_validate_strings', 'name', 'parse_file', 'parse_obj', 'parse_raw', 'responsibilities', 'schema', 'schema_json', 'time_frame', 'title', 'to_dict', 'update_forward_refs', 'validate']
2025-09-02 11:37:28,761 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Profile dict: {'id': 'cfo_001', 'name': 'Lars Mikkelsen', 'title': 'Chief Financial Officer', 'description': 'CFO responsible for financial performance in EMEA.', 'business_processes': ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals'], 'kpis': [], 'responsibilities': ['maximize EBIT', 'manage revenue', 'control expenses'], 'default_filters': {'profit_center_hierarchyid': ['Total'], 'customer_hierarchyid': ['Total']}, 'time_frame': {'default_period': 'QTD', 'historical_periods': 4, 'forward_looking_periods': 2}, 'communication': {'detail_level': 'high', 'format_preference': ['visual', 'text', 'table'], 'emphasis': ['trends', 'anomalies', 'forecasts']}, 'metadata': {}}
2025-09-02 11:37:28,763 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found 4 principals in registry
2025-09-02 11:37:28,763 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Loaded 4 principal profiles by ID from registry
2025-09-02 11:37:28,764 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Loaded 4 principal profiles by role from registry
2025-09-02 11:37:28,764 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Connected to dependencies
2025-09-02 11:37:28,765 - principal_context_agent_test - INFO - Loaded 4 principal profiles in principal_profiles dictionary
2025-09-02 11:37:28,765 - principal_context_agent_test - INFO - Loaded 4 principal profiles in principal_profiles_by_id dictionary
2025-09-02 11:37:28,766 - principal_context_agent_test - INFO - Keys in principal_profiles_by_id: ['cfo_001', 'ceo_001', 'coo_001', 'finance_manager_001']
2025-09-02 11:37:28,766 - principal_context_agent_test - INFO - Available roles in principal_profiles: ['chief financial officer', 'chief executive officer', 'chief operating officer', 'finance manager']
2025-09-02 11:37:28,766 - principal_context_agent_test - INFO - Sample profile for chief financial officer:
2025-09-02 11:37:28,767 - principal_context_agent_test - INFO -   id: cfo_001
2025-09-02 11:37:28,767 - principal_context_agent_test - INFO -   role: Chief Financial Officer
2025-09-02 11:37:28,768 - principal_context_agent_test - INFO -   name: Lars Mikkelsen
2025-09-02 11:37:28,770 - principal_context_agent_test - INFO -   title: Chief Financial Officer
2025-09-02 11:37:28,771 - principal_context_agent_test - INFO -   business_processes: ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals']
2025-09-02 11:37:28,772 - principal_context_agent_test - INFO -   default_filters: {'profit_center_hierarchyid': ['Total'], 'customer_hierarchyid': ['Total']}
2025-09-02 11:37:28,772 - principal_context_agent_test - INFO -   decision_style: Analytical
2025-09-02 11:37:28,773 - principal_context_agent_test - INFO -   communication_style: Concise
2025-09-02 11:37:28,773 - principal_context_agent_test - INFO -   description: CFO responsible for financial performance in EMEA.
2025-09-02 11:37:28,773 - principal_context_agent_test - INFO -   timeframes: []
2025-09-02 11:37:28,774 - principal_context_agent_test - INFO - Inspecting _load_principal_profiles method
2025-09-02 11:37:28,787 - principal_context_agent_test - INFO - _load_principal_profiles method code:
    async def _load_principal_profiles(self):
        """Load principal profiles from registry."""
        try:
            # Try to get principal profiles from registry
            if not self._principal_provider:
                self.logger.warning("Principal profile provider not initialized")
                self._load_default_profiles()
                return
                
            registry_data = self._principal_provider.get_all()
            self.logger.info(f"Loaded {len(registry_data) if registry_data else 0} principal profiles from registry")
            
            if registry_data and isinstance(registry_data, list):
                # Debug: Log the first profile to see its structure
                if registry_data:
                    first_profile = registry_data[0]
                    self.logger.info(f"First profile: id={getattr(first_profile, 'id', 'unknown')}, "
                                    f"role={getattr(first_profile, 'role', 'unknown')}, "
                                    f"name={getattr(first_profile, 'name', 'unknown')}")
                    self.logger.info(f"Profile attributes: {dir(first_profile)}")
                    self.logger.info(f"Profile dict: {first_profile.dict() if hasattr(first_profile, 'dict') else 'No dict method'}")
                
                principals = registry_data
                self.logger.info(f"Found {len(principals)} principals in registry")
                
                # Convert to our internal dictionary format keyed by ID and role
                normalized_by_role: Dict[str, Any] = {}
                normalized_by_id: Dict[str, Any] = {}
                role_to_id: Dict[str, str] = {}
                
                for principal in principals:
                    # Use attribute access for Pydantic models instead of dictionary-style access
                    principal_id = getattr(principal, 'id', None)
                    role = getattr(principal, 'role', None)
                    title = getattr(principal, 'title', None)
                    
                    # Use title as role key if role is not available
                    role_key = ''
                    if role:
                        role_key = str(role).lower()
                    elif title:
                        role_key = str(title).lower()
                    
                    if not principal_id:
                        self.logger.warning(f"Principal missing ID: {getattr(principal, 'name', 'Unknown')} - {role or title}")
                        continue
                        
                    # Create profile object
                    profile = {
                        "id": principal_id,
                        "role": role or title,  # Use title as role if role is not available
                        "name": getattr(principal, 'name', None),
                        "title": title,
                        "business_processes": getattr(principal, 'business_processes', []),
                        "default_filters": getattr(principal, 'default_filters', {}),
                        "decision_style": getattr(getattr(principal, 'persona_profile', {}), 'decision_style', 'Analytical'),
                        "communication_style": getattr(getattr(principal, 'persona_profile', {}), 'communication_style', 'Concise'),
                        "description": getattr(principal, 'description', ''),
                        "timeframes": getattr(principal, 'typical_timeframes', [])
                    }
                    
                    # Store by ID (primary index)
                    normalized_by_id[principal_id] = profile
                    
                    # Store by role (secondary index for backward compatibility)
                    if role_key:
                        normalized_by_role[role_key] = profile
                        role_to_id[role_key] = principal_id
                        
                        # Also store by title for additional lookup options
                        if title and title.lower() != role_key:
                            title_key = title.lower()
                            normalized_by_role[title_key] = profile
                            role_to_id[title_key] = principal_id
                
                if normalized_by_id:
                    self.principal_profiles = normalized_by_role
                    self.principal_profiles_by_id = normalized_by_id
                    self.role_to_id_map = role_to_id
                    self.logger.info(f"Loaded {len(self.principal_profiles_by_id)} principal profiles by ID from registry")
                    self.logger.info(f"Loaded {len(self.principal_profiles)} principal profiles by role from registry")
                    return
            
            # Fallback to old format or empty registry
            self.logger.warning("No 'principals' key found in registry or no valid profiles, using defaults")
            self._load_default_profiles()
        except Exception as e:
            error_id = self._log_error("_load_principal_profiles", e)
            self._load_default_profiles()
            self.logger.warning(f"Using default profiles due to loading error {error_id}")

2025-09-02 11:37:28,795 - principal_context_agent_test - INFO - Available roles from agent: ['chief financial officer', 'chief executive officer', 'chief operating officer', 'finance manager']
2025-09-02 11:37:28,796 - principal_context_agent_test - INFO - Testing with roles: ['chief financial officer', 'chief executive officer', 'chief operating officer']
2025-09-02 11:37:28,796 - principal_context_agent_test - INFO - 
Testing with role: chief financial officer
2025-09-02 11:37:28,797 - principal_context_agent_test - INFO - Step 3: Testing fetch_principal_profile
2025-09-02 11:37:28,797 - principal_context_agent_test - INFO - === Testing fetch_principal_profile for role: chief financial officer ===
2025-09-02 11:37:28,798 - principal_context_agent_test - INFO - Checking if 'chief financial officer' exists in principal_profiles_by_id
2025-09-02 11:37:28,798 - principal_context_agent_test - INFO - Calling fetch_principal_profile for 'chief financial officer'
2025-09-02 11:37:28,798 - principal_context_agent_test - INFO - Successfully fetched profile for chief financial officer:
2025-09-02 11:37:28,799 - principal_context_agent_test - INFO -   Profile type: <class 'dict'>
2025-09-02 11:37:28,799 - principal_context_agent_test - INFO -   Name: Lars Mikkelsen
2025-09-02 11:37:28,800 - principal_context_agent_test - INFO -   Title: Chief Financial Officer
2025-09-02 11:37:28,800 - principal_context_agent_test - INFO -   Business Processes: ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals']
2025-09-02 11:37:28,801 - principal_context_agent_test - INFO -   Default Filters: {'profit_center_hierarchyid': ['Total'], 'customer_hierarchyid': ['Total']}
2025-09-02 11:37:28,801 - principal_context_agent_test - INFO -   Decision Style: Analytical
2025-09-02 11:37:28,802 - principal_context_agent_test - INFO -   Communication Style: Concise
2025-09-02 11:37:28,802 - principal_context_agent_test - INFO -   Timeframes: []
2025-09-02 11:37:28,803 - principal_context_agent_test - INFO - Step 4: Testing get_principal_context
2025-09-02 11:37:28,804 - principal_context_agent_test - INFO - === Testing get_principal_context for role: chief financial officer ===
2025-09-02 11:37:28,804 - principal_context_agent_test - INFO - Calling get_principal_context with role: chief financial officer
2025-09-02 11:37:28,804 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: chief financial officer
2025-09-02 11:37:28,805 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'chief financial officer'
2025-09-02 11:37:28,806 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['chief financial officer', 'chief executive officer', 'chief operating officer', 'finance manager']
2025-09-02 11:37:28,807 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['chief financial officer', 'CHIEF FINANCIAL OFFICER', 'CHIEF_FINANCIAL_OFFICER', 'Chief Financial Officer', 'chief_financial_officer', 'cfo', 'CFO']
2025-09-02 11:37:28,807 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'chief financial officer'
2025-09-02 11:37:28,808 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: chief financial officer
2025-09-02 11:37:28,809 - principal_context_agent_test - ERROR - Error testing get_principal_context: 'str' object is not a mapping
2025-09-02 11:37:28,809 - principal_context_agent_test - INFO - Could not get context for chief financial officer, continuing with next tests
2025-09-02 11:37:28,809 - principal_context_agent_test - INFO - 
Testing with role: chief executive officer
2025-09-02 11:37:28,810 - principal_context_agent_test - INFO - Step 3: Testing fetch_principal_profile
2025-09-02 11:37:28,810 - principal_context_agent_test - INFO - === Testing fetch_principal_profile for role: chief executive officer ===
2025-09-02 11:37:28,811 - principal_context_agent_test - INFO - Checking if 'chief executive officer' exists in principal_profiles_by_id
2025-09-02 11:37:28,811 - principal_context_agent_test - INFO - Calling fetch_principal_profile for 'chief executive officer'
2025-09-02 11:37:28,811 - principal_context_agent_test - INFO - Successfully fetched profile for chief executive officer:
2025-09-02 11:37:28,812 - principal_context_agent_test - INFO -   Profile type: <class 'dict'>
2025-09-02 11:37:28,812 - principal_context_agent_test - INFO -   Name: Alex Morgan
2025-09-02 11:37:28,812 - principal_context_agent_test - INFO -   Title: Chief Executive Officer
2025-09-02 11:37:28,813 - principal_context_agent_test - INFO -   Business Processes: ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals']
2025-09-02 11:37:28,813 - principal_context_agent_test - INFO -   Default Filters: {'profit_center_hierarchyid': ['#']}
2025-09-02 11:37:28,814 - principal_context_agent_test - INFO -   Decision Style: Analytical
2025-09-02 11:37:28,814 - principal_context_agent_test - INFO -   Communication Style: Concise
2025-09-02 11:37:28,816 - principal_context_agent_test - INFO -   Timeframes: []
2025-09-02 11:37:28,816 - principal_context_agent_test - INFO - Step 4: Testing get_principal_context
2025-09-02 11:37:28,816 - principal_context_agent_test - INFO - === Testing get_principal_context for role: chief executive officer ===
2025-09-02 11:37:28,817 - principal_context_agent_test - INFO - Calling get_principal_context with role: chief executive officer
2025-09-02 11:37:28,817 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: chief executive officer
2025-09-02 11:37:28,818 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'chief executive officer'
2025-09-02 11:37:28,818 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['chief financial officer', 'chief executive officer', 'chief operating officer', 'finance manager']
2025-09-02 11:37:28,819 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['chief executive officer', 'CHIEF EXECUTIVE OFFICER', 'CHIEF_EXECUTIVE_OFFICER', 'Chief Executive Officer', 'chief_executive_officer', 'ceo', 'CEO']
2025-09-02 11:37:28,821 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'chief executive officer'
2025-09-02 11:37:28,822 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: chief executive officer
2025-09-02 11:37:28,822 - principal_context_agent_test - ERROR - Error testing get_principal_context: 'str' object is not a mapping
2025-09-02 11:37:28,823 - principal_context_agent_test - INFO - Could not get context for chief executive officer, continuing with next tests
2025-09-02 11:37:28,823 - principal_context_agent_test - INFO - 
Testing with role: chief operating officer
2025-09-02 11:37:28,823 - principal_context_agent_test - INFO - Step 3: Testing fetch_principal_profile
2025-09-02 11:37:28,824 - principal_context_agent_test - INFO - === Testing fetch_principal_profile for role: chief operating officer ===
2025-09-02 11:37:28,824 - principal_context_agent_test - INFO - Checking if 'chief operating officer' exists in principal_profiles_by_id
2025-09-02 11:37:28,825 - principal_context_agent_test - INFO - Calling fetch_principal_profile for 'chief operating officer'
2025-09-02 11:37:28,825 - principal_context_agent_test - INFO - Successfully fetched profile for chief operating officer:
2025-09-02 11:37:28,825 - principal_context_agent_test - INFO -   Profile type: <class 'dict'>
2025-09-02 11:37:28,826 - principal_context_agent_test - INFO -   Name: Priya Desai
2025-09-02 11:37:28,826 - principal_context_agent_test - INFO -   Title: Chief Operating Officer
2025-09-02 11:37:28,826 - principal_context_agent_test - INFO -   Business Processes: ['finance_expense_management', 'finance_cash_flow', 'finance_budget_vs_actuals']
2025-09-02 11:37:28,828 - principal_context_agent_test - INFO -   Default Filters: {'profit_center_hierarchyid': ['Best Run U'], 'customer_hierarchyid': ['17100001']}
2025-09-02 11:37:28,828 - principal_context_agent_test - INFO -   Decision Style: Analytical
2025-09-02 11:37:28,828 - principal_context_agent_test - INFO -   Communication Style: Concise
2025-09-02 11:37:28,829 - principal_context_agent_test - INFO -   Timeframes: []
2025-09-02 11:37:28,829 - principal_context_agent_test - INFO - Step 4: Testing get_principal_context
2025-09-02 11:37:28,830 - principal_context_agent_test - INFO - === Testing get_principal_context for role: chief operating officer ===
2025-09-02 11:37:28,830 - principal_context_agent_test - INFO - Calling get_principal_context with role: chief operating officer
2025-09-02 11:37:28,830 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: chief operating officer
2025-09-02 11:37:28,831 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'chief operating officer'
2025-09-02 11:37:28,832 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['chief financial officer', 'chief executive officer', 'chief operating officer', 'finance manager']
2025-09-02 11:37:28,832 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['chief operating officer', 'CHIEF OPERATING OFFICER', 'CHIEF_OPERATING_OFFICER', 'Chief Operating Officer', 'chief_operating_officer', 'coo', 'COO']
2025-09-02 11:37:28,833 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'chief operating officer'
2025-09-02 11:37:28,834 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: chief operating officer
2025-09-02 11:37:28,834 - principal_context_agent_test - ERROR - Error testing get_principal_context: 'str' object is not a mapping
2025-09-02 11:37:28,835 - principal_context_agent_test - INFO - Could not get context for chief operating officer, continuing with next tests
2025-09-02 11:37:28,836 - principal_context_agent_test - INFO - 
Step 5: Testing case-insensitive profile lookup
2025-09-02 11:37:28,837 - principal_context_agent_test - INFO - === Testing case-insensitive profile lookup ===
2025-09-02 11:37:28,838 - principal_context_agent_test - INFO - Testing lookup with role format: 'CFO'
2025-09-02 11:37:28,838 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: CFO
2025-09-02 11:37:28,838 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'CFO'
2025-09-02 11:37:28,839 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['chief financial officer', 'chief executive officer', 'chief operating officer', 'finance manager']
2025-09-02 11:37:28,840 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['CFO', 'cfo', 'Cfo', 'Chief Financial Officer']
2025-09-02 11:37:28,840 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by attribute match: 'cfo_001' with role/title: 'Chief Financial Officer'
2025-09-02 11:37:28,841 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: CFO
2025-09-02 11:37:28,854 - principal_context_agent_test - INFO - Testing lookup with role format: 'cfo'
2025-09-02 11:37:28,855 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: cfo
2025-09-02 11:37:28,855 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'cfo'
2025-09-02 11:37:28,856 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['chief financial officer', 'chief executive officer', 'chief operating officer', 'finance manager']
2025-09-02 11:37:28,856 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['cfo', 'CFO', 'Cfo', 'Chief Financial Officer']
2025-09-02 11:37:28,857 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by attribute match: 'cfo_001' with role/title: 'Chief Financial Officer'
2025-09-02 11:37:28,858 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: cfo
2025-09-02 11:37:28,868 - principal_context_agent_test - INFO - Testing lookup with role format: 'Cfo'
2025-09-02 11:37:28,868 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: Cfo
2025-09-02 11:37:28,869 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'Cfo'
2025-09-02 11:37:28,870 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['chief financial officer', 'chief executive officer', 'chief operating officer', 'finance manager']
2025-09-02 11:37:28,871 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['Cfo', 'cfo', 'CFO', 'Chief Financial Officer']
2025-09-02 11:37:28,871 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by attribute match: 'cfo_001' with role/title: 'Chief Financial Officer'
2025-09-02 11:37:28,872 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: Cfo
2025-09-02 11:37:28,884 - principal_context_agent_test - INFO - Testing lookup with role format: 'FINANCE_MANAGER'
2025-09-02 11:37:28,885 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: FINANCE_MANAGER
2025-09-02 11:37:28,885 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'FINANCE_MANAGER'
2025-09-02 11:37:28,888 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['chief financial officer', 'chief executive officer', 'chief operating officer', 'finance manager']
2025-09-02 11:37:28,889 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['FINANCE_MANAGER', 'finance_manager', 'Finance Manager', 'finance manager']
2025-09-02 11:37:28,889 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'finance manager'
2025-09-02 11:37:28,890 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: FINANCE_MANAGER
2025-09-02 11:37:28,890 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Mapped role directly to enum: Finance Manager -> PrincipalRole.FINANCE_MANAGER
2025-09-02 11:37:28,909 - principal_context_agent_test - INFO - Testing lookup with role format: 'Finance Manager'
2025-09-02 11:37:28,910 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: Finance Manager
2025-09-02 11:37:28,910 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'Finance Manager'
2025-09-02 11:37:28,911 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['chief financial officer', 'chief executive officer', 'chief operating officer', 'finance manager']
2025-09-02 11:37:28,912 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['Finance Manager', 'finance manager', 'FINANCE MANAGER', 'FINANCE_MANAGER', 'finance_manager']
2025-09-02 11:37:28,912 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'finance manager'
2025-09-02 11:37:28,913 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: Finance Manager
2025-09-02 11:37:28,914 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Mapped role directly to enum: Finance Manager -> PrincipalRole.FINANCE_MANAGER
2025-09-02 11:37:28,928 - principal_context_agent_test - INFO - Testing lookup with role format: 'finance manager'
2025-09-02 11:37:28,929 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: finance manager
2025-09-02 11:37:28,929 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'finance manager'
2025-09-02 11:37:28,930 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['chief financial officer', 'chief executive officer', 'chief operating officer', 'finance manager']
2025-09-02 11:37:28,931 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['finance manager', 'FINANCE MANAGER', 'FINANCE_MANAGER', 'Finance Manager', 'finance_manager']
2025-09-02 11:37:28,931 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'finance manager'
2025-09-02 11:37:28,932 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: finance manager
2025-09-02 11:37:28,932 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Mapped role directly to enum: Finance Manager -> PrincipalRole.FINANCE_MANAGER
2025-09-02 11:37:28,950 - principal_context_agent_test - INFO - Testing lookup with non-existent role: 'INVALID_ROLE'
2025-09-02 11:37:28,950 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: INVALID_ROLE
2025-09-02 11:37:28,951 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'INVALID_ROLE'
2025-09-02 11:37:28,954 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['chief financial officer', 'chief executive officer', 'chief operating officer', 'finance manager']
2025-09-02 11:37:28,955 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['INVALID_ROLE', 'invalid_role', 'Invalid Role']
2025-09-02 11:37:28,956 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - WARNING - Principal profile not found for any variation of: 'INVALID_ROLE'
2025-09-02 11:37:28,957 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profiles: ['Chief Financial Officer', 'Chief Executive Officer', 'Chief Operating Officer', 'Finance Manager']
2025-09-02 11:37:28,958 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - WARNING - Principal profile not found for role: INVALID_ROLE
2025-09-02 11:37:28,958 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Using default principal ID: default_id
2025-09-02 11:37:28,959 - principal_context_agent_test - ERROR - Error testing non-existent role: 'str' object is not a mapping
2025-09-02 11:37:28,960 - principal_context_agent_test - INFO - 
Step 6: Testing extract_filters
2025-09-02 11:37:28,960 - principal_context_agent_test - INFO - === Testing extract_filters ===
2025-09-02 11:37:28,960 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Extracting filters from description: 
    Analyze the Q2 financial performance for the ...
2025-09-02 11:37:28,961 - principal_context_agent_test - INFO - Response status: success
2025-09-02 11:37:28,961 - principal_context_agent_test - INFO - Response message: Extracted 1 filters from description
2025-09-02 11:37:28,962 - principal_context_agent_test - INFO - Extracted filters: {'region': ['North America']}
2025-09-02 11:37:28,962 - principal_context_agent_test - INFO - Extracted filter objects: [{'dimension': 'region', 'value': 'North America', 'confidence': 0.8, 'extraction_method': 'rule_based'}]
2025-09-02 11:37:28,963 - principal_context_agent_test - INFO - All tests completed successfully
2025-09-02 11:40:42,057 - asyncio - DEBUG - Using proactor: IocpProactor
2025-09-02 11:40:42,059 - principal_context_agent_test - INFO - Starting Principal Context Agent tests
2025-09-02 11:40:42,059 - principal_context_agent_test - INFO - Step 1: Testing registry structure
2025-09-02 11:40:42,060 - principal_context_agent_test - INFO - === Testing registry structure ===
2025-09-02 11:40:42,060 - principal_context_agent_test - INFO - Initializing registry bootstrap
2025-09-02 11:40:42,061 - src.registry.factory - INFO - Registry Factory initialized
2025-09-02 11:40:42,061 - src.registry.factory - INFO - Registered principal_profile provider
2025-09-02 11:40:42,062 - src.registry.providers.principal_provider - INFO - Loading principal profiles from C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\principal\principal_registry.yaml (yaml)
2025-09-02 11:40:42,087 - src.registry.providers.principal_provider - INFO - Found 4 roles in YAML under 'roles' key
2025-09-02 11:40:42,088 - src.registry.providers.principal_provider - DEBUG - Registered role: cfo_001 - CFO
2025-09-02 11:40:42,089 - src.registry.providers.principal_provider - DEBUG - Registered role: ceo_001 - CEO
2025-09-02 11:40:42,090 - src.registry.providers.principal_provider - DEBUG - Registered role: coo_001 - COO
2025-09-02 11:40:42,090 - src.registry.providers.principal_provider - DEBUG - Registered role: finance_manager_001 - Finance Manager
2025-09-02 11:40:42,090 - src.registry.providers.principal_provider - INFO - Found 4 principal profiles in YAML under 'principals' key
2025-09-02 11:40:42,091 - src.registry.providers.principal_provider - DEBUG - Mapped role name CFO to principal ID cfo_001
2025-09-02 11:40:42,091 - src.registry.providers.principal_provider - INFO - Registered principal: cfo_001 - Lars Mikkelsen
2025-09-02 11:40:42,091 - src.registry.providers.principal_provider - DEBUG - Mapped role name CEO to principal ID ceo_001
2025-09-02 11:40:42,092 - src.registry.providers.principal_provider - INFO - Registered principal: ceo_001 - Alex Morgan
2025-09-02 11:40:42,092 - src.registry.providers.principal_provider - DEBUG - Mapped role name COO to principal ID coo_001
2025-09-02 11:40:42,092 - src.registry.providers.principal_provider - INFO - Registered principal: coo_001 - Priya Desai
2025-09-02 11:40:42,093 - src.registry.providers.principal_provider - DEBUG - Mapped role name Finance Manager to principal ID finance_manager_001
2025-09-02 11:40:42,093 - src.registry.providers.principal_provider - INFO - Registered principal: finance_manager_001 - Emily Chen
2025-09-02 11:40:42,093 - src.registry.providers.principal_provider - INFO - Added role ID mapping: cfo_001 -> Lars Mikkelsen
2025-09-02 11:40:42,094 - src.registry.providers.principal_provider - INFO - Added role ID mapping: ceo_001 -> Alex Morgan
2025-09-02 11:40:42,094 - src.registry.providers.principal_provider - INFO - Added role ID mapping: coo_001 -> Priya Desai
2025-09-02 11:40:42,095 - src.registry.providers.principal_provider - INFO - Added role ID mapping: finance_manager_001 -> Emily Chen
2025-09-02 11:40:42,095 - src.registry.providers.principal_provider - INFO - Loaded 4 principal profiles
2025-09-02 11:40:42,095 - src.registry.bootstrap - INFO - Initialized principal provider with 4 profiles
2025-09-02 11:40:42,099 - src.registry.factory - WARNING - Provider 'business_glossary' not found in registry factory
2025-09-02 11:40:42,099 - src.registry.bootstrap - INFO - Initializing business glossary provider
2025-09-02 11:40:42,105 - src.registry.providers.business_glossary_provider - INFO - Loaded 4 business terms from glossary
2025-09-02 11:40:42,105 - src.registry.factory - INFO - Registered business_glossary provider
2025-09-02 11:40:42,106 - src.registry.bootstrap - INFO - Initialized business glossary provider with 4 terms
2025-09-02 11:40:42,106 - src.registry.factory - INFO - Registered data_product provider
2025-09-02 11:40:42,107 - src.registry.providers.data_product_provider - INFO - Loading data products from C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\data_product\data_product_registry.yaml (yaml)
2025-09-02 11:40:42,117 - src.registry.providers.data_product_provider - INFO - Loaded 1 data products
2025-09-02 11:40:42,118 - src.registry.bootstrap - INFO - Initialized data product provider with 1 data products
2025-09-02 11:40:42,118 - src.registry.bootstrap - INFO - Initializing KPI provider
2025-09-02 11:40:42,118 - src.registry.factory - WARNING - Provider 'kpi' not found in registry factory
2025-09-02 11:40:42,119 - src.registry.bootstrap - INFO - Creating KPI provider with file at C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\kpi\kpi_registry.yaml
2025-09-02 11:40:42,119 - src.registry.bootstrap - INFO - Registering KPI provider with registry factory
2025-09-02 11:40:42,121 - src.registry.factory - INFO - Registered kpi provider
2025-09-02 11:40:42,121 - src.registry.bootstrap - INFO - Loading KPI provider data
2025-09-02 11:40:42,122 - src.registry.providers.kpi_provider - INFO - Loading KPIs from C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\kpi\kpi_registry.yaml (yaml)
2025-09-02 11:40:42,150 - src.registry.providers.kpi_provider - INFO - Loaded 6 KPIs
2025-09-02 11:40:42,150 - src.registry.bootstrap - INFO - KPI provider successfully registered and initialized with 6 KPIs
2025-09-02 11:40:42,150 - src.registry.bootstrap - INFO - Initializing agent bootstrap
2025-09-02 11:40:42,151 - src.agents.agent_bootstrap - WARNING - No agent implementations discovered
2025-09-02 11:40:42,152 - src.registry.bootstrap - WARNING - Agent bootstrap initialization had issues, continuing with available agents
2025-09-02 11:40:42,152 - src.registry.bootstrap - INFO - Registry providers and agent factories initialized successfully
2025-09-02 11:40:42,152 - principal_context_agent_test - INFO - Registry bootstrap initialized successfully
2025-09-02 11:40:42,153 - principal_context_agent_test - INFO - Got RegistryFactory from bootstrap
2025-09-02 11:40:42,155 - principal_context_agent_test - INFO - Provider status: {'principal_profile': True, 'business_glossary': True, 'data_product': False, 'kpi': True}
2025-09-02 11:40:42,155 - principal_context_agent_test - INFO - principal_profile provider status: True
2025-09-02 11:40:42,156 - principal_context_agent_test - INFO - Got principal provider: <src.registry.providers.principal_provider.PrincipalProfileProvider object at 0x00000224D0E9BCD0>
2025-09-02 11:40:42,157 - principal_context_agent_test - INFO - Provider methods: ['__abstractmethods__', '__class__', '__class_getitem__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__orig_bases__', '__parameters__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', '__weakref__', '_abc_impl', '_add_profile', '_extract_profiles_from_module', '_is_protocol', '_load_default_profiles', '_load_from_json', '_load_from_python_module', '_load_from_yaml', '_profiles', '_profiles_by_name', '_profiles_by_title', '_registry_base_path', 'find_by_attribute', 'find_by_business_process', 'find_by_kpi', 'get', 'get_all', 'get_registry_path', 'initialize', 'load', 'register', 'source_path', 'storage_format']
2025-09-02 11:40:42,158 - principal_context_agent_test - INFO - Principal registry file exists at: C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\principal\principal_registry.yaml
2025-09-02 11:40:42,159 - principal_context_agent_test - INFO - Registry file content length: 6517 bytes
2025-09-02 11:40:42,159 - principal_context_agent_test - INFO - Registry file first 100 chars: # Principal Registry
# Contains all principal profiles for personalization and context-aware process...
2025-09-02 11:40:42,161 - principal_context_agent_test - INFO - Got registry data type: <class 'list'>
2025-09-02 11:40:42,161 - principal_context_agent_test - INFO - Found 4 principals in registry
2025-09-02 11:40:42,161 - principal_context_agent_test - INFO - Principal 1 details:
2025-09-02 11:40:42,162 - principal_context_agent_test - INFO -   ID: cfo_001
2025-09-02 11:40:42,162 - principal_context_agent_test - INFO -   Name: Lars Mikkelsen
2025-09-02 11:40:42,162 - principal_context_agent_test - INFO -   Role: N/A
2025-09-02 11:40:42,163 - principal_context_agent_test - INFO -   Title: Chief Financial Officer
2025-09-02 11:40:42,163 - principal_context_agent_test - INFO -   Business Processes: ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals']
2025-09-02 11:40:42,166 - principal_context_agent_test - INFO -   All attributes: ['__abstractmethods__', '__annotations__', '__class__', '__class_getitem__', '__class_vars__', '__copy__', '__deepcopy__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__fields__', '__fields_set__', '__format__', '__ge__', '__get_pydantic_core_schema__', '__get_pydantic_json_schema__', '__getattr__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__iter__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__pretty__', '__private_attributes__', '__pydantic_complete__', '__pydantic_computed_fields__', '__pydantic_core_schema__', '__pydantic_custom_init__', '__pydantic_decorators__', '__pydantic_extra__', '__pydantic_fields__', '__pydantic_fields_set__', '__pydantic_generic_metadata__', '__pydantic_init_subclass__', '__pydantic_parent_namespace__', '__pydantic_post_init__', '__pydantic_private__', '__pydantic_root_model__', '__pydantic_serializer__', '__pydantic_setattr_handlers__', '__pydantic_validator__', '__reduce__', '__reduce_ex__', '__replace__', '__repr__', '__repr_args__', '__repr_name__', '__repr_recursion__', '__repr_str__', '__rich_repr__', '__setattr__', '__setstate__', '__signature__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', '__weakref__', '_abc_impl', '_calculate_keys', '_copy_and_set_values', '_get_value', '_iter', '_setattr_handler', 'business_processes', 'communication', 'construct', 'copy', 'default_filters', 'description', 'dict', 'from_orm', 'id', 'json', 'kpis', 'metadata', 'model_computed_fields', 'model_config', 'model_construct', 'model_copy', 'model_dump', 'model_dump_json', 'model_extra', 'model_fields', 'model_fields_set', 'model_json_schema', 'model_parametrized_name', 'model_post_init', 'model_rebuild', 'model_validate', 'model_validate_json', 'model_validate_strings', 'name', 'parse_file', 'parse_obj', 'parse_raw', 'responsibilities', 'schema', 'schema_json', 'time_frame', 'title', 'to_dict', 'update_forward_refs', 'validate']
2025-09-02 11:40:42,169 - principal_context_agent_test - INFO -   Dict representation: {'id': 'cfo_001', 'name': 'Lars Mikkelsen', 'title': 'Chief Financial Officer', 'description': 'CFO responsible for financial performance in EMEA.', 'business_processes': ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals'], 'kpis': [], 'responsibilities': ['maximize EBIT', 'manage revenue', 'control expenses'], 'default_filters': {'profit_center_hierarchyid': ['Total'], 'customer_hierarchyid': ['Total']}, 'time_frame': {'default_period': 'QTD', 'historical_periods': 4, 'forward_looking_periods': 2}, 'communication': {'detail_level': 'high', 'format_preference': ['visual', 'text', 'table'], 'emphasis': ['trends', 'anomalies', 'forecasts']}, 'metadata': {}}
2025-09-02 11:40:42,171 - principal_context_agent_test - INFO -   __dict__ representation: {'id': 'cfo_001', 'name': 'Lars Mikkelsen', 'title': 'Chief Financial Officer', 'description': 'CFO responsible for financial performance in EMEA.', 'business_processes': ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals'], 'kpis': [], 'responsibilities': ['maximize EBIT', 'manage revenue', 'control expenses'], 'default_filters': {'profit_center_hierarchyid': ['Total'], 'customer_hierarchyid': ['Total']}, 'time_frame': TimeFrame(default_period='QTD', historical_periods=4, forward_looking_periods=2), 'communication': CommunicationPreference(detail_level='high', format_preference=['visual', 'text', 'table'], emphasis=['trends', 'anomalies', 'forecasts']), 'metadata': {}}
2025-09-02 11:40:42,173 - principal_context_agent_test - INFO - Principal 2 details:
2025-09-02 11:40:42,173 - principal_context_agent_test - INFO -   ID: ceo_001
2025-09-02 11:40:42,173 - principal_context_agent_test - INFO -   Name: Alex Morgan
2025-09-02 11:40:42,174 - principal_context_agent_test - INFO -   Role: N/A
2025-09-02 11:40:42,174 - principal_context_agent_test - INFO -   Title: Chief Executive Officer
2025-09-02 11:40:42,175 - principal_context_agent_test - INFO -   Business Processes: ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals']
2025-09-02 11:40:42,177 - principal_context_agent_test - INFO -   All attributes: ['__abstractmethods__', '__annotations__', '__class__', '__class_getitem__', '__class_vars__', '__copy__', '__deepcopy__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__fields__', '__fields_set__', '__format__', '__ge__', '__get_pydantic_core_schema__', '__get_pydantic_json_schema__', '__getattr__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__iter__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__pretty__', '__private_attributes__', '__pydantic_complete__', '__pydantic_computed_fields__', '__pydantic_core_schema__', '__pydantic_custom_init__', '__pydantic_decorators__', '__pydantic_extra__', '__pydantic_fields__', '__pydantic_fields_set__', '__pydantic_generic_metadata__', '__pydantic_init_subclass__', '__pydantic_parent_namespace__', '__pydantic_post_init__', '__pydantic_private__', '__pydantic_root_model__', '__pydantic_serializer__', '__pydantic_setattr_handlers__', '__pydantic_validator__', '__reduce__', '__reduce_ex__', '__replace__', '__repr__', '__repr_args__', '__repr_name__', '__repr_recursion__', '__repr_str__', '__rich_repr__', '__setattr__', '__setstate__', '__signature__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', '__weakref__', '_abc_impl', '_calculate_keys', '_copy_and_set_values', '_get_value', '_iter', '_setattr_handler', 'business_processes', 'communication', 'construct', 'copy', 'default_filters', 'description', 'dict', 'from_orm', 'id', 'json', 'kpis', 'metadata', 'model_computed_fields', 'model_config', 'model_construct', 'model_copy', 'model_dump', 'model_dump_json', 'model_extra', 'model_fields', 'model_fields_set', 'model_json_schema', 'model_parametrized_name', 'model_post_init', 'model_rebuild', 'model_validate', 'model_validate_json', 'model_validate_strings', 'name', 'parse_file', 'parse_obj', 'parse_raw', 'responsibilities', 'schema', 'schema_json', 'time_frame', 'title', 'to_dict', 'update_forward_refs', 'validate']
2025-09-02 11:40:42,179 - principal_context_agent_test - INFO -   Dict representation: {'id': 'ceo_001', 'name': 'Alex Morgan', 'title': 'Chief Executive Officer', 'description': 'CEO driving company strategy and performance.', 'business_processes': ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals'], 'kpis': [], 'responsibilities': ['set strategic direction', 'oversee company performance', 'lead executive team'], 'default_filters': {'profit_center_hierarchyid': ['#']}, 'time_frame': {'default_period': 'YTD', 'historical_periods': 3, 'forward_looking_periods': 4}, 'communication': {'detail_level': 'medium', 'format_preference': ['visual', 'summary'], 'emphasis': ['trends', 'strategic_impact']}, 'metadata': {}}
2025-09-02 11:40:42,180 - principal_context_agent_test - INFO -   __dict__ representation: {'id': 'ceo_001', 'name': 'Alex Morgan', 'title': 'Chief Executive Officer', 'description': 'CEO driving company strategy and performance.', 'business_processes': ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals'], 'kpis': [], 'responsibilities': ['set strategic direction', 'oversee company performance', 'lead executive team'], 'default_filters': {'profit_center_hierarchyid': ['#']}, 'time_frame': TimeFrame(default_period='YTD', historical_periods=3, forward_looking_periods=4), 'communication': CommunicationPreference(detail_level='medium', format_preference=['visual', 'summary'], emphasis=['trends', 'strategic_impact']), 'metadata': {}}
2025-09-02 11:40:42,181 - principal_context_agent_test - INFO - Principal 3 details:
2025-09-02 11:40:42,182 - principal_context_agent_test - INFO -   ID: coo_001
2025-09-02 11:40:42,182 - principal_context_agent_test - INFO -   Name: Priya Desai
2025-09-02 11:40:42,182 - principal_context_agent_test - INFO -   Role: N/A
2025-09-02 11:40:42,183 - principal_context_agent_test - INFO -   Title: Chief Operating Officer
2025-09-02 11:40:42,183 - principal_context_agent_test - INFO -   Business Processes: ['finance_expense_management', 'finance_cash_flow', 'finance_budget_vs_actuals']
2025-09-02 11:40:42,185 - principal_context_agent_test - INFO -   All attributes: ['__abstractmethods__', '__annotations__', '__class__', '__class_getitem__', '__class_vars__', '__copy__', '__deepcopy__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__fields__', '__fields_set__', '__format__', '__ge__', '__get_pydantic_core_schema__', '__get_pydantic_json_schema__', '__getattr__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__iter__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__pretty__', '__private_attributes__', '__pydantic_complete__', '__pydantic_computed_fields__', '__pydantic_core_schema__', '__pydantic_custom_init__', '__pydantic_decorators__', '__pydantic_extra__', '__pydantic_fields__', '__pydantic_fields_set__', '__pydantic_generic_metadata__', '__pydantic_init_subclass__', '__pydantic_parent_namespace__', '__pydantic_post_init__', '__pydantic_private__', '__pydantic_root_model__', '__pydantic_serializer__', '__pydantic_setattr_handlers__', '__pydantic_validator__', '__reduce__', '__reduce_ex__', '__replace__', '__repr__', '__repr_args__', '__repr_name__', '__repr_recursion__', '__repr_str__', '__rich_repr__', '__setattr__', '__setstate__', '__signature__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', '__weakref__', '_abc_impl', '_calculate_keys', '_copy_and_set_values', '_get_value', '_iter', '_setattr_handler', 'business_processes', 'communication', 'construct', 'copy', 'default_filters', 'description', 'dict', 'from_orm', 'id', 'json', 'kpis', 'metadata', 'model_computed_fields', 'model_config', 'model_construct', 'model_copy', 'model_dump', 'model_dump_json', 'model_extra', 'model_fields', 'model_fields_set', 'model_json_schema', 'model_parametrized_name', 'model_post_init', 'model_rebuild', 'model_validate', 'model_validate_json', 'model_validate_strings', 'name', 'parse_file', 'parse_obj', 'parse_raw', 'responsibilities', 'schema', 'schema_json', 'time_frame', 'title', 'to_dict', 'update_forward_refs', 'validate']
2025-09-02 11:40:42,189 - principal_context_agent_test - INFO -   Dict representation: {'id': 'coo_001', 'name': 'Priya Desai', 'title': 'Chief Operating Officer', 'description': 'COO focused on operational excellence and efficiency.', 'business_processes': ['finance_expense_management', 'finance_cash_flow', 'finance_budget_vs_actuals'], 'kpis': [], 'responsibilities': ['optimize operations', 'reduce operational costs', 'improve process efficiency'], 'default_filters': {'profit_center_hierarchyid': ['Best Run U'], 'customer_hierarchyid': ['17100001']}, 'time_frame': {'default_period': 'MTD', 'historical_periods': 6, 'forward_looking_periods': 2}, 'communication': {'detail_level': 'high', 'format_preference': ['table', 'visual'], 'emphasis': ['variances', 'operational_metrics']}, 'metadata': {}}
2025-09-02 11:40:42,190 - principal_context_agent_test - INFO -   __dict__ representation: {'id': 'coo_001', 'name': 'Priya Desai', 'title': 'Chief Operating Officer', 'description': 'COO focused on operational excellence and efficiency.', 'business_processes': ['finance_expense_management', 'finance_cash_flow', 'finance_budget_vs_actuals'], 'kpis': [], 'responsibilities': ['optimize operations', 'reduce operational costs', 'improve process efficiency'], 'default_filters': {'profit_center_hierarchyid': ['Best Run U'], 'customer_hierarchyid': ['17100001']}, 'time_frame': TimeFrame(default_period='MTD', historical_periods=6, forward_looking_periods=2), 'communication': CommunicationPreference(detail_level='high', format_preference=['table', 'visual'], emphasis=['variances', 'operational_metrics']), 'metadata': {}}
2025-09-02 11:40:42,191 - principal_context_agent_test - INFO - Principal 4 details:
2025-09-02 11:40:42,192 - principal_context_agent_test - INFO -   ID: finance_manager_001
2025-09-02 11:40:42,192 - principal_context_agent_test - INFO -   Name: Emily Chen
2025-09-02 11:40:42,193 - principal_context_agent_test - INFO -   Role: N/A
2025-09-02 11:40:42,193 - principal_context_agent_test - INFO -   Title: Finance Manager
2025-09-02 11:40:42,194 - principal_context_agent_test - INFO -   Business Processes: ['Finance: Expense Management', 'Finance: Budget vs. Actuals', 'Finance: Cash Flow Management']
2025-09-02 11:40:42,196 - principal_context_agent_test - INFO -   All attributes: ['__abstractmethods__', '__annotations__', '__class__', '__class_getitem__', '__class_vars__', '__copy__', '__deepcopy__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__fields__', '__fields_set__', '__format__', '__ge__', '__get_pydantic_core_schema__', '__get_pydantic_json_schema__', '__getattr__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__iter__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__pretty__', '__private_attributes__', '__pydantic_complete__', '__pydantic_computed_fields__', '__pydantic_core_schema__', '__pydantic_custom_init__', '__pydantic_decorators__', '__pydantic_extra__', '__pydantic_fields__', '__pydantic_fields_set__', '__pydantic_generic_metadata__', '__pydantic_init_subclass__', '__pydantic_parent_namespace__', '__pydantic_post_init__', '__pydantic_private__', '__pydantic_root_model__', '__pydantic_serializer__', '__pydantic_setattr_handlers__', '__pydantic_validator__', '__reduce__', '__reduce_ex__', '__replace__', '__repr__', '__repr_args__', '__repr_name__', '__repr_recursion__', '__repr_str__', '__rich_repr__', '__setattr__', '__setstate__', '__signature__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', '__weakref__', '_abc_impl', '_calculate_keys', '_copy_and_set_values', '_get_value', '_iter', '_setattr_handler', 'business_processes', 'communication', 'construct', 'copy', 'default_filters', 'description', 'dict', 'from_orm', 'id', 'json', 'kpis', 'metadata', 'model_computed_fields', 'model_config', 'model_construct', 'model_copy', 'model_dump', 'model_dump_json', 'model_extra', 'model_fields', 'model_fields_set', 'model_json_schema', 'model_parametrized_name', 'model_post_init', 'model_rebuild', 'model_validate', 'model_validate_json', 'model_validate_strings', 'name', 'parse_file', 'parse_obj', 'parse_raw', 'responsibilities', 'schema', 'schema_json', 'time_frame', 'title', 'to_dict', 'update_forward_refs', 'validate']
2025-09-02 11:40:42,198 - principal_context_agent_test - INFO -   Dict representation: {'id': 'finance_manager_001', 'name': 'Emily Chen', 'title': 'Finance Manager', 'description': 'Finance Manager responsible for departmental financial analysis and reporting.', 'business_processes': ['Finance: Expense Management', 'Finance: Budget vs. Actuals', 'Finance: Cash Flow Management'], 'kpis': [], 'responsibilities': ['manage departmental budget', 'analyze financial data', 'prepare financial reports'], 'default_filters': {'profit_center_hierarchyid': ['Finance'], 'customer_hierarchyid': ['Total']}, 'time_frame': {'default_period': 'MTD', 'historical_periods': 6, 'forward_looking_periods': 3}, 'communication': {'detail_level': 'high', 'format_preference': ['table', 'visual', 'text'], 'emphasis': ['variances', 'trends', 'forecasts']}, 'metadata': {}}
2025-09-02 11:40:42,199 - principal_context_agent_test - INFO -   __dict__ representation: {'id': 'finance_manager_001', 'name': 'Emily Chen', 'title': 'Finance Manager', 'description': 'Finance Manager responsible for departmental financial analysis and reporting.', 'business_processes': ['Finance: Expense Management', 'Finance: Budget vs. Actuals', 'Finance: Cash Flow Management'], 'kpis': [], 'responsibilities': ['manage departmental budget', 'analyze financial data', 'prepare financial reports'], 'default_filters': {'profit_center_hierarchyid': ['Finance'], 'customer_hierarchyid': ['Total']}, 'time_frame': TimeFrame(default_period='MTD', historical_periods=6, forward_looking_periods=3), 'communication': CommunicationPreference(detail_level='high', format_preference=['table', 'visual', 'text'], emphasis=['variances', 'trends', 'forecasts']), 'metadata': {}}
2025-09-02 11:40:42,200 - principal_context_agent_test - INFO - 
Step 2: Testing Agent Initialization
2025-09-02 11:40:42,201 - principal_context_agent_test - INFO - === Testing loading principal profiles ===
2025-09-02 11:40:42,201 - principal_context_agent_test - INFO - Creating Principal Context Agent
2025-09-02 11:40:42,202 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Initializing A9_Principal_Context_Agent
2025-09-02 11:40:42,205 - principal_context_agent_test - INFO - Connecting agent
2025-09-02 11:40:42,206 - src.registry.bootstrap - INFO - Registry bootstrap already initialized
2025-09-02 11:40:42,206 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Loaded 4 principal profiles from registry
2025-09-02 11:40:42,208 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - First profile: id=cfo_001, role=unknown, name=Lars Mikkelsen
2025-09-02 11:40:42,208 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Profile attributes: ['__abstractmethods__', '__annotations__', '__class__', '__class_getitem__', '__class_vars__', '__copy__', '__deepcopy__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__fields__', '__fields_set__', '__format__', '__ge__', '__get_pydantic_core_schema__', '__get_pydantic_json_schema__', '__getattr__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__iter__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__pretty__', '__private_attributes__', '__pydantic_complete__', '__pydantic_computed_fields__', '__pydantic_core_schema__', '__pydantic_custom_init__', '__pydantic_decorators__', '__pydantic_extra__', '__pydantic_fields__', '__pydantic_fields_set__', '__pydantic_generic_metadata__', '__pydantic_init_subclass__', '__pydantic_parent_namespace__', '__pydantic_post_init__', '__pydantic_private__', '__pydantic_root_model__', '__pydantic_serializer__', '__pydantic_setattr_handlers__', '__pydantic_validator__', '__reduce__', '__reduce_ex__', '__replace__', '__repr__', '__repr_args__', '__repr_name__', '__repr_recursion__', '__repr_str__', '__rich_repr__', '__setattr__', '__setstate__', '__signature__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', '__weakref__', '_abc_impl', '_calculate_keys', '_copy_and_set_values', '_get_value', '_iter', '_setattr_handler', 'business_processes', 'communication', 'construct', 'copy', 'default_filters', 'description', 'dict', 'from_orm', 'id', 'json', 'kpis', 'metadata', 'model_computed_fields', 'model_config', 'model_construct', 'model_copy', 'model_dump', 'model_dump_json', 'model_extra', 'model_fields', 'model_fields_set', 'model_json_schema', 'model_parametrized_name', 'model_post_init', 'model_rebuild', 'model_validate', 'model_validate_json', 'model_validate_strings', 'name', 'parse_file', 'parse_obj', 'parse_raw', 'responsibilities', 'schema', 'schema_json', 'time_frame', 'title', 'to_dict', 'update_forward_refs', 'validate']
2025-09-02 11:40:42,211 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Profile dict: {'id': 'cfo_001', 'name': 'Lars Mikkelsen', 'title': 'Chief Financial Officer', 'description': 'CFO responsible for financial performance in EMEA.', 'business_processes': ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals'], 'kpis': [], 'responsibilities': ['maximize EBIT', 'manage revenue', 'control expenses'], 'default_filters': {'profit_center_hierarchyid': ['Total'], 'customer_hierarchyid': ['Total']}, 'time_frame': {'default_period': 'QTD', 'historical_periods': 4, 'forward_looking_periods': 2}, 'communication': {'detail_level': 'high', 'format_preference': ['visual', 'text', 'table'], 'emphasis': ['trends', 'anomalies', 'forecasts']}, 'metadata': {}}
2025-09-02 11:40:42,213 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found 4 principals in registry
2025-09-02 11:40:42,214 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Loaded 4 principal profiles by ID from registry
2025-09-02 11:40:42,214 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Loaded 4 principal profiles by role from registry
2025-09-02 11:40:42,214 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Connected to dependencies
2025-09-02 11:40:42,215 - principal_context_agent_test - INFO - Loaded 4 principal profiles in principal_profiles dictionary
2025-09-02 11:40:42,215 - principal_context_agent_test - INFO - Loaded 4 principal profiles in principal_profiles_by_id dictionary
2025-09-02 11:40:42,216 - principal_context_agent_test - INFO - Keys in principal_profiles_by_id: ['cfo_001', 'ceo_001', 'coo_001', 'finance_manager_001']
2025-09-02 11:40:42,216 - principal_context_agent_test - INFO - Available roles in principal_profiles: ['chief financial officer', 'chief executive officer', 'chief operating officer', 'finance manager']
2025-09-02 11:40:42,217 - principal_context_agent_test - INFO - Sample profile for chief financial officer:
2025-09-02 11:40:42,217 - principal_context_agent_test - INFO -   id: cfo_001
2025-09-02 11:40:42,217 - principal_context_agent_test - INFO -   role: Chief Financial Officer
2025-09-02 11:40:42,218 - principal_context_agent_test - INFO -   name: Lars Mikkelsen
2025-09-02 11:40:42,218 - principal_context_agent_test - INFO -   title: Chief Financial Officer
2025-09-02 11:40:42,219 - principal_context_agent_test - INFO -   business_processes: ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals']
2025-09-02 11:40:42,221 - principal_context_agent_test - INFO -   default_filters: {'profit_center_hierarchyid': ['Total'], 'customer_hierarchyid': ['Total']}
2025-09-02 11:40:42,222 - principal_context_agent_test - INFO -   decision_style: Analytical
2025-09-02 11:40:42,223 - principal_context_agent_test - INFO -   communication_style: Concise
2025-09-02 11:40:42,223 - principal_context_agent_test - INFO -   description: CFO responsible for financial performance in EMEA.
2025-09-02 11:40:42,223 - principal_context_agent_test - INFO -   timeframes: []
2025-09-02 11:40:42,223 - principal_context_agent_test - INFO - Inspecting _load_principal_profiles method
2025-09-02 11:40:42,232 - principal_context_agent_test - INFO - _load_principal_profiles method code:
    async def _load_principal_profiles(self):
        """Load principal profiles from registry."""
        try:
            # Try to get principal profiles from registry
            if not self._principal_provider:
                self.logger.warning("Principal profile provider not initialized")
                self._load_default_profiles()
                return
                
            registry_data = self._principal_provider.get_all()
            self.logger.info(f"Loaded {len(registry_data) if registry_data else 0} principal profiles from registry")
            
            if registry_data and isinstance(registry_data, list):
                # Debug: Log the first profile to see its structure
                if registry_data:
                    first_profile = registry_data[0]
                    self.logger.info(f"First profile: id={getattr(first_profile, 'id', 'unknown')}, "
                                    f"role={getattr(first_profile, 'role', 'unknown')}, "
                                    f"name={getattr(first_profile, 'name', 'unknown')}")
                    self.logger.info(f"Profile attributes: {dir(first_profile)}")
                    self.logger.info(f"Profile dict: {first_profile.dict() if hasattr(first_profile, 'dict') else 'No dict method'}")
                
                principals = registry_data
                self.logger.info(f"Found {len(principals)} principals in registry")
                
                # Convert to our internal dictionary format keyed by ID and role
                normalized_by_role: Dict[str, Any] = {}
                normalized_by_id: Dict[str, Any] = {}
                role_to_id: Dict[str, str] = {}
                
                for principal in principals:
                    # Use attribute access for Pydantic models instead of dictionary-style access
                    principal_id = getattr(principal, 'id', None)
                    role = getattr(principal, 'role', None)
                    title = getattr(principal, 'title', None)
                    
                    # Use title as role key if role is not available
                    role_key = ''
                    if role:
                        role_key = str(role).lower()
                    elif title:
                        role_key = str(title).lower()
                    
                    if not principal_id:
                        self.logger.warning(f"Principal missing ID: {getattr(principal, 'name', 'Unknown')} - {role or title}")
                        continue
                        
                    # Create profile object
                    profile = {
                        "id": principal_id,
                        "role": role or title,  # Use title as role if role is not available
                        "name": getattr(principal, 'name', None),
                        "title": title,
                        "business_processes": getattr(principal, 'business_processes', []),
                        "default_filters": getattr(principal, 'default_filters', {}),
                        "decision_style": getattr(getattr(principal, 'persona_profile', {}), 'decision_style', 'Analytical'),
                        "communication_style": getattr(getattr(principal, 'persona_profile', {}), 'communication_style', 'Concise'),
                        "description": getattr(principal, 'description', ''),
                        "timeframes": getattr(principal, 'typical_timeframes', [])
                    }
                    
                    # Store by ID (primary index)
                    normalized_by_id[principal_id] = profile
                    
                    # Store by role (secondary index for backward compatibility)
                    if role_key:
                        normalized_by_role[role_key] = profile
                        role_to_id[role_key] = principal_id
                        
                        # Also store by title for additional lookup options
                        if title and title.lower() != role_key:
                            title_key = title.lower()
                            normalized_by_role[title_key] = profile
                            role_to_id[title_key] = principal_id
                
                if normalized_by_id:
                    self.principal_profiles = normalized_by_role
                    self.principal_profiles_by_id = normalized_by_id
                    self.role_to_id_map = role_to_id
                    self.logger.info(f"Loaded {len(self.principal_profiles_by_id)} principal profiles by ID from registry")
                    self.logger.info(f"Loaded {len(self.principal_profiles)} principal profiles by role from registry")
                    return
            
            # Fallback to old format or empty registry
            self.logger.warning("No 'principals' key found in registry or no valid profiles, using defaults")
            self._load_default_profiles()
        except Exception as e:
            error_id = self._log_error("_load_principal_profiles", e)
            self._load_default_profiles()
            self.logger.warning(f"Using default profiles due to loading error {error_id}")

2025-09-02 11:40:42,241 - principal_context_agent_test - INFO - Available roles from agent: ['chief financial officer', 'chief executive officer', 'chief operating officer', 'finance manager']
2025-09-02 11:40:42,241 - principal_context_agent_test - INFO - Testing with roles: ['chief financial officer', 'chief executive officer', 'chief operating officer']
2025-09-02 11:40:42,242 - principal_context_agent_test - INFO - 
Testing with role: chief financial officer
2025-09-02 11:40:42,242 - principal_context_agent_test - INFO - Step 3: Testing fetch_principal_profile
2025-09-02 11:40:42,243 - principal_context_agent_test - INFO - === Testing fetch_principal_profile for role: chief financial officer ===
2025-09-02 11:40:42,243 - principal_context_agent_test - INFO - Checking if 'chief financial officer' exists in principal_profiles_by_id
2025-09-02 11:40:42,243 - principal_context_agent_test - INFO - Calling fetch_principal_profile for 'chief financial officer'
2025-09-02 11:40:42,244 - principal_context_agent_test - INFO - Successfully fetched profile for chief financial officer:
2025-09-02 11:40:42,244 - principal_context_agent_test - INFO -   Profile type: <class 'dict'>
2025-09-02 11:40:42,245 - principal_context_agent_test - INFO -   Name: Lars Mikkelsen
2025-09-02 11:40:42,245 - principal_context_agent_test - INFO -   Title: Chief Financial Officer
2025-09-02 11:40:42,245 - principal_context_agent_test - INFO -   Business Processes: ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals']
2025-09-02 11:40:42,246 - principal_context_agent_test - INFO -   Default Filters: {'profit_center_hierarchyid': ['Total'], 'customer_hierarchyid': ['Total']}
2025-09-02 11:40:42,246 - principal_context_agent_test - INFO -   Decision Style: Analytical
2025-09-02 11:40:42,247 - principal_context_agent_test - INFO -   Communication Style: Concise
2025-09-02 11:40:42,247 - principal_context_agent_test - INFO -   Timeframes: []
2025-09-02 11:40:42,247 - principal_context_agent_test - INFO - Step 4: Testing get_principal_context
2025-09-02 11:40:42,248 - principal_context_agent_test - INFO - === Testing get_principal_context for role: chief financial officer ===
2025-09-02 11:40:42,248 - principal_context_agent_test - INFO - Calling get_principal_context with role: chief financial officer
2025-09-02 11:40:42,249 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: chief financial officer
2025-09-02 11:40:42,250 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'chief financial officer'
2025-09-02 11:40:42,250 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['chief financial officer', 'chief executive officer', 'chief operating officer', 'finance manager']
2025-09-02 11:40:42,251 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['chief financial officer', 'CHIEF FINANCIAL OFFICER', 'CHIEF_FINANCIAL_OFFICER', 'Chief Financial Officer', 'chief_financial_officer', 'cfo', 'CFO']
2025-09-02 11:40:42,251 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'chief financial officer'
2025-09-02 11:40:42,252 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: chief financial officer
2025-09-02 11:40:42,252 - principal_context_agent_test - ERROR - Error testing get_principal_context: 'str' object is not a mapping
2025-09-02 11:40:42,255 - principal_context_agent_test - INFO - Could not get context for chief financial officer, continuing with next tests
2025-09-02 11:40:42,255 - principal_context_agent_test - INFO - 
Testing with role: chief executive officer
2025-09-02 11:40:42,256 - principal_context_agent_test - INFO - Step 3: Testing fetch_principal_profile
2025-09-02 11:40:42,256 - principal_context_agent_test - INFO - === Testing fetch_principal_profile for role: chief executive officer ===
2025-09-02 11:40:42,257 - principal_context_agent_test - INFO - Checking if 'chief executive officer' exists in principal_profiles_by_id
2025-09-02 11:40:42,258 - principal_context_agent_test - INFO - Calling fetch_principal_profile for 'chief executive officer'
2025-09-02 11:40:42,258 - principal_context_agent_test - INFO - Successfully fetched profile for chief executive officer:
2025-09-02 11:40:42,258 - principal_context_agent_test - INFO -   Profile type: <class 'dict'>
2025-09-02 11:40:42,259 - principal_context_agent_test - INFO -   Name: Alex Morgan
2025-09-02 11:40:42,259 - principal_context_agent_test - INFO -   Title: Chief Executive Officer
2025-09-02 11:40:42,260 - principal_context_agent_test - INFO -   Business Processes: ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals']
2025-09-02 11:40:42,261 - principal_context_agent_test - INFO -   Default Filters: {'profit_center_hierarchyid': ['#']}
2025-09-02 11:40:42,261 - principal_context_agent_test - INFO -   Decision Style: Analytical
2025-09-02 11:40:42,261 - principal_context_agent_test - INFO -   Communication Style: Concise
2025-09-02 11:40:42,261 - principal_context_agent_test - INFO -   Timeframes: []
2025-09-02 11:40:42,262 - principal_context_agent_test - INFO - Step 4: Testing get_principal_context
2025-09-02 11:40:42,262 - principal_context_agent_test - INFO - === Testing get_principal_context for role: chief executive officer ===
2025-09-02 11:40:42,263 - principal_context_agent_test - INFO - Calling get_principal_context with role: chief executive officer
2025-09-02 11:40:42,263 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: chief executive officer
2025-09-02 11:40:42,264 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'chief executive officer'
2025-09-02 11:40:42,265 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['chief financial officer', 'chief executive officer', 'chief operating officer', 'finance manager']
2025-09-02 11:40:42,265 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['chief executive officer', 'CHIEF EXECUTIVE OFFICER', 'CHIEF_EXECUTIVE_OFFICER', 'Chief Executive Officer', 'chief_executive_officer', 'ceo', 'CEO']
2025-09-02 11:40:42,266 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'chief executive officer'
2025-09-02 11:40:42,266 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: chief executive officer
2025-09-02 11:40:42,268 - principal_context_agent_test - ERROR - Error testing get_principal_context: 'str' object is not a mapping
2025-09-02 11:40:42,268 - principal_context_agent_test - INFO - Could not get context for chief executive officer, continuing with next tests
2025-09-02 11:40:42,269 - principal_context_agent_test - INFO - 
Testing with role: chief operating officer
2025-09-02 11:40:42,269 - principal_context_agent_test - INFO - Step 3: Testing fetch_principal_profile
2025-09-02 11:40:42,271 - principal_context_agent_test - INFO - === Testing fetch_principal_profile for role: chief operating officer ===
2025-09-02 11:40:42,271 - principal_context_agent_test - INFO - Checking if 'chief operating officer' exists in principal_profiles_by_id
2025-09-02 11:40:42,272 - principal_context_agent_test - INFO - Calling fetch_principal_profile for 'chief operating officer'
2025-09-02 11:40:42,272 - principal_context_agent_test - INFO - Successfully fetched profile for chief operating officer:
2025-09-02 11:40:42,273 - principal_context_agent_test - INFO -   Profile type: <class 'dict'>
2025-09-02 11:40:42,273 - principal_context_agent_test - INFO -   Name: Priya Desai
2025-09-02 11:40:42,273 - principal_context_agent_test - INFO -   Title: Chief Operating Officer
2025-09-02 11:40:42,274 - principal_context_agent_test - INFO -   Business Processes: ['finance_expense_management', 'finance_cash_flow', 'finance_budget_vs_actuals']
2025-09-02 11:40:42,274 - principal_context_agent_test - INFO -   Default Filters: {'profit_center_hierarchyid': ['Best Run U'], 'customer_hierarchyid': ['17100001']}
2025-09-02 11:40:42,275 - principal_context_agent_test - INFO -   Decision Style: Analytical
2025-09-02 11:40:42,276 - principal_context_agent_test - INFO -   Communication Style: Concise
2025-09-02 11:40:42,276 - principal_context_agent_test - INFO -   Timeframes: []
2025-09-02 11:40:42,276 - principal_context_agent_test - INFO - Step 4: Testing get_principal_context
2025-09-02 11:40:42,277 - principal_context_agent_test - INFO - === Testing get_principal_context for role: chief operating officer ===
2025-09-02 11:40:42,277 - principal_context_agent_test - INFO - Calling get_principal_context with role: chief operating officer
2025-09-02 11:40:42,277 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: chief operating officer
2025-09-02 11:40:42,278 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'chief operating officer'
2025-09-02 11:40:42,278 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['chief financial officer', 'chief executive officer', 'chief operating officer', 'finance manager']
2025-09-02 11:40:42,279 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['chief operating officer', 'CHIEF OPERATING OFFICER', 'CHIEF_OPERATING_OFFICER', 'Chief Operating Officer', 'chief_operating_officer', 'coo', 'COO']
2025-09-02 11:40:42,279 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'chief operating officer'
2025-09-02 11:40:42,280 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: chief operating officer
2025-09-02 11:40:42,281 - principal_context_agent_test - ERROR - Error testing get_principal_context: 'str' object is not a mapping
2025-09-02 11:40:42,281 - principal_context_agent_test - INFO - Could not get context for chief operating officer, continuing with next tests
2025-09-02 11:40:42,282 - principal_context_agent_test - INFO - 
Step 5: Testing case-insensitive profile lookup
2025-09-02 11:40:42,282 - principal_context_agent_test - INFO - === Testing case-insensitive profile lookup ===
2025-09-02 11:40:42,282 - principal_context_agent_test - INFO - Testing lookup with role format: 'CFO'
2025-09-02 11:40:42,283 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: CFO
2025-09-02 11:40:42,283 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'CFO'
2025-09-02 11:40:42,284 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['chief financial officer', 'chief executive officer', 'chief operating officer', 'finance manager']
2025-09-02 11:40:42,284 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['CFO', 'cfo', 'Cfo', 'Chief Financial Officer']
2025-09-02 11:40:42,285 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by attribute match: 'cfo_001' with role/title: 'Chief Financial Officer'
2025-09-02 11:40:42,286 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: CFO
2025-09-02 11:40:42,300 - principal_context_agent_test - INFO - Testing lookup with role format: 'cfo'
2025-09-02 11:40:42,300 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: cfo
2025-09-02 11:40:42,301 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'cfo'
2025-09-02 11:40:42,301 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['chief financial officer', 'chief executive officer', 'chief operating officer', 'finance manager']
2025-09-02 11:40:42,302 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['cfo', 'CFO', 'Cfo', 'Chief Financial Officer']
2025-09-02 11:40:42,302 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by attribute match: 'cfo_001' with role/title: 'Chief Financial Officer'
2025-09-02 11:40:42,303 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: cfo
2025-09-02 11:40:42,313 - principal_context_agent_test - INFO - Testing lookup with role format: 'Cfo'
2025-09-02 11:40:42,313 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: Cfo
2025-09-02 11:40:42,313 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'Cfo'
2025-09-02 11:40:42,314 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['chief financial officer', 'chief executive officer', 'chief operating officer', 'finance manager']
2025-09-02 11:40:42,315 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['Cfo', 'cfo', 'CFO', 'Chief Financial Officer']
2025-09-02 11:40:42,315 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by attribute match: 'cfo_001' with role/title: 'Chief Financial Officer'
2025-09-02 11:40:42,316 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: Cfo
2025-09-02 11:40:42,326 - principal_context_agent_test - INFO - Testing lookup with role format: 'FINANCE_MANAGER'
2025-09-02 11:40:42,327 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: FINANCE_MANAGER
2025-09-02 11:40:42,327 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'FINANCE_MANAGER'
2025-09-02 11:40:42,328 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['chief financial officer', 'chief executive officer', 'chief operating officer', 'finance manager']
2025-09-02 11:40:42,328 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['FINANCE_MANAGER', 'finance_manager', 'Finance Manager', 'finance manager']
2025-09-02 11:40:42,329 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'finance manager'
2025-09-02 11:40:42,329 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: FINANCE_MANAGER
2025-09-02 11:40:42,330 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Mapped role directly to enum: Finance Manager -> PrincipalRole.FINANCE_MANAGER
2025-09-02 11:40:42,342 - principal_context_agent_test - INFO - Testing lookup with role format: 'Finance Manager'
2025-09-02 11:40:42,342 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: Finance Manager
2025-09-02 11:40:42,343 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'Finance Manager'
2025-09-02 11:40:42,343 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['chief financial officer', 'chief executive officer', 'chief operating officer', 'finance manager']
2025-09-02 11:40:42,344 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['Finance Manager', 'finance manager', 'FINANCE MANAGER', 'FINANCE_MANAGER', 'finance_manager']
2025-09-02 11:40:42,344 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'finance manager'
2025-09-02 11:40:42,345 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: Finance Manager
2025-09-02 11:40:42,345 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Mapped role directly to enum: Finance Manager -> PrincipalRole.FINANCE_MANAGER
2025-09-02 11:40:42,359 - principal_context_agent_test - INFO - Testing lookup with role format: 'finance manager'
2025-09-02 11:40:42,360 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: finance manager
2025-09-02 11:40:42,360 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'finance manager'
2025-09-02 11:40:42,361 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['chief financial officer', 'chief executive officer', 'chief operating officer', 'finance manager']
2025-09-02 11:40:42,362 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['finance manager', 'FINANCE MANAGER', 'FINANCE_MANAGER', 'Finance Manager', 'finance_manager']
2025-09-02 11:40:42,363 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'finance manager'
2025-09-02 11:40:42,363 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: finance manager
2025-09-02 11:40:42,364 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Mapped role directly to enum: Finance Manager -> PrincipalRole.FINANCE_MANAGER
2025-09-02 11:40:42,377 - principal_context_agent_test - INFO - Testing lookup with non-existent role: 'INVALID_ROLE'
2025-09-02 11:40:42,378 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: INVALID_ROLE
2025-09-02 11:40:42,378 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'INVALID_ROLE'
2025-09-02 11:40:42,379 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['chief financial officer', 'chief executive officer', 'chief operating officer', 'finance manager']
2025-09-02 11:40:42,380 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['INVALID_ROLE', 'invalid_role', 'Invalid Role']
2025-09-02 11:40:42,380 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - WARNING - Principal profile not found for any variation of: 'INVALID_ROLE'
2025-09-02 11:40:42,381 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profiles: ['Chief Financial Officer', 'Chief Executive Officer', 'Chief Operating Officer', 'Finance Manager']
2025-09-02 11:40:42,382 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - WARNING - Principal profile not found for role: INVALID_ROLE
2025-09-02 11:40:42,382 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Using default principal ID: default_id
2025-09-02 11:40:42,383 - principal_context_agent_test - ERROR - Error testing non-existent role: 'str' object is not a mapping
2025-09-02 11:40:42,383 - principal_context_agent_test - INFO - 
Step 6: Testing extract_filters
2025-09-02 11:40:42,384 - principal_context_agent_test - INFO - === Testing extract_filters ===
2025-09-02 11:40:42,384 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Extracting filters from description: 
    Analyze the Q2 financial performance for the ...
2025-09-02 11:40:42,385 - principal_context_agent_test - INFO - Response status: success
2025-09-02 11:40:42,385 - principal_context_agent_test - INFO - Response message: Extracted 1 filters from description
2025-09-02 11:40:42,385 - principal_context_agent_test - INFO - Extracted filters: {'region': ['North America']}
2025-09-02 11:40:42,386 - principal_context_agent_test - INFO - Extracted filter objects: [{'dimension': 'region', 'value': 'North America', 'confidence': 0.8, 'extraction_method': 'rule_based'}]
2025-09-02 11:40:42,386 - principal_context_agent_test - INFO - All tests completed successfully
2025-09-02 12:00:06,231 - asyncio - DEBUG - Using proactor: IocpProactor
2025-09-02 12:00:06,234 - principal_context_agent_test - INFO - Starting Principal Context Agent tests
2025-09-02 12:00:06,234 - principal_context_agent_test - INFO - Step 1: Testing registry structure
2025-09-02 12:00:06,236 - principal_context_agent_test - INFO - === Testing registry structure ===
2025-09-02 12:00:06,236 - principal_context_agent_test - INFO - Initializing registry bootstrap
2025-09-02 12:00:06,238 - src.registry.factory - INFO - Registry Factory initialized
2025-09-02 12:00:06,239 - src.registry.factory - INFO - Registered principal_profile provider
2025-09-02 12:00:06,239 - src.registry.providers.principal_provider - INFO - Loading principal profiles from C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\principal\principal_registry.yaml (yaml)
2025-09-02 12:00:06,283 - src.registry.providers.principal_provider - INFO - Found 4 roles in YAML under 'roles' key
2025-09-02 12:00:06,283 - src.registry.providers.principal_provider - DEBUG - Registered role: cfo_001 - CFO
2025-09-02 12:00:06,284 - src.registry.providers.principal_provider - DEBUG - Registered role: ceo_001 - CEO
2025-09-02 12:00:06,284 - src.registry.providers.principal_provider - DEBUG - Registered role: coo_001 - COO
2025-09-02 12:00:06,285 - src.registry.providers.principal_provider - DEBUG - Registered role: finance_manager_001 - Finance Manager
2025-09-02 12:00:06,285 - src.registry.providers.principal_provider - INFO - Found 4 principal profiles in YAML under 'principals' key
2025-09-02 12:00:06,286 - src.registry.providers.principal_provider - DEBUG - Mapped role name CFO to principal ID cfo_001
2025-09-02 12:00:06,286 - src.registry.providers.principal_provider - INFO - Registered principal: cfo_001 - Lars Mikkelsen
2025-09-02 12:00:06,287 - src.registry.providers.principal_provider - DEBUG - Mapped role name CEO to principal ID ceo_001
2025-09-02 12:00:06,288 - src.registry.providers.principal_provider - INFO - Registered principal: ceo_001 - Alex Morgan
2025-09-02 12:00:06,289 - src.registry.providers.principal_provider - DEBUG - Mapped role name COO to principal ID coo_001
2025-09-02 12:00:06,289 - src.registry.providers.principal_provider - INFO - Registered principal: coo_001 - Priya Desai
2025-09-02 12:00:06,290 - src.registry.providers.principal_provider - DEBUG - Mapped role name Finance Manager to principal ID finance_manager_001
2025-09-02 12:00:06,291 - src.registry.providers.principal_provider - INFO - Registered principal: finance_manager_001 - Emily Chen
2025-09-02 12:00:06,295 - src.registry.providers.principal_provider - INFO - Added role ID mapping: cfo_001 -> Lars Mikkelsen
2025-09-02 12:00:06,296 - src.registry.providers.principal_provider - INFO - Added role ID mapping: ceo_001 -> Alex Morgan
2025-09-02 12:00:06,297 - src.registry.providers.principal_provider - INFO - Added role ID mapping: coo_001 -> Priya Desai
2025-09-02 12:00:06,298 - src.registry.providers.principal_provider - INFO - Added role ID mapping: finance_manager_001 -> Emily Chen
2025-09-02 12:00:06,299 - src.registry.providers.principal_provider - INFO - Loaded 4 principal profiles
2025-09-02 12:00:06,300 - src.registry.bootstrap - INFO - Initialized principal provider with 4 profiles
2025-09-02 12:00:06,303 - src.registry.factory - WARNING - Provider 'business_glossary' not found in registry factory
2025-09-02 12:00:06,304 - src.registry.bootstrap - INFO - Initializing business glossary provider
2025-09-02 12:00:06,314 - src.registry.providers.business_glossary_provider - INFO - Loaded 4 business terms from glossary
2025-09-02 12:00:06,314 - src.registry.factory - INFO - Registered business_glossary provider
2025-09-02 12:00:06,315 - src.registry.bootstrap - INFO - Initialized business glossary provider with 4 terms
2025-09-02 12:00:06,317 - src.registry.factory - INFO - Registered data_product provider
2025-09-02 12:00:06,318 - src.registry.providers.data_product_provider - INFO - Loading data products from C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\data_product\data_product_registry.yaml (yaml)
2025-09-02 12:00:06,346 - src.registry.providers.data_product_provider - INFO - Loaded 1 data products
2025-09-02 12:00:06,347 - src.registry.bootstrap - INFO - Initialized data product provider with 1 data products
2025-09-02 12:00:06,348 - src.registry.bootstrap - INFO - Initializing KPI provider
2025-09-02 12:00:06,349 - src.registry.factory - WARNING - Provider 'kpi' not found in registry factory
2025-09-02 12:00:06,350 - src.registry.bootstrap - INFO - Creating KPI provider with file at C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\kpi\kpi_registry.yaml
2025-09-02 12:00:06,351 - src.registry.bootstrap - INFO - Registering KPI provider with registry factory
2025-09-02 12:00:06,352 - src.registry.factory - INFO - Registered kpi provider
2025-09-02 12:00:06,354 - src.registry.bootstrap - INFO - Loading KPI provider data
2025-09-02 12:00:06,355 - src.registry.providers.kpi_provider - INFO - Loading KPIs from C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\kpi\kpi_registry.yaml (yaml)
2025-09-02 12:00:06,459 - src.registry.providers.kpi_provider - INFO - Loaded 6 KPIs
2025-09-02 12:00:06,460 - src.registry.bootstrap - INFO - KPI provider successfully registered and initialized with 6 KPIs
2025-09-02 12:00:06,461 - src.registry.bootstrap - INFO - Initializing agent bootstrap
2025-09-02 12:00:06,464 - src.agents.agent_bootstrap - WARNING - No agent implementations discovered
2025-09-02 12:00:06,472 - src.registry.bootstrap - WARNING - Agent bootstrap initialization had issues, continuing with available agents
2025-09-02 12:00:06,475 - src.registry.bootstrap - INFO - Registry providers and agent factories initialized successfully
2025-09-02 12:00:06,477 - principal_context_agent_test - INFO - Registry bootstrap initialized successfully
2025-09-02 12:00:06,480 - principal_context_agent_test - INFO - Got RegistryFactory from bootstrap
2025-09-02 12:00:06,482 - principal_context_agent_test - INFO - Provider status: {'principal_profile': True, 'business_glossary': True, 'data_product': False, 'kpi': True}
2025-09-02 12:00:06,484 - principal_context_agent_test - INFO - principal_profile provider status: True
2025-09-02 12:00:06,485 - principal_context_agent_test - INFO - Got principal provider: <src.registry.providers.principal_provider.PrincipalProfileProvider object at 0x0000014DA1C33410>
2025-09-02 12:00:06,488 - principal_context_agent_test - INFO - Provider methods: ['__abstractmethods__', '__class__', '__class_getitem__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__orig_bases__', '__parameters__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', '__weakref__', '_abc_impl', '_add_profile', '_extract_profiles_from_module', '_is_protocol', '_load_default_profiles', '_load_from_json', '_load_from_python_module', '_load_from_yaml', '_profiles', '_profiles_by_name', '_profiles_by_title', '_registry_base_path', 'find_by_attribute', 'find_by_business_process', 'find_by_kpi', 'get', 'get_all', 'get_registry_path', 'initialize', 'load', 'register', 'source_path', 'storage_format']
2025-09-02 12:00:06,494 - principal_context_agent_test - INFO - Principal registry file exists at: C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\principal\principal_registry.yaml
2025-09-02 12:00:06,498 - principal_context_agent_test - INFO - Registry file content length: 6517 bytes
2025-09-02 12:00:06,502 - principal_context_agent_test - INFO - Registry file first 100 chars: # Principal Registry
# Contains all principal profiles for personalization and context-aware process...
2025-09-02 12:00:06,504 - principal_context_agent_test - INFO - Got registry data type: <class 'list'>
2025-09-02 12:00:06,507 - principal_context_agent_test - INFO - Found 4 principals in registry
2025-09-02 12:00:06,509 - principal_context_agent_test - INFO - Principal 1 details:
2025-09-02 12:00:06,511 - principal_context_agent_test - INFO -   ID: cfo_001
2025-09-02 12:00:06,512 - principal_context_agent_test - INFO -   Name: Lars Mikkelsen
2025-09-02 12:00:06,514 - principal_context_agent_test - INFO -   Role: N/A
2025-09-02 12:00:06,515 - principal_context_agent_test - INFO -   Title: Chief Financial Officer
2025-09-02 12:00:06,518 - principal_context_agent_test - INFO -   Business Processes: ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals']
2025-09-02 12:00:06,523 - principal_context_agent_test - INFO -   All attributes: ['__abstractmethods__', '__annotations__', '__class__', '__class_getitem__', '__class_vars__', '__copy__', '__deepcopy__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__fields__', '__fields_set__', '__format__', '__ge__', '__get_pydantic_core_schema__', '__get_pydantic_json_schema__', '__getattr__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__iter__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__pretty__', '__private_attributes__', '__pydantic_complete__', '__pydantic_computed_fields__', '__pydantic_core_schema__', '__pydantic_custom_init__', '__pydantic_decorators__', '__pydantic_extra__', '__pydantic_fields__', '__pydantic_fields_set__', '__pydantic_generic_metadata__', '__pydantic_init_subclass__', '__pydantic_parent_namespace__', '__pydantic_post_init__', '__pydantic_private__', '__pydantic_root_model__', '__pydantic_serializer__', '__pydantic_setattr_handlers__', '__pydantic_validator__', '__reduce__', '__reduce_ex__', '__replace__', '__repr__', '__repr_args__', '__repr_name__', '__repr_recursion__', '__repr_str__', '__rich_repr__', '__setattr__', '__setstate__', '__signature__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', '__weakref__', '_abc_impl', '_calculate_keys', '_copy_and_set_values', '_get_value', '_iter', '_setattr_handler', 'business_processes', 'communication', 'construct', 'copy', 'default_filters', 'description', 'dict', 'from_orm', 'id', 'json', 'kpis', 'metadata', 'model_computed_fields', 'model_config', 'model_construct', 'model_copy', 'model_dump', 'model_dump_json', 'model_extra', 'model_fields', 'model_fields_set', 'model_json_schema', 'model_parametrized_name', 'model_post_init', 'model_rebuild', 'model_validate', 'model_validate_json', 'model_validate_strings', 'name', 'parse_file', 'parse_obj', 'parse_raw', 'responsibilities', 'schema', 'schema_json', 'time_frame', 'title', 'to_dict', 'update_forward_refs', 'validate']
2025-09-02 12:00:06,535 - principal_context_agent_test - INFO -   Dict representation: {'id': 'cfo_001', 'name': 'Lars Mikkelsen', 'title': 'Chief Financial Officer', 'description': 'CFO responsible for financial performance in EMEA.', 'business_processes': ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals'], 'kpis': [], 'responsibilities': ['maximize EBIT', 'manage revenue', 'control expenses'], 'default_filters': {'profit_center_hierarchyid': ['Total'], 'customer_hierarchyid': ['Total']}, 'time_frame': {'default_period': 'QTD', 'historical_periods': 4, 'forward_looking_periods': 2}, 'communication': {'detail_level': 'high', 'format_preference': ['visual', 'text', 'table'], 'emphasis': ['trends', 'anomalies', 'forecasts']}, 'metadata': {}}
2025-09-02 12:00:06,541 - principal_context_agent_test - INFO -   __dict__ representation: {'id': 'cfo_001', 'name': 'Lars Mikkelsen', 'title': 'Chief Financial Officer', 'description': 'CFO responsible for financial performance in EMEA.', 'business_processes': ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals'], 'kpis': [], 'responsibilities': ['maximize EBIT', 'manage revenue', 'control expenses'], 'default_filters': {'profit_center_hierarchyid': ['Total'], 'customer_hierarchyid': ['Total']}, 'time_frame': TimeFrame(default_period='QTD', historical_periods=4, forward_looking_periods=2), 'communication': CommunicationPreference(detail_level='high', format_preference=['visual', 'text', 'table'], emphasis=['trends', 'anomalies', 'forecasts']), 'metadata': {}}
2025-09-02 12:00:06,546 - principal_context_agent_test - INFO - Principal 2 details:
2025-09-02 12:00:06,547 - principal_context_agent_test - INFO -   ID: ceo_001
2025-09-02 12:00:06,548 - principal_context_agent_test - INFO -   Name: Alex Morgan
2025-09-02 12:00:06,549 - principal_context_agent_test - INFO -   Role: N/A
2025-09-02 12:00:06,550 - principal_context_agent_test - INFO -   Title: Chief Executive Officer
2025-09-02 12:00:06,555 - principal_context_agent_test - INFO -   Business Processes: ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals']
2025-09-02 12:00:06,567 - principal_context_agent_test - INFO -   All attributes: ['__abstractmethods__', '__annotations__', '__class__', '__class_getitem__', '__class_vars__', '__copy__', '__deepcopy__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__fields__', '__fields_set__', '__format__', '__ge__', '__get_pydantic_core_schema__', '__get_pydantic_json_schema__', '__getattr__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__iter__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__pretty__', '__private_attributes__', '__pydantic_complete__', '__pydantic_computed_fields__', '__pydantic_core_schema__', '__pydantic_custom_init__', '__pydantic_decorators__', '__pydantic_extra__', '__pydantic_fields__', '__pydantic_fields_set__', '__pydantic_generic_metadata__', '__pydantic_init_subclass__', '__pydantic_parent_namespace__', '__pydantic_post_init__', '__pydantic_private__', '__pydantic_root_model__', '__pydantic_serializer__', '__pydantic_setattr_handlers__', '__pydantic_validator__', '__reduce__', '__reduce_ex__', '__replace__', '__repr__', '__repr_args__', '__repr_name__', '__repr_recursion__', '__repr_str__', '__rich_repr__', '__setattr__', '__setstate__', '__signature__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', '__weakref__', '_abc_impl', '_calculate_keys', '_copy_and_set_values', '_get_value', '_iter', '_setattr_handler', 'business_processes', 'communication', 'construct', 'copy', 'default_filters', 'description', 'dict', 'from_orm', 'id', 'json', 'kpis', 'metadata', 'model_computed_fields', 'model_config', 'model_construct', 'model_copy', 'model_dump', 'model_dump_json', 'model_extra', 'model_fields', 'model_fields_set', 'model_json_schema', 'model_parametrized_name', 'model_post_init', 'model_rebuild', 'model_validate', 'model_validate_json', 'model_validate_strings', 'name', 'parse_file', 'parse_obj', 'parse_raw', 'responsibilities', 'schema', 'schema_json', 'time_frame', 'title', 'to_dict', 'update_forward_refs', 'validate']
2025-09-02 12:00:06,588 - principal_context_agent_test - INFO -   Dict representation: {'id': 'ceo_001', 'name': 'Alex Morgan', 'title': 'Chief Executive Officer', 'description': 'CEO driving company strategy and performance.', 'business_processes': ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals'], 'kpis': [], 'responsibilities': ['set strategic direction', 'oversee company performance', 'lead executive team'], 'default_filters': {'profit_center_hierarchyid': ['#']}, 'time_frame': {'default_period': 'YTD', 'historical_periods': 3, 'forward_looking_periods': 4}, 'communication': {'detail_level': 'medium', 'format_preference': ['visual', 'summary'], 'emphasis': ['trends', 'strategic_impact']}, 'metadata': {}}
2025-09-02 12:00:06,597 - principal_context_agent_test - INFO -   __dict__ representation: {'id': 'ceo_001', 'name': 'Alex Morgan', 'title': 'Chief Executive Officer', 'description': 'CEO driving company strategy and performance.', 'business_processes': ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals'], 'kpis': [], 'responsibilities': ['set strategic direction', 'oversee company performance', 'lead executive team'], 'default_filters': {'profit_center_hierarchyid': ['#']}, 'time_frame': TimeFrame(default_period='YTD', historical_periods=3, forward_looking_periods=4), 'communication': CommunicationPreference(detail_level='medium', format_preference=['visual', 'summary'], emphasis=['trends', 'strategic_impact']), 'metadata': {}}
2025-09-02 12:00:06,600 - principal_context_agent_test - INFO - Principal 3 details:
2025-09-02 12:00:06,601 - principal_context_agent_test - INFO -   ID: coo_001
2025-09-02 12:00:06,604 - principal_context_agent_test - INFO -   Name: Priya Desai
2025-09-02 12:00:06,607 - principal_context_agent_test - INFO -   Role: N/A
2025-09-02 12:00:06,609 - principal_context_agent_test - INFO -   Title: Chief Operating Officer
2025-09-02 12:00:06,612 - principal_context_agent_test - INFO -   Business Processes: ['finance_expense_management', 'finance_cash_flow', 'finance_budget_vs_actuals']
2025-09-02 12:00:06,617 - principal_context_agent_test - INFO -   All attributes: ['__abstractmethods__', '__annotations__', '__class__', '__class_getitem__', '__class_vars__', '__copy__', '__deepcopy__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__fields__', '__fields_set__', '__format__', '__ge__', '__get_pydantic_core_schema__', '__get_pydantic_json_schema__', '__getattr__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__iter__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__pretty__', '__private_attributes__', '__pydantic_complete__', '__pydantic_computed_fields__', '__pydantic_core_schema__', '__pydantic_custom_init__', '__pydantic_decorators__', '__pydantic_extra__', '__pydantic_fields__', '__pydantic_fields_set__', '__pydantic_generic_metadata__', '__pydantic_init_subclass__', '__pydantic_parent_namespace__', '__pydantic_post_init__', '__pydantic_private__', '__pydantic_root_model__', '__pydantic_serializer__', '__pydantic_setattr_handlers__', '__pydantic_validator__', '__reduce__', '__reduce_ex__', '__replace__', '__repr__', '__repr_args__', '__repr_name__', '__repr_recursion__', '__repr_str__', '__rich_repr__', '__setattr__', '__setstate__', '__signature__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', '__weakref__', '_abc_impl', '_calculate_keys', '_copy_and_set_values', '_get_value', '_iter', '_setattr_handler', 'business_processes', 'communication', 'construct', 'copy', 'default_filters', 'description', 'dict', 'from_orm', 'id', 'json', 'kpis', 'metadata', 'model_computed_fields', 'model_config', 'model_construct', 'model_copy', 'model_dump', 'model_dump_json', 'model_extra', 'model_fields', 'model_fields_set', 'model_json_schema', 'model_parametrized_name', 'model_post_init', 'model_rebuild', 'model_validate', 'model_validate_json', 'model_validate_strings', 'name', 'parse_file', 'parse_obj', 'parse_raw', 'responsibilities', 'schema', 'schema_json', 'time_frame', 'title', 'to_dict', 'update_forward_refs', 'validate']
2025-09-02 12:00:06,630 - principal_context_agent_test - INFO -   Dict representation: {'id': 'coo_001', 'name': 'Priya Desai', 'title': 'Chief Operating Officer', 'description': 'COO focused on operational excellence and efficiency.', 'business_processes': ['finance_expense_management', 'finance_cash_flow', 'finance_budget_vs_actuals'], 'kpis': [], 'responsibilities': ['optimize operations', 'reduce operational costs', 'improve process efficiency'], 'default_filters': {'profit_center_hierarchyid': ['Best Run U'], 'customer_hierarchyid': ['17100001']}, 'time_frame': {'default_period': 'MTD', 'historical_periods': 6, 'forward_looking_periods': 2}, 'communication': {'detail_level': 'high', 'format_preference': ['table', 'visual'], 'emphasis': ['variances', 'operational_metrics']}, 'metadata': {}}
2025-09-02 12:00:06,638 - principal_context_agent_test - INFO -   __dict__ representation: {'id': 'coo_001', 'name': 'Priya Desai', 'title': 'Chief Operating Officer', 'description': 'COO focused on operational excellence and efficiency.', 'business_processes': ['finance_expense_management', 'finance_cash_flow', 'finance_budget_vs_actuals'], 'kpis': [], 'responsibilities': ['optimize operations', 'reduce operational costs', 'improve process efficiency'], 'default_filters': {'profit_center_hierarchyid': ['Best Run U'], 'customer_hierarchyid': ['17100001']}, 'time_frame': TimeFrame(default_period='MTD', historical_periods=6, forward_looking_periods=2), 'communication': CommunicationPreference(detail_level='high', format_preference=['table', 'visual'], emphasis=['variances', 'operational_metrics']), 'metadata': {}}
2025-09-02 12:00:06,642 - principal_context_agent_test - INFO - Principal 4 details:
2025-09-02 12:00:06,644 - principal_context_agent_test - INFO -   ID: finance_manager_001
2025-09-02 12:00:06,645 - principal_context_agent_test - INFO -   Name: Emily Chen
2025-09-02 12:00:06,647 - principal_context_agent_test - INFO -   Role: N/A
2025-09-02 12:00:06,649 - principal_context_agent_test - INFO -   Title: Finance Manager
2025-09-02 12:00:06,651 - principal_context_agent_test - INFO -   Business Processes: ['Finance: Expense Management', 'Finance: Budget vs. Actuals', 'Finance: Cash Flow Management']
2025-09-02 12:00:06,660 - principal_context_agent_test - INFO -   All attributes: ['__abstractmethods__', '__annotations__', '__class__', '__class_getitem__', '__class_vars__', '__copy__', '__deepcopy__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__fields__', '__fields_set__', '__format__', '__ge__', '__get_pydantic_core_schema__', '__get_pydantic_json_schema__', '__getattr__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__iter__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__pretty__', '__private_attributes__', '__pydantic_complete__', '__pydantic_computed_fields__', '__pydantic_core_schema__', '__pydantic_custom_init__', '__pydantic_decorators__', '__pydantic_extra__', '__pydantic_fields__', '__pydantic_fields_set__', '__pydantic_generic_metadata__', '__pydantic_init_subclass__', '__pydantic_parent_namespace__', '__pydantic_post_init__', '__pydantic_private__', '__pydantic_root_model__', '__pydantic_serializer__', '__pydantic_setattr_handlers__', '__pydantic_validator__', '__reduce__', '__reduce_ex__', '__replace__', '__repr__', '__repr_args__', '__repr_name__', '__repr_recursion__', '__repr_str__', '__rich_repr__', '__setattr__', '__setstate__', '__signature__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', '__weakref__', '_abc_impl', '_calculate_keys', '_copy_and_set_values', '_get_value', '_iter', '_setattr_handler', 'business_processes', 'communication', 'construct', 'copy', 'default_filters', 'description', 'dict', 'from_orm', 'id', 'json', 'kpis', 'metadata', 'model_computed_fields', 'model_config', 'model_construct', 'model_copy', 'model_dump', 'model_dump_json', 'model_extra', 'model_fields', 'model_fields_set', 'model_json_schema', 'model_parametrized_name', 'model_post_init', 'model_rebuild', 'model_validate', 'model_validate_json', 'model_validate_strings', 'name', 'parse_file', 'parse_obj', 'parse_raw', 'responsibilities', 'schema', 'schema_json', 'time_frame', 'title', 'to_dict', 'update_forward_refs', 'validate']
2025-09-02 12:00:06,672 - principal_context_agent_test - INFO -   Dict representation: {'id': 'finance_manager_001', 'name': 'Emily Chen', 'title': 'Finance Manager', 'description': 'Finance Manager responsible for departmental financial analysis and reporting.', 'business_processes': ['Finance: Expense Management', 'Finance: Budget vs. Actuals', 'Finance: Cash Flow Management'], 'kpis': [], 'responsibilities': ['manage departmental budget', 'analyze financial data', 'prepare financial reports'], 'default_filters': {'profit_center_hierarchyid': ['Finance'], 'customer_hierarchyid': ['Total']}, 'time_frame': {'default_period': 'MTD', 'historical_periods': 6, 'forward_looking_periods': 3}, 'communication': {'detail_level': 'high', 'format_preference': ['table', 'visual', 'text'], 'emphasis': ['variances', 'trends', 'forecasts']}, 'metadata': {}}
2025-09-02 12:00:06,700 - principal_context_agent_test - INFO -   __dict__ representation: {'id': 'finance_manager_001', 'name': 'Emily Chen', 'title': 'Finance Manager', 'description': 'Finance Manager responsible for departmental financial analysis and reporting.', 'business_processes': ['Finance: Expense Management', 'Finance: Budget vs. Actuals', 'Finance: Cash Flow Management'], 'kpis': [], 'responsibilities': ['manage departmental budget', 'analyze financial data', 'prepare financial reports'], 'default_filters': {'profit_center_hierarchyid': ['Finance'], 'customer_hierarchyid': ['Total']}, 'time_frame': TimeFrame(default_period='MTD', historical_periods=6, forward_looking_periods=3), 'communication': CommunicationPreference(detail_level='high', format_preference=['table', 'visual', 'text'], emphasis=['variances', 'trends', 'forecasts']), 'metadata': {}}
2025-09-02 12:00:06,705 - principal_context_agent_test - INFO - 
Step 2: Testing Agent Initialization
2025-09-02 12:00:06,707 - principal_context_agent_test - INFO - === Testing loading principal profiles ===
2025-09-02 12:00:06,708 - principal_context_agent_test - INFO - Creating Principal Context Agent
2025-09-02 12:00:06,710 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Initializing A9_Principal_Context_Agent
2025-09-02 12:00:06,712 - principal_context_agent_test - INFO - Connecting agent
2025-09-02 12:00:06,714 - src.registry.bootstrap - INFO - Registry bootstrap already initialized
2025-09-02 12:00:06,715 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Loaded 4 principal profiles from registry
2025-09-02 12:00:06,717 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Profile 0: id=cfo_001, role=unknown, title=Chief Financial Officer, name=Lars Mikkelsen
2025-09-02 12:00:06,719 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Profile 1: id=ceo_001, role=unknown, title=Chief Executive Officer, name=Alex Morgan
2025-09-02 12:00:06,721 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Profile 2: id=coo_001, role=unknown, title=Chief Operating Officer, name=Priya Desai
2025-09-02 12:00:06,723 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Profile 3: id=finance_manager_001, role=unknown, title=Finance Manager, name=Emily Chen
2025-09-02 12:00:06,730 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Processing principal: id=cfo_001, role=None, title=Chief Financial Officer
2025-09-02 12:00:06,732 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Added profile by ID: cfo_001
2025-09-02 12:00:06,734 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Added profile by title (exact): Chief Financial Officer
2025-09-02 12:00:06,737 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Added profile by title (lowercase): chief financial officer
2025-09-02 12:00:06,739 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Processing principal: id=ceo_001, role=None, title=Chief Executive Officer
2025-09-02 12:00:06,742 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Added profile by ID: ceo_001
2025-09-02 12:00:06,745 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Added profile by title (exact): Chief Executive Officer
2025-09-02 12:00:06,748 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Added profile by title (lowercase): chief executive officer
2025-09-02 12:00:06,749 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Processing principal: id=coo_001, role=None, title=Chief Operating Officer
2025-09-02 12:00:06,752 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Added profile by ID: coo_001
2025-09-02 12:00:06,758 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Added profile by title (exact): Chief Operating Officer
2025-09-02 12:00:06,765 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Added profile by title (lowercase): chief operating officer
2025-09-02 12:00:06,770 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Processing principal: id=finance_manager_001, role=None, title=Finance Manager
2025-09-02 12:00:06,773 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Added profile by ID: finance_manager_001
2025-09-02 12:00:06,786 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Added profile by title (exact): Finance Manager
2025-09-02 12:00:06,787 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Added profile by title (lowercase): finance manager
2025-09-02 12:00:06,789 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Loaded 4 principal profiles by ID from registry
2025-09-02 12:00:06,791 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Loaded 8 principal profiles by role from registry
2025-09-02 12:00:06,793 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Available profile IDs: ['cfo_001', 'ceo_001', 'coo_001', 'finance_manager_001']
2025-09-02 12:00:06,796 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Available role keys: ['Chief Financial Officer', 'chief financial officer', 'Chief Executive Officer', 'chief executive officer', 'Chief Operating Officer', 'chief operating officer', 'Finance Manager', 'finance manager']
2025-09-02 12:00:06,798 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Connected to dependencies
2025-09-02 12:00:06,801 - principal_context_agent_test - INFO - Loaded 8 principal profiles in principal_profiles dictionary
2025-09-02 12:00:06,802 - principal_context_agent_test - INFO - Loaded 4 principal profiles in principal_profiles_by_id dictionary
2025-09-02 12:00:06,805 - principal_context_agent_test - INFO - Keys in principal_profiles_by_id: ['cfo_001', 'ceo_001', 'coo_001', 'finance_manager_001']
2025-09-02 12:00:06,807 - principal_context_agent_test - INFO - Available roles in principal_profiles: ['Chief Financial Officer', 'chief financial officer', 'Chief Executive Officer', 'chief executive officer', 'Chief Operating Officer', 'chief operating officer', 'Finance Manager', 'finance manager']
2025-09-02 12:00:06,808 - principal_context_agent_test - INFO - Sample profile for Chief Financial Officer:
2025-09-02 12:00:06,809 - principal_context_agent_test - INFO -   id: cfo_001
2025-09-02 12:00:06,815 - principal_context_agent_test - INFO -   role: Chief Financial Officer
2025-09-02 12:00:06,821 - principal_context_agent_test - INFO -   name: Lars Mikkelsen
2025-09-02 12:00:06,823 - principal_context_agent_test - INFO -   title: Chief Financial Officer
2025-09-02 12:00:06,825 - principal_context_agent_test - INFO -   business_processes: ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals']
2025-09-02 12:00:06,827 - principal_context_agent_test - INFO -   default_filters: {'profit_center_hierarchyid': ['Total'], 'customer_hierarchyid': ['Total']}
2025-09-02 12:00:06,828 - principal_context_agent_test - INFO -   decision_style: Analytical
2025-09-02 12:00:06,829 - principal_context_agent_test - INFO -   communication_style: Concise
2025-09-02 12:00:06,830 - principal_context_agent_test - INFO -   description: CFO responsible for financial performance in EMEA.
2025-09-02 12:00:06,834 - principal_context_agent_test - INFO -   timeframes: []
2025-09-02 12:00:06,835 - principal_context_agent_test - INFO - Inspecting _load_principal_profiles method
2025-09-02 12:00:06,870 - principal_context_agent_test - INFO - _load_principal_profiles method code:
    async def _load_principal_profiles(self):
        """Load principal profiles from registry."""
        try:
            # Try to get principal profiles from registry
            if not self._principal_provider:
                self.logger.warning("Principal profile provider not initialized")
                self._load_default_profiles()
                return
                
            # Get all profiles from the provider
            registry_data = self._principal_provider.get_all()
            self.logger.info(f"Loaded {len(registry_data) if registry_data else 0} principal profiles from registry")
            
            # Debug the registry data
            if not registry_data:
                self.logger.warning("No principal profiles found in registry")
                self._load_default_profiles()
                return
                
            if not isinstance(registry_data, list):
                self.logger.warning(f"Registry data is not a list: {type(registry_data)}")
                self._load_default_profiles()
                return
                
            # Debug: Log all profiles to see their structure
            for i, profile in enumerate(registry_data):
                self.logger.info(f"Profile {i}: id={getattr(profile, 'id', 'unknown')}, "
                                f"role={getattr(profile, 'role', 'unknown')}, "
                                f"title={getattr(profile, 'title', 'unknown')}, "
                                f"name={getattr(profile, 'name', 'unknown')}")
            
            # Convert to our internal dictionary format keyed by ID and role
            normalized_by_role = {}
            normalized_by_id = {}
            role_to_id = {}
            
            for principal in registry_data:
                # Use attribute access for Pydantic models instead of dictionary-style access
                principal_id = getattr(principal, 'id', None)
                role = getattr(principal, 'role', None)
                title = getattr(principal, 'title', None)
                
                self.logger.info(f"Processing principal: id={principal_id}, role={role}, title={title}")
                
                if not principal_id:
                    self.logger.warning(f"Principal missing ID: {getattr(principal, 'name', 'Unknown')} - {role or title}")
                    continue
                    
                # Create profile object
                profile = {
                    "id": principal_id,
                    "role": role or title,  # Use title as role if role is not available
                    "name": getattr(principal, 'name', None),
                    "title": title,
                    "business_processes": getattr(principal, 'business_processes', []),
                    "default_filters": getattr(principal, 'default_filters', {}),
                    "decision_style": getattr(getattr(principal, 'persona_profile', {}), 'decision_style', 'Analytical'),
                    "communication_style": getattr(getattr(principal, 'persona_profile', {}), 'communication_style', 'Concise'),
                    "description": getattr(principal, 'description', ''),
                    "timeframes": getattr(principal, 'typical_timeframes', [])
                }
                
                # Store by ID (primary index)
                normalized_by_id[principal_id] = profile
                self.logger.info(f"Added profile by ID: {principal_id}")
                
                # Store by role (secondary index for backward compatibility)
                if role:
                    # Store using exact role name
                    normalized_by_role[role] = profile
                    role_to_id[role] = principal_id
                    self.logger.info(f"Added profile by role (exact): {role}")
                    
                    # Also store using lowercase role name
                    role_lower = role.lower()
                    normalized_by_role[role_lower] = profile
                    role_to_id[role_lower] = principal_id
                    self.logger.info(f"Added profile by role (lowercase): {role_lower}")
                
                # Also store by title for additional lookup options
                if title:
                    # Store using exact title
                    normalized_by_role[title] = profile
                    role_to_id[title] = principal_id
                    self.logger.info(f"Added profile by title (exact): {title}")
                    
                    # Also store using lowercase title
                    title_lower = title.lower()
                    normalized_by_role[title_lower] = profile
                    role_to_id[title_lower] = principal_id
                    self.logger.info(f"Added profile by title (lowercase): {title_lower}")
            
            if normalized_by_id:
                self.principal_profiles = normalized_by_role
                self.principal_profiles_by_id = normalized_by_id
                self.role_to_id_map = role_to_id
                self.logger.info(f"Loaded {len(self.principal_profiles_by_id)} principal profiles by ID from registry")
                self.logger.info(f"Loaded {len(self.principal_profiles)} principal profiles by role from registry")
                self.logger.info(f"Available profile IDs: {list(self.principal_profiles_by_id.keys())}")
                self.logger.info(f"Available role keys: {list(self.principal_profiles.keys())}")
                return
            
            # Fallback to default profiles if no valid profiles were loaded
            self.logger.warning("No valid profiles found in registry, using defaults")
            self._load_default_profiles()
        except Exception as e:
            error_id = self._log_error("_load_principal_profiles", e)
            self._load_default_profiles()
            self.logger.warning(f"Using default profiles due to loading error {error_id}")

2025-09-02 12:00:06,892 - principal_context_agent_test - INFO - Available roles from agent: ['Chief Financial Officer', 'chief financial officer', 'Chief Executive Officer', 'chief executive officer', 'Chief Operating Officer', 'chief operating officer', 'Finance Manager', 'finance manager']
2025-09-02 12:00:06,894 - principal_context_agent_test - INFO - Testing with roles: ['Chief Financial Officer', 'chief financial officer', 'Chief Executive Officer']
2025-09-02 12:00:06,896 - principal_context_agent_test - INFO - 
Testing with role: Chief Financial Officer
2025-09-02 12:00:06,897 - principal_context_agent_test - INFO - Step 3: Testing fetch_principal_profile
2025-09-02 12:00:06,897 - principal_context_agent_test - INFO - === Testing fetch_principal_profile for role: Chief Financial Officer ===
2025-09-02 12:00:06,899 - principal_context_agent_test - INFO - Checking if 'Chief Financial Officer' exists in principal_profiles_by_id
2025-09-02 12:00:06,899 - principal_context_agent_test - INFO - Calling fetch_principal_profile for 'Chief Financial Officer'
2025-09-02 12:00:06,900 - principal_context_agent_test - INFO - Successfully fetched profile for Chief Financial Officer:
2025-09-02 12:00:06,900 - principal_context_agent_test - INFO -   Profile type: <class 'dict'>
2025-09-02 12:00:06,902 - principal_context_agent_test - INFO -   Name: Lars Mikkelsen
2025-09-02 12:00:06,902 - principal_context_agent_test - INFO -   Title: Chief Financial Officer
2025-09-02 12:00:06,904 - principal_context_agent_test - INFO -   Business Processes: ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals']
2025-09-02 12:00:06,905 - principal_context_agent_test - INFO -   Default Filters: {'profit_center_hierarchyid': ['Total'], 'customer_hierarchyid': ['Total']}
2025-09-02 12:00:06,906 - principal_context_agent_test - INFO -   Decision Style: Analytical
2025-09-02 12:00:06,907 - principal_context_agent_test - INFO -   Communication Style: Concise
2025-09-02 12:00:06,909 - principal_context_agent_test - INFO -   Timeframes: []
2025-09-02 12:00:06,910 - principal_context_agent_test - INFO - Step 4: Testing get_principal_context
2025-09-02 12:00:06,911 - principal_context_agent_test - INFO - === Testing get_principal_context for role: Chief Financial Officer ===
2025-09-02 12:00:06,911 - principal_context_agent_test - INFO - Calling get_principal_context with role: Chief Financial Officer
2025-09-02 12:00:06,912 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: Chief Financial Officer
2025-09-02 12:00:06,913 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'Chief Financial Officer'
2025-09-02 12:00:06,915 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['Chief Financial Officer', 'chief financial officer', 'Chief Executive Officer', 'chief executive officer', 'Chief Operating Officer', 'chief operating officer', 'Finance Manager', 'finance manager']
2025-09-02 12:00:06,917 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['Chief Financial Officer', 'chief financial officer', 'CHIEF FINANCIAL OFFICER', 'CHIEF_FINANCIAL_OFFICER', 'chief_financial_officer', 'cfo', 'CFO']
2025-09-02 12:00:06,918 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'Chief Financial Officer'
2025-09-02 12:00:06,919 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: Chief Financial Officer
2025-09-02 12:00:06,921 - principal_context_agent_test - ERROR - Error testing get_principal_context: 'str' object is not a mapping
2025-09-02 12:00:06,922 - principal_context_agent_test - INFO - Could not get context for Chief Financial Officer, continuing with next tests
2025-09-02 12:00:06,923 - principal_context_agent_test - INFO - 
Testing with role: chief financial officer
2025-09-02 12:00:06,924 - principal_context_agent_test - INFO - Step 3: Testing fetch_principal_profile
2025-09-02 12:00:06,925 - principal_context_agent_test - INFO - === Testing fetch_principal_profile for role: chief financial officer ===
2025-09-02 12:00:06,926 - principal_context_agent_test - INFO - Checking if 'chief financial officer' exists in principal_profiles_by_id
2025-09-02 12:00:06,927 - principal_context_agent_test - INFO - Calling fetch_principal_profile for 'chief financial officer'
2025-09-02 12:00:06,928 - principal_context_agent_test - INFO - Successfully fetched profile for chief financial officer:
2025-09-02 12:00:06,929 - principal_context_agent_test - INFO -   Profile type: <class 'dict'>
2025-09-02 12:00:06,931 - principal_context_agent_test - INFO -   Name: Lars Mikkelsen
2025-09-02 12:00:06,931 - principal_context_agent_test - INFO -   Title: Chief Financial Officer
2025-09-02 12:00:06,932 - principal_context_agent_test - INFO -   Business Processes: ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals']
2025-09-02 12:00:06,934 - principal_context_agent_test - INFO -   Default Filters: {'profit_center_hierarchyid': ['Total'], 'customer_hierarchyid': ['Total']}
2025-09-02 12:00:06,935 - principal_context_agent_test - INFO -   Decision Style: Analytical
2025-09-02 12:00:06,935 - principal_context_agent_test - INFO -   Communication Style: Concise
2025-09-02 12:00:06,936 - principal_context_agent_test - INFO -   Timeframes: []
2025-09-02 12:00:06,937 - principal_context_agent_test - INFO - Step 4: Testing get_principal_context
2025-09-02 12:00:06,937 - principal_context_agent_test - INFO - === Testing get_principal_context for role: chief financial officer ===
2025-09-02 12:00:06,938 - principal_context_agent_test - INFO - Calling get_principal_context with role: chief financial officer
2025-09-02 12:00:06,939 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: chief financial officer
2025-09-02 12:00:06,940 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'chief financial officer'
2025-09-02 12:00:06,942 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['Chief Financial Officer', 'chief financial officer', 'Chief Executive Officer', 'chief executive officer', 'Chief Operating Officer', 'chief operating officer', 'Finance Manager', 'finance manager']
2025-09-02 12:00:06,944 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['chief financial officer', 'CHIEF FINANCIAL OFFICER', 'CHIEF_FINANCIAL_OFFICER', 'Chief Financial Officer', 'chief_financial_officer', 'cfo', 'CFO']
2025-09-02 12:00:06,945 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'chief financial officer'
2025-09-02 12:00:06,946 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: chief financial officer
2025-09-02 12:00:06,947 - principal_context_agent_test - ERROR - Error testing get_principal_context: 'str' object is not a mapping
2025-09-02 12:00:06,950 - principal_context_agent_test - INFO - Could not get context for chief financial officer, continuing with next tests
2025-09-02 12:00:06,952 - principal_context_agent_test - INFO - 
Testing with role: Chief Executive Officer
2025-09-02 12:00:06,953 - principal_context_agent_test - INFO - Step 3: Testing fetch_principal_profile
2025-09-02 12:00:06,954 - principal_context_agent_test - INFO - === Testing fetch_principal_profile for role: Chief Executive Officer ===
2025-09-02 12:00:06,956 - principal_context_agent_test - INFO - Checking if 'Chief Executive Officer' exists in principal_profiles_by_id
2025-09-02 12:00:06,957 - principal_context_agent_test - INFO - Calling fetch_principal_profile for 'Chief Executive Officer'
2025-09-02 12:00:06,958 - principal_context_agent_test - INFO - Successfully fetched profile for Chief Executive Officer:
2025-09-02 12:00:06,960 - principal_context_agent_test - INFO -   Profile type: <class 'dict'>
2025-09-02 12:00:06,961 - principal_context_agent_test - INFO -   Name: Alex Morgan
2025-09-02 12:00:06,962 - principal_context_agent_test - INFO -   Title: Chief Executive Officer
2025-09-02 12:00:06,963 - principal_context_agent_test - INFO -   Business Processes: ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals']
2025-09-02 12:00:06,964 - principal_context_agent_test - INFO -   Default Filters: {'profit_center_hierarchyid': ['#']}
2025-09-02 12:00:06,965 - principal_context_agent_test - INFO -   Decision Style: Analytical
2025-09-02 12:00:06,966 - principal_context_agent_test - INFO -   Communication Style: Concise
2025-09-02 12:00:06,967 - principal_context_agent_test - INFO -   Timeframes: []
2025-09-02 12:00:06,967 - principal_context_agent_test - INFO - Step 4: Testing get_principal_context
2025-09-02 12:00:06,968 - principal_context_agent_test - INFO - === Testing get_principal_context for role: Chief Executive Officer ===
2025-09-02 12:00:06,969 - principal_context_agent_test - INFO - Calling get_principal_context with role: Chief Executive Officer
2025-09-02 12:00:06,969 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: Chief Executive Officer
2025-09-02 12:00:06,971 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'Chief Executive Officer'
2025-09-02 12:00:06,972 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['Chief Financial Officer', 'chief financial officer', 'Chief Executive Officer', 'chief executive officer', 'Chief Operating Officer', 'chief operating officer', 'Finance Manager', 'finance manager']
2025-09-02 12:00:06,973 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['Chief Executive Officer', 'chief executive officer', 'CHIEF EXECUTIVE OFFICER', 'CHIEF_EXECUTIVE_OFFICER', 'chief_executive_officer', 'ceo', 'CEO']
2025-09-02 12:00:06,975 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'Chief Executive Officer'
2025-09-02 12:00:06,976 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: Chief Executive Officer
2025-09-02 12:00:06,980 - principal_context_agent_test - ERROR - Error testing get_principal_context: 'str' object is not a mapping
2025-09-02 12:00:06,983 - principal_context_agent_test - INFO - Could not get context for Chief Executive Officer, continuing with next tests
2025-09-02 12:00:06,984 - principal_context_agent_test - INFO - 
Step 5: Testing case-insensitive profile lookup
2025-09-02 12:00:06,986 - principal_context_agent_test - INFO - === Testing case-insensitive profile lookup ===
2025-09-02 12:00:06,988 - principal_context_agent_test - INFO - Testing lookup with role format: 'CFO'
2025-09-02 12:00:06,991 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: CFO
2025-09-02 12:00:06,996 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'CFO'
2025-09-02 12:00:06,999 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['Chief Financial Officer', 'chief financial officer', 'Chief Executive Officer', 'chief executive officer', 'Chief Operating Officer', 'chief operating officer', 'Finance Manager', 'finance manager']
2025-09-02 12:00:07,002 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['CFO', 'cfo', 'Cfo', 'Chief Financial Officer']
2025-09-02 12:00:07,005 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'Chief Financial Officer'
2025-09-02 12:00:07,006 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: CFO
2025-09-02 12:00:07,044 - principal_context_agent_test - INFO - Testing lookup with role format: 'cfo'
2025-09-02 12:00:07,045 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: cfo
2025-09-02 12:00:07,048 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'cfo'
2025-09-02 12:00:07,050 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['Chief Financial Officer', 'chief financial officer', 'Chief Executive Officer', 'chief executive officer', 'Chief Operating Officer', 'chief operating officer', 'Finance Manager', 'finance manager']
2025-09-02 12:00:07,054 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['cfo', 'CFO', 'Cfo', 'Chief Financial Officer']
2025-09-02 12:00:07,056 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'Chief Financial Officer'
2025-09-02 12:00:07,057 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: cfo
2025-09-02 12:00:07,091 - principal_context_agent_test - INFO - Testing lookup with role format: 'Cfo'
2025-09-02 12:00:07,095 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: Cfo
2025-09-02 12:00:07,098 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'Cfo'
2025-09-02 12:00:07,100 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['Chief Financial Officer', 'chief financial officer', 'Chief Executive Officer', 'chief executive officer', 'Chief Operating Officer', 'chief operating officer', 'Finance Manager', 'finance manager']
2025-09-02 12:00:07,113 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['Cfo', 'cfo', 'CFO', 'Chief Financial Officer']
2025-09-02 12:00:07,115 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'Chief Financial Officer'
2025-09-02 12:00:07,117 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: Cfo
2025-09-02 12:00:07,141 - principal_context_agent_test - INFO - Testing lookup with role format: 'FINANCE_MANAGER'
2025-09-02 12:00:07,143 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: FINANCE_MANAGER
2025-09-02 12:00:07,145 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'FINANCE_MANAGER'
2025-09-02 12:00:07,147 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['Chief Financial Officer', 'chief financial officer', 'Chief Executive Officer', 'chief executive officer', 'Chief Operating Officer', 'chief operating officer', 'Finance Manager', 'finance manager']
2025-09-02 12:00:07,150 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['FINANCE_MANAGER', 'finance_manager', 'Finance Manager', 'finance manager']
2025-09-02 12:00:07,156 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'Finance Manager'
2025-09-02 12:00:07,158 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: FINANCE_MANAGER
2025-09-02 12:00:07,161 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Mapped role directly to enum: Finance Manager -> PrincipalRole.FINANCE_MANAGER
2025-09-02 12:00:07,220 - principal_context_agent_test - INFO - Testing lookup with role format: 'Finance Manager'
2025-09-02 12:00:07,221 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: Finance Manager
2025-09-02 12:00:07,224 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'Finance Manager'
2025-09-02 12:00:07,226 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['Chief Financial Officer', 'chief financial officer', 'Chief Executive Officer', 'chief executive officer', 'Chief Operating Officer', 'chief operating officer', 'Finance Manager', 'finance manager']
2025-09-02 12:00:07,227 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['Finance Manager', 'finance manager', 'FINANCE MANAGER', 'FINANCE_MANAGER', 'finance_manager']
2025-09-02 12:00:07,229 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'Finance Manager'
2025-09-02 12:00:07,231 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: Finance Manager
2025-09-02 12:00:07,233 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Mapped role directly to enum: Finance Manager -> PrincipalRole.FINANCE_MANAGER
2025-09-02 12:00:07,285 - principal_context_agent_test - INFO - Testing lookup with role format: 'finance manager'
2025-09-02 12:00:07,286 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: finance manager
2025-09-02 12:00:07,287 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'finance manager'
2025-09-02 12:00:07,288 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['Chief Financial Officer', 'chief financial officer', 'Chief Executive Officer', 'chief executive officer', 'Chief Operating Officer', 'chief operating officer', 'Finance Manager', 'finance manager']
2025-09-02 12:00:07,290 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['finance manager', 'FINANCE MANAGER', 'FINANCE_MANAGER', 'Finance Manager', 'finance_manager']
2025-09-02 12:00:07,293 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'finance manager'
2025-09-02 12:00:07,294 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: finance manager
2025-09-02 12:00:07,295 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Mapped role directly to enum: Finance Manager -> PrincipalRole.FINANCE_MANAGER
2025-09-02 12:00:07,338 - principal_context_agent_test - INFO - Testing lookup with non-existent role: 'INVALID_ROLE'
2025-09-02 12:00:07,339 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: INVALID_ROLE
2025-09-02 12:00:07,340 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'INVALID_ROLE'
2025-09-02 12:00:07,341 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['Chief Financial Officer', 'chief financial officer', 'Chief Executive Officer', 'chief executive officer', 'Chief Operating Officer', 'chief operating officer', 'Finance Manager', 'finance manager']
2025-09-02 12:00:07,344 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['INVALID_ROLE', 'invalid_role', 'Invalid Role']
2025-09-02 12:00:07,346 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - WARNING - Principal profile not found for any variation of: 'INVALID_ROLE'
2025-09-02 12:00:07,348 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profiles: ['Chief Financial Officer', 'Chief Financial Officer', 'Chief Executive Officer', 'Chief Executive Officer', 'Chief Operating Officer', 'Chief Operating Officer', 'Finance Manager', 'Finance Manager']
2025-09-02 12:00:07,349 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - WARNING - Principal profile not found for role: INVALID_ROLE
2025-09-02 12:00:07,351 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Using default principal ID: default_id
2025-09-02 12:00:07,354 - principal_context_agent_test - ERROR - Error testing non-existent role: 'str' object is not a mapping
2025-09-02 12:00:07,356 - principal_context_agent_test - INFO - 
Step 6: Testing extract_filters
2025-09-02 12:00:07,358 - principal_context_agent_test - INFO - === Testing extract_filters ===
2025-09-02 12:00:07,358 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Extracting filters from description: 
    Analyze the Q2 financial performance for the ...
2025-09-02 12:00:07,362 - principal_context_agent_test - INFO - Response status: success
2025-09-02 12:00:07,363 - principal_context_agent_test - INFO - Response message: Extracted 1 filters from description
2025-09-02 12:00:07,364 - principal_context_agent_test - INFO - Extracted filters: {'region': ['North America']}
2025-09-02 12:00:07,368 - principal_context_agent_test - INFO - Extracted filter objects: [{'dimension': 'region', 'value': 'North America', 'confidence': 0.8, 'extraction_method': 'rule_based'}]
2025-09-02 12:00:07,371 - principal_context_agent_test - INFO - All tests completed successfully
2025-09-02 12:05:24,683 - asyncio - DEBUG - Using proactor: IocpProactor
2025-09-02 12:05:24,686 - principal_context_agent_test - INFO - Starting Principal Context Agent tests
2025-09-02 12:05:24,686 - principal_context_agent_test - INFO - Step 1: Testing registry structure
2025-09-02 12:05:24,688 - principal_context_agent_test - INFO - === Testing registry structure ===
2025-09-02 12:05:24,689 - principal_context_agent_test - INFO - Initializing registry bootstrap
2025-09-02 12:05:24,690 - src.registry.factory - INFO - Registry Factory initialized
2025-09-02 12:05:24,691 - src.registry.factory - INFO - Registered principal_profile provider
2025-09-02 12:05:24,691 - src.registry.providers.principal_provider - INFO - Loading principal profiles from C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\principal\principal_registry.yaml (yaml)
2025-09-02 12:05:24,731 - src.registry.providers.principal_provider - INFO - Found 4 roles in YAML under 'roles' key
2025-09-02 12:05:24,733 - src.registry.providers.principal_provider - DEBUG - Registered role: cfo_001 - CFO
2025-09-02 12:05:24,734 - src.registry.providers.principal_provider - DEBUG - Registered role: ceo_001 - CEO
2025-09-02 12:05:24,734 - src.registry.providers.principal_provider - DEBUG - Registered role: coo_001 - COO
2025-09-02 12:05:24,735 - src.registry.providers.principal_provider - DEBUG - Registered role: finance_manager_001 - Finance Manager
2025-09-02 12:05:24,735 - src.registry.providers.principal_provider - INFO - Found 4 principal profiles in YAML under 'principals' key
2025-09-02 12:05:24,736 - src.registry.providers.principal_provider - DEBUG - Mapped role name CFO to principal ID cfo_001
2025-09-02 12:05:24,736 - src.registry.providers.principal_provider - INFO - Registered principal: cfo_001 - Lars Mikkelsen
2025-09-02 12:05:24,737 - src.registry.providers.principal_provider - DEBUG - Mapped role name CEO to principal ID ceo_001
2025-09-02 12:05:24,737 - src.registry.providers.principal_provider - INFO - Registered principal: ceo_001 - Alex Morgan
2025-09-02 12:05:24,738 - src.registry.providers.principal_provider - DEBUG - Mapped role name COO to principal ID coo_001
2025-09-02 12:05:24,739 - src.registry.providers.principal_provider - INFO - Registered principal: coo_001 - Priya Desai
2025-09-02 12:05:24,740 - src.registry.providers.principal_provider - DEBUG - Mapped role name Finance Manager to principal ID finance_manager_001
2025-09-02 12:05:24,741 - src.registry.providers.principal_provider - INFO - Registered principal: finance_manager_001 - Emily Chen
2025-09-02 12:05:24,745 - src.registry.providers.principal_provider - INFO - Added role ID mapping: cfo_001 -> Lars Mikkelsen
2025-09-02 12:05:24,747 - src.registry.providers.principal_provider - INFO - Added role ID mapping: ceo_001 -> Alex Morgan
2025-09-02 12:05:24,747 - src.registry.providers.principal_provider - INFO - Added role ID mapping: coo_001 -> Priya Desai
2025-09-02 12:05:24,748 - src.registry.providers.principal_provider - INFO - Added role ID mapping: finance_manager_001 -> Emily Chen
2025-09-02 12:05:24,749 - src.registry.providers.principal_provider - INFO - Loaded 4 principal profiles
2025-09-02 12:05:24,749 - src.registry.bootstrap - INFO - Initialized principal provider with 4 profiles
2025-09-02 12:05:24,756 - src.registry.factory - WARNING - Provider 'business_glossary' not found in registry factory
2025-09-02 12:05:24,757 - src.registry.bootstrap - INFO - Initializing business glossary provider
2025-09-02 12:05:24,764 - src.registry.providers.business_glossary_provider - INFO - Loaded 4 business terms from glossary
2025-09-02 12:05:24,765 - src.registry.factory - INFO - Registered business_glossary provider
2025-09-02 12:05:24,766 - src.registry.bootstrap - INFO - Initialized business glossary provider with 4 terms
2025-09-02 12:05:24,770 - src.registry.factory - INFO - Registered data_product provider
2025-09-02 12:05:24,770 - src.registry.providers.data_product_provider - INFO - Loading data products from C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\data_product\data_product_registry.yaml (yaml)
2025-09-02 12:05:24,788 - src.registry.providers.data_product_provider - INFO - Loaded 1 data products
2025-09-02 12:05:24,788 - src.registry.bootstrap - INFO - Initialized data product provider with 1 data products
2025-09-02 12:05:24,789 - src.registry.bootstrap - INFO - Initializing KPI provider
2025-09-02 12:05:24,789 - src.registry.factory - WARNING - Provider 'kpi' not found in registry factory
2025-09-02 12:05:24,791 - src.registry.bootstrap - INFO - Creating KPI provider with file at C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\kpi\kpi_registry.yaml
2025-09-02 12:05:24,791 - src.registry.bootstrap - INFO - Registering KPI provider with registry factory
2025-09-02 12:05:24,792 - src.registry.factory - INFO - Registered kpi provider
2025-09-02 12:05:24,792 - src.registry.bootstrap - INFO - Loading KPI provider data
2025-09-02 12:05:24,792 - src.registry.providers.kpi_provider - INFO - Loading KPIs from C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\kpi\kpi_registry.yaml (yaml)
2025-09-02 12:05:24,834 - src.registry.providers.kpi_provider - INFO - Loaded 6 KPIs
2025-09-02 12:05:24,835 - src.registry.bootstrap - INFO - KPI provider successfully registered and initialized with 6 KPIs
2025-09-02 12:05:24,836 - src.registry.bootstrap - INFO - Initializing agent bootstrap
2025-09-02 12:05:24,838 - src.agents.agent_bootstrap - WARNING - No agent implementations discovered
2025-09-02 12:05:24,839 - src.registry.bootstrap - WARNING - Agent bootstrap initialization had issues, continuing with available agents
2025-09-02 12:05:24,840 - src.registry.bootstrap - INFO - Registry providers and agent factories initialized successfully
2025-09-02 12:05:24,841 - principal_context_agent_test - INFO - Registry bootstrap initialized successfully
2025-09-02 12:05:24,842 - principal_context_agent_test - INFO - Got RegistryFactory from bootstrap
2025-09-02 12:05:24,843 - principal_context_agent_test - INFO - Provider status: {'principal_profile': True, 'business_glossary': True, 'data_product': False, 'kpi': True}
2025-09-02 12:05:24,846 - principal_context_agent_test - INFO - principal_profile provider status: True
2025-09-02 12:05:24,851 - principal_context_agent_test - INFO - Got principal provider: <src.registry.providers.principal_provider.PrincipalProfileProvider object at 0x000001AB0F943490>
2025-09-02 12:05:24,853 - principal_context_agent_test - INFO - Provider methods: ['__abstractmethods__', '__class__', '__class_getitem__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__orig_bases__', '__parameters__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', '__weakref__', '_abc_impl', '_add_profile', '_extract_profiles_from_module', '_is_protocol', '_load_default_profiles', '_load_from_json', '_load_from_python_module', '_load_from_yaml', '_profiles', '_profiles_by_name', '_profiles_by_title', '_registry_base_path', 'find_by_attribute', 'find_by_business_process', 'find_by_kpi', 'get', 'get_all', 'get_registry_path', 'initialize', 'load', 'register', 'source_path', 'storage_format']
2025-09-02 12:05:24,856 - principal_context_agent_test - INFO - Principal registry file exists at: C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\principal\principal_registry.yaml
2025-09-02 12:05:24,858 - principal_context_agent_test - INFO - Registry file content length: 6517 bytes
2025-09-02 12:05:24,860 - principal_context_agent_test - INFO - Registry file first 100 chars: # Principal Registry
# Contains all principal profiles for personalization and context-aware process...
2025-09-02 12:05:24,861 - principal_context_agent_test - INFO - Got registry data type: <class 'list'>
2025-09-02 12:05:24,862 - principal_context_agent_test - INFO - Found 4 principals in registry
2025-09-02 12:05:24,863 - principal_context_agent_test - INFO - Principal 1 details:
2025-09-02 12:05:24,863 - principal_context_agent_test - INFO -   ID: cfo_001
2025-09-02 12:05:24,864 - principal_context_agent_test - INFO -   Name: Lars Mikkelsen
2025-09-02 12:05:24,865 - principal_context_agent_test - INFO -   Role: N/A
2025-09-02 12:05:24,866 - principal_context_agent_test - INFO -   Title: Chief Financial Officer
2025-09-02 12:05:24,869 - principal_context_agent_test - INFO -   Business Processes: ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals']
2025-09-02 12:05:24,875 - principal_context_agent_test - INFO -   All attributes: ['__abstractmethods__', '__annotations__', '__class__', '__class_getitem__', '__class_vars__', '__copy__', '__deepcopy__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__fields__', '__fields_set__', '__format__', '__ge__', '__get_pydantic_core_schema__', '__get_pydantic_json_schema__', '__getattr__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__iter__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__pretty__', '__private_attributes__', '__pydantic_complete__', '__pydantic_computed_fields__', '__pydantic_core_schema__', '__pydantic_custom_init__', '__pydantic_decorators__', '__pydantic_extra__', '__pydantic_fields__', '__pydantic_fields_set__', '__pydantic_generic_metadata__', '__pydantic_init_subclass__', '__pydantic_parent_namespace__', '__pydantic_post_init__', '__pydantic_private__', '__pydantic_root_model__', '__pydantic_serializer__', '__pydantic_setattr_handlers__', '__pydantic_validator__', '__reduce__', '__reduce_ex__', '__replace__', '__repr__', '__repr_args__', '__repr_name__', '__repr_recursion__', '__repr_str__', '__rich_repr__', '__setattr__', '__setstate__', '__signature__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', '__weakref__', '_abc_impl', '_calculate_keys', '_copy_and_set_values', '_get_value', '_iter', '_setattr_handler', 'business_processes', 'communication', 'construct', 'copy', 'default_filters', 'description', 'dict', 'from_orm', 'id', 'json', 'kpis', 'metadata', 'model_computed_fields', 'model_config', 'model_construct', 'model_copy', 'model_dump', 'model_dump_json', 'model_extra', 'model_fields', 'model_fields_set', 'model_json_schema', 'model_parametrized_name', 'model_post_init', 'model_rebuild', 'model_validate', 'model_validate_json', 'model_validate_strings', 'name', 'parse_file', 'parse_obj', 'parse_raw', 'responsibilities', 'schema', 'schema_json', 'time_frame', 'title', 'to_dict', 'update_forward_refs', 'validate']
2025-09-02 12:05:24,882 - principal_context_agent_test - INFO -   Dict representation: {'id': 'cfo_001', 'name': 'Lars Mikkelsen', 'title': 'Chief Financial Officer', 'description': 'CFO responsible for financial performance in EMEA.', 'business_processes': ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals'], 'kpis': [], 'responsibilities': ['maximize EBIT', 'manage revenue', 'control expenses'], 'default_filters': {'profit_center_hierarchyid': ['Total'], 'customer_hierarchyid': ['Total']}, 'time_frame': {'default_period': 'QTD', 'historical_periods': 4, 'forward_looking_periods': 2}, 'communication': {'detail_level': 'high', 'format_preference': ['visual', 'text', 'table'], 'emphasis': ['trends', 'anomalies', 'forecasts']}, 'metadata': {}}
2025-09-02 12:05:24,889 - principal_context_agent_test - INFO -   __dict__ representation: {'id': 'cfo_001', 'name': 'Lars Mikkelsen', 'title': 'Chief Financial Officer', 'description': 'CFO responsible for financial performance in EMEA.', 'business_processes': ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals'], 'kpis': [], 'responsibilities': ['maximize EBIT', 'manage revenue', 'control expenses'], 'default_filters': {'profit_center_hierarchyid': ['Total'], 'customer_hierarchyid': ['Total']}, 'time_frame': TimeFrame(default_period='QTD', historical_periods=4, forward_looking_periods=2), 'communication': CommunicationPreference(detail_level='high', format_preference=['visual', 'text', 'table'], emphasis=['trends', 'anomalies', 'forecasts']), 'metadata': {}}
2025-09-02 12:05:24,894 - principal_context_agent_test - INFO - Principal 2 details:
2025-09-02 12:05:24,895 - principal_context_agent_test - INFO -   ID: ceo_001
2025-09-02 12:05:24,896 - principal_context_agent_test - INFO -   Name: Alex Morgan
2025-09-02 12:05:24,897 - principal_context_agent_test - INFO -   Role: N/A
2025-09-02 12:05:24,898 - principal_context_agent_test - INFO -   Title: Chief Executive Officer
2025-09-02 12:05:24,899 - principal_context_agent_test - INFO -   Business Processes: ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals']
2025-09-02 12:05:24,904 - principal_context_agent_test - INFO -   All attributes: ['__abstractmethods__', '__annotations__', '__class__', '__class_getitem__', '__class_vars__', '__copy__', '__deepcopy__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__fields__', '__fields_set__', '__format__', '__ge__', '__get_pydantic_core_schema__', '__get_pydantic_json_schema__', '__getattr__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__iter__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__pretty__', '__private_attributes__', '__pydantic_complete__', '__pydantic_computed_fields__', '__pydantic_core_schema__', '__pydantic_custom_init__', '__pydantic_decorators__', '__pydantic_extra__', '__pydantic_fields__', '__pydantic_fields_set__', '__pydantic_generic_metadata__', '__pydantic_init_subclass__', '__pydantic_parent_namespace__', '__pydantic_post_init__', '__pydantic_private__', '__pydantic_root_model__', '__pydantic_serializer__', '__pydantic_setattr_handlers__', '__pydantic_validator__', '__reduce__', '__reduce_ex__', '__replace__', '__repr__', '__repr_args__', '__repr_name__', '__repr_recursion__', '__repr_str__', '__rich_repr__', '__setattr__', '__setstate__', '__signature__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', '__weakref__', '_abc_impl', '_calculate_keys', '_copy_and_set_values', '_get_value', '_iter', '_setattr_handler', 'business_processes', 'communication', 'construct', 'copy', 'default_filters', 'description', 'dict', 'from_orm', 'id', 'json', 'kpis', 'metadata', 'model_computed_fields', 'model_config', 'model_construct', 'model_copy', 'model_dump', 'model_dump_json', 'model_extra', 'model_fields', 'model_fields_set', 'model_json_schema', 'model_parametrized_name', 'model_post_init', 'model_rebuild', 'model_validate', 'model_validate_json', 'model_validate_strings', 'name', 'parse_file', 'parse_obj', 'parse_raw', 'responsibilities', 'schema', 'schema_json', 'time_frame', 'title', 'to_dict', 'update_forward_refs', 'validate']
2025-09-02 12:05:24,914 - principal_context_agent_test - INFO -   Dict representation: {'id': 'ceo_001', 'name': 'Alex Morgan', 'title': 'Chief Executive Officer', 'description': 'CEO driving company strategy and performance.', 'business_processes': ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals'], 'kpis': [], 'responsibilities': ['set strategic direction', 'oversee company performance', 'lead executive team'], 'default_filters': {'profit_center_hierarchyid': ['#']}, 'time_frame': {'default_period': 'YTD', 'historical_periods': 3, 'forward_looking_periods': 4}, 'communication': {'detail_level': 'medium', 'format_preference': ['visual', 'summary'], 'emphasis': ['trends', 'strategic_impact']}, 'metadata': {}}
2025-09-02 12:05:24,919 - principal_context_agent_test - INFO -   __dict__ representation: {'id': 'ceo_001', 'name': 'Alex Morgan', 'title': 'Chief Executive Officer', 'description': 'CEO driving company strategy and performance.', 'business_processes': ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals'], 'kpis': [], 'responsibilities': ['set strategic direction', 'oversee company performance', 'lead executive team'], 'default_filters': {'profit_center_hierarchyid': ['#']}, 'time_frame': TimeFrame(default_period='YTD', historical_periods=3, forward_looking_periods=4), 'communication': CommunicationPreference(detail_level='medium', format_preference=['visual', 'summary'], emphasis=['trends', 'strategic_impact']), 'metadata': {}}
2025-09-02 12:05:24,920 - principal_context_agent_test - INFO - Principal 3 details:
2025-09-02 12:05:24,922 - principal_context_agent_test - INFO -   ID: coo_001
2025-09-02 12:05:24,923 - principal_context_agent_test - INFO -   Name: Priya Desai
2025-09-02 12:05:24,923 - principal_context_agent_test - INFO -   Role: N/A
2025-09-02 12:05:24,924 - principal_context_agent_test - INFO -   Title: Chief Operating Officer
2025-09-02 12:05:24,925 - principal_context_agent_test - INFO -   Business Processes: ['finance_expense_management', 'finance_cash_flow', 'finance_budget_vs_actuals']
2025-09-02 12:05:24,930 - principal_context_agent_test - INFO -   All attributes: ['__abstractmethods__', '__annotations__', '__class__', '__class_getitem__', '__class_vars__', '__copy__', '__deepcopy__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__fields__', '__fields_set__', '__format__', '__ge__', '__get_pydantic_core_schema__', '__get_pydantic_json_schema__', '__getattr__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__iter__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__pretty__', '__private_attributes__', '__pydantic_complete__', '__pydantic_computed_fields__', '__pydantic_core_schema__', '__pydantic_custom_init__', '__pydantic_decorators__', '__pydantic_extra__', '__pydantic_fields__', '__pydantic_fields_set__', '__pydantic_generic_metadata__', '__pydantic_init_subclass__', '__pydantic_parent_namespace__', '__pydantic_post_init__', '__pydantic_private__', '__pydantic_root_model__', '__pydantic_serializer__', '__pydantic_setattr_handlers__', '__pydantic_validator__', '__reduce__', '__reduce_ex__', '__replace__', '__repr__', '__repr_args__', '__repr_name__', '__repr_recursion__', '__repr_str__', '__rich_repr__', '__setattr__', '__setstate__', '__signature__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', '__weakref__', '_abc_impl', '_calculate_keys', '_copy_and_set_values', '_get_value', '_iter', '_setattr_handler', 'business_processes', 'communication', 'construct', 'copy', 'default_filters', 'description', 'dict', 'from_orm', 'id', 'json', 'kpis', 'metadata', 'model_computed_fields', 'model_config', 'model_construct', 'model_copy', 'model_dump', 'model_dump_json', 'model_extra', 'model_fields', 'model_fields_set', 'model_json_schema', 'model_parametrized_name', 'model_post_init', 'model_rebuild', 'model_validate', 'model_validate_json', 'model_validate_strings', 'name', 'parse_file', 'parse_obj', 'parse_raw', 'responsibilities', 'schema', 'schema_json', 'time_frame', 'title', 'to_dict', 'update_forward_refs', 'validate']
2025-09-02 12:05:24,935 - principal_context_agent_test - INFO -   Dict representation: {'id': 'coo_001', 'name': 'Priya Desai', 'title': 'Chief Operating Officer', 'description': 'COO focused on operational excellence and efficiency.', 'business_processes': ['finance_expense_management', 'finance_cash_flow', 'finance_budget_vs_actuals'], 'kpis': [], 'responsibilities': ['optimize operations', 'reduce operational costs', 'improve process efficiency'], 'default_filters': {'profit_center_hierarchyid': ['Best Run U'], 'customer_hierarchyid': ['17100001']}, 'time_frame': {'default_period': 'MTD', 'historical_periods': 6, 'forward_looking_periods': 2}, 'communication': {'detail_level': 'high', 'format_preference': ['table', 'visual'], 'emphasis': ['variances', 'operational_metrics']}, 'metadata': {}}
2025-09-02 12:05:24,938 - principal_context_agent_test - INFO -   __dict__ representation: {'id': 'coo_001', 'name': 'Priya Desai', 'title': 'Chief Operating Officer', 'description': 'COO focused on operational excellence and efficiency.', 'business_processes': ['finance_expense_management', 'finance_cash_flow', 'finance_budget_vs_actuals'], 'kpis': [], 'responsibilities': ['optimize operations', 'reduce operational costs', 'improve process efficiency'], 'default_filters': {'profit_center_hierarchyid': ['Best Run U'], 'customer_hierarchyid': ['17100001']}, 'time_frame': TimeFrame(default_period='MTD', historical_periods=6, forward_looking_periods=2), 'communication': CommunicationPreference(detail_level='high', format_preference=['table', 'visual'], emphasis=['variances', 'operational_metrics']), 'metadata': {}}
2025-09-02 12:05:24,939 - principal_context_agent_test - INFO - Principal 4 details:
2025-09-02 12:05:24,940 - principal_context_agent_test - INFO -   ID: finance_manager_001
2025-09-02 12:05:24,942 - principal_context_agent_test - INFO -   Name: Emily Chen
2025-09-02 12:05:24,943 - principal_context_agent_test - INFO -   Role: N/A
2025-09-02 12:05:24,944 - principal_context_agent_test - INFO -   Title: Finance Manager
2025-09-02 12:05:24,945 - principal_context_agent_test - INFO -   Business Processes: ['Finance: Expense Management', 'Finance: Budget vs. Actuals', 'Finance: Cash Flow Management']
2025-09-02 12:05:24,948 - principal_context_agent_test - INFO -   All attributes: ['__abstractmethods__', '__annotations__', '__class__', '__class_getitem__', '__class_vars__', '__copy__', '__deepcopy__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__fields__', '__fields_set__', '__format__', '__ge__', '__get_pydantic_core_schema__', '__get_pydantic_json_schema__', '__getattr__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__iter__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__pretty__', '__private_attributes__', '__pydantic_complete__', '__pydantic_computed_fields__', '__pydantic_core_schema__', '__pydantic_custom_init__', '__pydantic_decorators__', '__pydantic_extra__', '__pydantic_fields__', '__pydantic_fields_set__', '__pydantic_generic_metadata__', '__pydantic_init_subclass__', '__pydantic_parent_namespace__', '__pydantic_post_init__', '__pydantic_private__', '__pydantic_root_model__', '__pydantic_serializer__', '__pydantic_setattr_handlers__', '__pydantic_validator__', '__reduce__', '__reduce_ex__', '__replace__', '__repr__', '__repr_args__', '__repr_name__', '__repr_recursion__', '__repr_str__', '__rich_repr__', '__setattr__', '__setstate__', '__signature__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', '__weakref__', '_abc_impl', '_calculate_keys', '_copy_and_set_values', '_get_value', '_iter', '_setattr_handler', 'business_processes', 'communication', 'construct', 'copy', 'default_filters', 'description', 'dict', 'from_orm', 'id', 'json', 'kpis', 'metadata', 'model_computed_fields', 'model_config', 'model_construct', 'model_copy', 'model_dump', 'model_dump_json', 'model_extra', 'model_fields', 'model_fields_set', 'model_json_schema', 'model_parametrized_name', 'model_post_init', 'model_rebuild', 'model_validate', 'model_validate_json', 'model_validate_strings', 'name', 'parse_file', 'parse_obj', 'parse_raw', 'responsibilities', 'schema', 'schema_json', 'time_frame', 'title', 'to_dict', 'update_forward_refs', 'validate']
2025-09-02 12:05:24,956 - principal_context_agent_test - INFO -   Dict representation: {'id': 'finance_manager_001', 'name': 'Emily Chen', 'title': 'Finance Manager', 'description': 'Finance Manager responsible for departmental financial analysis and reporting.', 'business_processes': ['Finance: Expense Management', 'Finance: Budget vs. Actuals', 'Finance: Cash Flow Management'], 'kpis': [], 'responsibilities': ['manage departmental budget', 'analyze financial data', 'prepare financial reports'], 'default_filters': {'profit_center_hierarchyid': ['Finance'], 'customer_hierarchyid': ['Total']}, 'time_frame': {'default_period': 'MTD', 'historical_periods': 6, 'forward_looking_periods': 3}, 'communication': {'detail_level': 'high', 'format_preference': ['table', 'visual', 'text'], 'emphasis': ['variances', 'trends', 'forecasts']}, 'metadata': {}}
2025-09-02 12:05:24,960 - principal_context_agent_test - INFO -   __dict__ representation: {'id': 'finance_manager_001', 'name': 'Emily Chen', 'title': 'Finance Manager', 'description': 'Finance Manager responsible for departmental financial analysis and reporting.', 'business_processes': ['Finance: Expense Management', 'Finance: Budget vs. Actuals', 'Finance: Cash Flow Management'], 'kpis': [], 'responsibilities': ['manage departmental budget', 'analyze financial data', 'prepare financial reports'], 'default_filters': {'profit_center_hierarchyid': ['Finance'], 'customer_hierarchyid': ['Total']}, 'time_frame': TimeFrame(default_period='MTD', historical_periods=6, forward_looking_periods=3), 'communication': CommunicationPreference(detail_level='high', format_preference=['table', 'visual', 'text'], emphasis=['variances', 'trends', 'forecasts']), 'metadata': {}}
2025-09-02 12:05:24,964 - principal_context_agent_test - INFO - 
Step 2: Testing Agent Initialization
2025-09-02 12:05:24,965 - principal_context_agent_test - INFO - === Testing loading principal profiles ===
2025-09-02 12:05:24,969 - principal_context_agent_test - INFO - Creating Principal Context Agent
2025-09-02 12:05:24,970 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Initializing A9_Principal_Context_Agent
2025-09-02 12:05:24,970 - principal_context_agent_test - INFO - Connecting agent
2025-09-02 12:05:24,971 - src.registry.bootstrap - INFO - Registry bootstrap already initialized
2025-09-02 12:05:24,972 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Loaded 4 principal profiles from registry
2025-09-02 12:05:24,974 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Profile 0: id=cfo_001, role=unknown, title=Chief Financial Officer, name=Lars Mikkelsen
2025-09-02 12:05:24,975 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Profile 1: id=ceo_001, role=unknown, title=Chief Executive Officer, name=Alex Morgan
2025-09-02 12:05:24,977 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Profile 2: id=coo_001, role=unknown, title=Chief Operating Officer, name=Priya Desai
2025-09-02 12:05:24,978 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Profile 3: id=finance_manager_001, role=unknown, title=Finance Manager, name=Emily Chen
2025-09-02 12:05:24,979 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Processing principal: id=cfo_001, role=None, title=Chief Financial Officer
2025-09-02 12:05:24,981 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Added profile by ID: cfo_001
2025-09-02 12:05:24,982 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Added profile by title (exact): Chief Financial Officer
2025-09-02 12:05:24,985 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Added profile by title (lowercase): chief financial officer
2025-09-02 12:05:24,986 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Processing principal: id=ceo_001, role=None, title=Chief Executive Officer
2025-09-02 12:05:24,988 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Added profile by ID: ceo_001
2025-09-02 12:05:24,989 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Added profile by title (exact): Chief Executive Officer
2025-09-02 12:05:24,990 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Added profile by title (lowercase): chief executive officer
2025-09-02 12:05:24,992 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Processing principal: id=coo_001, role=None, title=Chief Operating Officer
2025-09-02 12:05:24,993 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Added profile by ID: coo_001
2025-09-02 12:05:24,994 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Added profile by title (exact): Chief Operating Officer
2025-09-02 12:05:24,994 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Added profile by title (lowercase): chief operating officer
2025-09-02 12:05:24,996 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Processing principal: id=finance_manager_001, role=None, title=Finance Manager
2025-09-02 12:05:24,997 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Added profile by ID: finance_manager_001
2025-09-02 12:05:24,999 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Added profile by title (exact): Finance Manager
2025-09-02 12:05:25,002 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Added profile by title (lowercase): finance manager
2025-09-02 12:05:25,005 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Loaded 4 principal profiles by ID from registry
2025-09-02 12:05:25,006 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Loaded 8 principal profiles by role from registry
2025-09-02 12:05:25,008 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Available profile IDs: ['cfo_001', 'ceo_001', 'coo_001', 'finance_manager_001']
2025-09-02 12:05:25,011 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Available role keys: ['Chief Financial Officer', 'chief financial officer', 'Chief Executive Officer', 'chief executive officer', 'Chief Operating Officer', 'chief operating officer', 'Finance Manager', 'finance manager']
2025-09-02 12:05:25,013 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Connected to dependencies
2025-09-02 12:05:25,017 - principal_context_agent_test - INFO - Loaded 8 principal profiles in principal_profiles dictionary
2025-09-02 12:05:25,019 - principal_context_agent_test - INFO - Loaded 4 principal profiles in principal_profiles_by_id dictionary
2025-09-02 12:05:25,019 - principal_context_agent_test - INFO - Keys in principal_profiles_by_id: ['cfo_001', 'ceo_001', 'coo_001', 'finance_manager_001']
2025-09-02 12:05:25,020 - principal_context_agent_test - INFO - Available roles in principal_profiles: ['Chief Financial Officer', 'chief financial officer', 'Chief Executive Officer', 'chief executive officer', 'Chief Operating Officer', 'chief operating officer', 'Finance Manager', 'finance manager']
2025-09-02 12:05:25,022 - principal_context_agent_test - INFO - Sample profile for Chief Financial Officer:
2025-09-02 12:05:25,023 - principal_context_agent_test - INFO -   id: cfo_001
2025-09-02 12:05:25,023 - principal_context_agent_test - INFO -   role: Chief Financial Officer
2025-09-02 12:05:25,024 - principal_context_agent_test - INFO -   name: Lars Mikkelsen
2025-09-02 12:05:25,026 - principal_context_agent_test - INFO -   title: Chief Financial Officer
2025-09-02 12:05:25,027 - principal_context_agent_test - INFO -   business_processes: ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals']
2025-09-02 12:05:25,029 - principal_context_agent_test - INFO -   default_filters: {'profit_center_hierarchyid': ['Total'], 'customer_hierarchyid': ['Total']}
2025-09-02 12:05:25,030 - principal_context_agent_test - INFO -   decision_style: Analytical
2025-09-02 12:05:25,031 - principal_context_agent_test - INFO -   communication_style: Concise
2025-09-02 12:05:25,033 - principal_context_agent_test - INFO -   description: CFO responsible for financial performance in EMEA.
2025-09-02 12:05:25,035 - principal_context_agent_test - INFO -   timeframes: []
2025-09-02 12:05:25,035 - principal_context_agent_test - INFO - Inspecting _load_principal_profiles method
2025-09-02 12:05:25,057 - principal_context_agent_test - INFO - _load_principal_profiles method code:
    async def _load_principal_profiles(self):
        """Load principal profiles from registry."""
        try:
            # Try to get principal profiles from registry
            if not self._principal_provider:
                self.logger.warning("Principal profile provider not initialized")
                self._load_default_profiles()
                return
                
            # Get all profiles from the provider
            registry_data = self._principal_provider.get_all()
            self.logger.info(f"Loaded {len(registry_data) if registry_data else 0} principal profiles from registry")
            
            # Debug the registry data
            if not registry_data:
                self.logger.warning("No principal profiles found in registry")
                self._load_default_profiles()
                return
                
            if not isinstance(registry_data, list):
                self.logger.warning(f"Registry data is not a list: {type(registry_data)}")
                self._load_default_profiles()
                return
                
            # Debug: Log all profiles to see their structure
            for i, profile in enumerate(registry_data):
                self.logger.info(f"Profile {i}: id={getattr(profile, 'id', 'unknown')}, "
                                f"role={getattr(profile, 'role', 'unknown')}, "
                                f"title={getattr(profile, 'title', 'unknown')}, "
                                f"name={getattr(profile, 'name', 'unknown')}")
            
            # Convert to our internal dictionary format keyed by ID and role
            normalized_by_role = {}
            normalized_by_id = {}
            role_to_id = {}
            
            for principal in registry_data:
                # Use attribute access for Pydantic models instead of dictionary-style access
                principal_id = getattr(principal, 'id', None)
                role = getattr(principal, 'role', None)
                title = getattr(principal, 'title', None)
                
                self.logger.info(f"Processing principal: id={principal_id}, role={role}, title={title}")
                
                if not principal_id:
                    self.logger.warning(f"Principal missing ID: {getattr(principal, 'name', 'Unknown')} - {role or title}")
                    continue
                    
                # Create profile object
                profile = {
                    "id": principal_id,
                    "role": role or title,  # Use title as role if role is not available
                    "name": getattr(principal, 'name', None),
                    "title": title,
                    "business_processes": getattr(principal, 'business_processes', []),
                    "default_filters": getattr(principal, 'default_filters', {}),
                    "decision_style": getattr(getattr(principal, 'persona_profile', {}), 'decision_style', 'Analytical'),
                    "communication_style": getattr(getattr(principal, 'persona_profile', {}), 'communication_style', 'Concise'),
                    "description": getattr(principal, 'description', ''),
                    "timeframes": getattr(principal, 'typical_timeframes', [])
                }
                
                # Store by ID (primary index)
                normalized_by_id[principal_id] = profile
                self.logger.info(f"Added profile by ID: {principal_id}")
                
                # Store by role (secondary index for backward compatibility)
                if role:
                    # Store using exact role name
                    normalized_by_role[role] = profile
                    role_to_id[role] = principal_id
                    self.logger.info(f"Added profile by role (exact): {role}")
                    
                    # Also store using lowercase role name
                    role_lower = role.lower()
                    normalized_by_role[role_lower] = profile
                    role_to_id[role_lower] = principal_id
                    self.logger.info(f"Added profile by role (lowercase): {role_lower}")
                
                # Also store by title for additional lookup options
                if title:
                    # Store using exact title
                    normalized_by_role[title] = profile
                    role_to_id[title] = principal_id
                    self.logger.info(f"Added profile by title (exact): {title}")
                    
                    # Also store using lowercase title
                    title_lower = title.lower()
                    normalized_by_role[title_lower] = profile
                    role_to_id[title_lower] = principal_id
                    self.logger.info(f"Added profile by title (lowercase): {title_lower}")
            
            if normalized_by_id:
                self.principal_profiles = normalized_by_role
                self.principal_profiles_by_id = normalized_by_id
                self.role_to_id_map = role_to_id
                self.logger.info(f"Loaded {len(self.principal_profiles_by_id)} principal profiles by ID from registry")
                self.logger.info(f"Loaded {len(self.principal_profiles)} principal profiles by role from registry")
                self.logger.info(f"Available profile IDs: {list(self.principal_profiles_by_id.keys())}")
                self.logger.info(f"Available role keys: {list(self.principal_profiles.keys())}")
                return
            
            # Fallback to default profiles if no valid profiles were loaded
            self.logger.warning("No valid profiles found in registry, using defaults")
            self._load_default_profiles()
        except Exception as e:
            error_id = self._log_error("_load_principal_profiles", e)
            self._load_default_profiles()
            self.logger.warning(f"Using default profiles due to loading error {error_id}")

2025-09-02 12:05:25,088 - principal_context_agent_test - INFO - Available roles from agent: ['Chief Financial Officer', 'chief financial officer', 'Chief Executive Officer', 'chief executive officer', 'Chief Operating Officer', 'chief operating officer', 'Finance Manager', 'finance manager']
2025-09-02 12:05:25,090 - principal_context_agent_test - INFO - Testing with roles: ['Chief Financial Officer', 'chief financial officer', 'Chief Executive Officer']
2025-09-02 12:05:25,091 - principal_context_agent_test - INFO - 
Testing with role: Chief Financial Officer
2025-09-02 12:05:25,092 - principal_context_agent_test - INFO - Step 3: Testing fetch_principal_profile
2025-09-02 12:05:25,093 - principal_context_agent_test - INFO - === Testing fetch_principal_profile for role: Chief Financial Officer ===
2025-09-02 12:05:25,094 - principal_context_agent_test - INFO - Checking if 'Chief Financial Officer' exists in principal_profiles_by_id
2025-09-02 12:05:25,096 - principal_context_agent_test - INFO - Calling fetch_principal_profile for 'Chief Financial Officer'
2025-09-02 12:05:25,096 - principal_context_agent_test - INFO - Successfully fetched profile for Chief Financial Officer:
2025-09-02 12:05:25,097 - principal_context_agent_test - INFO -   Profile type: <class 'dict'>
2025-09-02 12:05:25,099 - principal_context_agent_test - INFO -   Name: Lars Mikkelsen
2025-09-02 12:05:25,100 - principal_context_agent_test - INFO -   Title: Chief Financial Officer
2025-09-02 12:05:25,101 - principal_context_agent_test - INFO -   Business Processes: ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals']
2025-09-02 12:05:25,102 - principal_context_agent_test - INFO -   Default Filters: {'profit_center_hierarchyid': ['Total'], 'customer_hierarchyid': ['Total']}
2025-09-02 12:05:25,102 - principal_context_agent_test - INFO -   Decision Style: Analytical
2025-09-02 12:05:25,103 - principal_context_agent_test - INFO -   Communication Style: Concise
2025-09-02 12:05:25,104 - principal_context_agent_test - INFO -   Timeframes: []
2025-09-02 12:05:25,105 - principal_context_agent_test - INFO - Step 4: Testing get_principal_context
2025-09-02 12:05:25,106 - principal_context_agent_test - INFO - === Testing get_principal_context for role: Chief Financial Officer ===
2025-09-02 12:05:25,107 - principal_context_agent_test - INFO - Calling get_principal_context with role: Chief Financial Officer
2025-09-02 12:05:25,108 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: Chief Financial Officer
2025-09-02 12:05:25,109 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'Chief Financial Officer'
2025-09-02 12:05:25,111 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['Chief Financial Officer', 'chief financial officer', 'Chief Executive Officer', 'chief executive officer', 'Chief Operating Officer', 'chief operating officer', 'Finance Manager', 'finance manager']
2025-09-02 12:05:25,113 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['Chief Financial Officer', 'chief financial officer', 'CHIEF FINANCIAL OFFICER', 'CHIEF_FINANCIAL_OFFICER', 'chief_financial_officer', 'cfo', 'CFO']
2025-09-02 12:05:25,114 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'Chief Financial Officer'
2025-09-02 12:05:25,116 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: Chief Financial Officer
2025-09-02 12:05:25,118 - principal_context_agent_test - ERROR - Error testing get_principal_context: 'str' object is not a mapping
2025-09-02 12:05:25,120 - principal_context_agent_test - INFO - Could not get context for Chief Financial Officer, continuing with next tests
2025-09-02 12:05:25,121 - principal_context_agent_test - INFO - 
Testing with role: chief financial officer
2025-09-02 12:05:25,122 - principal_context_agent_test - INFO - Step 3: Testing fetch_principal_profile
2025-09-02 12:05:25,123 - principal_context_agent_test - INFO - === Testing fetch_principal_profile for role: chief financial officer ===
2025-09-02 12:05:25,123 - principal_context_agent_test - INFO - Checking if 'chief financial officer' exists in principal_profiles_by_id
2025-09-02 12:05:25,124 - principal_context_agent_test - INFO - Calling fetch_principal_profile for 'chief financial officer'
2025-09-02 12:05:25,125 - principal_context_agent_test - INFO - Successfully fetched profile for chief financial officer:
2025-09-02 12:05:25,126 - principal_context_agent_test - INFO -   Profile type: <class 'dict'>
2025-09-02 12:05:25,127 - principal_context_agent_test - INFO -   Name: Lars Mikkelsen
2025-09-02 12:05:25,128 - principal_context_agent_test - INFO -   Title: Chief Financial Officer
2025-09-02 12:05:25,129 - principal_context_agent_test - INFO -   Business Processes: ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals']
2025-09-02 12:05:25,130 - principal_context_agent_test - INFO -   Default Filters: {'profit_center_hierarchyid': ['Total'], 'customer_hierarchyid': ['Total']}
2025-09-02 12:05:25,131 - principal_context_agent_test - INFO -   Decision Style: Analytical
2025-09-02 12:05:25,131 - principal_context_agent_test - INFO -   Communication Style: Concise
2025-09-02 12:05:25,133 - principal_context_agent_test - INFO -   Timeframes: []
2025-09-02 12:05:25,134 - principal_context_agent_test - INFO - Step 4: Testing get_principal_context
2025-09-02 12:05:25,135 - principal_context_agent_test - INFO - === Testing get_principal_context for role: chief financial officer ===
2025-09-02 12:05:25,136 - principal_context_agent_test - INFO - Calling get_principal_context with role: chief financial officer
2025-09-02 12:05:25,136 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: chief financial officer
2025-09-02 12:05:25,137 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'chief financial officer'
2025-09-02 12:05:25,138 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['Chief Financial Officer', 'chief financial officer', 'Chief Executive Officer', 'chief executive officer', 'Chief Operating Officer', 'chief operating officer', 'Finance Manager', 'finance manager']
2025-09-02 12:05:25,139 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['chief financial officer', 'CHIEF FINANCIAL OFFICER', 'CHIEF_FINANCIAL_OFFICER', 'Chief Financial Officer', 'chief_financial_officer', 'cfo', 'CFO']
2025-09-02 12:05:25,141 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'chief financial officer'
2025-09-02 12:05:25,142 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: chief financial officer
2025-09-02 12:05:25,149 - principal_context_agent_test - ERROR - Error testing get_principal_context: 'str' object is not a mapping
2025-09-02 12:05:25,151 - principal_context_agent_test - INFO - Could not get context for chief financial officer, continuing with next tests
2025-09-02 12:05:25,152 - principal_context_agent_test - INFO - 
Testing with role: Chief Executive Officer
2025-09-02 12:05:25,154 - principal_context_agent_test - INFO - Step 3: Testing fetch_principal_profile
2025-09-02 12:05:25,155 - principal_context_agent_test - INFO - === Testing fetch_principal_profile for role: Chief Executive Officer ===
2025-09-02 12:05:25,155 - principal_context_agent_test - INFO - Checking if 'Chief Executive Officer' exists in principal_profiles_by_id
2025-09-02 12:05:25,156 - principal_context_agent_test - INFO - Calling fetch_principal_profile for 'Chief Executive Officer'
2025-09-02 12:05:25,157 - principal_context_agent_test - INFO - Successfully fetched profile for Chief Executive Officer:
2025-09-02 12:05:25,158 - principal_context_agent_test - INFO -   Profile type: <class 'dict'>
2025-09-02 12:05:25,158 - principal_context_agent_test - INFO -   Name: Alex Morgan
2025-09-02 12:05:25,158 - principal_context_agent_test - INFO -   Title: Chief Executive Officer
2025-09-02 12:05:25,160 - principal_context_agent_test - INFO -   Business Processes: ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals']
2025-09-02 12:05:25,160 - principal_context_agent_test - INFO -   Default Filters: {'profit_center_hierarchyid': ['#']}
2025-09-02 12:05:25,161 - principal_context_agent_test - INFO -   Decision Style: Analytical
2025-09-02 12:05:25,161 - principal_context_agent_test - INFO -   Communication Style: Concise
2025-09-02 12:05:25,162 - principal_context_agent_test - INFO -   Timeframes: []
2025-09-02 12:05:25,164 - principal_context_agent_test - INFO - Step 4: Testing get_principal_context
2025-09-02 12:05:25,166 - principal_context_agent_test - INFO - === Testing get_principal_context for role: Chief Executive Officer ===
2025-09-02 12:05:25,167 - principal_context_agent_test - INFO - Calling get_principal_context with role: Chief Executive Officer
2025-09-02 12:05:25,168 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: Chief Executive Officer
2025-09-02 12:05:25,170 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'Chief Executive Officer'
2025-09-02 12:05:25,170 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['Chief Financial Officer', 'chief financial officer', 'Chief Executive Officer', 'chief executive officer', 'Chief Operating Officer', 'chief operating officer', 'Finance Manager', 'finance manager']
2025-09-02 12:05:25,172 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['Chief Executive Officer', 'chief executive officer', 'CHIEF EXECUTIVE OFFICER', 'CHIEF_EXECUTIVE_OFFICER', 'chief_executive_officer', 'ceo', 'CEO']
2025-09-02 12:05:25,174 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'Chief Executive Officer'
2025-09-02 12:05:25,175 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: Chief Executive Officer
2025-09-02 12:05:25,177 - principal_context_agent_test - ERROR - Error testing get_principal_context: 'str' object is not a mapping
2025-09-02 12:05:25,179 - principal_context_agent_test - INFO - Could not get context for Chief Executive Officer, continuing with next tests
2025-09-02 12:05:25,180 - principal_context_agent_test - INFO - 
Step 5: Testing case-insensitive profile lookup
2025-09-02 12:05:25,182 - principal_context_agent_test - INFO - === Testing case-insensitive profile lookup ===
2025-09-02 12:05:25,183 - principal_context_agent_test - INFO - Testing lookup with role format: 'CFO'
2025-09-02 12:05:25,185 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: CFO
2025-09-02 12:05:25,186 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'CFO'
2025-09-02 12:05:25,187 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['Chief Financial Officer', 'chief financial officer', 'Chief Executive Officer', 'chief executive officer', 'Chief Operating Officer', 'chief operating officer', 'Finance Manager', 'finance manager']
2025-09-02 12:05:25,192 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['CFO', 'cfo', 'Cfo', 'Chief Financial Officer']
2025-09-02 12:05:25,193 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'Chief Financial Officer'
2025-09-02 12:05:25,196 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: CFO
2025-09-02 12:05:25,220 - principal_context_agent_test - INFO - Testing lookup with role format: 'cfo'
2025-09-02 12:05:25,220 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: cfo
2025-09-02 12:05:25,221 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'cfo'
2025-09-02 12:05:25,223 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['Chief Financial Officer', 'chief financial officer', 'Chief Executive Officer', 'chief executive officer', 'Chief Operating Officer', 'chief operating officer', 'Finance Manager', 'finance manager']
2025-09-02 12:05:25,225 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['cfo', 'CFO', 'Cfo', 'Chief Financial Officer']
2025-09-02 12:05:25,226 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'Chief Financial Officer'
2025-09-02 12:05:25,228 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: cfo
2025-09-02 12:05:25,248 - principal_context_agent_test - INFO - Testing lookup with role format: 'Cfo'
2025-09-02 12:05:25,249 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: Cfo
2025-09-02 12:05:25,250 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'Cfo'
2025-09-02 12:05:25,251 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['Chief Financial Officer', 'chief financial officer', 'Chief Executive Officer', 'chief executive officer', 'Chief Operating Officer', 'chief operating officer', 'Finance Manager', 'finance manager']
2025-09-02 12:05:25,253 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['Cfo', 'cfo', 'CFO', 'Chief Financial Officer']
2025-09-02 12:05:25,255 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'Chief Financial Officer'
2025-09-02 12:05:25,256 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: Cfo
2025-09-02 12:05:25,272 - principal_context_agent_test - INFO - Testing lookup with role format: 'FINANCE_MANAGER'
2025-09-02 12:05:25,272 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: FINANCE_MANAGER
2025-09-02 12:05:25,274 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'FINANCE_MANAGER'
2025-09-02 12:05:25,279 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['Chief Financial Officer', 'chief financial officer', 'Chief Executive Officer', 'chief executive officer', 'Chief Operating Officer', 'chief operating officer', 'Finance Manager', 'finance manager']
2025-09-02 12:05:25,280 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['FINANCE_MANAGER', 'finance_manager', 'Finance Manager', 'finance manager']
2025-09-02 12:05:25,282 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'Finance Manager'
2025-09-02 12:05:25,283 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: FINANCE_MANAGER
2025-09-02 12:05:25,284 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Mapped role directly to enum: Finance Manager -> PrincipalRole.FINANCE_MANAGER
2025-09-02 12:05:25,309 - principal_context_agent_test - INFO - Testing lookup with role format: 'Finance Manager'
2025-09-02 12:05:25,310 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: Finance Manager
2025-09-02 12:05:25,311 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'Finance Manager'
2025-09-02 12:05:25,312 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['Chief Financial Officer', 'chief financial officer', 'Chief Executive Officer', 'chief executive officer', 'Chief Operating Officer', 'chief operating officer', 'Finance Manager', 'finance manager']
2025-09-02 12:05:25,313 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['Finance Manager', 'finance manager', 'FINANCE MANAGER', 'FINANCE_MANAGER', 'finance_manager']
2025-09-02 12:05:25,314 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'Finance Manager'
2025-09-02 12:05:25,315 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: Finance Manager
2025-09-02 12:05:25,316 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Mapped role directly to enum: Finance Manager -> PrincipalRole.FINANCE_MANAGER
2025-09-02 12:05:25,344 - principal_context_agent_test - INFO - Testing lookup with role format: 'finance manager'
2025-09-02 12:05:25,345 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: finance manager
2025-09-02 12:05:25,346 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'finance manager'
2025-09-02 12:05:25,347 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['Chief Financial Officer', 'chief financial officer', 'Chief Executive Officer', 'chief executive officer', 'Chief Operating Officer', 'chief operating officer', 'Finance Manager', 'finance manager']
2025-09-02 12:05:25,348 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['finance manager', 'FINANCE MANAGER', 'FINANCE_MANAGER', 'Finance Manager', 'finance_manager']
2025-09-02 12:05:25,350 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'finance manager'
2025-09-02 12:05:25,351 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: finance manager
2025-09-02 12:05:25,353 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Mapped role directly to enum: Finance Manager -> PrincipalRole.FINANCE_MANAGER
2025-09-02 12:05:25,387 - principal_context_agent_test - INFO - Testing lookup with non-existent role: 'INVALID_ROLE'
2025-09-02 12:05:25,388 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: INVALID_ROLE
2025-09-02 12:05:25,389 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'INVALID_ROLE'
2025-09-02 12:05:25,390 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['Chief Financial Officer', 'chief financial officer', 'Chief Executive Officer', 'chief executive officer', 'Chief Operating Officer', 'chief operating officer', 'Finance Manager', 'finance manager']
2025-09-02 12:05:25,392 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['INVALID_ROLE', 'invalid_role', 'Invalid Role']
2025-09-02 12:05:25,393 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - WARNING - Principal profile not found for any variation of: 'INVALID_ROLE'
2025-09-02 12:05:25,394 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profiles: ['Chief Financial Officer', 'Chief Financial Officer', 'Chief Executive Officer', 'Chief Executive Officer', 'Chief Operating Officer', 'Chief Operating Officer', 'Finance Manager', 'Finance Manager']
2025-09-02 12:05:25,396 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - WARNING - Principal profile not found for role: INVALID_ROLE
2025-09-02 12:05:25,396 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Using default principal ID: default_id
2025-09-02 12:05:25,398 - principal_context_agent_test - ERROR - Error testing non-existent role: 'str' object is not a mapping
2025-09-02 12:05:25,400 - principal_context_agent_test - INFO - 
Step 6: Testing extract_filters
2025-09-02 12:05:25,400 - principal_context_agent_test - INFO - === Testing extract_filters ===
2025-09-02 12:05:25,401 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Extracting filters from description: 
    Analyze the Q2 financial performance for the ...
2025-09-02 12:05:25,402 - principal_context_agent_test - INFO - Response status: success
2025-09-02 12:05:25,402 - principal_context_agent_test - INFO - Response message: Extracted 1 filters from description
2025-09-02 12:05:25,403 - principal_context_agent_test - INFO - Extracted filters: {'region': ['North America']}
2025-09-02 12:05:25,403 - principal_context_agent_test - INFO - Extracted filter objects: [{'dimension': 'region', 'value': 'North America', 'confidence': 0.8, 'extraction_method': 'rule_based'}]
2025-09-02 12:05:25,405 - principal_context_agent_test - INFO - All tests completed successfully
2025-09-02 12:06:46,942 - asyncio - DEBUG - Using proactor: IocpProactor
2025-09-02 12:06:46,947 - principal_context_agent_test - INFO - Starting Principal Context Agent tests
2025-09-02 12:06:46,948 - principal_context_agent_test - INFO - Step 1: Testing registry structure
2025-09-02 12:06:46,949 - principal_context_agent_test - INFO - === Testing registry structure ===
2025-09-02 12:06:46,950 - principal_context_agent_test - INFO - Initializing registry bootstrap
2025-09-02 12:06:46,953 - src.registry.factory - INFO - Registry Factory initialized
2025-09-02 12:06:46,954 - src.registry.factory - INFO - Registered principal_profile provider
2025-09-02 12:06:46,959 - src.registry.providers.principal_provider - INFO - Loading principal profiles from C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\principal\principal_registry.yaml (yaml)
2025-09-02 12:06:47,009 - src.registry.providers.principal_provider - INFO - Found 4 roles in YAML under 'roles' key
2025-09-02 12:06:47,011 - src.registry.providers.principal_provider - DEBUG - Registered role: cfo_001 - CFO
2025-09-02 12:06:47,012 - src.registry.providers.principal_provider - DEBUG - Registered role: ceo_001 - CEO
2025-09-02 12:06:47,013 - src.registry.providers.principal_provider - DEBUG - Registered role: coo_001 - COO
2025-09-02 12:06:47,013 - src.registry.providers.principal_provider - DEBUG - Registered role: finance_manager_001 - Finance Manager
2025-09-02 12:06:47,014 - src.registry.providers.principal_provider - INFO - Found 4 principal profiles in YAML under 'principals' key
2025-09-02 12:06:47,017 - src.registry.providers.principal_provider - DEBUG - Mapped role name CFO to principal ID cfo_001
2025-09-02 12:06:47,018 - src.registry.providers.principal_provider - INFO - Registered principal: cfo_001 - Lars Mikkelsen
2025-09-02 12:06:47,019 - src.registry.providers.principal_provider - DEBUG - Mapped role name CEO to principal ID ceo_001
2025-09-02 12:06:47,019 - src.registry.providers.principal_provider - INFO - Registered principal: ceo_001 - Alex Morgan
2025-09-02 12:06:47,022 - src.registry.providers.principal_provider - DEBUG - Mapped role name COO to principal ID coo_001
2025-09-02 12:06:47,024 - src.registry.providers.principal_provider - INFO - Registered principal: coo_001 - Priya Desai
2025-09-02 12:06:47,026 - src.registry.providers.principal_provider - DEBUG - Mapped role name Finance Manager to principal ID finance_manager_001
2025-09-02 12:06:47,028 - src.registry.providers.principal_provider - INFO - Registered principal: finance_manager_001 - Emily Chen
2025-09-02 12:06:47,032 - src.registry.providers.principal_provider - INFO - Added role ID mapping: cfo_001 -> Lars Mikkelsen
2025-09-02 12:06:47,033 - src.registry.providers.principal_provider - INFO - Added role ID mapping: ceo_001 -> Alex Morgan
2025-09-02 12:06:47,035 - src.registry.providers.principal_provider - INFO - Added role ID mapping: coo_001 -> Priya Desai
2025-09-02 12:06:47,036 - src.registry.providers.principal_provider - INFO - Added role ID mapping: finance_manager_001 -> Emily Chen
2025-09-02 12:06:47,038 - src.registry.providers.principal_provider - INFO - Loaded 4 principal profiles
2025-09-02 12:06:47,040 - src.registry.bootstrap - INFO - Initialized principal provider with 4 profiles
2025-09-02 12:06:47,047 - src.registry.factory - WARNING - Provider 'business_glossary' not found in registry factory
2025-09-02 12:06:47,048 - src.registry.bootstrap - INFO - Initializing business glossary provider
2025-09-02 12:06:47,066 - src.registry.providers.business_glossary_provider - INFO - Loaded 4 business terms from glossary
2025-09-02 12:06:47,067 - src.registry.factory - INFO - Registered business_glossary provider
2025-09-02 12:06:47,068 - src.registry.bootstrap - INFO - Initialized business glossary provider with 4 terms
2025-09-02 12:06:47,069 - src.registry.factory - INFO - Registered data_product provider
2025-09-02 12:06:47,079 - src.registry.providers.data_product_provider - INFO - Loading data products from C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\data_product\data_product_registry.yaml (yaml)
2025-09-02 12:06:47,109 - src.registry.providers.data_product_provider - INFO - Loaded 1 data products
2025-09-02 12:06:47,109 - src.registry.bootstrap - INFO - Initialized data product provider with 1 data products
2025-09-02 12:06:47,110 - src.registry.bootstrap - INFO - Initializing KPI provider
2025-09-02 12:06:47,111 - src.registry.factory - WARNING - Provider 'kpi' not found in registry factory
2025-09-02 12:06:47,113 - src.registry.bootstrap - INFO - Creating KPI provider with file at C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\kpi\kpi_registry.yaml
2025-09-02 12:06:47,114 - src.registry.bootstrap - INFO - Registering KPI provider with registry factory
2025-09-02 12:06:47,115 - src.registry.factory - INFO - Registered kpi provider
2025-09-02 12:06:47,115 - src.registry.bootstrap - INFO - Loading KPI provider data
2025-09-02 12:06:47,116 - src.registry.providers.kpi_provider - INFO - Loading KPIs from C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\kpi\kpi_registry.yaml (yaml)
2025-09-02 12:06:47,168 - src.registry.providers.kpi_provider - INFO - Loaded 6 KPIs
2025-09-02 12:06:47,169 - src.registry.bootstrap - INFO - KPI provider successfully registered and initialized with 6 KPIs
2025-09-02 12:06:47,175 - src.registry.bootstrap - INFO - Initializing agent bootstrap
2025-09-02 12:06:47,180 - src.agents.agent_bootstrap - WARNING - No agent implementations discovered
2025-09-02 12:06:47,183 - src.registry.bootstrap - WARNING - Agent bootstrap initialization had issues, continuing with available agents
2025-09-02 12:06:47,189 - src.registry.bootstrap - INFO - Registry providers and agent factories initialized successfully
2025-09-02 12:06:47,192 - principal_context_agent_test - INFO - Registry bootstrap initialized successfully
2025-09-02 12:06:47,197 - principal_context_agent_test - INFO - Got RegistryFactory from bootstrap
2025-09-02 12:06:47,215 - principal_context_agent_test - INFO - Provider status: {'principal_profile': True, 'business_glossary': True, 'data_product': False, 'kpi': True}
2025-09-02 12:06:47,217 - principal_context_agent_test - INFO - principal_profile provider status: True
2025-09-02 12:06:47,219 - principal_context_agent_test - INFO - Got principal provider: <src.registry.providers.principal_provider.PrincipalProfileProvider object at 0x0000025330BF3510>
2025-09-02 12:06:47,225 - principal_context_agent_test - INFO - Provider methods: ['__abstractmethods__', '__class__', '__class_getitem__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__orig_bases__', '__parameters__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', '__weakref__', '_abc_impl', '_add_profile', '_extract_profiles_from_module', '_is_protocol', '_load_default_profiles', '_load_from_json', '_load_from_python_module', '_load_from_yaml', '_profiles', '_profiles_by_name', '_profiles_by_title', '_registry_base_path', 'find_by_attribute', 'find_by_business_process', 'find_by_kpi', 'get', 'get_all', 'get_registry_path', 'initialize', 'load', 'register', 'source_path', 'storage_format']
2025-09-02 12:06:47,230 - principal_context_agent_test - INFO - Principal registry file exists at: C:\Users\barry\CascadeProjects\Agent9-HERMES\src\registry\principal\principal_registry.yaml
2025-09-02 12:06:47,232 - principal_context_agent_test - INFO - Registry file content length: 6517 bytes
2025-09-02 12:06:47,234 - principal_context_agent_test - INFO - Registry file first 100 chars: # Principal Registry
# Contains all principal profiles for personalization and context-aware process...
2025-09-02 12:06:47,235 - principal_context_agent_test - INFO - Got registry data type: <class 'list'>
2025-09-02 12:06:47,236 - principal_context_agent_test - INFO - Found 4 principals in registry
2025-09-02 12:06:47,238 - principal_context_agent_test - INFO - Principal 1 details:
2025-09-02 12:06:47,242 - principal_context_agent_test - INFO -   ID: cfo_001
2025-09-02 12:06:47,243 - principal_context_agent_test - INFO -   Name: Lars Mikkelsen
2025-09-02 12:06:47,245 - principal_context_agent_test - INFO -   Role: N/A
2025-09-02 12:06:47,246 - principal_context_agent_test - INFO -   Title: Chief Financial Officer
2025-09-02 12:06:47,248 - principal_context_agent_test - INFO -   Business Processes: ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals']
2025-09-02 12:06:47,259 - principal_context_agent_test - INFO -   All attributes: ['__abstractmethods__', '__annotations__', '__class__', '__class_getitem__', '__class_vars__', '__copy__', '__deepcopy__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__fields__', '__fields_set__', '__format__', '__ge__', '__get_pydantic_core_schema__', '__get_pydantic_json_schema__', '__getattr__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__iter__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__pretty__', '__private_attributes__', '__pydantic_complete__', '__pydantic_computed_fields__', '__pydantic_core_schema__', '__pydantic_custom_init__', '__pydantic_decorators__', '__pydantic_extra__', '__pydantic_fields__', '__pydantic_fields_set__', '__pydantic_generic_metadata__', '__pydantic_init_subclass__', '__pydantic_parent_namespace__', '__pydantic_post_init__', '__pydantic_private__', '__pydantic_root_model__', '__pydantic_serializer__', '__pydantic_setattr_handlers__', '__pydantic_validator__', '__reduce__', '__reduce_ex__', '__replace__', '__repr__', '__repr_args__', '__repr_name__', '__repr_recursion__', '__repr_str__', '__rich_repr__', '__setattr__', '__setstate__', '__signature__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', '__weakref__', '_abc_impl', '_calculate_keys', '_copy_and_set_values', '_get_value', '_iter', '_setattr_handler', 'business_processes', 'communication', 'construct', 'copy', 'default_filters', 'description', 'dict', 'from_orm', 'id', 'json', 'kpis', 'metadata', 'model_computed_fields', 'model_config', 'model_construct', 'model_copy', 'model_dump', 'model_dump_json', 'model_extra', 'model_fields', 'model_fields_set', 'model_json_schema', 'model_parametrized_name', 'model_post_init', 'model_rebuild', 'model_validate', 'model_validate_json', 'model_validate_strings', 'name', 'parse_file', 'parse_obj', 'parse_raw', 'responsibilities', 'schema', 'schema_json', 'time_frame', 'title', 'to_dict', 'update_forward_refs', 'validate']
2025-09-02 12:06:47,270 - principal_context_agent_test - INFO -   Dict representation: {'id': 'cfo_001', 'name': 'Lars Mikkelsen', 'title': 'Chief Financial Officer', 'description': 'CFO responsible for financial performance in EMEA.', 'business_processes': ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals'], 'kpis': [], 'responsibilities': ['maximize EBIT', 'manage revenue', 'control expenses'], 'default_filters': {'profit_center_hierarchyid': ['Total'], 'customer_hierarchyid': ['Total']}, 'time_frame': {'default_period': 'QTD', 'historical_periods': 4, 'forward_looking_periods': 2}, 'communication': {'detail_level': 'high', 'format_preference': ['visual', 'text', 'table'], 'emphasis': ['trends', 'anomalies', 'forecasts']}, 'metadata': {}}
2025-09-02 12:06:47,283 - principal_context_agent_test - INFO -   __dict__ representation: {'id': 'cfo_001', 'name': 'Lars Mikkelsen', 'title': 'Chief Financial Officer', 'description': 'CFO responsible for financial performance in EMEA.', 'business_processes': ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals'], 'kpis': [], 'responsibilities': ['maximize EBIT', 'manage revenue', 'control expenses'], 'default_filters': {'profit_center_hierarchyid': ['Total'], 'customer_hierarchyid': ['Total']}, 'time_frame': TimeFrame(default_period='QTD', historical_periods=4, forward_looking_periods=2), 'communication': CommunicationPreference(detail_level='high', format_preference=['visual', 'text', 'table'], emphasis=['trends', 'anomalies', 'forecasts']), 'metadata': {}}
2025-09-02 12:06:47,286 - principal_context_agent_test - INFO - Principal 2 details:
2025-09-02 12:06:47,287 - principal_context_agent_test - INFO -   ID: ceo_001
2025-09-02 12:06:47,288 - principal_context_agent_test - INFO -   Name: Alex Morgan
2025-09-02 12:06:47,290 - principal_context_agent_test - INFO -   Role: N/A
2025-09-02 12:06:47,294 - principal_context_agent_test - INFO -   Title: Chief Executive Officer
2025-09-02 12:06:47,296 - principal_context_agent_test - INFO -   Business Processes: ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals']
2025-09-02 12:06:47,307 - principal_context_agent_test - INFO -   All attributes: ['__abstractmethods__', '__annotations__', '__class__', '__class_getitem__', '__class_vars__', '__copy__', '__deepcopy__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__fields__', '__fields_set__', '__format__', '__ge__', '__get_pydantic_core_schema__', '__get_pydantic_json_schema__', '__getattr__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__iter__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__pretty__', '__private_attributes__', '__pydantic_complete__', '__pydantic_computed_fields__', '__pydantic_core_schema__', '__pydantic_custom_init__', '__pydantic_decorators__', '__pydantic_extra__', '__pydantic_fields__', '__pydantic_fields_set__', '__pydantic_generic_metadata__', '__pydantic_init_subclass__', '__pydantic_parent_namespace__', '__pydantic_post_init__', '__pydantic_private__', '__pydantic_root_model__', '__pydantic_serializer__', '__pydantic_setattr_handlers__', '__pydantic_validator__', '__reduce__', '__reduce_ex__', '__replace__', '__repr__', '__repr_args__', '__repr_name__', '__repr_recursion__', '__repr_str__', '__rich_repr__', '__setattr__', '__setstate__', '__signature__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', '__weakref__', '_abc_impl', '_calculate_keys', '_copy_and_set_values', '_get_value', '_iter', '_setattr_handler', 'business_processes', 'communication', 'construct', 'copy', 'default_filters', 'description', 'dict', 'from_orm', 'id', 'json', 'kpis', 'metadata', 'model_computed_fields', 'model_config', 'model_construct', 'model_copy', 'model_dump', 'model_dump_json', 'model_extra', 'model_fields', 'model_fields_set', 'model_json_schema', 'model_parametrized_name', 'model_post_init', 'model_rebuild', 'model_validate', 'model_validate_json', 'model_validate_strings', 'name', 'parse_file', 'parse_obj', 'parse_raw', 'responsibilities', 'schema', 'schema_json', 'time_frame', 'title', 'to_dict', 'update_forward_refs', 'validate']
2025-09-02 12:06:47,314 - principal_context_agent_test - INFO -   Dict representation: {'id': 'ceo_001', 'name': 'Alex Morgan', 'title': 'Chief Executive Officer', 'description': 'CEO driving company strategy and performance.', 'business_processes': ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals'], 'kpis': [], 'responsibilities': ['set strategic direction', 'oversee company performance', 'lead executive team'], 'default_filters': {'profit_center_hierarchyid': ['#']}, 'time_frame': {'default_period': 'YTD', 'historical_periods': 3, 'forward_looking_periods': 4}, 'communication': {'detail_level': 'medium', 'format_preference': ['visual', 'summary'], 'emphasis': ['trends', 'strategic_impact']}, 'metadata': {}}
2025-09-02 12:06:47,325 - principal_context_agent_test - INFO -   __dict__ representation: {'id': 'ceo_001', 'name': 'Alex Morgan', 'title': 'Chief Executive Officer', 'description': 'CEO driving company strategy and performance.', 'business_processes': ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals'], 'kpis': [], 'responsibilities': ['set strategic direction', 'oversee company performance', 'lead executive team'], 'default_filters': {'profit_center_hierarchyid': ['#']}, 'time_frame': TimeFrame(default_period='YTD', historical_periods=3, forward_looking_periods=4), 'communication': CommunicationPreference(detail_level='medium', format_preference=['visual', 'summary'], emphasis=['trends', 'strategic_impact']), 'metadata': {}}
2025-09-02 12:06:47,327 - principal_context_agent_test - INFO - Principal 3 details:
2025-09-02 12:06:47,328 - principal_context_agent_test - INFO -   ID: coo_001
2025-09-02 12:06:47,329 - principal_context_agent_test - INFO -   Name: Priya Desai
2025-09-02 12:06:47,329 - principal_context_agent_test - INFO -   Role: N/A
2025-09-02 12:06:47,330 - principal_context_agent_test - INFO -   Title: Chief Operating Officer
2025-09-02 12:06:47,332 - principal_context_agent_test - INFO -   Business Processes: ['finance_expense_management', 'finance_cash_flow', 'finance_budget_vs_actuals']
2025-09-02 12:06:47,338 - principal_context_agent_test - INFO -   All attributes: ['__abstractmethods__', '__annotations__', '__class__', '__class_getitem__', '__class_vars__', '__copy__', '__deepcopy__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__fields__', '__fields_set__', '__format__', '__ge__', '__get_pydantic_core_schema__', '__get_pydantic_json_schema__', '__getattr__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__iter__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__pretty__', '__private_attributes__', '__pydantic_complete__', '__pydantic_computed_fields__', '__pydantic_core_schema__', '__pydantic_custom_init__', '__pydantic_decorators__', '__pydantic_extra__', '__pydantic_fields__', '__pydantic_fields_set__', '__pydantic_generic_metadata__', '__pydantic_init_subclass__', '__pydantic_parent_namespace__', '__pydantic_post_init__', '__pydantic_private__', '__pydantic_root_model__', '__pydantic_serializer__', '__pydantic_setattr_handlers__', '__pydantic_validator__', '__reduce__', '__reduce_ex__', '__replace__', '__repr__', '__repr_args__', '__repr_name__', '__repr_recursion__', '__repr_str__', '__rich_repr__', '__setattr__', '__setstate__', '__signature__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', '__weakref__', '_abc_impl', '_calculate_keys', '_copy_and_set_values', '_get_value', '_iter', '_setattr_handler', 'business_processes', 'communication', 'construct', 'copy', 'default_filters', 'description', 'dict', 'from_orm', 'id', 'json', 'kpis', 'metadata', 'model_computed_fields', 'model_config', 'model_construct', 'model_copy', 'model_dump', 'model_dump_json', 'model_extra', 'model_fields', 'model_fields_set', 'model_json_schema', 'model_parametrized_name', 'model_post_init', 'model_rebuild', 'model_validate', 'model_validate_json', 'model_validate_strings', 'name', 'parse_file', 'parse_obj', 'parse_raw', 'responsibilities', 'schema', 'schema_json', 'time_frame', 'title', 'to_dict', 'update_forward_refs', 'validate']
2025-09-02 12:06:47,344 - principal_context_agent_test - INFO -   Dict representation: {'id': 'coo_001', 'name': 'Priya Desai', 'title': 'Chief Operating Officer', 'description': 'COO focused on operational excellence and efficiency.', 'business_processes': ['finance_expense_management', 'finance_cash_flow', 'finance_budget_vs_actuals'], 'kpis': [], 'responsibilities': ['optimize operations', 'reduce operational costs', 'improve process efficiency'], 'default_filters': {'profit_center_hierarchyid': ['Best Run U'], 'customer_hierarchyid': ['17100001']}, 'time_frame': {'default_period': 'MTD', 'historical_periods': 6, 'forward_looking_periods': 2}, 'communication': {'detail_level': 'high', 'format_preference': ['table', 'visual'], 'emphasis': ['variances', 'operational_metrics']}, 'metadata': {}}
2025-09-02 12:06:47,348 - principal_context_agent_test - INFO -   __dict__ representation: {'id': 'coo_001', 'name': 'Priya Desai', 'title': 'Chief Operating Officer', 'description': 'COO focused on operational excellence and efficiency.', 'business_processes': ['finance_expense_management', 'finance_cash_flow', 'finance_budget_vs_actuals'], 'kpis': [], 'responsibilities': ['optimize operations', 'reduce operational costs', 'improve process efficiency'], 'default_filters': {'profit_center_hierarchyid': ['Best Run U'], 'customer_hierarchyid': ['17100001']}, 'time_frame': TimeFrame(default_period='MTD', historical_periods=6, forward_looking_periods=2), 'communication': CommunicationPreference(detail_level='high', format_preference=['table', 'visual'], emphasis=['variances', 'operational_metrics']), 'metadata': {}}
2025-09-02 12:06:47,351 - principal_context_agent_test - INFO - Principal 4 details:
2025-09-02 12:06:47,352 - principal_context_agent_test - INFO -   ID: finance_manager_001
2025-09-02 12:06:47,353 - principal_context_agent_test - INFO -   Name: Emily Chen
2025-09-02 12:06:47,356 - principal_context_agent_test - INFO -   Role: N/A
2025-09-02 12:06:47,356 - principal_context_agent_test - INFO -   Title: Finance Manager
2025-09-02 12:06:47,358 - principal_context_agent_test - INFO -   Business Processes: ['Finance: Expense Management', 'Finance: Budget vs. Actuals', 'Finance: Cash Flow Management']
2025-09-02 12:06:47,366 - principal_context_agent_test - INFO -   All attributes: ['__abstractmethods__', '__annotations__', '__class__', '__class_getitem__', '__class_vars__', '__copy__', '__deepcopy__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__fields__', '__fields_set__', '__format__', '__ge__', '__get_pydantic_core_schema__', '__get_pydantic_json_schema__', '__getattr__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__iter__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__pretty__', '__private_attributes__', '__pydantic_complete__', '__pydantic_computed_fields__', '__pydantic_core_schema__', '__pydantic_custom_init__', '__pydantic_decorators__', '__pydantic_extra__', '__pydantic_fields__', '__pydantic_fields_set__', '__pydantic_generic_metadata__', '__pydantic_init_subclass__', '__pydantic_parent_namespace__', '__pydantic_post_init__', '__pydantic_private__', '__pydantic_root_model__', '__pydantic_serializer__', '__pydantic_setattr_handlers__', '__pydantic_validator__', '__reduce__', '__reduce_ex__', '__replace__', '__repr__', '__repr_args__', '__repr_name__', '__repr_recursion__', '__repr_str__', '__rich_repr__', '__setattr__', '__setstate__', '__signature__', '__sizeof__', '__slots__', '__str__', '__subclasshook__', '__weakref__', '_abc_impl', '_calculate_keys', '_copy_and_set_values', '_get_value', '_iter', '_setattr_handler', 'business_processes', 'communication', 'construct', 'copy', 'default_filters', 'description', 'dict', 'from_orm', 'id', 'json', 'kpis', 'metadata', 'model_computed_fields', 'model_config', 'model_construct', 'model_copy', 'model_dump', 'model_dump_json', 'model_extra', 'model_fields', 'model_fields_set', 'model_json_schema', 'model_parametrized_name', 'model_post_init', 'model_rebuild', 'model_validate', 'model_validate_json', 'model_validate_strings', 'name', 'parse_file', 'parse_obj', 'parse_raw', 'responsibilities', 'schema', 'schema_json', 'time_frame', 'title', 'to_dict', 'update_forward_refs', 'validate']
2025-09-02 12:06:47,378 - principal_context_agent_test - INFO -   Dict representation: {'id': 'finance_manager_001', 'name': 'Emily Chen', 'title': 'Finance Manager', 'description': 'Finance Manager responsible for departmental financial analysis and reporting.', 'business_processes': ['Finance: Expense Management', 'Finance: Budget vs. Actuals', 'Finance: Cash Flow Management'], 'kpis': [], 'responsibilities': ['manage departmental budget', 'analyze financial data', 'prepare financial reports'], 'default_filters': {'profit_center_hierarchyid': ['Finance'], 'customer_hierarchyid': ['Total']}, 'time_frame': {'default_period': 'MTD', 'historical_periods': 6, 'forward_looking_periods': 3}, 'communication': {'detail_level': 'high', 'format_preference': ['table', 'visual', 'text'], 'emphasis': ['variances', 'trends', 'forecasts']}, 'metadata': {}}
2025-09-02 12:06:47,381 - principal_context_agent_test - INFO -   __dict__ representation: {'id': 'finance_manager_001', 'name': 'Emily Chen', 'title': 'Finance Manager', 'description': 'Finance Manager responsible for departmental financial analysis and reporting.', 'business_processes': ['Finance: Expense Management', 'Finance: Budget vs. Actuals', 'Finance: Cash Flow Management'], 'kpis': [], 'responsibilities': ['manage departmental budget', 'analyze financial data', 'prepare financial reports'], 'default_filters': {'profit_center_hierarchyid': ['Finance'], 'customer_hierarchyid': ['Total']}, 'time_frame': TimeFrame(default_period='MTD', historical_periods=6, forward_looking_periods=3), 'communication': CommunicationPreference(detail_level='high', format_preference=['table', 'visual', 'text'], emphasis=['variances', 'trends', 'forecasts']), 'metadata': {}}
2025-09-02 12:06:47,386 - principal_context_agent_test - INFO - 
Step 2: Testing Agent Initialization
2025-09-02 12:06:47,387 - principal_context_agent_test - INFO - === Testing loading principal profiles ===
2025-09-02 12:06:47,389 - principal_context_agent_test - INFO - Creating Principal Context Agent
2025-09-02 12:06:47,390 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Initializing A9_Principal_Context_Agent
2025-09-02 12:06:47,392 - principal_context_agent_test - INFO - Connecting agent
2025-09-02 12:06:47,393 - src.registry.bootstrap - INFO - Registry bootstrap already initialized
2025-09-02 12:06:47,393 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Loaded 4 principal profiles from registry
2025-09-02 12:06:47,394 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Profile 0: id=cfo_001, role=unknown, title=Chief Financial Officer, name=Lars Mikkelsen
2025-09-02 12:06:47,397 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Profile 1: id=ceo_001, role=unknown, title=Chief Executive Officer, name=Alex Morgan
2025-09-02 12:06:47,399 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Profile 2: id=coo_001, role=unknown, title=Chief Operating Officer, name=Priya Desai
2025-09-02 12:06:47,401 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Profile 3: id=finance_manager_001, role=unknown, title=Finance Manager, name=Emily Chen
2025-09-02 12:06:47,404 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Processing principal: id=cfo_001, role=None, title=Chief Financial Officer
2025-09-02 12:06:47,406 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Added profile by ID: cfo_001
2025-09-02 12:06:47,408 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Added profile by title (exact): Chief Financial Officer
2025-09-02 12:06:47,409 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Added profile by title (lowercase): chief financial officer
2025-09-02 12:06:47,410 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Processing principal: id=ceo_001, role=None, title=Chief Executive Officer
2025-09-02 12:06:47,411 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Added profile by ID: ceo_001
2025-09-02 12:06:47,413 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Added profile by title (exact): Chief Executive Officer
2025-09-02 12:06:47,414 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Added profile by title (lowercase): chief executive officer
2025-09-02 12:06:47,415 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Processing principal: id=coo_001, role=None, title=Chief Operating Officer
2025-09-02 12:06:47,417 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Added profile by ID: coo_001
2025-09-02 12:06:47,418 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Added profile by title (exact): Chief Operating Officer
2025-09-02 12:06:47,419 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Added profile by title (lowercase): chief operating officer
2025-09-02 12:06:47,421 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Processing principal: id=finance_manager_001, role=None, title=Finance Manager
2025-09-02 12:06:47,423 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Added profile by ID: finance_manager_001
2025-09-02 12:06:47,425 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Added profile by title (exact): Finance Manager
2025-09-02 12:06:47,426 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Added profile by title (lowercase): finance manager
2025-09-02 12:06:47,428 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Loaded 4 principal profiles by ID from registry
2025-09-02 12:06:47,430 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Loaded 8 principal profiles by role from registry
2025-09-02 12:06:47,431 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Available profile IDs: ['cfo_001', 'ceo_001', 'coo_001', 'finance_manager_001']
2025-09-02 12:06:47,433 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Available role keys: ['Chief Financial Officer', 'chief financial officer', 'Chief Executive Officer', 'chief executive officer', 'Chief Operating Officer', 'chief operating officer', 'Finance Manager', 'finance manager']
2025-09-02 12:06:47,439 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Connected to dependencies
2025-09-02 12:06:47,442 - principal_context_agent_test - INFO - Loaded 8 principal profiles in principal_profiles dictionary
2025-09-02 12:06:47,443 - principal_context_agent_test - INFO - Loaded 4 principal profiles in principal_profiles_by_id dictionary
2025-09-02 12:06:47,444 - principal_context_agent_test - INFO - Keys in principal_profiles_by_id: ['cfo_001', 'ceo_001', 'coo_001', 'finance_manager_001']
2025-09-02 12:06:47,444 - principal_context_agent_test - INFO - Available roles in principal_profiles: ['Chief Financial Officer', 'chief financial officer', 'Chief Executive Officer', 'chief executive officer', 'Chief Operating Officer', 'chief operating officer', 'Finance Manager', 'finance manager']
2025-09-02 12:06:47,445 - principal_context_agent_test - INFO - Sample profile for Chief Financial Officer:
2025-09-02 12:06:47,447 - principal_context_agent_test - INFO -   id: cfo_001
2025-09-02 12:06:47,448 - principal_context_agent_test - INFO -   role: Chief Financial Officer
2025-09-02 12:06:47,448 - principal_context_agent_test - INFO -   name: Lars Mikkelsen
2025-09-02 12:06:47,449 - principal_context_agent_test - INFO -   title: Chief Financial Officer
2025-09-02 12:06:47,451 - principal_context_agent_test - INFO -   business_processes: ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals']
2025-09-02 12:06:47,453 - principal_context_agent_test - INFO -   default_filters: {'profit_center_hierarchyid': ['Total'], 'customer_hierarchyid': ['Total']}
2025-09-02 12:06:47,455 - principal_context_agent_test - INFO -   decision_style: Analytical
2025-09-02 12:06:47,456 - principal_context_agent_test - INFO -   communication_style: Concise
2025-09-02 12:06:47,458 - principal_context_agent_test - INFO -   description: CFO responsible for financial performance in EMEA.
2025-09-02 12:06:47,459 - principal_context_agent_test - INFO -   timeframes: []
2025-09-02 12:06:47,460 - principal_context_agent_test - INFO - Inspecting _load_principal_profiles method
2025-09-02 12:06:47,493 - principal_context_agent_test - INFO - _load_principal_profiles method code:
    async def _load_principal_profiles(self):
        """Load principal profiles from registry."""
        try:
            # Try to get principal profiles from registry
            if not self._principal_provider:
                self.logger.warning("Principal profile provider not initialized")
                self._load_default_profiles()
                return
                
            # Get all profiles from the provider
            registry_data = self._principal_provider.get_all()
            self.logger.info(f"Loaded {len(registry_data) if registry_data else 0} principal profiles from registry")
            
            # Debug the registry data
            if not registry_data:
                self.logger.warning("No principal profiles found in registry")
                self._load_default_profiles()
                return
                
            if not isinstance(registry_data, list):
                self.logger.warning(f"Registry data is not a list: {type(registry_data)}")
                self._load_default_profiles()
                return
                
            # Debug: Log all profiles to see their structure
            for i, profile in enumerate(registry_data):
                self.logger.info(f"Profile {i}: id={getattr(profile, 'id', 'unknown')}, "
                                f"role={getattr(profile, 'role', 'unknown')}, "
                                f"title={getattr(profile, 'title', 'unknown')}, "
                                f"name={getattr(profile, 'name', 'unknown')}")
            
            # Convert to our internal dictionary format keyed by ID and role
            normalized_by_role = {}
            normalized_by_id = {}
            role_to_id = {}
            
            for principal in registry_data:
                # Use attribute access for Pydantic models instead of dictionary-style access
                principal_id = getattr(principal, 'id', None)
                role = getattr(principal, 'role', None)
                title = getattr(principal, 'title', None)
                
                self.logger.info(f"Processing principal: id={principal_id}, role={role}, title={title}")
                
                if not principal_id:
                    self.logger.warning(f"Principal missing ID: {getattr(principal, 'name', 'Unknown')} - {role or title}")
                    continue
                    
                # Create profile object
                profile = {
                    "id": principal_id,
                    "role": role or title,  # Use title as role if role is not available
                    "name": getattr(principal, 'name', None),
                    "title": title,
                    "business_processes": getattr(principal, 'business_processes', []),
                    "default_filters": getattr(principal, 'default_filters', {}),
                    "decision_style": getattr(getattr(principal, 'persona_profile', {}), 'decision_style', 'Analytical'),
                    "communication_style": getattr(getattr(principal, 'persona_profile', {}), 'communication_style', 'Concise'),
                    "description": getattr(principal, 'description', ''),
                    "timeframes": getattr(principal, 'typical_timeframes', [])
                }
                
                # Store by ID (primary index)
                normalized_by_id[principal_id] = profile
                self.logger.info(f"Added profile by ID: {principal_id}")
                
                # Store by role (secondary index for backward compatibility)
                if role:
                    # Store using exact role name
                    normalized_by_role[role] = profile
                    role_to_id[role] = principal_id
                    self.logger.info(f"Added profile by role (exact): {role}")
                    
                    # Also store using lowercase role name
                    role_lower = role.lower()
                    normalized_by_role[role_lower] = profile
                    role_to_id[role_lower] = principal_id
                    self.logger.info(f"Added profile by role (lowercase): {role_lower}")
                
                # Also store by title for additional lookup options
                if title:
                    # Store using exact title
                    normalized_by_role[title] = profile
                    role_to_id[title] = principal_id
                    self.logger.info(f"Added profile by title (exact): {title}")
                    
                    # Also store using lowercase title
                    title_lower = title.lower()
                    normalized_by_role[title_lower] = profile
                    role_to_id[title_lower] = principal_id
                    self.logger.info(f"Added profile by title (lowercase): {title_lower}")
            
            if normalized_by_id:
                self.principal_profiles = normalized_by_role
                self.principal_profiles_by_id = normalized_by_id
                self.role_to_id_map = role_to_id
                self.logger.info(f"Loaded {len(self.principal_profiles_by_id)} principal profiles by ID from registry")
                self.logger.info(f"Loaded {len(self.principal_profiles)} principal profiles by role from registry")
                self.logger.info(f"Available profile IDs: {list(self.principal_profiles_by_id.keys())}")
                self.logger.info(f"Available role keys: {list(self.principal_profiles.keys())}")
                return
            
            # Fallback to default profiles if no valid profiles were loaded
            self.logger.warning("No valid profiles found in registry, using defaults")
            self._load_default_profiles()
        except Exception as e:
            error_id = self._log_error("_load_principal_profiles", e)
            self._load_default_profiles()
            self.logger.warning(f"Using default profiles due to loading error {error_id}")

2025-09-02 12:06:47,526 - principal_context_agent_test - INFO - Available roles from agent: ['Chief Financial Officer', 'chief financial officer', 'Chief Executive Officer', 'chief executive officer', 'Chief Operating Officer', 'chief operating officer', 'Finance Manager', 'finance manager']
2025-09-02 12:06:47,529 - principal_context_agent_test - INFO - Testing with roles: ['Chief Financial Officer', 'chief financial officer', 'Chief Executive Officer']
2025-09-02 12:06:47,532 - principal_context_agent_test - INFO - 
Testing with role: Chief Financial Officer
2025-09-02 12:06:47,533 - principal_context_agent_test - INFO - Step 3: Testing fetch_principal_profile
2025-09-02 12:06:47,534 - principal_context_agent_test - INFO - === Testing fetch_principal_profile for role: Chief Financial Officer ===
2025-09-02 12:06:47,536 - principal_context_agent_test - INFO - Checking if 'Chief Financial Officer' exists in principal_profiles_by_id
2025-09-02 12:06:47,538 - principal_context_agent_test - INFO - Calling fetch_principal_profile for 'Chief Financial Officer'
2025-09-02 12:06:47,542 - principal_context_agent_test - INFO - Successfully fetched profile for Chief Financial Officer:
2025-09-02 12:06:47,544 - principal_context_agent_test - INFO -   Profile type: <class 'dict'>
2025-09-02 12:06:47,546 - principal_context_agent_test - INFO -   Name: Lars Mikkelsen
2025-09-02 12:06:47,548 - principal_context_agent_test - INFO -   Title: Chief Financial Officer
2025-09-02 12:06:47,548 - principal_context_agent_test - INFO -   Business Processes: ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals']
2025-09-02 12:06:47,550 - principal_context_agent_test - INFO -   Default Filters: {'profit_center_hierarchyid': ['Total'], 'customer_hierarchyid': ['Total']}
2025-09-02 12:06:47,552 - principal_context_agent_test - INFO -   Decision Style: Analytical
2025-09-02 12:06:47,553 - principal_context_agent_test - INFO -   Communication Style: Concise
2025-09-02 12:06:47,555 - principal_context_agent_test - INFO -   Timeframes: []
2025-09-02 12:06:47,556 - principal_context_agent_test - INFO - Step 4: Testing get_principal_context
2025-09-02 12:06:47,557 - principal_context_agent_test - INFO - === Testing get_principal_context for role: Chief Financial Officer ===
2025-09-02 12:06:47,558 - principal_context_agent_test - INFO - Calling get_principal_context with role: Chief Financial Officer
2025-09-02 12:06:47,559 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: Chief Financial Officer
2025-09-02 12:06:47,560 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'Chief Financial Officer'
2025-09-02 12:06:47,564 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['Chief Financial Officer', 'chief financial officer', 'Chief Executive Officer', 'chief executive officer', 'Chief Operating Officer', 'chief operating officer', 'Finance Manager', 'finance manager']
2025-09-02 12:06:47,568 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['Chief Financial Officer', 'chief financial officer', 'CHIEF FINANCIAL OFFICER', 'CHIEF_FINANCIAL_OFFICER', 'chief_financial_officer', 'cfo', 'CFO']
2025-09-02 12:06:47,572 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'Chief Financial Officer'
2025-09-02 12:06:47,575 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: Chief Financial Officer
2025-09-02 12:06:47,577 - principal_context_agent_test - ERROR - Error testing get_principal_context: 'str' object is not a mapping
2025-09-02 12:06:47,579 - principal_context_agent_test - INFO - Could not get context for Chief Financial Officer, continuing with next tests
2025-09-02 12:06:47,586 - principal_context_agent_test - INFO - 
Testing with role: chief financial officer
2025-09-02 12:06:47,588 - principal_context_agent_test - INFO - Step 3: Testing fetch_principal_profile
2025-09-02 12:06:47,589 - principal_context_agent_test - INFO - === Testing fetch_principal_profile for role: chief financial officer ===
2025-09-02 12:06:47,591 - principal_context_agent_test - INFO - Checking if 'chief financial officer' exists in principal_profiles_by_id
2025-09-02 12:06:47,592 - principal_context_agent_test - INFO - Calling fetch_principal_profile for 'chief financial officer'
2025-09-02 12:06:47,594 - principal_context_agent_test - INFO - Successfully fetched profile for chief financial officer:
2025-09-02 12:06:47,594 - principal_context_agent_test - INFO -   Profile type: <class 'dict'>
2025-09-02 12:06:47,596 - principal_context_agent_test - INFO -   Name: Lars Mikkelsen
2025-09-02 12:06:47,598 - principal_context_agent_test - INFO -   Title: Chief Financial Officer
2025-09-02 12:06:47,602 - principal_context_agent_test - INFO -   Business Processes: ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals']
2025-09-02 12:06:47,606 - principal_context_agent_test - INFO -   Default Filters: {'profit_center_hierarchyid': ['Total'], 'customer_hierarchyid': ['Total']}
2025-09-02 12:06:47,608 - principal_context_agent_test - INFO -   Decision Style: Analytical
2025-09-02 12:06:47,610 - principal_context_agent_test - INFO -   Communication Style: Concise
2025-09-02 12:06:47,611 - principal_context_agent_test - INFO -   Timeframes: []
2025-09-02 12:06:47,612 - principal_context_agent_test - INFO - Step 4: Testing get_principal_context
2025-09-02 12:06:47,613 - principal_context_agent_test - INFO - === Testing get_principal_context for role: chief financial officer ===
2025-09-02 12:06:47,614 - principal_context_agent_test - INFO - Calling get_principal_context with role: chief financial officer
2025-09-02 12:06:47,615 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: chief financial officer
2025-09-02 12:06:47,617 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'chief financial officer'
2025-09-02 12:06:47,619 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['Chief Financial Officer', 'chief financial officer', 'Chief Executive Officer', 'chief executive officer', 'Chief Operating Officer', 'chief operating officer', 'Finance Manager', 'finance manager']
2025-09-02 12:06:47,621 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['chief financial officer', 'CHIEF FINANCIAL OFFICER', 'CHIEF_FINANCIAL_OFFICER', 'Chief Financial Officer', 'chief_financial_officer', 'cfo', 'CFO']
2025-09-02 12:06:47,624 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'chief financial officer'
2025-09-02 12:06:47,626 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: chief financial officer
2025-09-02 12:06:47,627 - principal_context_agent_test - ERROR - Error testing get_principal_context: 'str' object is not a mapping
2025-09-02 12:06:47,628 - principal_context_agent_test - INFO - Could not get context for chief financial officer, continuing with next tests
2025-09-02 12:06:47,630 - principal_context_agent_test - INFO - 
Testing with role: Chief Executive Officer
2025-09-02 12:06:47,631 - principal_context_agent_test - INFO - Step 3: Testing fetch_principal_profile
2025-09-02 12:06:47,632 - principal_context_agent_test - INFO - === Testing fetch_principal_profile for role: Chief Executive Officer ===
2025-09-02 12:06:47,633 - principal_context_agent_test - INFO - Checking if 'Chief Executive Officer' exists in principal_profiles_by_id
2025-09-02 12:06:47,635 - principal_context_agent_test - INFO - Calling fetch_principal_profile for 'Chief Executive Officer'
2025-09-02 12:06:47,639 - principal_context_agent_test - INFO - Successfully fetched profile for Chief Executive Officer:
2025-09-02 12:06:47,642 - principal_context_agent_test - INFO -   Profile type: <class 'dict'>
2025-09-02 12:06:47,643 - principal_context_agent_test - INFO -   Name: Alex Morgan
2025-09-02 12:06:47,644 - principal_context_agent_test - INFO -   Title: Chief Executive Officer
2025-09-02 12:06:47,645 - principal_context_agent_test - INFO -   Business Processes: ['Finance: Profitability Analysis', 'Finance: Revenue Growth Analysis', 'Finance: Expense Management', 'Finance: Cash Flow Management', 'Finance: Budget vs. Actuals']
2025-09-02 12:06:47,646 - principal_context_agent_test - INFO -   Default Filters: {'profit_center_hierarchyid': ['#']}
2025-09-02 12:06:47,647 - principal_context_agent_test - INFO -   Decision Style: Analytical
2025-09-02 12:06:47,648 - principal_context_agent_test - INFO -   Communication Style: Concise
2025-09-02 12:06:47,650 - principal_context_agent_test - INFO -   Timeframes: []
2025-09-02 12:06:47,650 - principal_context_agent_test - INFO - Step 4: Testing get_principal_context
2025-09-02 12:06:47,651 - principal_context_agent_test - INFO - === Testing get_principal_context for role: Chief Executive Officer ===
2025-09-02 12:06:47,652 - principal_context_agent_test - INFO - Calling get_principal_context with role: Chief Executive Officer
2025-09-02 12:06:47,654 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: Chief Executive Officer
2025-09-02 12:06:47,656 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'Chief Executive Officer'
2025-09-02 12:06:47,660 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['Chief Financial Officer', 'chief financial officer', 'Chief Executive Officer', 'chief executive officer', 'Chief Operating Officer', 'chief operating officer', 'Finance Manager', 'finance manager']
2025-09-02 12:06:47,661 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['Chief Executive Officer', 'chief executive officer', 'CHIEF EXECUTIVE OFFICER', 'CHIEF_EXECUTIVE_OFFICER', 'chief_executive_officer', 'ceo', 'CEO']
2025-09-02 12:06:47,663 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'Chief Executive Officer'
2025-09-02 12:06:47,663 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: Chief Executive Officer
2025-09-02 12:06:47,666 - principal_context_agent_test - ERROR - Error testing get_principal_context: 'str' object is not a mapping
2025-09-02 12:06:47,666 - principal_context_agent_test - INFO - Could not get context for Chief Executive Officer, continuing with next tests
2025-09-02 12:06:47,668 - principal_context_agent_test - INFO - 
Step 5: Testing case-insensitive profile lookup
2025-09-02 12:06:47,669 - principal_context_agent_test - INFO - === Testing case-insensitive profile lookup ===
2025-09-02 12:06:47,670 - principal_context_agent_test - INFO - Testing lookup with role format: 'CFO'
2025-09-02 12:06:47,671 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: CFO
2025-09-02 12:06:47,677 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'CFO'
2025-09-02 12:06:47,678 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['Chief Financial Officer', 'chief financial officer', 'Chief Executive Officer', 'chief executive officer', 'Chief Operating Officer', 'chief operating officer', 'Finance Manager', 'finance manager']
2025-09-02 12:06:47,680 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['CFO', 'cfo', 'Cfo', 'Chief Financial Officer']
2025-09-02 12:06:47,682 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'Chief Financial Officer'
2025-09-02 12:06:47,683 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: CFO
2025-09-02 12:06:47,726 - principal_context_agent_test - INFO - Testing lookup with role format: 'cfo'
2025-09-02 12:06:47,727 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: cfo
2025-09-02 12:06:47,728 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'cfo'
2025-09-02 12:06:47,735 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['Chief Financial Officer', 'chief financial officer', 'Chief Executive Officer', 'chief executive officer', 'Chief Operating Officer', 'chief operating officer', 'Finance Manager', 'finance manager']
2025-09-02 12:06:47,737 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['cfo', 'CFO', 'Cfo', 'Chief Financial Officer']
2025-09-02 12:06:47,739 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'Chief Financial Officer'
2025-09-02 12:06:47,741 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: cfo
2025-09-02 12:06:47,783 - principal_context_agent_test - INFO - Testing lookup with role format: 'Cfo'
2025-09-02 12:06:47,787 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: Cfo
2025-09-02 12:06:47,790 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'Cfo'
2025-09-02 12:06:47,792 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['Chief Financial Officer', 'chief financial officer', 'Chief Executive Officer', 'chief executive officer', 'Chief Operating Officer', 'chief operating officer', 'Finance Manager', 'finance manager']
2025-09-02 12:06:47,797 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['Cfo', 'cfo', 'CFO', 'Chief Financial Officer']
2025-09-02 12:06:47,799 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'Chief Financial Officer'
2025-09-02 12:06:47,800 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: Cfo
2025-09-02 12:06:47,820 - principal_context_agent_test - INFO - Testing lookup with role format: 'FINANCE_MANAGER'
2025-09-02 12:06:47,822 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: FINANCE_MANAGER
2025-09-02 12:06:47,823 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'FINANCE_MANAGER'
2025-09-02 12:06:47,825 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['Chief Financial Officer', 'chief financial officer', 'Chief Executive Officer', 'chief executive officer', 'Chief Operating Officer', 'chief operating officer', 'Finance Manager', 'finance manager']
2025-09-02 12:06:47,826 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['FINANCE_MANAGER', 'finance_manager', 'Finance Manager', 'finance manager']
2025-09-02 12:06:47,835 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'Finance Manager'
2025-09-02 12:06:47,837 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: FINANCE_MANAGER
2025-09-02 12:06:47,839 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Mapped role directly to enum: Finance Manager -> PrincipalRole.FINANCE_MANAGER
2025-09-02 12:06:47,873 - principal_context_agent_test - INFO - Testing lookup with role format: 'Finance Manager'
2025-09-02 12:06:47,874 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: Finance Manager
2025-09-02 12:06:47,875 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'Finance Manager'
2025-09-02 12:06:47,876 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['Chief Financial Officer', 'chief financial officer', 'Chief Executive Officer', 'chief executive officer', 'Chief Operating Officer', 'chief operating officer', 'Finance Manager', 'finance manager']
2025-09-02 12:06:47,880 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['Finance Manager', 'finance manager', 'FINANCE MANAGER', 'FINANCE_MANAGER', 'finance_manager']
2025-09-02 12:06:47,882 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'Finance Manager'
2025-09-02 12:06:47,884 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: Finance Manager
2025-09-02 12:06:47,886 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Mapped role directly to enum: Finance Manager -> PrincipalRole.FINANCE_MANAGER
2025-09-02 12:06:47,941 - principal_context_agent_test - INFO - Testing lookup with role format: 'finance manager'
2025-09-02 12:06:47,942 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: finance manager
2025-09-02 12:06:47,943 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'finance manager'
2025-09-02 12:06:47,944 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['Chief Financial Officer', 'chief financial officer', 'Chief Executive Officer', 'chief executive officer', 'Chief Operating Officer', 'chief operating officer', 'Finance Manager', 'finance manager']
2025-09-02 12:06:47,947 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['finance manager', 'FINANCE MANAGER', 'FINANCE_MANAGER', 'Finance Manager', 'finance_manager']
2025-09-02 12:06:47,948 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile with key: 'finance manager'
2025-09-02 12:06:47,949 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Found profile by role: finance manager
2025-09-02 12:06:47,951 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Mapped role directly to enum: Finance Manager -> PrincipalRole.FINANCE_MANAGER
2025-09-02 12:06:47,976 - principal_context_agent_test - INFO - Testing lookup with non-existent role: 'INVALID_ROLE'
2025-09-02 12:06:47,977 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile by role: INVALID_ROLE
2025-09-02 12:06:47,979 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Looking up profile with case-insensitive search for: 'INVALID_ROLE'
2025-09-02 12:06:47,980 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profile keys: ['Chief Financial Officer', 'chief financial officer', 'Chief Executive Officer', 'chief executive officer', 'Chief Operating Officer', 'chief operating officer', 'Finance Manager', 'finance manager']
2025-09-02 12:06:47,983 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Trying variations: ['INVALID_ROLE', 'invalid_role', 'Invalid Role']
2025-09-02 12:06:47,985 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - WARNING - Principal profile not found for any variation of: 'INVALID_ROLE'
2025-09-02 12:06:47,987 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - DEBUG - Available profiles: ['Chief Financial Officer', 'Chief Financial Officer', 'Chief Executive Officer', 'Chief Executive Officer', 'Chief Operating Officer', 'Chief Operating Officer', 'Finance Manager', 'Finance Manager']
2025-09-02 12:06:47,990 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - WARNING - Principal profile not found for role: INVALID_ROLE
2025-09-02 12:06:47,992 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Using default principal ID: default_id
2025-09-02 12:06:47,994 - principal_context_agent_test - ERROR - Error testing non-existent role: 'str' object is not a mapping
2025-09-02 12:06:47,994 - principal_context_agent_test - INFO - 
Step 6: Testing extract_filters
2025-09-02 12:06:47,994 - principal_context_agent_test - INFO - === Testing extract_filters ===
2025-09-02 12:06:47,996 - src.agents.a9_principal_context_agent.A9_Principal_Context_Agent - INFO - Extracting filters from description: 
    Analyze the Q2 financial performance for the ...
2025-09-02 12:06:47,998 - principal_context_agent_test - INFO - Response status: success
2025-09-02 12:06:47,999 - principal_context_agent_test - INFO - Response message: Extracted 1 filters from description
2025-09-02 12:06:47,999 - principal_context_agent_test - INFO - Extracted filters: {'region': ['North America']}
2025-09-02 12:06:47,999 - principal_context_agent_test - INFO - Extracted filter objects: [{'dimension': 'region', 'value': 'North America', 'confidence': 0.8, 'extraction_method': 'rule_based'}]
2025-09-02 12:06:47,999 - principal_context_agent_test - INFO - All tests completed successfully
