  - id: other_operating_expense
    name: "Other Operating Expense"
    domain: "Finance"
    description: "Total other operating expense."
    unit: "$"
    data_product_id: "FI_Star_Schema"
    view_name: "FI_Star_View"
    business_process_ids:
      - "finance_expense_management"
      - "finance_miscellaneous_expense"
    filters:
      "Account Hierarchy Desc": "Other Operating Expense"
    sql_query: "SELECT SUM(value) FROM sap.FinancialTransactions JOIN sap.GLAccounts ON FinancialTransactions.account_id = GLAccounts.account_id WHERE GLAccounts.account_hierarchy_desc = 'Other Operating Expense'"
    thresholds:
      - comparison_type: "mom"
        green_threshold: -0.05
        yellow_threshold: 0.0
        red_threshold: 0.10
        inverse_logic: true
    dimensions:
      - name: "Profit Center"
        field: "profit_center"
        description: "Business profit center"
    tags:
      - "expense"
      - "financial"
    owner_role: "Finance Manager"
    stakeholder_roles:
      - "Finance Manager"

  - id: net_revenue
    name: "Net Revenue"
    domain: "Finance"
    description: "Total net revenue (Gross Revenue - Sales Deductions)."
    unit: "$"
    data_product_id: "FI_Star_Schema"
    view_name: "FI_Star_View"
    business_process_ids:
      - "finance_revenue_growth_analysis"
      - "finance_profitability_analysis"
    filters:
      "Parent Account/Group Description": "Net Revenue"
    sql_query: "SELECT SUM(value) FROM sap.FinancialTransactions JOIN sap.GLAccounts ON FinancialTransactions.account_id = GLAccounts.account_id LEFT JOIN sap.GLAccountsHierarchy gah ON GLAccounts.account_id = gah.HIERARCHYID LEFT JOIN sap.GLAccountsHierarchy gah_parent ON gah.LEVEL = gah_parent.HIERARCHYID WHERE gah_parent.DESCRIPTION = 'Net Revenue'"
    thresholds:
      - comparison_type: "yoy"
        green_threshold: 0.10
        yellow_threshold: 0.0
        red_threshold: -0.05
        inverse_logic: false
    dimensions:
      - name: "Profit Center"
        field: "profit_center"
        description: "Business profit center"
    tags:
      - "revenue"
      - "financial"
    owner_role: "CFO"
    stakeholder_roles:
      - "CFO"
      - "CEO"

  - id: operating_income
    name: "Operating Income"
    domain: "Finance"
    description: "Operating Income."
    unit: "$"
    data_product_id: "FI_Star_Schema"
    view_name: "FI_Star_View"
    business_process_ids:
      - "finance_profitability_analysis"
    filters:
      # Calculated: Net Revenue (Parent) + COGS (Leaf) - OpExp (Grandparent -> Building/Employee Parents + Other Leaf)
      # Assuming all values aggregate correctly
      "Calculated_Filter": "Operating Income"
    sql_query: "SELECT SUM(value) FROM sap.FinancialTransactions JOIN sap.GLAccounts ON FinancialTransactions.account_id = GLAccounts.account_id LEFT JOIN sap.GLAccountsHierarchy gah ON GLAccounts.account_id = gah.HIERARCHYID LEFT JOIN sap.GLAccountsHierarchy gah_parent ON gah.LEVEL = gah_parent.HIERARCHYID WHERE gah_parent.DESCRIPTION IN ('Net Revenue', 'Building Expense', 'Employee Expense') OR GLAccounts.account_hierarchy_desc IN ('Cost of Goods Sold', 'Other Operating Expense')"
    thresholds:
      - comparison_type: "yoy"
        green_threshold: 0.10
        yellow_threshold: 0.0
        red_threshold: -0.05
        inverse_logic: false
    dimensions:
      - name: "Profit Center"
        field: "profit_center"
        description: "Business profit center"
    tags:
      - "profitability"
      - "financial"
    owner_role: "CFO"
    stakeholder_roles:
      - "CFO"
      - "CEO"

  - id: operating_expense
    name: "Operating Expense"
    domain: "Finance"
    description: "Total Operating Expense."
    unit: "$"
    data_product_id: "FI_Star_Schema"
    view_name: "FI_Star_View"
    business_process_ids:
      - "finance_expense_management"
    filters:
      # Calculated: Building/Employee (Parents) + Other (Leaf)
      "Calculated_Filter": "Operating Expense"
    sql_query: "SELECT SUM(value) FROM sap.FinancialTransactions JOIN sap.GLAccounts ON FinancialTransactions.account_id = GLAccounts.account_id LEFT JOIN sap.GLAccountsHierarchy gah ON GLAccounts.account_id = gah.HIERARCHYID LEFT JOIN sap.GLAccountsHierarchy gah_parent ON gah.LEVEL = gah_parent.HIERARCHYID WHERE gah_parent.DESCRIPTION IN ('Building Expense', 'Employee Expense') OR GLAccounts.account_hierarchy_desc = 'Other Operating Expense'"
    thresholds:
      - comparison_type: "mom"
        green_threshold: -0.05
        yellow_threshold: 0.0
        red_threshold: 0.10
        inverse_logic: true
    dimensions:
      - name: "Profit Center"
        field: "profit_center"
        description: "Business profit center"
    tags:
      - "expense"
      - "financial"
    owner_role: "CFO"
    stakeholder_roles:
      - "CFO"
      - "Finance Manager"

  - id: building_expense
    name: "Building Expense"
    domain: "Finance"
    description: "Total Building Expense (includes Periodic & Utilities)."
    unit: "$"
    data_product_id: "FI_Star_Schema"
    view_name: "FI_Star_View"
    business_process_ids:
      - "finance_expense_management"
      - "finance_facilities_management"
    filters:
      "Parent Account/Group Description": "Building Expense"
    sql_query: "SELECT SUM(value) FROM sap.FinancialTransactions JOIN sap.GLAccounts ON FinancialTransactions.account_id = GLAccounts.account_id LEFT JOIN sap.GLAccountsHierarchy gah ON GLAccounts.account_id = gah.HIERARCHYID LEFT JOIN sap.GLAccountsHierarchy gah_parent ON gah.LEVEL = gah_parent.HIERARCHYID WHERE gah_parent.DESCRIPTION = 'Building Expense'"
    thresholds:
      - comparison_type: "mom"
        green_threshold: -0.05
        yellow_threshold: 0.0
        red_threshold: 0.10
        inverse_logic: true
    dimensions:
      - name: "Profit Center"
        field: "profit_center"
        description: "Business profit center"
    tags:
      - "expense"
      - "facilities"
      - "financial"
    owner_role: "Finance Manager"
    stakeholder_roles:
      - "Finance Manager"
      - "COO"

  - id: employee_expense
    name: "Employee Expense"
    domain: "Finance"
    description: "Total Employee Expense (includes Payroll, Travel, Office, Other)."
    unit: "$"
    data_product_id: "FI_Star_Schema"
    view_name: "FI_Star_View"
    business_process_ids:
      - "finance_expense_management"
      - "finance_human_resources"
    filters:
      "Parent Account/Group Description": "Employee Expense"
    sql_query: "SELECT SUM(value) FROM sap.FinancialTransactions JOIN sap.GLAccounts ON FinancialTransactions.account_id = GLAccounts.account_id LEFT JOIN sap.GLAccountsHierarchy gah ON GLAccounts.account_id = gah.HIERARCHYID LEFT JOIN sap.GLAccountsHierarchy gah_parent ON gah.LEVEL = gah_parent.HIERARCHYID WHERE gah_parent.DESCRIPTION = 'Employee Expense'"
    thresholds:
      - comparison_type: "mom"
        green_threshold: -0.05
        yellow_threshold: 0.0
        red_threshold: 0.10
        inverse_logic: true
    dimensions:
      - name: "Profit Center"
        field: "profit_center"
        description: "Business profit center"
    tags:
      - "expense"
      - "hr"
      - "financial"
    owner_role: "Finance Manager"
    stakeholder_roles:
      - "Finance Manager"
      - "CHRO"

  - id: net_income
    name: "Net Income"
    domain: "Finance"
    description: "Net Income."
    unit: "$"
    data_product_id: "FI_Star_Schema"
    view_name: "FI_Star_View"
    business_process_ids:
      - "finance_profitability_analysis"
      - "finance_investor_relations_reporting"
    filters:
      # Same as Operating Income for MVP
      "Calculated_Filter": "Net Income"
    sql_query: "SELECT SUM(value) FROM sap.FinancialTransactions JOIN sap.GLAccounts ON FinancialTransactions.account_id = GLAccounts.account_id LEFT JOIN sap.GLAccountsHierarchy gah ON GLAccounts.account_id = gah.HIERARCHYID LEFT JOIN sap.GLAccountsHierarchy gah_parent ON gah.LEVEL = gah_parent.HIERARCHYID WHERE gah_parent.DESCRIPTION IN ('Net Revenue', 'Building Expense', 'Employee Expense') OR GLAccounts.account_hierarchy_desc IN ('Cost of Goods Sold', 'Other Operating Expense')"
    thresholds:
      - comparison_type: "yoy"
        green_threshold: 0.10
        yellow_threshold: 0.0
        red_threshold: -0.05
        inverse_logic: false
    dimensions:
      - name: "Profit Center"
        field: "profit_center"
        description: "Business profit center"
    tags:
      - "profitability"
      - "financial"
      - "bottom_line"
    owner_role: "CFO"
    stakeholder_roles:
      - "CFO"
      - "CEO"
      - "Investors"

  - id: earnings_before_interest_and_taxes
    name: "Earnings Before Interest & Taxes"
    domain: "Finance"
    description: "Earnings Before Interest & Taxes (EBIT)."
    unit: "$"
    data_product_id: "FI_Star_Schema"
    view_name: "FI_Star_View"
    business_process_ids:
      - "finance_profitability_analysis"
      - "strategy_ebitda_growth_tracking"
    filters:
      # Same as Operating Income for MVP
      "Calculated_Filter": "EBIT"
    sql_query: "SELECT SUM(value) FROM sap.FinancialTransactions JOIN sap.GLAccounts ON FinancialTransactions.account_id = GLAccounts.account_id LEFT JOIN sap.GLAccountsHierarchy gah ON GLAccounts.account_id = gah.HIERARCHYID LEFT JOIN sap.GLAccountsHierarchy gah_parent ON gah.LEVEL = gah_parent.HIERARCHYID WHERE gah_parent.DESCRIPTION IN ('Net Revenue', 'Building Expense', 'Employee Expense') OR GLAccounts.account_hierarchy_desc IN ('Cost of Goods Sold', 'Other Operating Expense')"
    thresholds:
      - comparison_type: "yoy"
        green_threshold: 0.10
        yellow_threshold: 0.0
        red_threshold: -0.05
        inverse_logic: false
    dimensions:
      - name: "Profit Center"
        field: "profit_center"
        description: "Business profit center"
    tags:
      - "profitability"
      - "financial"
      - "ebit"
    synonyms:
      - "EBIT"
    owner_role: "CFO"
    stakeholder_roles:
      - "CFO"
      - "CEO"

  - id: depreciation
    name: "Depreciation"
    domain: "Finance"
    description: "Depreciation."
    unit: "$"
    data_product_id: "FI_Star_Schema"
    view_name: "FI_Star_View"
    business_process_ids:
      - "finance_expense_management"
      - "finance_cash_flow_management"
    filters:
      "Account Hierarchy Desc": "Depreciation"
    sql_query: "SELECT SUM(value) FROM sap.FinancialTransactions JOIN sap.GLAccounts ON FinancialTransactions.account_id = GLAccounts.account_id WHERE GLAccounts.account_hierarchy_desc = 'Depreciation'"
    thresholds:
      - comparison_type: "mom"
        green_threshold: -0.05
        yellow_threshold: 0.0
        red_threshold: 0.10
        inverse_logic: true
    dimensions:
      - name: "Profit Center"
        field: "profit_center"
        description: "Business profit center"
    tags:
      - "expense"
      - "financial"
      - "cash_flow"
    owner_role: "CFO"
    stakeholder_roles:
      - "CFO"
      - "Finance Manager"

  - id: cash_flow_from_operating_activities
    name: "Cash Flow from Operating Activities"
    domain: "Finance"
    description: "Cash Flow from Operating Activities (CFO)."
    unit: "$"
    data_product_id: "FI_Star_Schema"
    view_name: "FI_Star_View"
    business_process_ids:
      - "finance_cash_flow_management"
    filters:
      "Parent Account/Group Description": "Cash Flow from Operating Activities (CFO)"
    sql_query: "SELECT SUM(value) FROM sap.FinancialTransactions JOIN sap.GLAccounts ON FinancialTransactions.account_id = GLAccounts.account_id LEFT JOIN sap.GLAccountsHierarchy gah ON GLAccounts.account_id = gah.HIERARCHYID LEFT JOIN sap.GLAccountsHierarchy gah_parent ON gah.LEVEL = gah_parent.HIERARCHYID WHERE gah_parent.DESCRIPTION = 'Cash Flow from Operating Activities (CFO)'"
    thresholds:
      - comparison_type: "yoy"
        green_threshold: 0.10
        yellow_threshold: 0.0
        red_threshold: -0.05
        inverse_logic: false
    dimensions:
      - name: "Profit Center"
        field: "profit_center"
        description: "Business profit center"
    tags:
      - "cash_flow"
      - "financial"
    synonyms:
      - "CFO"
      - "Operating Cash Flow"
    owner_role: "CFO"
    stakeholder_roles:
      - "CFO"
      - "CEO"
